{"version":3,"sources":["wscbundle.js"],"names":["window","envTypes","node","browser","env","glob","global","WEBSPELLCHECKER","module","exports","init","Namespace","ArrayUtils","arrayUnique","array","comparisonFunc","a","concat","b","i","length","j","splice","argumentsToArray","args","len","resultArray","Array","zipArraysToObject","keysArr","valuesArr","resultObject","diffArrays","base","comparable","result","comparableLength","indexOf","push","Utils","StringUtils","string","startIndex","insertString","substring","replaceFromTo","from","to","Browser","agent","navigator","userAgent","toLowerCase","edge","match","trident","ie","opera","version","webkit","air","mac","quirks","document","compatMode","documentMode","mobile","iOS","test","gecko","product","chrome","safari","parseFloat","geckoRelease","split","Object","assign","target","varArgs","TypeError","index","arguments","nextSource","nextKey","prototype","hasOwnProperty","call","create","Temp","O","obj","Properties","prop","keys","hasDontEnumBug","toString","propertyIsEnumerable","dontEnums","dontEnumsLength","Function","bind","oThis","aArgs","slice","fToBind","fNOP","fBound","apply","String","trim","replace","searchElement","fromIndex","k","o","n","Math","max","abs","filter","fun","t","res","thisArg","val","isArray","arg","map","callback","T","A","kValue","mappedValue","includes","reduce","value","forEach","parseInt","currentElement","TypeChecker","isString","notEmptyString","isHash","isObject","isFunction","isBoolean","isDate","Date","isDefined","undefined","isEmpty","attr","EMPTY_STRING_REGEXP","isInteger","isNumber","isNaN","isPositive","RegularsSources","space","commonSpace","quotes","nonWhiteSpaceChar","dot","anyChar","comma","EOL","digits","HtmlSpaceSymbol","fromCharCode","textPunctuation","situationalSeparators","sentenceEndChars","specialCharacters","ip","twoAndMore","whiteSpace","methods","JSON","stringify","console","trigger","logger","isON","state","location","hash","isIE","log","data","options","message","name","msg","join","isMocked","mockParams","IO","XMLHttpRequest","XDomainRequest","URL","params","_protocol","protocol","_host","host","_port","port","_path","path","request_params","request_meta_params","addParameter","addParameters","parameters","param","addMetaParameters","getParameter","joinParams","encodeURIComponent","joinRequestParams","joinRequestMetaParams","joinUrl","urlString","joinUrlWithParams","paramsString","joinUrlWithMetadata","build","clear","AJAX","ajax","parse","success","setTimeout","onSuccess","error","onError","finished","url","request","withCredentials","warn","onload","responseData","responseText","responseStatus","status","onerror","onabort","open","send","JSONP","callbackName","random","substr","callbackFunctionPath","Script","id","NODE","metaParams","client","require","requestOptions","hostname","method","headers","response","statusCode","body","on","chunk","write","end","self","head","registerCallback","removeCallback","removeAll","removeScript","script","createElement","onreadystatechange","readyState","getElementsByTagName","appendChild","getScript","removeChild","get","loadScript","cache","ioMockStart","ioMockEnd","requestTypes","setRequestType","type","requestType","removeSetBrackets","RegularType","source","flags","regExp","_wrapSymbol","_getRegExp","regExpFlags","RegExp","_combine","regExpObject","Error","separator","nameSeparator","compositionName","combainRegType","addFlags","_replaceWithAnotherSource","subStr","clone","_updateSource","getString","getLastIndex","lastIndex","setLastIndex","flagsArr","flag","g","set","group","start","onePlus","more","leftWordBoundary","rightWordBoundary","wrapWordBoundary","lookahead","search","replaceLeftWrapped","wrapSymbol","replaceRightWrapped","wrapInclude","composition","or","compositionGraph","listOfRegExpObjects","compositionObj","element","store","RegularsManager","addRegularType","wrap","validators","OptionType","typeData","validate","erroMessageTemplate","constructor","createErrorMessage","optionName","ErrorsObject","critical","count","reports","addError","OptionsObject","_validatedFields","deepClone","addOption","option","_createOptionValue","optionData","optionValue","optionTemplate","template","errorReport","optionErrorHandler","errorHandler","validated","defaultValue","required","OptionsTemplate","getDefaultValue","setDefaults","defaults","OptionsManager","optionTypes","optionsTemplate","optionsValidators","boolean","date","defined","empty","integer","positive","number","object","urlProtocol","urlHost","urlPort","urlPath","createOptions","clientOptions","errorsHandler","valid","errorsObject","importOptionsTemplate","extendOptionTypes","exportOptionsTemplate","templateName","mergeOptionsTemplates","el","lang","serviceProtocol","serviceHost","servicePort","servicePath","serviceId","userDictionaryName","customDictionaryIds","minWordLength","communicationFormat","customPunctuation","appType","WebApi","isErrorsCritical","connection","_services","_options","errors","report","_dependencies","TextProcessor","Connection","_commands","getCommands","_udActions","getUdActions","_getService","_request","_makeUdAction","actionName","getOption","requestparameters","command","userDictionary","UDAction","UDName","newUDName","newName","wordList","UDWord","word","_udMethodWrapper","responseInfo","ud","UserDictionary","wordlist","modificationTime","makeUdAction","setOption","getInfo","getLangList","spellCheck","_parameters","words","getWordsFromString","text","wordsCollection","addOffsetsToMisspelled","offsets","misspelled","prev","offsetsObj","misspelledsWithOffsets","wordsOffsets","language","userWordlist","customDictionary","grammarCheck","sentences","getUserDictionary","createUserDictionary","deleteUserDictionary","renameUserDictionary","addWordToUserDictionary","deleteWordFromUserDictionary","getDictionariesModifyTime","_action","addWord","deleteWord","rename","getWordList","initWebApi","moduleId","appInstance","replaceSepatators","_situationalSepSetGlob","punctuationRegExp","removeSpecialCharacters","getWordOffsets","startOffset","endOffset","wordObject","_parametersMap","removeUDCookie","outType","_commandsMap","_UDActionsMap","check","getDict","defaultParameters","paramsNames","storage","getURL","prepareParameters","paramName","defaultMetaParameters","signals","f","c","h","d","_listener","_isOnce","context","_signal","_priority","e","_bindings","_prevParams","dispatch","active","execute","detach","isBound","remove","isOnce","getListener","getSignal","_destroy","VERSION","memorize","_shouldPropagate","_registerListener","_indexOfListener","_addBinding","has","add","addOnce","getNumListeners","halt","forget","dispose","Signal","rangy","OBJECT","FUNCTION","UNDEFINED","domRangeProperties","domRangeMethods","textRangeProperties","textRangeMethods","isHostMethod","p","isHostObject","isHostProperty","createMultiplePropertyTest","testFunc","props","areHostMethods","areHostObjects","areHostProperties","isTextRange","range","getBody","doc","arr","func","modules","isBrowser","util","api","initialized","supported","features","config","alertOnFail","alertOnWarn","preferTextRange","autoInitialize","rangyAutoInitialize","consoleLog","alertOrLog","shouldAlert","alert","fail","reason","extend","deep","optionsParam","toArray","childNodes","nodeType","arrayLike","addListener","eventType","listener","addEventListener","attachEvent","initListeners","getErrorDesc","ex","description","testRange","implementsDomRange","implementsTextRange","createRange","nodeName","createTextRange","errorMessage","moduleName","Module","deprecationNotice","deprecated","replacement","createAliasForDeprecatedMethod","owner","addInitListener","shimListeners","addShimListener","shim","win","createMissingNativeApi","dependencies","initializer","requiredModuleNames","requiredModule","createError","createModule","initFunc","newModule","stack","createCoreModule","RangePrototype","rangePrototype","SelectionPrototype","selectionPrototype","UNDEF","textNode","createTextNode","arrayContains","isHtmlNamespace","ns","namespaceURI","parentElement","parent","parentNode","getNodeIndex","previousSibling","getNodeLength","getCommonAncestor","node1","node2","ancestors","isAncestorOf","ancestor","descendant","selfIsAncestor","isOrIsAncestorOf","getClosestAncestorIn","isCharacterDataNode","isTextOrCommentNode","insertAfter","precedingNode","nextNode","nextSibling","insertBefore","splitDataNode","positionsToPreserve","newNode","cloneNode","deleteData","position","offset","getDocument","ownerDocument","getWindow","defaultView","parentWindow","getIframeDocument","iframeEl","contentDocument","contentWindow","getIframeWindow","isWindow","getContentDocument","methodName","tagName","getRootContainer","comparePoints","nodeA","offsetA","nodeB","offsetB","nodeC","root","childA","childB","firstChild","crashyTextNodes","isBrokenNode","innerHTML","inspectNode","idAttr","fragmentFromNodeChildren","fragment","createDocumentFragment","child","getComputedStyleProperty","getComputedStyle","propName","documentElement","currentStyle","createTestElement","html","contentEditable","bodyFirstChild","removeNode","NodeIterator","_next","_current","hasNext","next","createIterator","DomPosition","equals","pos","inspect","DOMException","codeName","code","INDEX_SIZE_ERR","HIERARCHY_REQUEST_ERR","WRONG_DOCUMENT_ERR","NO_MODIFICATION_ALLOWED_ERR","NOT_FOUND_ERR","NOT_SUPPORTED_ERR","INVALID_STATE_ERR","INVALID_NODE_TYPE_ERR","dom","isNonTextPartiallySelected","startContainer","endContainer","getRangeDocument","getRangeRoot","getBoundaryBeforeNode","getBoundaryAfterNode","insertNodeAtPosition","firstNodeInserted","rangesIntersect","rangeA","rangeB","touchingIsIntersecting","assertRangeValid","startComparison","endComparison","cloneSubtree","iterator","partiallySelected","frag","subIterator","isPartiallySelectedSubtree","getSubtreeIterator","iterateSubtree","rangeIterator","iteratorState","it","stop","subRangeIterator","deleteSubtree","extractSubtree","getNodesInRange","nodeTypes","filterNodeTypes","regex","filterExists","nodes","RangeIterator","sc","ec","getName","clonePartiallySelectedTextNodes","collapsed","so","eo","commonAncestorContainer","isSingleCharacterDataNode","_first","_last","reset","current","subRange","cloneRange","collapse","Range","updateBoundaries","beforeAfterNodeTypes","rootContainerNodeTypes","readonlyNodeTypes","insertableNodeTypes","surroundNodeTypes","createAncestorFinder","getDocumentOrFragmentContainer","getReadonlyAncestor","getDocTypeNotationEntityAncestor","assertNoDocTypeNotationEntityAncestor","allowSelf","assertValidNodeType","invalidTypes","assertValidOffset","assertSameDocumentOrFragment","assertNodeNotReadOnly","assertNode","isValidOffset","isRangeValid","styleEl","htmlParsingConforms","createContextualFragment","fragmentStr","splitRangeBoundaries","startEndSame","setStartAndEnd","rangeToHtml","container","cloneContents","rangeProperties","s2s","s2e","e2e","e2s","n_b","n_a","n_b_a","n_i","compareBoundaryPoints","how","prefixA","prefixB","insertNode","setStartBefore","canSurroundContents","boundariesInvalid","surroundContents","content","extractContents","hasChildNodes","lastChild","selectNode","textParts","compareNode","nodeIndex","comparePoint","toHtml","intersectsNode","isPointInRange","intersectsRange","intersectsOrTouchesRange","intersection","intersectionRange","setStart","setEnd","union","unionRange","containsNode","allowPartial","containsNodeContents","containsRange","containsNodeText","nodeRange","textNodes","getNodes","lastTextNode","pop","collapseBefore","setEndBefore","collapseAfter","setStartAfter","getBookmark","containerNode","preSelectionRange","selectNodeContents","moveToBookmark","bookmark","charIndex","nodeStack","foundStart","nextCharIndex","rangesEqual","isValid","copyComparisonConstantsToObject","START_TO_START","START_TO_END","END_TO_END","END_TO_START","NODE_BEFORE","NODE_AFTER","NODE_BEFORE_AND_AFTER","NODE_INSIDE","copyComparisonConstants","createRangeContentRemover","remover","boundaryUpdater","boundary","returnValue","createPrototypeRange","createBeforeAfterNodeSetter","isBefore","isStart","setRangeStart","setRangeEnd","F","setBoundary","setEndAfter","deleteContents","splitBoundaries","splitBoundariesPreservingPositions","normalizeBoundaries","mergeForward","sibling","appendData","mergeBackward","nodeLength","insertData","normalizeStart","endNode","startNode","collapseToPoint","updateCollapsedAndCommonAncestor","r1","r2","DomRange","WrappedRange","WrappedTextRange","rangeProto","updateRangeProperties","nativeRange","updateNativeRange","startMoved","endMoved","nativeRangeDifferent","refresh","testTextNode","oppositeName","range2","createNativeRange","getTextRangeContainerElement","textRange","parentEl","duplicate","startEl","endEl","startEndContainer","textRangeIsCollapsed","compareEndPoints","getTextRangeBoundaryPosition","wholeRangeContainerElement","isCollapsed","startInfo","workingRange","containerElement","canHaveHTML","boundaryPosition","nodeInfo","workingNode","comparison","workingComparisonType","previousNode","boundaryNode","childNodeCount","moveToElementText","floor","setEndPoint","tempRange","rangeLength","moveStart","createBoundaryTextRange","boundaryParent","boundaryOffset","nodeIsDataNode","startBoundary","rangeContainerElement","rangeToTextRange","startRange","endRange","toTextRange","globalObj","createRangyRange","checkSelectionRanges","BOOLEAN","NUMBER","getNativeSelection","selectionIsCollapsed","CONTROL","isDirectionBackward","dir","WrappedSelection","getWinSelection","winParam","getSelection","getDocSelection","selection","winSelectionIsBackward","sel","backward","anchorNode","anchorOffset","focusNode","focusOffset","implementsWinGetSelection","implementsDocSelection","useDocumentSelection","isSelectionValid","nativeSel","testSelection","selectionHasAnchorAndFocus","selectionHasExtend","selectionHasRangeCount","rangeCount","selectionSupportsMultipleRanges","collapsedNonEditableSelectionsSupported","addRangeBackwardToNative","nativeSelection","addRange","getNativeRange","implementsControlRange","testControlRange","createControlRange","getRangeAt","updateAnchorAndFocusFromRange","anchorPrefix","focusPrefix","updateAnchorAndFocusFromNativeSelection","updateEmptySelection","_ranges","rangeContainsSingleElement","rangeNodes","getSingleElementFromRange","updateFromTextRange","wrappedRange","updateControlSelection","docSelection","controlRange","item","addRangeToControlSelection","rangeElement","newControlRange","select","getSelectionRangeAt","deleteProperties","detached","cachedRangySelections","actOnCachedSelection","action","cached","docSel","selProto","createControlSelection","ranges","removeAllRanges","addRangeBackward","direction","previousRangeCount","clonedNativeRange","selectionIsBackward","setRanges","refreshSelection","checkForChanges","oldRanges","oldAnchorNode","oldAnchorOffset","removeRangeManually","getAllRanges","removeRange","removed","isBackward","isBackwards","rangeTexts","assertNodeInSameDocument","setSingleRange","collapseToStart","collapseToEnd","selectAllChildren","deleteFromDocument","eachRange","callMethodOnEachRange","results","createStartOrEndSetter","changeEachRange","rangeBookmarks","selRanges","rangeBookmark","saveRanges","restoreRanges","rangeHtmls","getNativeTextRange","rangeInspects","anchor","focus","detachAll","Selection","docReady","loadHandler","markerTextChar","gEBI","getElementById","insertRangeBoundaryMarker","atStart","markerId","markerEl","boundaryRange","style","lineHeight","display","className","setRangeBoundary","compareRanges","saveRange","startMarkerId","endMarkerId","restoreRange","rangeInfo","normalize","rangeInfos","sort","saveSelection","restored","restoreSelection","savedSelection","preserveDirection","removeMarkerElement","removeMarkers","CHARACTER","WORD","spacesRegex","spacesMinusLineBreaksRegex","allWhiteSpaceRegex","nonLineBreakWhiteSpaceRegex","lineBreakRegex","defaultLanguage","trailingSpaceInBlockCollapses","vendor","trailingSpaceBeforeBrCollapses","trailingSpaceBeforeBlockCollapses","trailingSpaceBeforeLineBreakInPreLineCollapses","defaultTokenizer","chars","wordOptions","tokenRanges","createTokenRange","isWord","lastWordEnd","wordStart","wordEnd","wordRegex","exec","includeTrailingSpace","convertCharRangeToToken","tokenRange","tokenChars","token","tokenize","tokenizer","tokens","defaultCharacterOptions","includeBlockContentTrailingSpace","includeSpaceBeforeBr","includeSpaceBeforeBlock","includePreLineTrailingSpace","ignoreCharacters","normalizeIgnoredCharacters","ignoredCharacters","ignoredChars","ignoredCharsArray","char1","char2","charCodeAt","defaultCaretCharacterOptions","defaultWordOptions","defaultFindOptions","caseSensitive","withinRange","wholeWordsOnly","characterOptions","defaultMoveOptions","defaultExpandOptions","trimStart","trimEnd","defaultWordIteratorOptions","createWordOptions","createNestedOptions","tableCssDisplayBlock","table","defaultDisplayValueForTag","caption","colgroup","col","thead","tbody","tfoot","tr","td","th","getComputedDisplay","isHidden","getAncestorsAndSelf","isVisibilityHiddenTextNode","isBlockNode","getLastDescendantOrSelf","containsPositions","getAncestors","unshift","nextNodeDescendants","excludeChildren","previous","isWhitespaceNode","computedWhiteSpace","isCollapsedWhitespaceNode","isCollapsedNode","isIgnoredNode","Cache","key","cachedCount","uncachedCount","createCachingGetter","objProperty","NodeWrapper","session","positions","nodeProto","getPosition","Position","EMPTY","NON_SPACE","UNCOLLAPSIBLE_SPACE","COLLAPSIBLE_SPACE","TRAILING_SPACE_BEFORE_BLOCK","TRAILING_SPACE_IN_BLOCK","TRAILING_SPACE_BEFORE_BR","PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK","TRAILING_LINE_BREAK_AFTER_BR","INCLUDED_TRAILING_LINE_BREAK_AFTER_BR","getLength","isWhitespace","isCollapsedWhitespace","isIgnored","getTextNodeInfo","spaceRegex","collapseSpaces","cssWhitespace","preLine","hasInnerText","posAfterEl","firstPosInEl","endPos","prepopulateChar","isDefinitelyNonEmpty","previousVisible","nextVisible","isRenderedBlock","brs","getTrailingSpace","getNodeWrapper","getLeadingSpace","nodeWrapper","inspectPosition","positionProto","character","characterType","isBr","prepopulatedChar","visibleChar","charType","finalizedChar","textChar","charAt","nodePassed","checkForTrailingSpace","checkForLeadingSpace","isCharInvariant","resolveLeadingAndTrailingSpaces","trailingSpace","isTrailingSpace","leadingSpace","isLeadingSpace","getPrecedingUncollapsedPosition","getCharacter","thisChar","returnChar","isIgnoredCharacter","cacheKey","cachedChar","collapsible","nextPos","previousPos","gotPreviousPos","getPreviousPos","nextUncollapsed","nextOffset","previousOffset","newPos","currentSession","Session","createWrapperCache","nodeProperty","wrappersByProperty","wrapper","property","uniqueIDSupported","initCaches","elementCache","elementsCache","uniqueID","elWrapper","textNodeCache","otherNodeCache","wrapperCache","getRangeBoundaryPosition","prefix","startSession","endSession","getSession","createCharacterIterator","startPos","charPos","previousTextPos","returnPreviousTextPos","rewind","arrayIndexOf","createTokenizedTextProvider","forwardIterator","backwardIterator","consumeWord","forward","newChars","passedWordBoundary","insideWord","forwardChars","backwardChars","reverse","forwardTokensBuffer","backwardTokensBuffer","inspectBuffer","buffer","textPositions","nextEndToken","lastToken","shift","previousStartToken","movePositionBy","unit","unitsMoved","currentPos","charIterator","absCount","tokenizedTextProvider","createRangeCharacterIterator","rangeStart","rangeEnd","itStart","itEnd","getRangeCharacters","isWholeWord","expand","findTextFromPosition","initialPos","searchTerm","isRegex","searchScopeRange","findOptions","currentChar","matchStartIndex","matchEndIndex","insideRegexMatch","handleMatch","endIndex","createEntryPointFunction","sessionRunning","createRangeBoundaryMover","moveOptions","boundaryIsStart","moveResult","createRangeTrimmer","trimCharCount","trimmed","moveEnd","move","startTrimmed","endTrimmed","expandOptions","moved","startTokenizedTextProvider","startToken","newStartPos","endToken","newEndPos","endTokenizedTextProvider","selectCharacters","toCharacterRange","rangeStartsBeforeNode","rangeBetween","findText","searchTermParam","wrappedAround","findResult","pasteHtml","createSelectionTrimmer","saveCharacterRanges","characterRange","restoreCharacterRanges","saved","innerText","createWordIterator","iteratorOptions","noMutation","createPosition","_$","_jquip","queryShimCdn","queryEngines","docEl","scriptFns","load","sLoaded","runtil","rmultiselector","rparentsprev","rtagname","rclass","rtagSelector","ridSelector","rclassSelector","rspace","rdigit","rnotwhite","rReturn","rsingleTag","rCRLF","rselectTextarea","rinput","strim","trimLeft","trimRight","contains","sortOrder","guaranteedUnique","children","contents","class2type","hasDup","baseHasDup","wrapMap","legend","area","_default","breaker","ArrayProto","ObjProto","hasOwn","nativeForEach","nativeFilter","nativeIndexOf","expando","fosterNode","J","ctx","ret","l","ctors","isF","isA","isWin","isS","htmlFrag","$$","isPlainObj","plugins","jquid","_cache","_id","_display","$","dm","tbl","cb","first","ps","els","selector","merge","prevObject","make","num","makeArray","all","unique","fn","idx","nt","isO","removeAttribute","setAttribute","getAttribute","setVal","isFunc","before","append","show","hide","r","winnow","_indexOf","cur","setHtml","textContent","nodeValue","cls","setClass","cl","clss","hasClass","elements","disabled","checked","wrapperClone","each","addClass","removeClass","keep","grep","expr","orphan","tag","eqClass","walk","subEl","qry","rest","getElementsByClassName","querySelectorAll","useQuery","async","s","rs","src","var_args","isObj","_each","hasAttribute","_filter","tmp","proxy","guid","until","matched","is","nth","inv","retVal","attrs","elAttrs","attributes","eqSI","str1","str2","typeOf","isAL","isNan","a1","a2","opt","copy","copyIsArr","dst","aLen","clean","div","fragDiv","depth","sibChk","compareDocumentPosition","sourceIndex","al","bl","ap","bp","aup","bup","orig","boxmodel","width","padding","w","offsetWidth","boxModel","opacity","cssFloat","rwebkit","ropera","rmsie","rmozilla","ua","loadAsync","fireSL","cbs","meta","xhrs","ActiveXObject","_xhrf","_xhr","req","_xhrResp","xhr","dataType","getResponseHeader","eval","responseXML","formData","kvps","regEx","timer","timeout","abort","timeoutFn","cbCtx","evtCtx","clearTimeout","decode","dt","statusText","isPost","getTime","setRequestHeader","_","ralpha","ropacity","rdashAlpha","rupper","rnumpx","rnum","rroot","cssShow","visibility","cssWidth","cssHeight","curCSS","fcamelCase","toUpperCase","comp","extra","getWH","swap","offsetHeight","which","css","computed","$1","zoom","computedStyle","getPropertyValue","left","rsLeft","runtimeStyle","pixelLeft","access","origName","camelCase","hooks","old","pass","noMarginBodyOff","subBorderForOverflow","suppFixedPos","noAddBorder","noAddBorderForTables","initialize","iDiv","cDiv","bodyMarginTop","top","margin","border","height","offsetTop","overflow","bodyOffset","offsetLeft","box","getBoundingClientRect","getWin","clientTop","clientLeft","scrollTop","scrollLeft","offPar","off","parOff","op","offsetParent","size","docElProp","qsMap","vars","Key","keyCode","kvp","unescape","namedKeys","Backspace","Tab","Enter","Shift","Ctrl","Alt","Pause","Capslock","Escape","PageUp","PageDown","End","Home","LeftArrow","UpArrow","RightArrow","DownArrow","Insert","Delete","event","cancelBubble","stopPropagation","preventDefault","evaluate","interpolate","escape","str","tmpl","DOMContentLoaded","readyBound","readyList","isReady","readyWait","doScrollCheck","doScroll","ready","wait","removeEventListener","detachEvent","toplevel","frameElement","handlers","_jquid","_ieBindHandlers","unbind","parseEvt","evt","parts","matcherFor","findHdls","m","hdl","addEvt","evts","delegate","handler","del","remEvt","evtMethods","createProxy","originalEvent","callee","srcElement","currentTarget","liveFired","undelegate","createEvent","dispatchEvent","initEvent","fireEvent","jquip","CORE","webApiTemplate","coreOptionsTemplate","optionToStore","storedValue","unsupportedInputFieldTypes","unsuported","localizationList","optionsList","avalableOptions","debug","focused","suggestionsCount","moreSuggestionsCount","localization","languageNodeName","languageAttributeName","data_attribute_name","data_attribute_name_backward","data_lang_attribute","misspelled_word_class","instance_class","iframe_quirks_class","problem_text_active","problem_grammar_node","misspelled_word_node","problem_grammar_data_attribute","problem_grammar_data_attribute_backward","problem_grammar_data_attribute_rule","problem_grammar_class","problem_id_data_attribute","originalContainer","documentContainer","focusContainer","currentDocument","leftMouseButtonPressed","deleteKeyButtonPressed","backspaceKeyButtonPressed","spaceKeyButtonPressed","enterKeyButtonPressed","isTextBasedContainer","isTouchDevice","isIframe","freeze","banner","bannerInfo","linkHref","linkText","supportLocale","isServiceHostDefault","isMutationObserver","paused","appStarted","wordsLimit","maxLength","numberOfFailedRequest","spellCheckDelay","mainWSCdomain","userDictionaryKey","userDictionaryNameKey","wscLogo","cssPath","productName","wscVersion","wscSupportUrl","moreLangUrl","ECUserManual","CKUserManual","uid","multiLanguageStyles","detectLocalizationLanguage","styles","localizationPath","eventsBlockedState","spellingLangList","grammarLangList","cdModificationTime","programVersion","modifierKeys","shortcutsList","permanentMinWordLength","languagesMap","htmlContainer","proofreadOptions","ignoreAllCapsWords","ignoreDomainNames","ignoreWordsWithMixedCases","ignoreWordsWithNumbers","ignoreElements","ignoreGrammarElements","undoDataSize","enableOnTouchDevices","enableBadgeButton","disableProblemDescription","actionItems","controlActions","staticActions","settingsSections","defaultSettingsSections","multiLanguageMode","mirrorBasedInstance","disableCache","cacheSize","isProofreadInDialogActive","proofreadAsYouType","isModelEditor","criticalMessage","ALT","CTRL","SHIFT","getUrl","basePath","instanceManager","getUniqueId","DataStorage","getData","setData","Communication","DOMCommunication","WebApiAdapter","RegExpressions","RangeCreator","Deferred","StateController","decorateModules","instance","service","decoratedService","decorator","decoratorFor","moduleID","decorate","buildModules","modulesToInit","moduleObj","moduleConstructor","creator","_register","_start","_initModules","modulesList","syncModules","asyncModules","fireAllModulesReady","allModulesReady","getService","fire","asyncModulesReadyHandler","unsubscribe","subscribe","startModule","core","createModuleInstance","Sandbox","checkModulesState","statusMessage","communication","initModules","destroyModules","destroy","getCommunication","getContextMenu","contextMenu","addItems","getItem","addItem","addGroup","getDOMElement","getBadge","inMainWindow","getSelect","savedSel","bookmarksIsEnabled","fireInAllApps","lock","getSelectionManager","isSelectionCollapsed","restoredSel","deleteStoredSelection","currentSelection","getCaretRangeFromEvent","x","clientX","y","clientY","currentRange","getCurrentDocument","caretPositionFromPoint","offsetNode","caretRangeFromPoint","moveToPoint","pasteHTML","UILib","find","Localization","Template","clipboardManager","FullUILib","UILibPrivats","accessLimitation","DataProcessor","UIMetrics","getHtmlWithoutSpellingNodes","getHtmlWithoutGrammarNodes","getHtmlWithoutProblemNodes","blockEvents","eventsCollection","unblockEvents","getInstance","startSpellCheck","startGrammarCheck","startProblemsCheck","setMarkupPaused","setPaused","removeAllDeferredFunctions","startApp","startMarkup","stopApp","stopMarkup","setSpellingMarkupPaused","setGrammarMarkupPaused","setProblemMarkupPaused","spellingMarkupEventsCollection","grammarEventsCollection","problemMarkupEventsCollection","removeSentencesFromCache","sentencesDictionary","sentence","handleCacheUpdate","DOMElement","argumentsToObject","priority","overrideHandler","addEventProxy","EventProxy","removeEventProxy","notifyAll","_getCoreOptionObject","_retOptionsObject","getActions","actionsList","getProblemActions","problem","getStaticActions","getProblemInfo","problemNode","getNodeInfo","getFullNodeInfo","getChildProblemNodes","getParentProblemNodes","getProblemNodeFromMouseEvent","getProblemNodesFromPoint","getProblemTypes","isOriginalContainerTextBased","getDefaultOption","getLocal","abbreviation","addDeferredFunction","register","unregisterAll","getRegExp","setFocused","getFocused","isFocused","isActiveContainer","activeElement","isActiveContainerInMain","setContainer","removeMarkupFromString","tempNode","problem_word_node","problem_attribute_name","spellingChildNodes","findNodeChildren","grammarChildNodes","spellingNode","grammarNode","getProblemNodeFromSelection","selectionNode","rangeText","problemWord","problemStartsFromRange","rangeStartsFromProblem","problemNodeName","problemAttrName","problemClassName","isEqualNode","findNodeParents","getSpellingNodeFromSelection","getGrammarNodeFromSelection","getSpellingNodesInElement","spellingAttrName","getGrammarNodesInElement","grammarAttrName","getParentBlockElement","blockElementsRegex","getOffsetParent","getPrevSymbol","getNextSymbol","getTextBeforeCursor","isNodeContentBroken","attrWord","realWord","getBrokenProblemNodes","wordBoundaryRegex","_node","getProblemNodesInElement","problemNodesToRemove","prevSymbol","nextSymbol","getBrokenSpellingNodes","getBrokenGrammarNodes","getProblemsCount","spellingNodes","grammarNodes","clientWidth","isCaretInStartOfMisspelledWord","misspelledAttrName","walker","Walker","siblingNode","currentNode","textWalkedThrough","getNext","isCaretInEndOfMisspelledWord","throwRange","getLatestTextNodeFromSpellingNode","savedRange","getRangeManager","restoredRange","getMainContainer","getContainerInstance","mirror","ckeditor5","editor","getDataFromContainer","containerInstance","setDataToContainer","isCacheAvailable","isLocalStorageSupported","privats","returnedObject","ArgumentsObject","isLeftMouseButtonPressed","libAdapter","jQuipAdapter","IEHandlers","jQuip","getNative","jObject","getjObject","parents","appendTo","prependTo","prepend","attrName","attrValue","removeAttr","cssProperty","newHtml","newVal","newText","domReady","eventName","eventHandler","getEventTarget","jEvent","cancelEvent","defaultPrevented","stopImmediatePropagation","isImmediatePropagationStopped","blur","contextmenu","outerWidth","outerHeight","createEventObject","isDefaultPrevented","setPosition","query","attributeName","jQuipDefiner","instances","sandbox","hashCode","href","getControlById","originalElementId","getInstanceByElement","_instance","objectIsEmpty","invertObject","stopNode","getNextNodeMethod","startTextChunk","findFirstNodeWithString","queue","localStorage","setItem","removeItem","removeFillingCharacter","removeGlobal","variable","scope","sortRangesForMurkup","Ð°","_order","_document","getScrollWidth","scrollWidth","overflowY","getScrollBarsState","vertical","scrollHeight","clientHeight","horizontal","getScrollLeftForInput","input","paddingLeft","borderLeft","rangeRect","inputRect","getScrollWidthForInput","reduceCoordinates","inputArr","reducer","coordObj","scrollToNodeInContainer","containerRect","nodeRect","distance","bottom","elementsFromPoint","previousPointerEvents","msElementsFromPoint","elementFromPoint","pointerEvents","escapeHTML","unescapeProblemTags","getVisibilityApiData","hidden","visibilityChangeEvent","webkitHidden","getWindowByDocument","fixRangeBoundaryPoints","rangePoint","ancestorContainer","startBeforeNode","endAfterNode","extendOptions","extender","getLocationInfo","pathname","Parent","Child","extends","Main","Decorator","mainProto","DecoratorProto","char","now","stylesObject","processedStyles","fileName","regPath","startStr","endStr","currentScript","lastIndexOf","scripts","ignoredAttrs","availableTypes","inputFieldTypes","ckeditor5Class","editorByClass","editorByAttribute","isInPage","DocumentTouch","errOrItem","collection","letter","matches","isUppercaseLetter","zIndex","currentZIndex","getZIndex","currentPosition","getScrollLeft","getScrollTop","getScrollInfo","getWindowWidth","getWindowHeight","getWindowSize","getWindowInnerWidth","innerWidth","getWindowInnerHeight","innerHeight","getBodyMinWidth","bodyMinWidth","getPageWidth","getPageHeight","getDocumentWidth","getDocumentHeight","tplName","tpl","render","DataTypeManager","getDataType","convertDataToString","restoreDataFromString","separatorStartIndex","backCompatibility","convertedStr","LocalStorage","_value","CookiesStorage","expiration","getCookie","setCookie","expires","deleteCookie","cookie","decodeURIComponent","exp","setTime","toUTCString","updatedCookie","propValue","cookies","eqPos","strategy","ignoreElementsRegex","RangyAdapter","rangyOptions","nonWhiteSpaceExtendedGlobal","createTokenFromRange","getDocumentContainer","SelectionManager","RangeManager","comparisonType","adapter","toStart","curRange","_getRangyRange","rangeManager","selectionManager","Lib","_range","_selection","_adapter","_convertedRange","_rangeClone","_text","documentFragment","_wscRange","_getSelection","_selRange","_savedSelection","_savedRange","_rangyRange","_restoredRange","TestAdapter","bool","removeBindings","addBindings","focusHandler","blurHandler","mouseDownHandler","mouseUpHandler","keydownHandler","keyupHandler","_events","events","addEvents","createSignal","eventTypes","signal","resultData","eventObject","Event","aggregateEventData","foundEvents","_type","_eventData","_propagationStopped","_defaultPrevented","_immediatePropagationStopped","setReturnedData","isEventDataEmpty","isPropagationStopped","aggregationRules","eventData","eventsNames","wrapMethod","removeAllEventProxy","fill","UISignal","checkOnEventSupport","validateListener","fnName","setEventData","ignoredProps","checkEventTypes","customEvent","fireBeforeEventsForContainer","targetDocument","interectiveEvents","fireResult","lastSystemFireResult","subscription","userContext","userHandler","addSubscription","UIEventDecorator","nativeEvent","removeSubscription","subscribers","prepareOption","DOMCommunicationInstance","proxyElements","proxyObject","eventPrototype","defaultPreventedBefore","emmiter","registredElements","findElementIndex","registerElement","unregisterElement","registredElement","parametersMap","webApi","actionMethod","parametrs","mapWebApiParameters","mappedParameter","parametr","regExps","createIgnoreElementsRegex","elementsName","ignoreElementsArray","defaultIgnoredTagNames","defaultIgnoredTagReg","tasks","taskCount","taskEndedHandler","taskName","unregister","single","extendCollection","Task","startTask","withoutCallback","onUnregister","delay","partialItemsCount","deferredFunction","getTaskFunction","defferedFunctionArgs","endTask","getPartialItems","runDeferredFunction","partialItems","_spliceHelper","coreTemplate","markupHandlerCallback","AppTemplate","scriptLocation","enableGrammar","autoStartup","charsToObserve","units","onLoad","function","getBaseData","_createApp","callbackSuccess","callbackError","appInstanceOptions","clientUnits","parseOptions","Wrapper","Mirror","ContenteditableMirror","IME","StyleManager","LocalizationManager","Banner","FocusManager","AccessLimiter","WordsCollector","WordsFinder","DictionaryManager","Markup","WordsProcessor","DragAndDropManager","UndoManager","DOMChangesListener","SentencesCollector","GrammarDictionaryManager","GrammarPhrasesFinder","SentencesProcessor","GrammarMarkup","MaxLength","KeyboardManager","ProblemManager","ActionsManager","InfoGetter","GarbageCollector","ProofreadDialogManager","ProblemsTokenizer","UI","UIBuilder","spelling","grammar","ui","common","editableControls","autoSearchCreation","priorityModules","getModulesList","getModuleIndexByName","setModulesOrder","priorityModuleName","priorityModule","priorityModuleIndex","startAppWhenModulesReady","setAdditionalClasses","bindEvents","runSuccessCallback","doctype","doubleClickHandler","checkNodeWithSpecialChars","nodeWithChar","charCode","charName","unitName","extraModules","setGrammarState","setAdditionalAttributes","filterOptions","changedOptions","dictionary","Dictionary","getStatus","wordStatus","inprocess","setStatus","unknown","disableOptionsStorage","userOptions","availableValue","valuesOption","isValidOption","makeOptionsToStorage","retval","isGroupOptionInUserOptions","containerToCheck","textChanged","isNodeAvailable","form","wscMarkupRemoved","isTextBased","selectedText","currLang","ltr","rtl","containerWithId","isAllModulesReady","reloadMarkup","replaceSelectionNode","getSuggestions","dictionaryModule","grammarDictionaryModule","problemFromDictionary","getWordFromDictionary","getPhraseFromDictionary","phrase","suggestions","ignoreWord","ignorePhrase","ignoreAllPhrases","ignoreAllWords","removeMarkupInSelectionNode","grammarOnly","getSpellingLangList","getGrammarLangList","getApplicationConfig","getLang","setLang","commitOption","getUserDictionaryName","restoreUserDictionary","disconnectFromUserDictionary","removeUserDictionary","setUserDictionaryName","isUserDictionaryExist","getLogo","getVersion","getBrandingInfo","isSpellingNode","isGrammarNode","findSpellingNode","nodeArr","addMarkupHandler","getLangAttribute","showBanner","contextMenuContainerSelector","hideBanner","getProblemDescriptionText","grammarPhrase","rule","grammarDictionary","getProblemDescription","findNodeWithChar","getAttributeInfo","isBannerEnable","findGrammarNode","getCustomDictionary","getSpellingNodeAttributeName","getNodeAttribute","getGrammarNodeAttributeName","getGrammarNodeRuleAttributeName","getContainerNode","itemName","isDisabled","setDisabled","fixBrokenNodes","fixProblemNodesInElement","spellingNodesToRemove","grammarNodesToRemove","_sandbox","serviceName","includeRequiredUI","userDictionaryManager","UserDictionaryManager","ignored","correct","userIgnore","userDictionaryActionsMap","wordsCollectedHandler","orignalSuccess","userDictionaryStateRestoredHandler","getUserDictionaryFromServer","syncUserDictionaryName","userDictionaryStateChangedHandler","addWordToUserDictionaryHandler","suggestionList","getSuggestionsListHandler","optionsCommitedHandler","saveCache","restoreCache","setCacheState","setState","getCachedWord","getWord","addWordToCache","addedWords","unknownWords","detectedLanguages","addWordsToDictionary","getUnknownWords","getWordsInfo","processWithTimeout","ignoredWords","existsInInstance","setIgnoredStateIfRequired","processIgnoredWords","udWordsFromDictionary","getUdWordsFromDictionary","setStatusForAllInstances","isLowercaseLetter","capitalizeFirstLetter","problems","problemType","userDictionaryObject","udModificationTime","wordsFromDictionary","wordsLength","getAllWordsByName","clearCache","_addedWords","wordKey","addToInstance","addCustomDictionariesInInstance","isNeedGetWordInfo","resetStatus","getWordsFromDictionaryByStatus","_unknownWords","getMisspelledWords","_misspelledWords","getAllWordsByStatus","wordsToMarkup","wordsPrefix","wordsToGetInfo","cachedWords","cachedWordsObject","misspelledWords","cachedWord","setGlobalStatus","setInProcess","createObjectFromArray","_word","isInUserDictionary","handleMisspelledWord","handleUdCdCorrectWord","currentTask","setGlobalStatusToWords","removeWordsFromProcess","wordsString","getWordsFromUserDictionary","_dataWords","removeFromProcess","knownWords","setStatusForAllInstancesWithSuchCustomDictionary","wordsFromUserDictionary","err","onSuccessCallback","clearUserDictionary","onErrorCallback","remoteAction","replaceText","messagePostfix","addWordToUserDictionaryServer","deleteWordFromUserDictionaryServer","userWordsList","udName","checkUserDictionaryName","addWordsToUserDictionary","setWordStatus","allLangDictionaries","getDictionary","setCapitalizedWordStatus","wordsStorage","wordStoragePrefix","hasStatusInAnyInstance","setStatusToWords","clonedWordsStorage","newWord","Word","statusInInstance","wordInInstance","customDictionariesInInstance","settedInProcessBy","globalStatus","_status","instanceUID","tail","cacheName","cacheRestored","cacheSaved","toJSON","aditionalData","v","tempProgramVersion","tempUdModificationTime","encode","enc","Node","setHead","json","problemTypes","getSuggestionsEvent","replaceEvent","ignoreEvent","ignoreAllEvent","replaceField","attrNameBackward","attrLang","classOption","attrRuleName","problemInfo","getSuggestionsEventResult","problemDescription","isProblemNode","hasProblemClass","broken","problemNodes","parentNodes","cssClass","mainCssClass","typeName","filterBySystemActions","control","getAction","suggestion","actions","coreActionItems","actionItem","actionList","eventObj","ignore","_fireEventWithNode","ignoreAll","settings","elementName","proofreadDialog","toggle","help","THEMEPATH","themeLoaded","misspelledNodeClass","problemGrammarClass","loadStyle","addAdditionalStyles","getLanguageStyleRules","links","link","createStyleSheet","styleSheet","ownerNode","owningElement","addDynamicStyles","cssText","cssRules","documentNode","rootBgColor","localizationLoaded","langId","loadLocalization","handleLocalizationLoad","autoDetect","defaultLangId","fireModuleReady","detect","languagesList","browserLanguage","userLanguage","locale","markupWords","handleKeydown","removeMarkupInDocument","removeMarkupFromWords","removeMarkup","cKey","xKey","aKey","uKey","rKey","copyAction","selectAllAction","undoAction","redoAction","additionalRedoAction","notShortcutActions","printableKey","notExcludeKey","alternativeKey","monitoredKey","excludeKeyCodes","alternativeKeyCodes","monitoredKeyCodes","ctrlKey","metaKey","shiftKey","getSpellingNodeIfCaretInEndOfIt","moveCaretFromSpellingNode","spellingParentNode","dataLangAttrName","specialCharactersRegex","strong","_selectionNode","_spellingParentsNode","_strong","_spellingChildNodes","_spellingNode","nodesWithMarkup","_spellingNodes","foundNodes","dataAttributeName","removeInside","forceBookmark","leftStartNode","rightStartNode","leftStartOffset","rightStartOffset","getSpellingNodes","nodeArray","getNeighbourSpellingNodes","leftDirectionData","rightDirectionData","misspelledWordNode","getNearestSpellingNode","nonWhiteSpaceExtended","textWithoutPunctuation","punctuationWasFounded","_nodes","removedNodes","collectWords","ignoreMisspellingsInContainer","spellCheckSource","collectWordsInString","collectWordsInContainer","collectWordsInRange","currentLanguage","rangeString","createStringWithoutScaytElements","finder","Finder","collectBlockInfo","resultText","rootNode","bookmarkClassRegex","processMisspelledWords","current_lang","wordsInCurrentControl","findWordRangesForMarkup","findWord","wordRange","wordLanguage","wordIndex","ignoreMisspellings","newParts","getPos","foundedProblems","getPreviousProblemsCount","defaultLang","langAttr","block","editable","isContentEditable","anyCharG","misspelledDataAttrName","indexOffset","foundCharacters","addPart","part","addFoundedProblems","prevValue","emptyCharsCountInPart","_editable","_lang","spellcheckLanguage","replaceWordInSelection","ignoreWordInSelection","ignoreWordInDocument","replaceWordByNode","ignoreWords","wordNodes","textBeforeCursor","bannerTemplate","editors","closeBannerTimeout","contextMenuContainer","bannerTemplates","bannerId","showBannerHandler","actionLinks","_bannerHTML","bindActionForLinks","wscBanner","setTimeoutId","activateFreeze","limitController","LimitController","getWordsLimitHandler","sentWordsCountHandler","spellCheckEndedHandler","getWordsLimit","updateWordsLimit","isFrozen","getContainer","infoTypesMap","appSetPause","infoType","infoTypeName","proofreadInDialogContainer","isCheckingFinished","isSomethingChanged","wordsForRemovingMarkup","phrasesForRemovingMarkup","typesStore","problemArray","saveOriginalContainers","setProofreadInDialogContainer","handleStartProofreadInDialog","handleFinishProofreadInDialog","handleFinishCheckingInDialog","handleChanges","handleRemoveMarkup","originalDocumentContainer","changeToOriginalContainers","changeContainers","changeToProofreadInDialogContainers","setDataToProofreadInDialogContainer","isInputBased","textToHtml","processContenteditable","inDialog","setDataToOriginalContainer","htmlToText","syncActions","tempAttr","removeContenteditable","nodesWithContenteditable","nodesWithTempAttr","Component","title","modificators","_isVisible","childDataAttr","_elementOf","_separators","modificator","_modificatorsTypes","focusable","clearfix","borderBox","fullscreen","_errorsMessages","modificatorNotRegistred","customModificatorParent","templateData","_internalName","_modificators","_customModificators","_lifeCycleMethods","_UIDFields","_lifeCycleHandlers","after","_element","_position","_children","_template","_templateData","_createLifeCycles","_setTemplateField","childrenName","registerLifeCycleHandler","isVisible","_hidByParent","_renderChildren","components","proccesElements","_addChildClasses","childName","model","defaultTemplate","_buildCssString","_buildModificators","_bindEvents","_unBindEvents","removeAllChildren","getUID","_isInternalCommand","isDeep","removeModificator","hidByParent","InternalCommand","addModificator","addTemplateData","ariaLabel","ariaExpanded","tabIndex","component","pushOrConcat","round","modificatorsTypes","blockName","_modificatorAction","modificatorsArray","_customModificatorAction","focusableElements","tabIndexed","createWrapper","elementString","modificatorString","field","tData","_buildCustomModificator","actionMethods","manageList","manageClass","_blocks","modificatorsString","modificatorsForCurrentContext","elementObj","blockInfo","elementsWithChildAttr","renderChild","childElement","lastRendered","elementDataName","getChildren","_findChildren","Icon","setTemplate","registerModificatorsTypes","big","small","confirm","iconName","Input","placeholder","autocomplete","autocorrect","autocapitalize","spellcheck","labelledBy","onKeydown","attachEvents","getTemplateData","_getField","_setField","fieldName","Label","labelFor","labelText","labelTitle","TextInput","buildInput","buildLabel","proxyMethodsFrom","registerChildren","label","controlsStrategys","checkInputs","controls","Form","controlsStrategies","radio","getChecked","getAttrName","getValue","checkbox","controlType","Button","role","ariaLevel","disable","icon","registerIcon","onClick","onFocus","onBlur","cssString","activate","deactivate","Item","itemContent","ItemList","controlsBy","itemRole","changeTabIndexOnFocus","prevKey","keyboardTrapped","onFocusin","handleFocusin","onFocusout","handleFocusout","itemsContents","trapKeyboard","relatedTarget","handlePrevKeyPress","handleNextKeyPress","getNextPrevByActive","getTabIndexedElements","resetAllTabIndexes","Checkbox","Radio","Page","getTitle","ariaLabelledFor","TabNavlink","ariaControlsFor","ariaSelected","registerIcons","externalIcon","Tabs","activeSection","list","activateSectionByIndex","nav","componentTitle","componentTitleLowerCased","tabNavlink","navItem","registerBemElements","tabContent","bindNavWithContent","bindNavLinkWithNavItem","activateSection","addCustomModificator","removeCustomModificator","deactivateAriaTabAttributes","activateAriaTabAttributes","tabContents","navItems","Dialog","textChanges","setFocusToFirstElement","restoreDialog","builder","menu","buildMenu","buildContent","closeDialogHandler","closeDialog","header","buildHeader","closeDialogWithCheckTextChanges","maximizeRestoreDialogHandler","maximizeRestoreDialog","textBox","buildTextBox","closable","confirmBox","buildConfirmBox","buildFooter","buildMenuButton","removeStateModificators","handleShowMessage","menuButton","setTitle","setAriaLabel","handleTabPress","handleEscPress","getFocusableElements","postfix","messageTemplate","maximizeDialog","maximizeRestoreButton","ProgressBar","setAriaValueNow","Header","withBanner","buildCloseDialogButton","buildMaximizeRestoreButton","buildProgressBar","menuIcon","createIcon","TextBox","MessageBox","stateModificators","timeoutDelay","timeoutId","handleHideMessage","buildIconBox","buildCloseMessageBoxButton","buildMessageActions","handleCloseMessageButtonClick","createActionsItem","actionsContainer","WordItem","buildDeleteButton","handleDeleteWord","About","textVersion","textCopyrights","Languages","buildLanguagesList","langList","spellingLang","languagesItem","currentLang","isChecked","setChecked","serializeToPlainObject","Options","buildOptionsList","OptionsItem","optionItems","Dictionaries","udWordsItems","buildDictionaryNameInput","buildDeleteDictionaryButton","buildRenameDictionaryButton","buildCreateDictionaryButton","buildConnectDictionaryButton","buildDisconnectDictionaryButton","buildAddWordInput","buildAddToDictionaryButton","buildWordsList","handleUserDictionaryAction","toggleDictionaryStates","createButton","handleDeleteDictionary","handleRenameDictionary","handleCreateDictionary","handleConnectDictionary","handleDisconnectDictionary","handleWordInputKeydown","handleAddToDictionary","createWordItem","removeAllItems","wordsList","addWordInput","wordItem","setFocus","activateFirstWord","setTabIndex","clearWordsList","buildWordsListItems","toggleWordsList","handleAddWordState","dictionaryNameInput","setValue","addToDictionaryButton","dictionaryName","deleteDictionaryButton","renameDictionaryButton","createDictionaryButton","connectDictionaryButton","disconnectDictionaryButton","enable","Description","ProblemItem","nodesContainer","resetAllTabIndexesInSectionsContainer","showHideButton","suggestionPreview","activeNodeClass","info","suggestionsActions","maxSuggestionsCount","min","buildOverlay","buildSuggestions","buildControlActions","buildDescription","buildUpDown","handleOverlayClick","handleOverlayKeyDown","createSuggestionsItem","upDownIcon","handleUpDown","handleButtonsKeyDown","upDownButton","suggestionsContainer","listItem","addActive","overlay","removeActive","setAriaExpanded","addActiveNode","removeActiveNode","ContentContainer","ProblemsSection","buildShowHideButton","buildProblemsSectionItems","handleShowHideSection","handleShowHideButtonKeyDown","problemsSectionItems","items","ProblemsContainer","activeItem","problemsSections","activateFirstItem","buildProblemsSectionsContainer","problemItems","sectionsPriority","activated","getProblemItems","buildProblemsSectionsItems","sections","createProblemsSection","section","sectionsContainer","problemsSection","problemItem","itemListItem","originalFunction","handleActiveItem","button","ProofreadDialog","handleMarkupedNode","handleRemovedMarkupInContainer","buildContentContainer","buildProblemsContainer","buildFinishCheckingButton","contentContainer","problemsContainer","finishCheckingButton","handleFinishChecking","createProblemItem","unbindNodeClick","bindNodeClick","scrollContainer","Settings","settingComponents","tabsNav","tabs","getOptions","defineValues","lists","settingComponent","registerSettingsElements","createTab","settingValue","ContextMenu","generalEvents","deactiveteNode","clearProblemItems","activeteNode","defineBehavior","buildProblemItems","definePosition","createItem","createSection","createItems","buildNoSuggestions","buildDescriptionItem","fullSuggestionsCount","moreSuggestionsItems","suggestionsAction","buildMoreSuggestionItem","moreSuggestionsItem","mouseoverTimer","cursorCases","componentOpen","clearTimer","getProblemNode","showAtPosition","componentClose","noProblem","clearAndHide","cursorAnalysis","openState","problemState","delayFunction","attachGeneralEvents","eventsData","activatedNode","rect","contextmenuSize","getSize","windowSize","scrollInfo","documentHeight","iframe","iframeComputed","rightSide","getOffset","Badge","ariaHaspopup","ariaControls","problemsCount","expandedByKey","checking","animationMove","manyErrors","expanded","setInitialState","alwaysViewed","setUnfocusedState","labelButton","setChecking","update","changeBgColor","isEnabled","changePosition","setText","handleMouseenter","handleMouseleave","setPositionAndSize","setZIndex","getMaxZIndex","htmlBox","containerBox","containerHeight","containerWidth","right","containerClientHeight","containerClientWidth","smallOffset","bigOffset","addRequiredForShowActions","removeRequiredForHideActions","detachEvents","settingsComponents","languages","dictionaries","about","showUiElement","hideUiElement","buildElement","badge","elementHtml","buildStaticItems","directors","_createFacade","WSCDialog","WSCDialogBuilder","componentFacade","showContent","showMenu","DialogBuilder","sectionName","createSetting","isInline","blockElements","encodingTools","htmlDecode","htmlToPlainText","tagsToLowerCase","misspelledWordClass","getHtmlWithoutGivenNodes","problemGrammarNode","getHtmlWithoutRangyMarkerNodes","findBy","startElementIndex","endElementIndex","isLastElement","recogniseContentType","htmlRegex","specialCharactersFilter","symbolsToSave","searchFor","replaceWith","symbolsToRestore","save","restore","htmlEncode","defaultDataType","pasteEvent","TRANSFER_TYPE","INTERNAL","EXTERNAL","pasteHolder","contentType","contentTypes","cleanup","getPastedData","IE11","ClipboardManager","forcePlainText","isPasteDialog","instanceToRemove","preventPasteEvent","preventBeforePasteEvent","preventToFastPasteEvent","pasteEventHandler","savedContent","dataFromPasteBin","clipboardData","arrayOfTypes","preventBeforePasteEventNow","types","processPaste","pastedData","pasteInto","transferType","getTransferType","contentTrueType","elementNode","selectionRange","elementNodeRange","nodeContentsRange","elem","readyCallback","instanceObj","originalElement","fakeElement","createFakeElement","eventProxyInstance","setMaxLength","adjustStyles","eventProxy","proofraytFakeElement","getOriginalElement","getFakeElement","getTextContainer","readOnly","fromElement","toElement","addStyles","inlineStyles","classList","wrapperStylesNode","defaultStyles","styleNode","fontFamily","fontSize","preventDOMEvent","preventAppEvent","charLength","altKey","onPasteHandler","onEnterKeyHandler","onDeleteKeyHandler","brTag","isEndOfContainer","appendBogus","textFragment","clonedRange","nodesFromRange","brNodesFromRange","bogus","focusData","blurData","eventsMap","blockDOMKeyDown","keydownCharLength","onKeyDownHandler","onDropHandler","cutAction","conditionalCases","checkConditionalCases","mediumResult","checkMaxLength","charsExceeded","droppedData","dropState","getTextLength","incomingCharsLength","textLength","controlFocused","beforefocus","beforeblur","beforeBlurHandler","dropStates","internalDrop","externalDrop","crossContainerDrop","dropped","dragRange","savedDragRange","dragstartContainer","dropContainer","handleNativeDrop","handleDragStart","handleDragEnd","handleDrop","removeAllEventHandlers","caretRange","isAffected","savedCaretRange","savedRangeToRemove","dataTransfer","getCaretRangeFromDrop","isCaretRangeInEndOfDragRange","isCaretRangeWillAffected","addContent","dropEffect","clearTemporaryData","setShortcuts","shortcuts","removeShortcuts","shortcut","toFixed","setShortcut","removeShortcut","limit","isTyping","isDeleted","isDirty","handleNavigation","handleCutReplace","handlePaste","handleCrossContainerDrop","undo","redo","checkUndoRedoPosibility","breakingRichMarkupCommands","modKey","funcKey","fixRichMarkup","execCommand","setBreakingRichMarkupCommands","clearBreakingRichMarkupCommands","oldText","clearRedo","checkDataLimit","clearFlags","undoLevel","canUndo","canRedo","mutationObserver","mutationOptions","attributeOldValue","childList","characterData","characterDataOldValue","subtree","inThrottle","MutationObserver","handleMutations","startMutationObserver","lockMutationsListener","stopMutationObserver","observe","disconnect","mutations","findSentences","sentenceCollection","newSentences","collectSentencesFromString","collectSentencesInRange","sentencesCollection","createStringForGrammarCheck","ieSeparator","problemPhraseNode","problemDataAttrName","ignoreGrammarElementsRegex","marker","sentenceFull","increase","lastAddedIndex","withMarker","findStopChars","trimToOne","txt","addSentenceToArray","markuped","replacer","hasUppercaseLetter","startsWithSpaceAndUppercaseLetter","sentencesCollectedHandler","grammarAttrRuleName","createCacheSentences","getPhraseInfo","phraseObject","getPhrase","unknownSentences","foundGrammarErrors","addPhrase","phrasesInfo","phrases","deleteSentence","deleteSentencesByPhrase","sentencesStorage","keyPrefix","cachedData","phraseData","sentenceKey","incomingSentences","problemsSentences","prefixedSentence","stayAlive","added","getKeys","problemsStorage","ignoreStorage","phrasesStoragePrefix","addToDictionary","problemId","phraseKey","setIgnoreInInstance","isIgnoreInInstance","processGrammarProblem","sentencesInCurrentControl","findPhraseRangesForMarkup","findPhrases","phraseRanges","phraseRange","phraseIndex","differentLanguage","regExpress","problemPhrase","prevSymbolsRegExp","newLineSymbolRegExp","prevTrue","nextTrue","prevText","nextText","replacePhraseInSelection","ignorePhraseInSelection","ignorePhraseInDocument","_grammarNode","oldPhrase","replacePhraseByNode","ignorePhrases","dataAttributeRuleName","phraseNodes","_grammarPhrase","newPhrase","markupPhrase","removeMarkupFromPhrases","problemDataAttrNameRule","problemPhraseClass","_grammarParentsNode","_phrase","_grammarChildNodes","_nodesWithMarkup","_grammarNodes","nodesWithCachedPhrases","getGrammarNodes","getNeighbourGrammarNodes","leftGrammarNode","rightGrammarNode","getNearestGrammarNode","WEBSPELLCHECKER_CONFIG","isWSCBundleLoaded","webspellcheckerReady","isWSCReady","readyCallbacks","ECTemplate","createInstance","lowerCaseName","ECInstance","ECInstanceResult","createApp","extendAppInstance","createAppCallback","_ECInstance","openDialog","dialogName","setCssStyles","maxLengthModule","observeOnload","blank","loadWSCBundle","wscBundleLoadCallback","createControlById","filterBy","classes","ids","filters","isElementInFilters","visibilityApiData","filterType","_autoSearchCreationActivated","baseScript","optionAttrPrefix","autosearch","getOptionsFromDataAttrs","autoSearch","autostartup","disableoptionsstorage","configureFilterFunctionality","startActiveElementChecking","createInstanceIfRequired","handleVisibilityChange","stopActiveElementChecking","enableAutoSearchIn","enableautosearchin","disableAutoSearchIn","disableautosearchin","withoutFilters","isDisabledByDefault","disableByClass","getActiveElementWithoutInstance","isBody","instanceClass","iframeBody","parentsEditable","modelEditor","isCKEditor5","staticControlCreation","_staticControlCreationActivated","editableContols","webspellcheckerInstance","webspellcheckerAlreadyLoaded","setupAutofocus","firstAutofocusElement","wscElement","syncInstance","mirrorElement","mirrorElementTextContainer","isInput","isIE11","textNodeParts","nodesToRemove","properties","outer","inner","background","createMirrorElement","copyStyles","renderProblems","startChecking","startInputListener","handleScroll","updateTextInOriginalContainer","handleScrollWithDelay","elementTextContainer","borderColor","color","wordWrap","msOverflowStyle","lockMutations","mirrorElementTop","mirrorElementLeft","originalElementBox","mirrorElementProp","mirrorElementTextProp","computedHeight","checkTextChanges","stopChecking","offsetParentBox","handleInput","stringsDiff","getStringsDiff","filteredRanges","getFilteredProblemPositions","boundaries","getBoundaries","sortedBoundaries","sortBoundaries","isUpdated","updateTextInMirrorContainer","originalElementScrollWidth","originalElementScrollHeight","isOriginalTextCutted","fixNewLineSymbols","setSelectionRange","stopInputListener","spellingNodeName","grammarNodeName","getNodePartByPosition","operation","wsc","originalString","mirrorString","originalNewLine","lengthDiff","lengthToRemove","cursorPosition","selectionStart","isAdded","isEqual","moreText","lessText","changed","insertStart","deleteStart","spellingClass","grammarClass","markup","markupedProblems","markupProblems","replaceProblem","ignoreAllProblems","removeMarkupFromProblems","removeAllMarkupedProblems","elementProblemBox","minWidth","minHeight","mirrorElementProblemBox","maxZIndex","mirrorElementZIndex","shortcutKeys","extraKeys","rangeCoordinates","shortcutAction","leftProblemNodes","rightProblemNodes","getClientRects","removeLater","mirrorElementProblemBoxCoordinates","problemPrefix","prefixedText","markupedProblem","alreadyMarkuped","sameTypes","sameStart","sameEnd","getCoordinatesFromRange","createProblemElements","coordinates","relatedCoordinates","getMarkupedProblem","removeMarkupedProblem","ProblemTypesActions","setIgnoreStatus","textField","changeProblemsPosition","markapedArray","differentText","rangeWidth","rangeHeight","rangeTop","rangeLeft","repaintMirrorLayout","founded","problemsArray","processFoundedProblems","collections","prepareTokensCollectionsToGettingInfo","getTokensCollections","problemsInCurrentControl","deferredPrefix","problemsCollection","findProblemsRangesForMarkup","collectInfoFromNode","fullInfo","customModel","createPartInfo","tokenizeWords","wordBoundary","addToResult","nextChar","nextIndex","tokenizeSentences","withEndChar","addToBuffer","prevChar","prevIndex","getTextNodeByIndex","sentencePrefix","tokensInContainer","prefixedProblem","processedProblem","problemName","processProblem","problemInContainer","problemFromEvent","brokenNodes","collectBrokenNodes","langAttribute","nodesToCheck","attrText","realText","realTextLength","ruleName","isDifferentLanguages","inDictionary","itemToCheck","firstSymbol","lastSymbol","SCAYT","mapOptions","optionsMap","createInst","initMethod","inst","editorsOptionsMap","customer_id","ignoreGraytElementsRegex","graytAutoStartup","service_protocol","service_host","service_port","service_path","createEditorIntegration","eventMap","graytStateChanged","optionValues","oldOptions","_subscribe","_getOption","_fire","problemNodeFromSelection","_getProblemDescriptionText","_getProblemNodeFromSelection","isScaytNode","getScaytNodeAttributeName","getScaytLangList","getGraytNodeAttributeName","getGraytNodeRuleAttributeName","getGraytLangList","getSelectionNode","isGraytNode","isLicensed","mapValue","CKSCAYT","scaytOptionsMap","spellcheckLang","elementsToIgnore","contextMenuCommands","uiTabs","enableGrayt","customerId","basePaths","scayt","customscayt","ckscayt","tinymcescayt","setServiceParameters","setIfEmpty","serviceParams","scayt_srcUrl","contextMenuSections","createScaytControl","createScaytControlById","getScaytControlById","CUSTOMSCAYT","ckInst","origGetLocal","localMap","label_allCaps","label_mixedCase","label_mixedWithDigits","local","TINYMCE","configBackward","SCAYT_CONFIG","mappedName","replacePrefix","attributeValue","HTMLCollectionToArray","scaytAlreadyLoaded","inArray","Number","Infinity"],"mappings":"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","file":"wscbundle.js","sourcesContent":["(function(window) {\n(function() {\n    // Define local variables\n    var envTypes = {\n            node: 'node',\n            browser: 'browser'\n        },\n        env,\n        glob;\n\n    // Define environment (Browser or Node)\n    if (typeof window === 'undefined') {\n        glob = global;\n        env = envTypes.node;\n    } else {\n        glob = window;\n        env = envTypes.browser;\n    }\n\n    glob.WEBSPELLCHECKER = glob.WEBSPELLCHECKER || {};\n    glob.WEBSPELLCHECKER.env = env;\n    glob.WEBSPELLCHECKER.envTypes = envTypes;\n\n    if (env === envTypes.node) {\n        module.exports = glob.WEBSPELLCHECKER;\n    }\n})();\n// arrayutils.js\n/**\n * @fileoverview Static Module. WEBSPELLCHECKER ArrayUtils module.\n */\n(function() {\n    function init(Namespace) {\n        'use strict';\n\n        var ArrayUtils = {\n            arrayUnique: function( array, comparisonFunc ) {\n                var a = array.concat();\n                var comparisonFunc = comparisonFunc || function(a, b) {\n                    return a === b;\n                };\n\n                for (var i = 0; i < a.length; i++) {\n                    for (var j = i + 1; j < a.length; j++) {\n                        if (comparisonFunc(a[i], a[j])) {\n                            a.splice(j--, 1);\n                        }\n                    }\n                }\n\n                return a;\n            },\n\n            /**\n            * Transform Array-like arguments object to common array.\n            * @param {Arguments} args - Array-like object\n            */\n            argumentsToArray: function(args) {\n                var len = args.length,\n                    resultArray = new Array(len);\n\n                for (var i = 0; i < len; i++) {\n                    resultArray[i] = args[i];\n                }\n\n                return resultArray;\n            },\n\n            /**\n            * Create object based on provided arrays\n            * @param {Array} keys - array with keys of result object\n            * @param {Array} values - array with values of result object\n            */\n            zipArraysToObject: function(keysArr, valuesArr) {\n                var resultObject = {};\n\n                for (var i = 0; i < keysArr.length; i++) {\n                    resultObject[keysArr[i]] = valuesArr[i];\n                }\n\n                return resultObject;\n            },\n\n            /**\n            * Compare two arrays of strings and return result of their difference\n            * @param {Array.<String>} base - array of strings which will be compared to new array\n            * @param {Array.<String>} comparable - new array\n            * @returns {Array.<String>} - returned difference array\n            */\n            diffArrays: function( base, comparable ) {\n                var result = [],\n                    comparableLength = comparable.length; // difference\n\n                for (var i = 0; i < comparableLength; i++) {\n                    if ( this.indexOf(base, comparable[i]) < 0 ) {\n                        result.push(comparable[i]);\n                    }\n                }\n\n                return result;\n            }\n        };\n\n        Namespace.Utils = Namespace.Utils || {};\n        Namespace.Utils.ArrayUtils = ArrayUtils;\n    }\n\n    if (typeof window === 'undefined') {\n        module.exports = init;\n    }\n\n    if (typeof WEBSPELLCHECKER !== 'undefined') {\n        init(WEBSPELLCHECKER);\n    }\n})();\n\n// stringutils.js\n/**\n * @fileoverview Static Module. WEBSPELLCHECKER StringUtils module.\n */\n(function() {\n    function init(Namespace) {\n        'use strict';\n\n        var StringUtils = {\n            splice: function(string, startIndex, length, insertString){\n                return string.substring(0, startIndex) + insertString + string.substring(startIndex + length);\n            },\n            replaceFromTo: function(string, from, to, insertString){\n                return string.substring(0, from) + insertString + string.substring(to);\n            }\n        };\n\n        Namespace.Utils = Namespace.Utils || {};\n        Namespace.Utils.StringUtils = StringUtils;\n    }\n\n    if (typeof window === 'undefined') {\n        module.exports = init;\n    }\n\n    if (typeof WEBSPELLCHECKER !== 'undefined') {\n        init(WEBSPELLCHECKER);\n    }\n})();\n// browser.js\n/**\n * @fileoverview Static Module. WEBSPELLCHECKER Browser module.\n */\n(function() {\n    function init(Namespace) {\n        'use strict';\n\n        if (Namespace.env !== Namespace.envTypes.browser) {\n            return;\n        }\n\n        var Browser = (function() {\n            var agent = navigator.userAgent.toLowerCase(),\n                edge = agent.match(/edge[ \\/](\\d+.?\\d*)/),\n                trident = agent.indexOf('trident/') > -1,\n                ie = !!( edge || trident ),\n                opera = window.opera;\n\n            var browser = {\n                ie: ie,\n                edge: !!edge,\n                opera: (!!opera && opera.version),\n                webkit: ( !ie && agent.indexOf(' applewebkit/') > -1 ),\n                air: ( agent.indexOf(' adobeair/') > -1 ),\n                mac: ( agent.indexOf('macintosh') > -1 ),\n                quirks: ( document.compatMode == 'BackCompat' && (!document.documentMode || document.documentMode < 10) ),\n                mobile: ( agent.indexOf('mobile') > -1 ),\n                iOS: /(ipad|iphone|ipod)/.test(agent)\n            };\n\n            browser.gecko = (navigator.product == 'Gecko' && !browser.webkit && !browser.opera && !browser.ie);\n\n            if (browser.webkit) {\n                if ( agent.indexOf('chrome') > -1 ) {\n                    browser.chrome = true;\n                } else {\n                    browser.safari = true;\n                }\n            }\n\n            var version = 0;\n\n            if (browser.ie) {\n                if (edge) {\n                    version = parseFloat(edge[1]);\n                } else if (browser.quirks || !document.documentMode) {\n                    version = parseFloat( agent.match(/msie (\\d+)/)[1] );\n                } else {\n                    version = document.documentMode;\n                }\n            }\n\n            // Gecko\n            if (browser.gecko) {\n                var geckoRelease = agent.match(/rv:([\\d\\.]+)/);\n                if (geckoRelease) {\n                    geckoRelease = geckoRelease[1].split('.');\n                    version = geckoRelease[0] * 10000 + (geckoRelease[1] || 0) * 100 + (geckoRelease[2] || 0) * 1;\n                }\n            }\n\n            // Adobe AIR 1.0+\n            // Checked before Safari because AIR have the WebKit rich text editor\n            // features from Safari 3.0.4, but the version reported is 420.\n            if (browser.air)\n                version = parseFloat( agent.match(/ adobeair\\/(\\d+)/)[1] );\n\n            // WebKit 522+ (Safari 3+)\n            if (browser.webkit)\n                version = parseFloat( agent.match(/ applewebkit\\/(\\d+)/)[1] );\n\n            browser.version = version;\n\n            return browser;\n        }());\n\n        Namespace.Utils = Namespace.Utils || {};\n        Namespace.Utils.Browser = Browser;\n    }\n    \n    if (typeof window === 'undefined') {\n        module.exports = init;\n    }\n\n    if (typeof WEBSPELLCHECKER !== 'undefined') {\n        init(WEBSPELLCHECKER);\n    }\n})();\n// polyfills.js\n/**\n * @fileoverview Static Module. WEBSPELLCHECKER Polyfills module.\n */\n(function() {\n    'use strict';\n\n    if (typeof Object.assign != 'function') {\n        Object.assign = function(target, varArgs) {\n            'use strict';\n            if (target == null) { // TypeError if undefined or null\n                throw new TypeError('Cannot convert undefined or null to object');\n            }\n\n            var to = Object(target);\n\n            for (var index = 1; index < arguments.length; index++) {\n                var nextSource = arguments[index];\n\n                if (nextSource != null) { // Skip over if undefined or null\n                    for (var nextKey in nextSource) {\n                        // Avoid bugs when hasOwnProperty is shadowed\n                        if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n                            to[nextKey] = nextSource[nextKey];\n                        }\n                    }\n                }\n            }\n            return to;\n        };\n    }\n\n    if (typeof Object.create !== 'function') {\n        // Production steps of ECMA-262, Edition 5, 15.2.3.5\n        // Reference: http://es5.github.io/#x15.2.3.5\n        Object.create = (function() {\n            // To save on memory, use a shared constructor\n            function Temp() {}\n\n            // make a safe reference to Object.prototype.hasOwnProperty\n            var hasOwnProperty = Object.prototype.hasOwnProperty;\n\n            return function (O) {\n                // 1. If Type(O) is not Object or Null throw a TypeError exception.\n                if (typeof O != 'object') {\n                    throw TypeError('Object prototype may only be an Object or null');\n                }\n\n                // 2. Let obj be the result of creating a new object as if by the\n                //    expression new Object() where Object is the standard built-in\n                //    constructor with that name\n                // 3. Set the [[Prototype]] internal property of obj to O.\n                Temp.prototype = O;\n\n                var obj = new Temp();\n\n                Temp.prototype = null; // Let's not keep a stray reference to O...\n\n                // 4. If the argument Properties is present and not undefined, add\n                //    own properties to obj as if by calling the standard built-in\n                //    function Object.defineProperties with arguments obj and\n                //    Properties.\n                if (arguments.length > 1) {\n                    // Object.defineProperties does ToObject on its first argument.\n                    var Properties = Object(arguments[1]);\n\n                    for (var prop in Properties) {\n                        if (hasOwnProperty.call(Properties, prop) ) {\n                            obj[prop] = Properties[prop];\n                        }\n                    }\n                }\n\n                // 5. Return obj\n                return obj;\n            };\n        })();\n    }\n\n    if (!Object.keys) {\n        Object.keys = (function() {\n            var hasOwnProperty = Object.prototype.hasOwnProperty,\n                hasDontEnumBug = !({ toString: null }).propertyIsEnumerable('toString'),\n                dontEnums = [\n                    'toString',\n                    'toLocaleString',\n                    'valueOf',\n                    'hasOwnProperty',\n                    'isPrototypeOf',\n                    'propertyIsEnumerable',\n                    'constructor'\n                ],\n                dontEnumsLength = dontEnums.length;\n\n            return function(obj) {\n                if (typeof obj !== 'function' && (typeof obj !== 'object' || obj === null)) {\n                    throw new TypeError('Object.keys called on non-object');\n                }\n\n                var result = [], prop, i;\n\n                for (prop in obj) {\n                    if ( hasOwnProperty.call(obj, prop) ) {\n                        result.push(prop);\n                    }\n                }\n\n                if (hasDontEnumBug) {\n                    for (i = 0; i < dontEnumsLength; i++) {\n                        if ( hasOwnProperty.call(obj, dontEnums[i]) ) {\n                            result.push(dontEnums[i]);\n                        }\n                    }\n                }\n\n                return result;\n            };\n        }());\n    }\n\n    if (!Function.prototype.bind) {\n        Function.prototype.bind = function(oThis) {\n            if (typeof this !== 'function') {\n                // closest thing possible to the ECMAScript 5\n                // internal IsCallable function\n                throw new TypeError('Function.prototype.bind - what is trying to be bound is not callable');\n            }\n\n            var aArgs = Array.prototype.slice.call(arguments, 1),\n                fToBind = this,\n                fNOP    = function() {},\n                fBound  = function() {\n                    return fToBind.apply(this instanceof fNOP && oThis\n                            ? this\n                            : oThis,\n                            aArgs.concat(Array.prototype.slice.call(arguments)));\n                };\n\n            fNOP.prototype = this.prototype;\n            fBound.prototype = new fNOP();\n\n            return fBound;\n        };\n    }\n\n    if (!String.prototype.trim) {\n        String.prototype.trim = function() {\n            return this.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\n        };\n    }\n\n    // Production steps of ECMA-262, Edition 5, 15.4.4.14\n    // Reference: http://es5.github.io/#x15.4.4.14\n    if (!Array.prototype.indexOf) {\n        Array.prototype.indexOf = function(searchElement, fromIndex) {\n            var k;\n\n            // 1. Let o be the result of calling ToObject passing\n            //    the this value as the argument.\n            if (this == null) {\n                throw new TypeError('\"this\" is null or not defined');\n            }\n\n            var o = Object(this);\n\n            // 2. Let lenValue be the result of calling the Get\n            //    internal method of o with the argument \"length\".\n            // 3. Let len be ToUint32(lenValue).\n            var len = o.length >>> 0;\n\n            // 4. If len is 0, return -1.\n            if (len === 0) {\n                return -1;\n            }\n\n            // 5. If argument fromIndex was passed let n be\n            //    ToInteger(fromIndex); else let n be 0.\n            var n = fromIndex | 0;\n\n            // 6. If n >= len, return -1.\n            if (n >= len) {\n                return -1;\n            }\n\n            // 7. If n >= 0, then Let k be n.\n            // 8. Else, n<0, Let k be len - abs(n).\n            //    If k is less than 0, then let k be 0.\n            k = Math.max(n >= 0 ? n : len - Math.abs(n), 0);\n\n            // 9. Repeat, while k < len\n            while (k < len) {\n                // a. Let Pk be ToString(k).\n                //   This is implicit for LHS operands of the in operator\n                // b. Let kPresent be the result of calling the\n                //    HasProperty internal method of o with argument Pk.\n                //   This step can be combined with c\n                // c. If kPresent is true, then\n                //    i.  Let elementK be the result of calling the Get\n                //        internal method of o with the argument ToString(k).\n                //   ii.  Let same be the result of applying the\n                //        Strict Equality Comparison Algorithm to\n                //        searchElement and elementK.\n                //  iii.  If same is true, return k.\n                if (k in o && o[k] === searchElement) {\n                    return k;\n                }\n\n                k++;\n            }\n\n            return -1;\n        };\n    }\n\n    if (!Array.prototype.filter) {\n        Array.prototype.filter = function(fun/*, thisArg*/) {\n\n            if (this === void 0 || this === null) {\n                throw new TypeError();\n            }\n\n            var t = Object(this);\n            var len = t.length >>> 0;\n\n            if (typeof fun !== 'function') {\n                throw new TypeError();\n            }\n\n            var res = [];\n            var thisArg = arguments.length >= 2 ? arguments[1] : void 0;\n\n            for (var i = 0; i < len; i++) {\n                if (i in t) {\n                    var val = t[i];\n\n                    // NOTE: Technically this should Object.defineProperty at\n                    //       the next index, as push can be affected by\n                    //       properties on Object.prototype and Array.prototype.\n                    //       But that method's new, and collisions should be\n                    //       rare, so use the more-compatible alternative.\n                    if (fun.call(thisArg, val, i, t)) {\n                        res.push(val);\n                    }\n                }\n            }\n\n            return res;\n        };\n    }\n\n    if (!Array.isArray) {\n        Array.isArray = function(arg) {\n            return Object.prototype.toString.call(arg) === '[object Array]';\n        };\n    }\n\n    // Production steps of ECMA-262, Edition 5, 15.4.4.19\n    // Reference: http://es5.github.io/#x15.4.4.19\n    if (!Array.prototype.map) {\n\n        Array.prototype.map = function(callback/*, thisArg*/) {\n\n            var T, A, k;\n\n            if (this == null) {\n            throw new TypeError('this is null or not defined');\n            }\n\n            // 1. Let O be the result of calling ToObject passing the |this|\n            //    value as the argument.\n            var O = Object(this);\n\n            // 2. Let lenValue be the result of calling the Get internal\n            //    method of O with the argument \"length\".\n            // 3. Let len be ToUint32(lenValue).\n            var len = O.length >>> 0;\n\n            // 4. If IsCallable(callback) is false, throw a TypeError exception.\n            // See: http://es5.github.com/#x9.11\n            if (typeof callback !== 'function') {\n            throw new TypeError(callback + ' is not a function');\n            }\n\n            // 5. If thisArg was supplied, let T be thisArg; else let T be undefined.\n            if (arguments.length > 1) {\n            T = arguments[1];\n            }\n\n            // 6. Let A be a new array created as if by the expression new Array(len)\n            //    where Array is the standard built-in constructor with that name and\n            //    len is the value of len.\n            A = new Array(len);\n\n            // 7. Let k be 0\n            k = 0;\n\n            // 8. Repeat, while k < len\n            while (k < len) {\n\n            var kValue, mappedValue;\n\n            // a. Let Pk be ToString(k).\n            //   This is implicit for LHS operands of the in operator\n            // b. Let kPresent be the result of calling the HasProperty internal\n            //    method of O with argument Pk.\n            //   This step can be combined with c\n            // c. If kPresent is true, then\n            if (k in O) {\n\n                // i. Let kValue be the result of calling the Get internal\n                //    method of O with argument Pk.\n                kValue = O[k];\n\n                // ii. Let mappedValue be the result of calling the Call internal\n                //     method of callback with T as the this value and argument\n                //     list containing kValue, k, and O.\n                mappedValue = callback.call(T, kValue, k, O);\n\n                // iii. Call the DefineOwnProperty internal method of A with arguments\n                // Pk, Property Descriptor\n                // { Value: mappedValue,\n                //   Writable: true,\n                //   Enumerable: true,\n                //   Configurable: true },\n                // and false.\n\n                // In browsers that support Object.defineProperty, use the following:\n                // Object.defineProperty(A, k, {\n                //   value: mappedValue,\n                //   writable: true,\n                //   enumerable: true,\n                //   configurable: true\n                // });\n\n                // For best browser support, use the following:\n                A[k] = mappedValue;\n            }\n            // d. Increase k by 1.\n            k++;\n            }\n\n            // 9. return A\n            return A;\n        };\n    }\n\n    if (!String.prototype.includes) {\n        String.prototype.includes = function() {\n            return String.prototype.indexOf.apply(this, arguments) !== -1;\n        };\n    }\n\n    // Production steps of ECMA-262, Edition 5, 15.4.4.21\n    // Reference: http://es5.github.io/#x15.4.4.21\n    // https://tc39.github.io/ecma262/#sec-array.prototype.reduce\n    if (!Array.prototype.reduce) {\n        Array.prototype.reduce = function(callback/*, initialValue*/) {\n        'use strict';\n            if (this == null) {\n                throw new TypeError('Array.prototype.reduce called on null or undefined');\n            }\n            if (typeof callback !== 'function') {\n                throw new TypeError(callback + ' is not a function');\n            }\n            var t = Object(this), len = t.length >>> 0, k = 0, value;\n            if (arguments.length >= 2) {\n                value = arguments[1];\n            } else {\n                while (k < len && ! (k in t)) {\n                    k++;\n                }\n                if (k >= len) {\n                    throw new TypeError('Reduce of empty array with no initial value');\n                }\n                value = t[k++];\n            }\n            for (; k < len; k++) {\n                if (k in t) {\n                    value = callback(value, t[k], k, t);\n                }\n            }\n            return value;\n        };\n    }\n\n    // Production steps of ECMA-262, Edition 5, 15.4.4.18\n    // Reference: http://es5.github.io/#x15.4.4.18\n    if (!Array.prototype.forEach) {\n        Array.prototype.forEach = function(callback/*, thisArg*/) {\n            var T, k;\n\n            if (this == null) {\n                throw new TypeError('this is null or not defined');\n            }\n\n            // 1. Let O be the result of calling toObject() passing the\n            // |this| value as the argument.\n            var O = Object(this);\n\n            // 2. Let lenValue be the result of calling the Get() internal\n            // method of O with the argument \"length\".\n            // 3. Let len be toUint32(lenValue).\n            var len = O.length >>> 0;\n\n            // 4. If isCallable(callback) is false, throw a TypeError exception.\n            // See: http://es5.github.com/#x9.11\n            if (typeof callback !== 'function') {\n                throw new TypeError(callback + ' is not a function');\n            }\n\n            // 5. If thisArg was supplied, let T be thisArg; else let\n            // T be undefined.\n            if (arguments.length > 1) {\n                T = arguments[1];\n            }\n\n            // 6. Let k be 0.\n            k = 0;\n\n            // 7. Repeat while k < len.\n            while (k < len) {\n                var kValue;\n\n                // a. Let Pk be ToString(k).\n                //    This is implicit for LHS operands of the in operator.\n                // b. Let kPresent be the result of calling the HasProperty\n                //    internal method of O with argument Pk.\n                //    This step can be combined with c.\n                // c. If kPresent is true, then\n                if (k in O) {\n                    // i. Let kValue be the result of calling the Get internal\n                    // method of O with argument Pk.\n                    kValue = O[k];\n\n                    // ii. Call the Call internal method of callback with T as\n                    // the this value and argument list containing kValue, k, and O.\n                    callback.call(T, kValue, k, O);\n                }\n\n                // d. Increase k by 1.\n                k++;\n            }\n            // 8. return undefined.\n        };\n    }\n\n    if (!Array.prototype.includes) {\n        Array.prototype.includes = function(searchElement/*, fromIndex*/) {\n            var O = Object(this);\n            var len = parseInt(O.length) || 0;\n\n            if (len === 0) {\n                return false;\n            }\n\n            var n = parseInt(arguments[1]) || 0;\n            var k;\n\n            if (n >= 0) {\n                k = n;\n            } else {\n                k = len + n;\n\n                if (k < 0) {\n                    k = 0;\n                }\n            }\n\n            while (k < len) {\n                var currentElement = O[k];\n\n                if ( searchElement === currentElement ||\n                    (searchElement !== searchElement && currentElement !== currentElement) ) {\n                    return true;\n                }\n\n                k++;\n            }\n\n            return false;\n        };\n    }\n})();\n// typechecker.js\n/**\n * @fileoverview Static Module. WEBSPELLCHECKER TypeChecker module.\n */\n(function() {\n\tfunction init(Namespace) {\n       var TypeChecker = {\n            isString: function(value) {\n                return typeof value === 'string';\n            },\n            notEmptyString: function(value) {\n                return value !== '' && TypeChecker.isString(value);\n            },\n            isArray: function(value) {\n                return {}.toString.call(value) === '[object Array]';\n            },\n            // Checks if the object is a hash, which is equivalent to an object that\n            // is neither an array nor a function.\n            isHash: function(value) {\n                return TypeChecker.isObject(value) && !TypeChecker.isArray(value) && !TypeChecker.isFunction(value);\n            },\n                // Checks if the value is a boolean\n            isBoolean: function(value) {\n                return typeof value === 'boolean';\n            },// Uses the `Object` function to check if the given argument is an object.\n            isObject: function(obj) {\n                return obj === Object(obj);\n            },\n            // Simply checks if the object is an instance of a date\n            isDate: function(obj) {\n                return obj instanceof Date;\n            },\n            // Returns false if the object is `null` of `undefined`\n            isDefined: function(obj) {\n                return obj !== null && obj !== undefined;\n            },\n            isEmpty: function(value) {\n                var attr;\n\n                // Null and undefined are empty\n                if (!TypeChecker.isDefined(value)) {\n                    return true;\n                }\n\n                // functions are non empty\n                if (TypeChecker.isFunction(value)) {\n                    return false;\n                }\n\n                // Whitespace only strings are empty\n                if (TypeChecker.isString(value)) {\n                    return TypeChecker.EMPTY_STRING_REGEXP.test(value);\n                }\n\n                // For arrays we use the length property\n                if (TypeChecker.isArray(value)) {\n                    return value.length === 0;\n                }\n\n                // Dates have no attributes but aren't empty\n                if (TypeChecker.isDate(value)) {\n                    return false;\n                }\n\n                // If we find at least one property we consider it non empty\n                if (TypeChecker.isObject(value)) {\n                    for (attr in value) {\n                        return false;\n                    }\n                    \n                    return true;\n                }\n\n                return false;\n            },\n            // Returns false if the object is not a function\n            isFunction: function(value) {\n                return typeof value === 'function';\n            },\n            // A simple check to verify that the value is an integer. Uses `isNumber`\n            // and a simple modulo check.\n            isInteger: function(value) {\n                return TypeChecker.isNumber(value) && value % 1 === 0;\n            },\n            // Checks if the value is a number. TypeChecker function does not consider NaN a\n            // number like many other `isNumber` functions do.\n            isNumber: function(value) {\n                return typeof value === 'number' && !isNaN(value);\n            },\n            // Checks if the value is a number. TypeChecker function does not consider NaN a\n            // number like many other `isNumber` functions do.\n            isPositive: function(value) {\n                return typeof value === 'number' && value >= 0;\n            }\n        };\n\n        Namespace.Utils = Namespace.Utils || {};\n        Namespace.Utils.TypeChecker = TypeChecker;\n    }\n\n    if (typeof window === 'undefined') {\n        module.exports = init;\n    }\n\n    if (typeof WEBSPELLCHECKER !== 'undefined') {\n        init(WEBSPELLCHECKER);\n    }\n})();\n\n// regularssources.js\n/**\n * @fileoverview Static Module.\n */\n(function() {\n    function init(Namespace) {\n        'use strict';\n\n        var RegularsSources = {\n            space: \"[\\\\s\\\\xA0]\",\n            commonSpace: \" \",\n            quotes: \"'\\\"\",\n            nonWhiteSpaceChar: \"\\\\S\",\n            dot: '\\\\.',\n            anyChar: '.',\n            comma: '\\\\,',\n            EOL: '[\\r\\n(\\r\\n)]',\n            digits : '[0-9]',\n            //Punctuations\n            HtmlSpaceSymbol:  String.fromCharCode(160),\n            // \\u061F - Arabic question mark, \\u060C - Arabic comma, \\u061B - Arabic semicolon\n            textPunctuation: \" ,\\\"\\^\\$\\*\\+\\?\\=\\!\\:\\|\\\\\\/\\\\(\\\\)\\\\[\\\\]\\\\{\\\\}\\\\>\\\\<\\\\@\\\\%\\\\&\\\\#\\\\;\\\\_\\\\~\\\\u061F\\\\u060C\\\\u061B\\\\u0001-\\\\u001F\\\\u0080-\\\\u00B6\\\\u00B8-\\\\u00BF\\\\u2000-\\\\u200A\\\\u200C-\\\\u266F\\\\u2E00-\\\\u2E7F\",\n            situationalSeparators: \"\\\\.\\\\-\\\\'\",\n            sentenceEndChars: \"\\\\.!?\",\n            specialCharacters: String.fromCharCode(8203) + String.fromCharCode(65279),\n            ip: '/^((?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))*$/',\n            twoAndMore: '{2,}',\n            whiteSpace: \" \\\\f\\\\n\\\\r\\\\t\\\\v\\\\uFEFF\\\\u0085\\\\u00A0\\\\u1680\\\\u180E\\\\u2000-\\\\u200C\\\\u2028\\\\u2029\\\\u202F\\\\u205F\\\\u3000\"\n        };\n\n        Namespace.RegularsSources = RegularsSources;\n    }\n\n    if (typeof window === 'undefined') {\n        module.exports = init;\n    }\n\n    if (typeof WEBSPELLCHECKER !== 'undefined') {\n        init(WEBSPELLCHECKER);\n    }\n})();\n// logger.js\n/**\n * @fileoverview Static Module. Logger manager for WEBSPELLCHECKER\n */\n(function() {\n\tfunction init( Namespace ) {\n\t\t'use strict';\n\n\t\tvar methods = ['log', 'warn', 'info', 'debug'],\n\t\t\tbrowser = Namespace.Utils.browser;\n\n\t\tJSON.stringify = JSON.stringify || function() { return arguments };\n\n\t\t// rewrite the property, if the property is not supported, applied empty function\n\t\tfor (var i = 0; i < methods.length; i++) {\n\t\t\tconsole[methods[i]] = console[methods[i]] || function() {};\n\t\t};\n\n\t\tvar trigger = false;\n\n\t\t/**\n\t\t * @exports WEBSPELLCHECKER.logger\n\t\t */\n\t\tvar logger = {\n\t\t\t/**\n\t\t\t * Enable/disable logging in SCAYT\n\t\t\t * @memberof SCAYT.prototype#\n\t\t\t * @param {boolean} state - State\n\t\t\t * @returns {boolean} - Variable\n\t\t\t */\n\t\t\tisON: function(state) {\n\t\t\t\tstate = state || false;\n\t\t\t\ttrigger = ( !!state ? true : (/scaytDebug\\b/.test(location.hash)) );\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Check browser\n\t\t\t * @memberof SCAYT.prototype#\n\t\t\t * @type {boolean}\n\t\t\t * @returns {boolean} - true/false\n\t\t\t */\n\t\t\tisIE: (browser) ? browser.ie : false,\n\n\t\t\t/**\n\t\t\t * function for logging\n\t\t\t * @memberof SCAYT.prototype#\n\t\t\t * @param {object} data - incoming messages\n\t\t\t * @returns {string} - output message\n\t\t\t */\n\t\t\tlog: function(data) {\n\t\t\t\tvar options = data || {},\n\t\t\t\t\tmessage = undefined;\n\n\t\t\t\tif (!trigger) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (typeof options === 'object') {\n\t\t\t\t\tmessage = [options.name, ':: ' + options.msg, options.data];\n\t\t\t\t} else {\n\t\t\t\t\tmessage = [options];\n\t\t\t\t}\n\t\t\t\tif (this.isIE) {\n\t\t\t\t\tmessage = [options.name, ':: ' + options.msg, JSON.stringify(options.data, null, \"\")];\n\t\t\t\t\tmessage = message.join(' ');\n\t\t\t\t\tconsole.log(message);\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log.apply(console, message);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Avoid 'console' errors in browsers that lack a console.\n\t\t\t * @memberof SCAYT.prototype#\n\t\t\t * @type {object}\n\t\t\t * @returns {object} - real browser console or object with empty function to avoid 'console' errors\n\t\t\t */\n\t\t\tconsole: console\n\t\t};\n\n\t\t/**\n\t\t * Static Module. logger manager for SCAYT\n\t\t *\n\t\t * @alias SCAYT.prototype.logger\n\t\t */\n\t\tNamespace.logger = logger;\n\t}\n\n\tif (typeof window === 'undefined') {\n\t\tmodule.exports = init;\n\t}\n\n\tif (typeof WEBSPELLCHECKER !== 'undefined' && !('logger' in WEBSPELLCHECKER)) {\n\t\tinit(WEBSPELLCHECKER);\n\t}\n})();\n\n// io.js\n/**\n * @fileoverview Static Module. InputOutput Manager of WEBSPELLCHECKER\n */\n(function() {\n\tfunction init(Namespace) {\n\t\tvar Utils = Namespace.Utils,\n\t\t\tlogger = Namespace.logger.console;\n\n\t\t/**\n\t\t * Mocked request\n\t\t * @static\n\t\t * @privat\n\t\t */\n\t\tvar isMocked = false,\n\t\t\t/**\n\t\t\t * Mocked params\n\t\t\t * @static\n\t\t\t * @privat\n\t\t\t */\n\t\t\tmockParams = [];\n\n\t\t/**\n\t\t * @exports WEBSPELLCHECKER.IO\n\t\t */\n\t\tvar IO = {\n\t\t\t/**\n\t\t\t * Link to XMLHttpRequest constructor\n\t\t\t *\n\t\t\t * @alias WEBSPELLCHECKER.IO\n\t\t\t */\n\t\t\tXMLHttpRequest: (typeof XMLHttpRequest !== 'undefined') ? XMLHttpRequest : null,\n\t\t\t/**\n\t\t\t * Link to XDomainRequest constructor\n\t\t\t *\n\t\t\t * @alias WEBSPELLCHECKER.IO\n\t\t\t */\n\t\t\tXDomainRequest: (typeof XDomainRequest !== 'undefined') ? XDomainRequest : null,\n\t\t\t/**\n\t\t\t * Make url\n\t\t\t * @param {Object} params Define params that we need\n\t\t\t * @constructor\n\t\t\t */\n\t\t\tURL: function( params ) {\n\t\t\t\tparams = params || {};\n\n\t\t\t\tvar _protocol = this.protocol = params.protocol || 'http',\n\t\t\t\t\t_host = this.host = params.host || 'localhost',\n\t\t\t\t\t_port = this.port = params.port || '80',\n\t\t\t\t\t_path = this.path = params.path || '',\n\t\t\t\t\trequest_params = {},\n\t\t\t\t\trequest_meta_params = {};\n\n\t\t\t\tthis.addParameter = function(name, value) {\n\t\t\t\t\tif (name && value) {\n\t\t\t\t\t\trequest_params[name] = value;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this;\n\t\t\t\t};\n\n\t\t\t\tthis.addParameters = function(parameters) {\n\t\t\t\t\tfor (var param in parameters) {\n\t\t\t\t\t\tthis.addParameter(param, parameters[param]);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this;\n\t\t\t\t};\n\n\t\t\t\tthis.addMetaParameters = function(parameters) {\n\t\t\t\t\tObject.assign(request_meta_params, parameters);\n\n\t\t\t\t\treturn this;\n\t\t\t\t};\n\n\t\t\t\tthis.getParameter = function(name) {\n\t\t\t\t\treturn request_params[name];\n\t\t\t\t};\n\n\t\t\t\tthis.joinParams =function(params) {\n\t\t\t\t\tvar result = '';\n\n\t\t\t\t\tparams = params || request_params;\n\n\t\t\t\t\tif ( Object.keys(params).length ) {\n\t\t\t\t\t\tfor (var k in params) {\n\t\t\t\t\t\t\tresult += k + '=' + encodeURIComponent(params[k]) + '&';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn result.slice(0, -1);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn '';\n\t\t\t\t};\n\n\t\t\t\tthis.joinRequestParams = function() {\n\t\t\t\t\treturn this.joinParams(request_params);\n\t\t\t\t};\n\n\t\t\t\tthis.joinRequestMetaParams = function() {\n\t\t\t\t\treturn this.joinParams(request_meta_params);\n\t\t\t\t};\n\n\t\t\t\tthis.joinUrl = function() {\n\t\t\t\t\tvar urlString = '';\n\n\t\t\t\t\turlString += _protocol + '://';\n\t\t\t\t\turlString += _host;\n\t\t\t\t\turlString += _port == '80' ? '/' : ':' +_port + '/';\n\t\t\t\t\turlString += _path.replace(/^\\/*/, '');\n\n\t\t\t\t\treturn urlString;\n\t\t\t\t};\n\n\t\t\t\tthis.joinUrlWithParams = function(paramsString) {\n\t\t\t\t\tvar urlString = this.joinUrl();\n\n\t\t\t\t\turlString += paramsString ? '?' + paramsString : '';\n\n\t\t\t\t\treturn urlString;\n\t\t\t\t};\n\n\t\t\t\tthis.joinUrlWithMetadata = function() {\n\t\t\t\t\treturn this.joinUrlWithParams( this.joinRequestMetaParams() );\n\t\t\t\t};\n\n\t\t\t\tthis.build = function() {\n\t\t\t\t\treturn this.joinUrlWithParams( this.joinRequestParams() );\n\t\t\t\t};\n\n\t\t\t\tthis.clear = function() {\n\t\t\t\t\trequest_params = {};\n\t\t\t\t\trequest_meta_params = {};\n\n\t\t\t\t\treturn this;\n\t\t\t\t};\n\t\t\t},\n\t\t\t/**\n\t\t\t * Make reqest using AJAX way\n\t\t\t * @param {Object} params Define params that we need\n\t\t\t * @param {Object} params.url URL object for this request\n\t\t\t * @param {String} params.onSuccess Handler successful response from the server\n\t\t\t * @param {String} params.onError Handler unsuccessful response from the server\n\t\t\t * @return {Object} AJAX request custom object\n\t\t\t */\n\t\t\tAJAX: function(params) {\n\t\t\t\tvar ajax = {},\n\t\t\t\t\tparse = JSON.parse || function() { return arguments };\n\n\t\t\t\tif (isMocked) {\n\n\t\t\t\t\tfor (var i = 0; i < mockParams.length; i++) {\n\t\t\t\t\t\t(function(i) {\n\t\t\t\t\t\t\tif (mockParams[i].success) {\n\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\tparams.onSuccess(mockParams[i].success);\n\t\t\t\t\t\t\t\t}, 0);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (mockParams[i].error) {\n\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\tparams.onError(mockParams[i].error);\n\t\t\t\t\t\t\t\t}, 0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})(i);\n\t\t\t\t\t}\n\n\t\t\t\t\t// TODO: create Object for GET method and refactor current method\n\t\t\t\t\treturn {finished : true};\n\t\t\t\t}\n\n\t\t\t\tajax.params = {\n\t\t\t\t\turl: params.url.joinUrlWithMetadata(),\n\t\t\t\t\tdata: params.url.joinRequestParams(),\n\t\t\t\t\tonSuccess: params.onSuccess,\n\t\t\t\t\tonError: params.onError\n\t\t\t\t};\n\n\t\t\t\tajax.request = new IO.XMLHttpRequest();\n\n\t\t\t\tif (IO.XDomainRequest !== null) {\n\t\t\t\t\t// for IE's versions 8, 9\n\t\t\t\t\tajax.request = new IO.XDomainRequest();\n\t\t\t\t} else if ('withCredentials' in ajax.request) {\n\t\t\t\t\t// Set the value to 'true' if you'd like to pass cookies to the server.\n\t\t\t\t\tajax.request.withCredentials = false;\n\t\t\t\t} else {\n\t\t\t\t\tlogger.warn('Cors is not supported by this browser!');\n\t\t\t\t}\n\n\t\t\t\tajax.request.onload = function() {\n\t\t\t\t\tvar responseData = ajax.request.responseText,\n\t\t\t\t\t\tresponseStatus = ajax.request.status;\n\n\t\t\t\t\tajax.success = true;\n\n\t\t\t\t\tif (responseStatus && responseStatus !== 200) {\n\t\t\t\t\t\tajax.params.onError && ajax.params.onError({});\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tresponseData = parse(responseData);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tlogger.warn(\"CORS response parsing error: \" + error);\n\t\t\t\t\t\t\tajax.params.onError && ajax.params.onError();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (responseData && responseData.error) {\n\t\t\t\t\t\t\tresponseData.message && logger.warn(responseData.message);\n\t\t\t\t\t\t\tajax.params.onError && ajax.params.onError(responseData);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tajax.params.onSuccess && ajax.params.onSuccess(responseData);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tajax.request.onerror = function() {\n\t\t\t\t\tconsole.warn('The WebSpellChecker Service is currently unavailable.');\n\t\t\t\t\tajax.error = true;\n\t\t\t\t\tajax.params.onError && ajax.params.onError({});\n\t\t\t\t};\n\n\t\t\t\tajax.request.onabort = function() {\n\t\t\t\t\tajax.error = true;\n\t\t\t\t\tajax.params.onError && ajax.params.onError({});\n\t\t\t\t};\n\n\t\t\t\tajax.request.open('POST', ajax.params.url, true);\n\t\t\t\t// Fixed IE9 bug with ajax requests.\n\t\t\t\tif (Utils.Browser.ie && Utils.Browser.version === 9) {\n\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\tajax.request.send(ajax.params.data);\n\t\t\t\t\t}, 500);\n\t\t\t\t} else {\n\t\t\t\t\tajax.request.send(ajax.params.data);\n\t\t\t\t}\n\n\t\t\t\treturn ajax;\n\t\t\t},\n\t\t\t/**\n\t\t\t * Make reqest using JSONP way\n\t\t\t * @param {Object} params Define params that we need\n\t\t\t * @param {Object} params.url URL object for this request\n\t\t\t * @param {String} params.onSuccess Handler successful response from the server\n\t\t\t * @param {String} params.onError Handler unsuccessful response from the server\n\t\t\t * @return {Object} Script Model\n\t\t\t */\n\t\t\tJSONP: function(params) {\n\t\t\t\tvar callbackName = ( \"callback\" + Math.random().toString(20).substr(2,9) ),\n\t\t\t\t\tcallbackFunctionPath = \"WEBSPELLCHECKER.IO.\";\n\n\t\t\t\tif (isMocked) {\n\n\t\t\t\t\tfor (var i = 0; i < mockParams.length; i++) {\n\t\t\t\t\t\tif (mockParams[i].success) {\n\t\t\t\t\t\t\tparams.onSuccess(mockParams[i].success);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (mockParams[i].error) {\n\t\t\t\t\t\t\tparams.onError(mockParams[i].error);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// TODO: create Object for GET method and refactor current method\n\t\t\t\t\treturn callbackName;\n\t\t\t\t}\n\n\t\t\t\tparams.url.addParameter(\"callback\", callbackFunctionPath + callbackName);\n\n\t\t\t\treturn new IO.Script({\n\t\t\t\t\turl: params.url.build(),\n\t\t\t\t\tid: callbackName,\n\t\t\t\t\tcallbackName: callbackName,\n\t\t\t\t\tonSuccess: params.onSuccess,\n\t\t\t\t\tonError: params.onError\n\t\t\t\t});\n\t\t\t},\n\t\t\t/**\n\t\t\t * Make reqest using Node.js Http server.\n\t\t\t * @param {Object} params Define params that we need\n\t\t\t * @param {Object} params.url URL object for this request\n\t\t\t * @param {String} params.onSuccess Handler successful response from the server\n\t\t\t * @param {String} params.onError Handler unsuccessful response from the server\n\t\t\t * @return {Object} Script Model\n\t\t\t */\n\t\t\tNODE: function(params) {\n\t\t\t\tvar url = params.url,\n\t\t\t\t\tmetaParams = url.joinRequestMetaParams(),\n\t\t\t\t\tclient = (url.protocol === 'http') ? require('http') : require('https'),\n\t\t\t\t\trequestOptions = {\n\t\t\t\t\t\tprotocol: url.protocol + ':',\n\t\t\t\t\t\tport: url.port,\n\t\t\t\t\t\thostname: url.host,\n\t\t\t\t\t\tpath: '/' + url.path + (metaParams ? '?' + metaParams : ''),\n\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t'Content-Type': 'text/javascript; charset=UTF-8',\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\trequest;\n\n\t\t\t\trequest = client.request(requestOptions, function(response) {\n\t\t\t\t\tif (response.statusCode < 200 || response.statusCode > 299) {\n\t\t\t\t\t\tparams.onError && params.onError('Failed to load page, status code: ' + response.statusCode);\n\t\t\t\t\t}\n\n\t\t\t\t\t// temporary data holder\n\t\t\t\t\tvar body = [];\n\n\t\t\t\t\t// on every content chunk, push it to the data array\n\t\t\t\t\tresponse.on('data', function(chunk) {\n\t\t\t\t\t\tbody.push(chunk);\n\t\t\t\t\t});\n\n\t\t\t\t\t// we are done, resolve promise with those joined chunks\n\t\t\t\t\tresponse.on('end', function(){\n\t\t\t\t\t\tvar responseData = body.join('');\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tresponseData = JSON.parse(responseData);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tlogger.warn(\"CORS response parsing error: \" + error);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif(responseData && responseData.error) {\n\t\t\t\t\t\t\tresponseData.message && logger.warn(responseData.message);\n\t\t\t\t\t\t\tparams.onError && params.onError(responseData);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tparams.onSuccess && params.onSuccess(responseData);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\trequest.on('error', function(error) {\n\t\t\t\t\tparams.onError && params.onError({});\n\t\t\t\t});\n\n\t\t\t\trequest.write( params.url.joinRequestParams() );\n\t\t\t\trequest.end();\n\n\t\t\t\treturn request;\n\t\t\t},\n\t\t\t/**\n\t\t\t * Create script tag\n\t\t\t * @param {Object} params Define params that we need\n\t\t\t * @param {String} [params.url=''] URL for script src attribute\n\t\t\t * @param {String} [params.id=''] ID for script id attribute\n\t\t\t * @param {String} params.callbackName Callback name for JSONP request\n\t\t\t * @param {String} params.onSuccess Handler successful response from the server\n\t\t\t * @param {String} params.onError Handler unsuccessful response from the server\n\t\t\t * @return {HTMLScriptElement} HTML Script Element\n\t\t\t * @constructor\n\t\t\t */\n\t\t\tScript: function( params ) {\n\t\t\t\tparams = params || {};\n\t\t\t\tvar self = this,\n\t\t\t\t\tresponseData, // Variable for JSONP response data\n\t\t\t\t\thead;\n\n\t\t\t\tvar registerCallback = function() {\n\t\t\t\t\tWEBSPELLCHECKER.IO[params.callbackName] = function(data) {\n\t\t\t\t\t\tresponseData = data;\n\t\t\t\t\t};\n\t\t\t\t};\n\n\t\t\t\tvar removeCallback = function() {\n\t\t\t\t\tdelete WEBSPELLCHECKER.IO[params.callbackName];\n\t\t\t\t};\n\n\t\t\t\tvar removeAll = function() {\n\t\t\t\t\tremoveCallback();\n\t\t\t\t\tself.removeScript();\n\t\t\t\t};\n\n\t\t\t\tparams.callbackName && registerCallback();\n\n\t\t\t\tvar script = document.createElement('script');\n\n\t\t\t\tscript['type'] = 'text/javascript';\n\t\t\t\tscript['id'] = params.id ? params.id : '';\n\t\t\t\tscript['src'] = params.url ? params.url : '';\n\t\t\t\tscript['charset'] = 'UTF-8';\n\n\t\t\t\tscript.onload = function() {\n\t\t\t\t\tif (this.success) return; // for tests and for single call in IE8\n\n\t\t\t\t\tthis.success = true;\n\n\t\t\t\t\tif (params.callbackName) {\n\t\t\t\t\t\tif (responseData && responseData.error) {\n\t\t\t\t\t\t\tresponseData.message && logger.warn(responseData.message);\n\t\t\t\t\t\t\tparams.onError && params.onError(responseData);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tparams.onSuccess && params.onSuccess(responseData);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tremoveAll();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tparams.onSuccess && params.onSuccess();\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tscript.onerror = function() {\n\t\t\t\t\tthis.error = true; // for tests\n\n\t\t\t\t\tparams.onError && params.onError({});\n\n\t\t\t\t\tif (params.callbackName) {\n\t\t\t\t\t\tremoveAll();\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tscript.onreadystatechange = function() {\n\t\t\t\t\tvar self = this;\n\n\t\t\t\t\tif (this.readyState === 'complete' || this.readyState === 'loaded') {\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\tself.onload();\n\t\t\t\t\t\t}, 0);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\thead = document.getElementsByTagName('head')[0];\n\t\t\t\thead.appendChild(script);\n\n\t\t\t\tthis.getScript = function() {\n\t\t\t\t\treturn script;\n\t\t\t\t};\n\n\t\t\t\tthis.removeScript = function() {\n\t\t\t\t\thead.removeChild(script);\n\t\t\t\t\tscript = null;\n\t\t\t\t};\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Create request on server\n\t\t\t * @param  {Object} url         Object created with params\n\t\t\t * @param  {Function} onSuccess Handler successful response from the server\n\t\t\t * @param  {Function} onError   Handler unsuccessful response from the server\n\t\t\t * @return {String}             Callback function name\n\t\t\t */\n\t\t\tget: function( url , onSuccess, onError ) {\n\t\t\t\t// Make Request using defined request types\n\t\t\t\treturn IO.request({\n\t\t\t\t\turl: url,\n\t\t\t\t\tonSuccess: onSuccess,\n\t\t\t\t\tonError: onError\n\t\t\t\t});\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Load script from the server\n\t\t\t * @param  {Object} url         Object created with params\n\t\t\t * @param  {Function} onSuccess Handler successful response from the server\n\t\t\t * @param  {Function} onError   Handler unsuccessful response from the server\n\t\t\t */\n\t\t\tloadScript: function( url , onSuccess, onError ) {\n\t\t\t\tvar cache = IO.loadScript.cache ? IO.loadScript.cache : IO.loadScript.cache = {};\n\n\t\t\t\turl = url.build();\n\n\t\t\t\tif (cache.hasOwnProperty(url)) return;\n\n\t\t\t\tcache[url] = true;\n\n\t\t\t\t// Create new script element\n\t\t\t\tvar script = new IO.Script({\n\t\t\t\t\turl: url,\n\t\t\t\t\tonSuccess: onSuccess,\n\t\t\t\t\tonError: onError\n\t\t\t\t});\n\n\t\t\t\treturn script;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * @TODO ioMockStart description\n\t\t\t * @param  {Array} params [description]\n\t\t\t * @function\n\t\t\t */\n\t\t\tioMockStart: function( params ) {\n\t\t\t\tisMocked = true;\n\t\t\t\tmockParams = params ? params : mockParams;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * ioMockEnd description\n\t\t\t * @function\n\t\t\t */\n\t\t\tioMockEnd: function() {\n\t\t\t\tisMocked = false;\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Define list of request types\n\t\t *\n\t\t * @alias WEBSPELLCHECKER.IO\n\t\t */\n\t\tIO.requestTypes = {\n\t\t\tAJAX: IO.AJAX,\n\t\t\tJSONP: IO.JSONP,\n\t\t\tNODE: IO.NODE\n\t\t};\n\n\t\tIO.setRequestType = function(type) {\n\t\t\tvar requestType = IO.requestTypes[type];\n\t\t\tif(requestType) {\n\t\t\t\tIO.request = requestType;\n\t\t\t}\n\t\t};\n\t\t/**\n\t\t * Define request type for IO Manager\n\t\t *\n\t\t * @alias WEBSPELLCHECKER.IO\n\t\t */\n\t\tIO.request = (Namespace.env === Namespace.envTypes.node) ?\n\t\t\tIO.requestTypes.NODE :\n\t\t\tIO.requestTypes.AJAX ;\n\n\t\t/**\n\t\t * Static Module. Imput&Output (IO) Manager of SCAYT\n\t\t *\n\t\t * @alias WEBSPELLCHECKER.IO\n\t\t */\n\t\tNamespace.IO = IO;\n\t}\n\n\tif (typeof window === 'undefined') {\n\t\tmodule.exports = init;\n\t}\n\n\tif (typeof WEBSPELLCHECKER !== 'undefined' && !('IO' in WEBSPELLCHECKER)) {\n\t\tinit(WEBSPELLCHECKER);\n\t}\n})();\n// RegularsManager.js\n/**\n * @fileoverview Static Module. RegularsManager of WEBSPELLCHECKER\n */\n(function() {\n    'use strict';\n\n\tfunction init(Namespace) {\n        function removeSetBrackets(string) {\n            for (var i = 0; i < string.length; i++) {\n                if (string[i - 1] !== '\\\\' && (string[i] === '[' || string[i] === ']')) {\n                    string = string.substring(0, i) + string.substring(i + 1);\n                }\n            }\n\n            return string;\n        }\n\n        /**\n         * Constructor for regExp type.\n         * List of regulars sources stored in regularssources.js\n         * @constructor\n         *\n         * @param {String} name - type name.\n         * @param {String} source - string source of regular expression.\n         * @param {String} flags - regExp flags (g,i etc.).\n         */\n        function RegularType(name, source, flags) {\n            this.name = name;\n            this.flags = flags || '';\n            this.source = source;\n            this.string = '';\n            this.regExp = null;\n        }\n\n        RegularType.prototype = {\n            _wrapSymbol: '#',\n            /**\n             * Create RegExp from sources.\n             *\n             * @return {RegExp} RegExp.\n             */\n            _getRegExp: function() {\n                if(this.regExp) {\n                    // IE 8 hasn't field \"flags\"\n                    var regExpFlags = this.regExp.toString().match(/[gimuy]*$/)[0];\n                    if (this.regExp.source === this.source && regExpFlags === this.flags) {\n                        return this.regExp;\n                    }\n                }\n                return this.regExp = new RegExp(this.source, this.flags);\n            },\n            /**\n             * Combine provided regularType with current.\n             *\n             * @param {Object} options - Combine data Object.\n             * @param {Object} options.regExpObject - Instance of RegularType.\n             * @param {String} options.separator - string element what separate two regular sources.\n             * @param {String} options.nameSeparator - string element what separate two names of regular types.\n             * @param {String} options.compositionName - Name of result composition.\n             *                                           If not specified name generate automatically based on Regular Type names and name separator parameter.\n             *\n             * @return {Object} Combined regular types.\n             */\n            _combine: function(options) {\n                var regExpObject = options.regExpObject;\n\n                if (regExpObject instanceof RegularType === false) {\n                    throw new Error(regExpObject.name + ' should be instance of RegularType constructor.');\n                }\n\n                var separator = options.separator || '';\n                var nameSeparator = options.nameSeparator || '&';\n                var source = this.source + separator + regExpObject.source;\n                var name = options.compositionName || (this.name + options.nameSeparator + regExpObject.name);\n                var combainRegType = new RegularType(name, source).init(this.string);\n\n                combainRegType = combainRegType.addFlags(regExpObject.flags + this.flags);\n\n                return combainRegType;\n            },\n            /**\n             * The composition of the _updateSource and replace methods.\n             *\n             * @param {String} subStr - The string that replaces the substring specified by source parameter.\n             * @param {String} source - New source for current regular type.\n             *\n             * @return {Object} new regular type based on provided source and with changed string.\n             */\n            _replaceWithAnotherSource: function(subStr, source) {\n                var clone = this._updateSource(source).replace(subStr);\n\n                clone.source = this.source;\n\n                return clone;\n            },\n            /**\n             * Method what reassign source parameter.\n             *\n             * @param {String} source - Regular type source.\n             *\n             * @return {Object} new regular type with new source.\n             */\n            _updateSource: function(source) {\n                var clone = this.clone();\n\n                clone.source = source;\n\n                return clone;\n            },\n            /**\n             * Method what set string for processing to current regular type.\n             *\n             * @param {String} string - String what will process in current regular type.\n             *\n             * @return {Object} new regular with specified string.\n             */\n            init: function(string) {\n                 var clone = this.clone();\n\n                 clone.string = string;\n\n                 return clone;\n            },\n            /**\n             * Method what create new regular type based on current.\n             *\n             * @return {Object} clone of current regular type.\n             */\n            clone: function() {\n                var clone = Object.create(RegularType.prototype);\n\n                return Object.assign(clone, this) ;\n            },\n            /**\n             * Return the string field of current regular type.\n             *\n             * @return {String} current string.\n             */\n            getString: function() {\n                return this.string;\n            },\n            /**\n             * Return lastIndex field of current regularExp.\n             *\n             * @return {Number} index.\n             */\n            getLastIndex: function() {\n                return this._getRegExp().lastIndex;\n            },\n            /**\n             * Set lastIndex field of current regularExp.\n             *\n             * @return {Number} index.\n             */\n            setLastIndex: function(index) {\n                var regExp = this._getRegExp();\n\n                regExp.lastIndex = index;\n            },\n            /**\n             * Add RegEx flags if it not already setted.\n             * @param {String} flags - String with RegExp flags 'gi'| 'g' etc.\n             *\n             * @return {Object} clone of current regular type.\n             */\n            addFlags: function(flags) {\n                var clone = this.clone(),\n                    flagsArr = flags.split('');\n\n                flagsArr.forEach(function(flag) {\n                    if ( clone.flags.indexOf(flag) === -1 ) {\n                        clone.flags += flag;\n                    }\n                }, this);\n\n                return clone;\n            },\n            /**\n             * Add 'g' RegEx flag if it not already setted.\n             *\n             * @return {Object} clone of current regular type.\n             */\n            g: function() {\n                return this.addFlags('g');\n            },\n            /**\n             * Add 'i' RegEx flag if it not already setted.\n             *\n             * @return {Object} clone of current regular type.\n             */\n            i: function() {\n                return this.addFlags('i');\n            },\n            /**\n             * Transformation of regular type source to:\n             * a character set. Matches any one of the enclosed characters.\n             *\n             * @return {Object} clone of current regular type.\n             */\n            set: function() {\n                var source = removeSetBrackets(this.source);\n\n                return this._updateSource('[' + source + ']');\n            },\n            /**\n             * Transformation of regular type source to:\n             * a capturing groups.\n             *\n             * @return {Object} clone of current regular type.\n             */\n            group: function() {\n                return this._updateSource('(' + this.source + ')');\n            },\n            /**\n             * Transformation of regular type source to:\n             * a matches beginning of input.\n             *\n             * @return {Object} clone of current regular type.\n             */\n            start: function() {\n                return this._updateSource('^' + this.source );\n            },\n            /**\n             * Transformation of regular type source to:\n             * a matches end of input.\n             *\n             * @return {Object} clone of current regular type.\n             */\n            end: function() {\n                return this._updateSource(this.source + '$');\n            },\n            /**\n             * Transformation of regular type source to:\n             * a matches the preceding item x 0 or more times.\n             *\n             * @return {Object} clone of current regular type.\n             */\n            onePlus: function() {\n                return this._updateSource(this.source + '+');\n            },\n            /**\n             * Transformation of regular type source to:\n             * matches the preceding item x 0 or more times.\n             *\n             * @return {Object} clone of current regular type.\n             */\n            more: function() {\n                return this._updateSource(this.source + '*');\n            },\n            /**\n             * Matches a left word boundary.\n             *\n             * @return {Object} clone of current regular type.\n             */\n            leftWordBoundary: function() {\n                return this._updateSource('\\\\b' + this.source);\n            },\n            /**\n             * Matches a right word boundary.\n             *\n             * @return {Object} clone of current regular type.\n             */\n            rightWordBoundary: function() {\n                return this._updateSource(this.source + '\\\\b');\n            },\n            /**\n             * Wrap word boundary.\n             *\n             * @return {Object} clone of current regular type.\n             */\n            wrapWordBoundary: function() {\n                return this.leftWordBoundary().rightWordBoundary();\n            },\n            /**\n             * Transformation of regular type source to:\n             * a matches x only if x is followed by y.\n             *\n             * @return {Object} clone of current regular type.\n             */\n            lookahead: function() {\n                return this.group( this._updateSource('?=' + this.source) );\n            },\n            /**\n             * Split string by current regular type.\n             * @param {String} string - splitted string;\n             *\n             * @return {Array} clone of current regular type.\n             */\n            split: function(string) {\n                string = string || this.string;\n\n                return string.split( this._getRegExp() );\n            },\n            /**\n             * Retrieves the matches when matching a string against a regular expression.\n             *\n             * @return {Array}\n             */\n            match: function(string) {\n                string = string || this.string;\n\n                return string.match( this._getRegExp() );\n            },\n            /**\n             * Method executes a search for a match between a regular expression and this String object.\n             *\n             * The index of the first match between the regular expression and the given string.\n             * @return {Number}\n             */\n            search: function(string) {\n                string = string || this.string;\n\n                return string.search( this._getRegExp() );\n            },\n            /**\n             * Method executes a search for a match between a regular expression and a specified string.\n             *\n             * @return {Bool}\n             */\n            test: function(string) {\n                return this._getRegExp().test( string || this.string );\n            },\n            /**\n             * Clone regular type and change string.\n             * @param {String} subStr - The String that replaces the substring specified by regular type.\n             *\n             * @return {Array}\n             */\n            replace: function(string, subStr) {\n                if (subStr !== undefined) {\n                    return string.replace( this._getRegExp(), subStr );\n                } else {\n                    var clone = this.clone();\n\n                    subStr = string;\n                    clone.string = clone.string.replace( this._getRegExp(), subStr );\n\n                    return clone;\n                }\n            },\n            /**\n             * Replace regular type with provided left symbol.\n             * @param {String} wrapSymbol - String what will added to sources left.\n             * @param {String} subStr - The String that replaces the substring specified by regular type.\n             *\n             * @return {Object} clone of current regular type.\n             */\n            replaceLeftWrapped: function(wrapSymbol, subStr) {\n                wrapSymbol = wrapSymbol || this._wrapSymbol;\n\n                return this._replaceWithAnotherSource(subStr, wrapSymbol + this.source);\n            },\n            /**\n             * Replace regular type with provided right symbol.\n             * @param {String} wrapSymbol - String what will added to sources right.\n             * @param {String} subStr - The String that replaces the substring specified by regular type.\n             *\n             * @return {Object} clone of current regular type.\n             */\n            replaceRightWrapped: function(wrapSymbol, subStr) {\n                wrapSymbol = wrapSymbol || this._wrapSymbol;\n\n                return this._replaceWithAnotherSource(subStr, this.source + wrapSymbol);\n            },\n            /**\n             * Wrap regular includes in this.string by wrapSymbols.\n             * @param {String} wrapSymbol - What wrap include.\n             *\n             * @return {Object} clone of current regular type.\n             */\n            wrapInclude: function(wrapSymbol) {\n                wrapSymbol = wrapSymbol || this._wrapSymbol;\n\n                return this.group().replace(wrapSymbol + \"$1\" + wrapSymbol);\n            },\n            /**\n             * Add provided regular type to current.\n             * @param {Object} regExpObject - Instance of RegularType.\n             * @param {String} compositionName - Name of result composition.\n             *      If not specified name generate automatically from regular types combine by &.\n             *\n             * @return {Object} Combined regular types.\n             */\n            composition: function(regExpObject, compositionName) {\n                return this._combine({\n                    regExpObject: regExpObject,\n                    separator: '',\n                    nameSeparator: '&',\n                    compositionName: compositionName\n                });\n            },\n            /**\n             * \"Either\" operation between provided regular type with current.\n             * @param {Object} regExpObject - Instance of RegularType.\n             * @param {String} compositionName - Name of result composition.\n             *      If not specified name generate automatically from regular types combine by |.\n             *\n             * @return {Object} Combined regular types.\n             */\n            or: function(regExpObject, compositionName) {\n                return this._combine({\n                    compositionName: compositionName,\n                    regExpObject: regExpObject,\n                    separator: '|',\n                    nameSeparator: '|'\n                });\n            },\n            /**\n             * Add list of regular types to current.\n             * @param {Array} listOfRegExpObjects - List of regular types instances.\n             * @param {String} compositionName - Name of result composition.\n             *      If not specified name generate automatically from regular types combine by &.\n             *\n             * @return {Object} Combined regular types.\n             */\n            compositionGraph: function(listOfRegExpObjects, compositionName) {\n                var compositionObj = (this instanceof RegularType) ? this : undefined;\n\n                listOfRegExpObjects.forEach(function(element) {\n                    compositionObj = (compositionObj) ? compositionObj.composition(element) : element;\n                }, this);\n\n                compositionObj.name = compositionName || compositionObj.name;\n\n                return compositionObj;\n            },\n            /**\n             * Save current combination of regular type to store.\n             * @param {String} name - Name of regular type.\n             *\n             * @return {Object} current regular type.\n             */\n            store: function(name) {\n                RegularsManager.addRegularType(name || this.name, this.source, this.flags);\n\n                return this;\n            }\n        };\n\n        /**\n         * @exports WEBSPELLCHECKER.RegularsManager\n         */\n        var RegularsManager = {\n                /**\n                 * Add regular type to RegularsManager.\n                 *\n                 * @param {String} name - Name of regular type.\n                 * @param {String} source - Regular expression source.\n                 */\n                addRegularType: function(name, source, flags) {\n                    var type = new RegularType(name, source, flags);\n\n                    this[name] = type;\n\n                    return type;\n                },\n                wrap: function(source) {\n                    return new RegularType('regular', source);\n                }\n            },\n            RegularsSources = Namespace.RegularsSources;\n\n        for (var k in RegularsSources){\n            RegularsManager.addRegularType(k, RegularsSources[k]);\n        }\n\n        Namespace.RegularsManager = RegularsManager;\n    }\n\n    if (typeof window === 'undefined') {\n        module.exports = init;\n    }\n\n    if (typeof WEBSPELLCHECKER !== 'undefined' && !('RegularsManager' in WEBSPELLCHECKER)) {\n        init(WEBSPELLCHECKER);\n    }\n})();\n// OptionsManager.js\n/**\n * @fileoverview Static Module. OptionsManager\n */\n(function() {\n\tfunction init( Namespace ) {\n        var TypeChecker = Namespace.Utils.TypeChecker,\n            ArrayUtils = Namespace.Utils.ArrayUtils, validators;\n\n        /**\n         * Constructor for option type.\n         * @constructor\n         *\n         * @param {String} name - type name.\n         * @param {Function} validate - Parameter validation checker.\n         * @private\n         */\n        function OptionType(typeData) {\n            this.name = typeData.name;\n            this.validate = typeData.validate;\n            this.erroMessageTemplate = typeData.erroMessageTemplate ||\n                'Parameter %optionName% should have a type - ' + this.name + '.';\n        }\n\n        OptionType.prototype = {\n            constructor: OptionType,\n            createErrorMessage: function(optionName) {\n                return this.erroMessageTemplate.replace(/%optionName%/g, optionName);\n            }\n        }\n        /**\n         * Constructor for errors Object.\n         * This object acomulated errors what occur during validation parameters.\n         * @constructor\n         *\n         * @private\n         */\n        function ErrorsObject() {\n            this.critical = false;\n            this.count = 0;\n            this.reports = [];\n            this.addError = function(error) {\n                if (error.critical && this.critical === false) {\n                    this.critical = true;\n                }\n\n                this.reports.push(error);\n                this.count += 1;\n            };\n        }\n\n        function OptionsObject() {\n            this._validatedFields = [];\n        }\n\n        function deepClone(data) {\n            var res;\n            if( TypeChecker.isHash(data) ) {\n                res = {};\n                for(var k in data) {\n                    res[k] = deepClone(data[k]);\n                }\n            } else if( TypeChecker.isArray(data) ) {\n                res = data.slice(0);\n                for(var i = 0; i < res.length; i += 1) {\n                    res[i] = deepClone(res[i]);\n                }\n            } else {\n                res = data;\n            }\n\n            return res;\n        }\n\n        OptionsObject.prototype = {\n            constructor: OptionsObject,\n            addOption: function(option) {\n                var name = option.name;\n\n                if ( !this._validatedFields.includes(name) ) {\n                    this[name] = this._createOptionValue(option);\n\n                    if (typeof this[name] !== 'undefined') {\n                        this._validatedFields.push(name);\n                    }\n                }\n            },\n            /**\n             * Method return option value based on option parameters.\n             * @memberof WEBSPELLCHECKER.OptionsManager#\n             *\n             * @param {Object} optionData - Object with option parameters.\n             * @param {String} optionData.name - Option name.\n             * @param {*} optionData.value - Option user value.\n             * @param {Object} optionData.template - Object with object info.\n             * @param {Function} optionData.errorHandler - Problem Handler. Receive object with error info.\n             *\n             * @returns {*} - Option value.\n             * @private\n             */\n            _createOptionValue: function (optionData) {\n                var optionValue = optionData.value,\n                    optionTemplate = optionData.template,\n                    errorReport = {},\n                    optionName = optionData.name,\n                    optionErrorHandler = optionData.errorHandler,\n                    validated,\n                    defaultValue = deepClone(optionTemplate.defaultValue);\n\n                if (optionValue === undefined && !optionTemplate.required) {\n                    return defaultValue;\n                }\n\n                validated = optionTemplate.type.validate(optionValue);\n\n                if (validated) {\n                    return optionValue;\n                }\n\n                errorReport.critical = optionTemplate.required || false;\n                errorReport.optionName = optionName;\n                errorReport.message = optionTemplate.type.createErrorMessage(optionName);\n\n                optionErrorHandler(errorReport);\n\n                return defaultValue;\n            },\n        };\n\n        function OptionsTemplate(template) {\n            Object.assign(this, template);\n        }\n\n        OptionsTemplate.prototype = {\n            constructor: OptionsTemplate,\n            getDefaultValue: function(optionName) {\n                return this[optionName].defaultValue;\n            },\n            setDefaults: function(defaults) {\n                for (var k in defaults) {\n                    this[k].defaultValue = defaults[k];\n                }\n            }\n        };\n\n        /**\n         * @exports WEBSPELLCHECKER.OptionsManager\n         */\n        var OptionsManager = {\n            optionTypes: {},\n            optionsTemplate: {},\n            /**\n             * List of Validation rules.\n             * @memberof WEBSPELLCHECKER.OptionsManager#\n             */\n            optionsValidators: {\n                array: TypeChecker.isArray,\n                boolean: TypeChecker.isBoolean,\n                date: TypeChecker.isDate,\n                defined: TypeChecker.isDefined,\n                empty: TypeChecker.isEmpty,\n                'function': TypeChecker.isFunction,\n                hash: TypeChecker.isHash,\n                integer: TypeChecker.isInteger,\n                positive: TypeChecker.isPositive,\n                number: TypeChecker.isNumber,\n                object: TypeChecker.isObject,\n                string: TypeChecker.isString,\n                urlProtocol: function(value) {\n                    return value === 'http' || value === 'https';\n                },\n                urlHost:function(value) {\n                    return TypeChecker.notEmptyString(value); // && Regular test ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~:/?#[]@!$&'()*+,;=\n                },\n                urlPort: function(value) {\n                    if ( TypeChecker.isNumber(value) ) {\n                        return TypeChecker.isInteger(value);\n                    } else if (TypeChecker.isString) {\n                        return TypeChecker.isInteger( parseFloat(value) );\n                    }\n\n                    return false;\n                },\n                urlPath: function(value) {\n                    return TypeChecker.notEmptyString(value); // && Regular test ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~:/?#[]@!$&'()*+,;=\n                },\n                // Type when we always want use default value\n                defaultValue: function() {\n                    return false;\n                }\n            },\n            /**\n             * Method what porocces client options.\n             * @memberof WEBSPELLCHECKER.OptionsManager#\n             *\n             * @param {Object} clientOptions - Options what should be processed.\n             * @param {Object} optionsTemplate - Validation and another information for clientOptions options.\n             * @param {Object} errorHandler - Error callback if we have a problem with options creating.\n             *\n             * @returns {Object} - processed options.\n             * @private\n             */\n            createOptions: function(clientOptions, template, errorsHandler) {\n                var option, valid, options, optionsTemplate,\n                    errorsObject = new ErrorsObject();\n\n                clientOptions = clientOptions || {};\n\n                if (clientOptions instanceof OptionsObject === true) {\n                    options = clientOptions;\n                } else {\n                    options = new OptionsObject();\n                }\n\n                if ( TypeChecker.isString(template) ) {\n                    optionsTemplate = this.importOptionsTemplate(template);\n                } else if ( TypeChecker.isObject(template) ) {\n                    if (template instanceof OptionsTemplate === true) {\n                        optionsTemplate = template;\n                    } else {\n                        optionsTemplate = new OptionsTemplate(template);\n                    }\n                }\n\n                for (var k in optionsTemplate) {\n                    if ( optionsTemplate.hasOwnProperty(k) === false ) {\n                        continue;\n                    }\n\n                    if (optionsTemplate[k].type instanceof OptionType === false) {\n                        throw new Error(k + ' template \"type\" parameter should be instance of OptionsManager.OptionType constructor.');\n                    }\n\n                    options.addOption({\n                        name: k,\n                        value: clientOptions[k],\n                        template: optionsTemplate[k],\n                        errorHandler: function(error) {\n                            errorsObject.addError(error);\n                        }\n                    });\n                }\n\n                if (errorsHandler && errorsObject.count > 0) {\n                    errorsHandler(errorsObject);\n                }\n\n                return options;\n            },\n            /**\n             * Add new option type.\n             * @memberof WEBSPELLCHECKER.OptionsManager#\n             *\n             * @param {Object} type - New type info.\n             * @param {String} type.name - Type name.\n             * @param {Function} type.validate - Validation rules for current type.\n             * @private\n             */\n            extendOptionTypes: function(type) {\n                if ( TypeChecker.isArray(type) ) {\n                    type.forEach(OptionsManager.extendOptionTypes.bind(this));\n                }\n\n                if ( !type.name || !TypeChecker.isFunction(type.validate) ) {\n                    return false;\n                }\n\n                if (!this.optionTypes[type.name]) {\n                    this.optionTypes[type.name] = new OptionType(type);\n                }\n            },\n            exportOptionsTemplate: function(templateName, optionsTemplate) {\n                if (optionsTemplate instanceof OptionsTemplate === false) {\n                    optionsTemplate = new OptionsTemplate(optionsTemplate);\n                }\n\n                this.optionsTemplate[templateName] = optionsTemplate;\n            },\n            importOptionsTemplate: function(templateName) {\n                var res = this.optionsTemplate[templateName];\n\n                if (res instanceof OptionsTemplate === false) {\n                    throw new Error('Templates name: ' + templateName + ' is not defined.');\n                }\n\n                return res;\n            },\n            mergeOptionsTemplates: function() {\n                var result = {};\n\n                Array.prototype.forEach.call(arguments, function(el) {\n                    if( TypeChecker.isObject(el) ) {\n                        for (var k in el) {\n                            if ( el.hasOwnProperty(k) === false ) {\n                                continue;\n                            }\n                            if ( result[k] ) {\n                                throw new Error('Template for ' + k + ' defined twice.');\n                            }\n                            result[k] = el[k];\n                        }\n                    }\n                });\n\n                return new OptionsTemplate(result);\n            }\n        };\n\n        validators = OptionsManager.optionsValidators;\n        OptionsManager.optionTypes = {};\n\n        for (var type in validators) {\n            OptionsManager.optionTypes[type] = new OptionType({name: type, validate: validators[type]});\n        }\n\n        Namespace.OptionsManager = OptionsManager;\n    }\n\n    if (typeof window === 'undefined') {\n        module.exports = init;\n    }\n    if (typeof WEBSPELLCHECKER !== 'undefined' && !('OptionsManager' in WEBSPELLCHECKER)) {\n        init(WEBSPELLCHECKER);\n    }\n})();\n// webapi.js\n/**\n * @namespace WEBSPELLCHECKER\n */\n(function() {\n    function init(Namespace) {\n        // Private\n        var OptionsManager = Namespace.OptionsManager,\n            logger = Namespace.logger,\n            optionTypes = OptionsManager.optionTypes,\n            optionsTemplate;\n\n        logger.isON(true);\n\n        optionsTemplate = {\n            lang: {\n                type: optionTypes.string,\n                defaultValue: 'en_US'\n            },\n            serviceProtocol: {\n                type: optionTypes.urlProtocol,\n                defaultValue: 'http'\n            },\n            serviceHost: {\n                type: optionTypes.urlHost,\n                defaultValue: 'svc.webspellchecker.net'\n            },\n            servicePort: {\n                type: optionTypes.urlPort,\n                defaultValue: 80\n            },\n            servicePath: {\n                type: optionTypes.urlPath,\n                defaultValue: 'spellcheck31/script/ssrv.cgi'\n            },\n            serviceId: {\n                type: optionTypes.string,\n                defaultValue: '1:KpkvQ2-6KNUj-L1W3u2-C9j0K1-Zv2tY1-CfDOx-WfGRg2-qXtci-YyyE34-j09H42-b0aCt3-d9a'\n            },\n            userDictionaryName: {\n                type: optionTypes.string,\n                defaultValue: ''\n            },\n            customDictionaryIds: {\n                type: optionTypes.string,\n                defaultValue: ''\n            },\n            minWordLength: {\n                type: optionTypes.number,\n                defaultValue: 3\n            },\n            communicationFormat: {\n                type: optionTypes.string,\n                defaultValue: 'json'\n            },\n            customPunctuation: {\n                type: optionTypes.string,\n                defaultValue: ''\n            },\n            appType: {\n                type: optionTypes.string,\n                defaultValue: 'web_api'\n            }\n        };\n\n        OptionsManager.exportOptionsTemplate('WebApiTemplate', optionsTemplate);\n\n        /**\n         * @constructor\n         * @param {Object} clientOptions\n         * @private\n         */\n        function WebApi(clientOptions) {\n            var self = this,\n                isErrorsCritical,\n                connection;\n\n            this._services = {};\n\n            // Create options based on clientOptions from user and with WebApiTemplate template.\n            this._options = OptionsManager.createOptions(clientOptions, 'WebApiTemplate', function errorHandler(errors) {\n                isErrorsCritical = errors.critical;\n\n                errors.reports.forEach(function(report) {\n                    logger.log(report.message);\n                }, this);\n            });\n\n            // Instance based dependencies\n            this._dependencies = {\n                'TextProcessor': Namespace.TextProcessor,\n                'Connection': Namespace.Connection\n            };\n\n            for (var k in this._dependencies) {\n                this._services[k] = new this._dependencies[k](k, this);\n            }\n\n            connection = this._services['Connection'];\n            this._commands = connection.getCommands();\n            this._udActions = connection.getUdActions();\n        }\n\n        /**\n         * @namespace WebApiInstance\n         */\n        WebApi.prototype = {\n            constructor: WebApi,\n            /**\n             * Return instance of dependencie.\n             * @private\n             *\n             * @param {String} name - Name of instancebased service.\n             *\n             * @returns {Object} - Instance of service.\n             */\n            _getService: function(name) {\n                return this._services[name] || null;\n            },\n            /**\n             * Wrapper of request method.\n             * @private\n             *\n             * @param {Object} data - Object with request data.\n             * @param {function} success - Handler successful response from the server.\n             * @param {function} error - Handler unsuccessful response from the server.\n             *\n             * @returns {Object} - Transport object.\n             */\n            _request: function(data, parameters) {\n                return this._getService('Connection').request(\n                    data,\n                    parameters.success || function() {},\n                    parameters.error || function() {}\n                );\n            },\n            _makeUdAction: function(actionName, parameters) {\n                if (typeof parameters.name === 'undefined') {\n                    parameters.name = this.getOption('userDictionaryName');\n                }\n                var requestparameters = {\n                        command: this._commands.userDictionary,\n                        UDAction: this._udActions[actionName],\n                        UDName: parameters.name,\n                        newUDName: parameters.newName,\n                        wordList: parameters.wordList,\n                        UDWord: parameters.word\n                    };\n\n                return this._request(requestparameters, parameters);\n            },\n            _udMethodWrapper: function(actionName, parameters) {\n                var self = this,\n                    success = parameters.success || function(){};\n\n                parameters.success = function(responseInfo) {\n                    var ud = new UserDictionary({\n                            wordlist: responseInfo.wordlist,\n                            name: responseInfo.name,\n                            modificationTime: responseInfo.modificationTime,\n                            makeUdAction: self._makeUdAction.bind(self)\n                        });\n\n                    success(ud);\n                };\n\n                return this._makeUdAction(actionName, parameters);\n            },\n            getOption: function(name) {\n                return this._options[name];\n            },\n            setOption: function(name, value) {\n                var result = false,\n                    template = {},\n                    option = {};\n\n                if (optionsTemplate[name]) {\n                    result = true;\n                    template[name] = optionsTemplate[name];\n                    option[name] = value;\n                    this._options[name] = OptionsManager.createOptions(option, template)[name];\n                }\n\n                return result;\n            },\n            /**\n             * getInfo success Callback.\n             *\n             * @callback getInfoCallback\n             * @param {Object} data\n             * @param {Object} [data.langList={\"ltr\":{\"en_US\" : \"American English\",\"en_GB\" : \"British English\",\"fr_FR\" : \"French\",\"de_DE\" : \"German\",\"it_IT\" : \"Italian\",\"es_ES\" : \"Spanish\"},\"rtl\":{}}]\n             *      Object with list of available languages. Separeted on ltr(left-to-right) and rtl(right-to-left) directions.\n             * @param {Number} [data.verLang=9] Number of available languages.\n             * @param {Boolean} [data.banner=false] Banner parameter for integrations.\n             */\n\n            /**\n             * getInfo API method.\n             * @public\n             * @memberof WebApiInstance#\n             *\n             * @param {Object} parameters\n             * @param {getInfoCallback} parameters.success - Handler successful response from the server.\n             * @param {RequestCallback} parameters.error - Handler unsuccessful response from the server.\n             * @returns {Object} - Transport object.\n             * @example\n             * wscWebApiInstance.getInfo({\n             *      success: function(data) {\n             *          console.log(data); // {\"langList\":{\"ltr\":{\"en_US\" : \"American English\",\"en_GB\" : \"British English\",\"fr_FR\" : \"French\",\"de_DE\" : \"German\",\"it_IT\" : \"Italian\",\"es_ES\" : \"Spanish\"},\"rtl\":{}},\"verLang\":9}\n             *      },\n             *      error: function(error) {\n             *          console.log(error);\n             *      }\n             * })\n             */\n            getInfo: function(parameters) {\n                return this._request({\n                        command: this._commands.getInfo\n                    },\n                    parameters\n                );\n            },\n            /**\n             * getLangList success Callback.\n             *\n             * @callback GetLangListCallback\n             * @param {Object} data\n             * @param {Object} [data.langList={\"ltr\":{\"en_US\" : \"American English\",\"en_GB\" : \"British English\",\"fr_FR\" : \"French\",\"de_DE\" : \"German\",\"it_IT\" : \"Italian\",\"es_ES\" : \"Spanish\"},\"rtl\":{}}]\n             *      Object with list of available languages. Separeted on ltr(left-to-right) and rtl(right-to-left) directions.\n             * @param {Number} [data.verLang=9] Number of available languages.\n             */\n\n            /**\n             * getLangList API method.\n             * @public\n             * @memberof WebApiInstance#\n             *\n             * @param {Object} parameters\n             * @param {GetLangListCallback} parameters.success - Handler successful response from the server.\n             * @param {RequestCallback} parameters.error - Handler unsuccessful response from the server.\n             * @returns {Object} - Transport object.\n             * @example\n             * wscWebApiInstance.getLangList({\n             *      success: function(data) {\n             *          console.log(data); // {\"langList\":{\"ltr\":{\"en_US\" : \"American English\",\"en_GB\" : \"British English\",\"fr_FR\" : \"French\",\"de_DE\" : \"German\",\"it_IT\" : \"Italian\",\"es_ES\" : \"Spanish\"},\"rtl\":{}},\"verLang\":9}\n             *      },\n             *      error: function(error) {\n             *          console.log(error);\n             *      }\n             * })\n             */\n            getLangList: function(parameters) {\n                return this._request({\n                        command: this._commands.getLangList\n                    },\n                    parameters\n                );\n            },\n            /**\n             * spellCheck success Callback.\n             *\n             * @callback SpellCheckCallback\n             * @param {Object[]} wordObjects\n             * @param {String} wordObjects.word - Misspelled word.\n             * @param {String} wordObjects.ud - Flag. Is this word in the user dictionary.\n             * @param {String[]} wordObjects.suggestions - Array with suggestions for current misspelled.\n             */\n\n            /**\n             * spellCheck API method.\n             * @public\n             * @memberof WebApiInstance#\n             *\n             * @param {Object} parameters\n             * @param {String} parameters.text - Text to check spelling.\n             * @param {String} parameters.lang - Spellcheck language. If not provided then take from constructor.\n             * @param {SpellCheckCallback} parameters.success - Handler successful response from the server.\n             * @param {RequestCallback} parameters.error - Handler unsuccessful response from the server.\n             * @returns {Object} - Transport object.\n             * @example\n             * wscWebApiInstance.spellCheck({\n             *      text: 'This is an exampl of a sentence with two mispelled words. Just type text with misspelling to see how it works',\n             *      success: function(data) {\n             *          console.log(data); // [{\"word\":\"exampl\",\"ud\":\"false\",\"suggestions\":[\"example\",\"examples\",\"exempla\",\"exam\",\"exemplar\",\"exemplum\",\"resample\",\"exemplars\",\"exemplary\",\"exemplify\",\"exempt\",\"exams\",\"xml\",\"decamp\",\"beanpole\"]},{\"word\":\"mispelled\",\"ud\":\"false\",\"suggestions\":[\"misspelled\",\"dispelled\",\"impelled\",\"misspell\",\"miscalled\",\"misspells\",\"misplaced\",\"misplayed\",\"respelled\",\"morseled\",\"micelle\",\"Giselle\",\"misapplied\",\"misspelt\",\"installed\"]}]\n             *      },\n             *      error: function(error) {\n             *          console.log(error);\n             *      }\n             * });\n             */\n            spellCheck: function(parameters) {\n                var _parameters = Object.assign({}, parameters),\n                    words = this._getService('TextProcessor').getWordsFromString( _parameters.text ),\n                    text = words.wordsCollection.join(',');\n\n                function addOffsetsToMisspelled(data, offsets) {\n                    var misspelled;\n\n                    return offsets.reduce(function(prev, offsetsObj) {\n                        for (var i = 0; i < data.length; i += 1) {\n                            misspelled = data[i];\n\n                            if (misspelled.word === offsetsObj.word) {\n                                prev.push( Object.assign(\n                                    {},\n                                    misspelled,\n                                    offsetsObj\n                                ) );\n\n                                return prev;\n                            }\n                        }\n\n                        return prev;\n                    }, []);\n                }\n\n                _parameters.success = function(data) {\n                    var misspelledsWithOffsets = addOffsetsToMisspelled(data, words.wordsOffsets);\n\n                    parameters.success(misspelledsWithOffsets);\n                };\n\n                return this._request({\n                        command: this._commands.spellCheck,\n                        language:  _parameters.lang || this.getOption('lang'),\n                        userWordlist: parameters.userWordlist,\n                        customDictionary: this.getOption('customDictionaryIds'),\n                        userDictionary: this.getOption('userDictionaryName'),\n                        text: text\n                    },\n                    {\n                        success: _parameters.success,\n                        error: _parameters.error\n                    }\n                );\n            },\n            /**\n             * grammarCheck success Callback.\n             *\n             * @callback GrammarCheckCallback\n             * @param {Object[]} phraseObjects\n             * @param {String} phraseObjects.description - Description of grammar problem.\n             * @param {String} phraseObjects.phrase - Phrase with problem.\n             * @param {Number} phraseObjects.problem_id - Id of current problem.\n             * @param {String[]} phraseObjects.suggestions - Array with suggestions.\n             */\n\n            /**\n             * grammarCheck API method.\n             * @public\n             * @memberof WebApiInstance#\n             *\n             * @param {Object} parameters\n             * @param {String} parameters.text - Text to grammar checking.\n             * @param {String} parameters.lang - Grammarcheck language. If not provided then take from constructor.\n             * @param {GrammarCheckCallback} parameters.success - Handler successful response from the server.\n             * @param {RequestCallback} parameters.error - Handler unsuccessful response from the server.\n             * @returns {Object} - Transport object.\n             * @example\n             * wscWebApiInstance.grammarCheck({\n             *      text: 'These are an examples of a sentences with two misspelled words and gramar problems. Just type text with mispelling to see how it works.',\n             *      success: function(data) {\n             *          console.log(data); // [{\"phrase\":\"type text\",\"description\":\"Missing preposition.\",\"problem_id\":\"436864176\",\"suggestions\":[\"type of text\"]}]\n             *      },\n             *      error: function(error) {\n             *          console.log(error);\n             *      }\n             * });\n             */\n            grammarCheck: function(parameters) {\n                return this._request({\n                        command: this._commands.grammarCheck,\n                        language: parameters.lang || this.getOption('lang'),\n                        sentences: parameters.sentences,\n                        text: parameters.text\n                    },\n                    parameters\n                );\n            },\n            /**\n             * userDictionary success Callback.\n             *\n             * @callback UserDictionaryCallback\n             * @param {UserDictionary} UDObject\n             */\n\n            /**\n             * getUserDictionary API method.\n             * @public\n             * @memberof WebApiInstance#\n             *\n             * @param {Object} parameters\n             * @param {String} parameters.name - User dictionary name.\n             * @param {UserDictionaryCallback} parameters.success - Handler successful response from the server.\n             * @param {RequestCallback} parameters.error - Handler unsuccessful response from the server.\n             * @returns {Object} - Transport object.\n             * @example\n             * wscWebApiInstance.getUserDictionary({\n             *      name: 'test',\n             *      success: function(data) {\n             *          console.log(data); // {\"name\":\"test\",\"action\":\"getdict\",\"wordlist\":[]}\n             *      },\n             *      error: function(error) {\n             *          console.log(error);\n             *      }\n             * });\n             */\n            getUserDictionary: function(parameters) {\n                return this._udMethodWrapper('getDict', parameters);\n            },\n            /**\n             * createUserDictionary API method.\n             * @public\n             * @memberof WebApiInstance#\n             *\n             * @param {Object} parameters\n             * @param {String} parameters.name - User dictionary name.\n             * @param {String} parameters.wordList - Word list.\n             *\n             * @param {UserDictionaryCallback} parameters.success - Handler successful response from the server.\n             * @param {RequestCallback} parameters.error - Handler unsuccessful response from the server.\n             * @returns {Object} - Transport object.\n             * @example\n             * wscWebApiInstance.createUserDictionary({\n             *      name: 'test',\n             *      success: function(data) {\n             *          console.log(data); // {\"name\":\"test\",\"action\":\"create\",\"wordlist\":[]}\n             *      },\n             *      error: function(error) {\n             *          console.log(error);\n             *      }\n             * });\n             */\n            createUserDictionary: function(parameters) {\n                return this._udMethodWrapper('create', parameters);\n            },\n            /**\n             * deleteUserDictionary API method.\n             * @public\n             * @memberof WebApiInstance#\n             *\n             * @param {Object} parameters\n             * @param {String} parameters.name - User dictionary name.\n             * @param {UserDictionaryCallback} parameters.success - Handler successful response from the server.\n             * @param {RequestCallback} parameters.error - Handler unsuccessful response from the server.\n             * @returns {Object} - Transport object.\n             * @example\n             * wscWebApiInstance.deleteUserDictionary({\n             *      name: 'test',\n             *      success: function(data) {\n             *          console.log(data); // {\"name\":\"test\",\"action\":\"delete\",\"wordlist\":[]}\n             *      },\n             *      error: function(error) {\n             *          console.log(error);\n             *      }\n             * });\n             */\n            deleteUserDictionary: function(parameters) {\n                return this._udMethodWrapper('delete', parameters);\n            },\n            /**\n             * renameUserDictionary API method.\n             * @public\n             * @memberof WebApiInstance#\n             *\n             * @param {Object} parameters\n             * @param {String} parameters.name - User dictionary name.\n             * @param {String} parameters.newName - New user dictionary name.\n             * @param {UserDictionaryCallback} parameters.success - Handler successful response from the server.\n             * @param {RequestCallback} parameters.error - Handler unsuccessful response from the server.\n             * @returns {Object} - Transport object.\n             * @example\n             * wscWebApiInstance.renameUserDictionary({\n             *      name: 'test',\n             *      success: function(data) {\n             *          console.log(data); // {\"name\":\"test\",\"action\":\"rename\",\"wordlist\":[]}\n             *      },\n             *      error: function(error) {\n             *          console.log(error);\n             *      }\n             * });\n             */\n            renameUserDictionary: function(parameters) {\n                return this._udMethodWrapper('rename' , parameters);\n            },\n            /**\n             * addWordToUserDictionary API method.\n             * @public\n             * @memberof WebApiInstance#\n             *\n             * @param {Object} parameters\n             * @param {String} parameters.name - User dictionary name.\n             * @param {String} parameters.word - Word what will be added to UD.\n             * @param {UserDictionaryCallback} parameters.success - Handler successful response from the server.\n             * @param {RequestCallback} parameters.error - Handler unsuccessful response from the server.\n             * @returns {Object} - Transport object.\n             * @example\n             * wscWebApiInstance.addWordToUserDictionary({\n             *      name: 'test',\n             *      word: 'exaple',\n             *      success: function(data) {\n             *          console.log(data); // {\"name\":\"test\",\"action\":\"addword\",\"wordlist\":[]}\n             *      },\n             *      error: function(error) {\n             *          console.log(error);\n             *      }\n             * });\n             */\n            addWordToUserDictionary: function(parameters) {\n                return this._udMethodWrapper('addWord', parameters);\n            },\n            /**\n             * deleteWordFromUserDictionary API method.\n             * @public\n             * @memberof WebApiInstance#\n             *\n             * @param {Object} parameters\n             * @param {String} parameters.name - User dictionary name.\n             * @param {String} parameters.word - Word what will be deleted from UD.\n             * @param {UserDictionaryCallback} parameters.success - Handler successful response from the server.\n             * @param {RequestCallback} parameters.error - Handler unsuccessful response from the server.\n             * @returns {Object} - Transport object.\n             * @example\n             * wscWebApiInstance.deleteWordFromUserDictionary({\n             *      name: 'test',\n             *      word: 'exaple',\n             *      success: function(data) {\n             *          console.log(data); // {\"name\":\"test\",\"action\":\"deleteword\",\"wordlist\":[]}\n             *      },\n             *      error: function(error) {\n             *          console.log(error);\n             *      }\n             * });\n             */\n            deleteWordFromUserDictionary: function(parameters) {\n                return this._udMethodWrapper('deleteWord', parameters);\n            },\n            /**\n             * getDictionariesModifyTime API method.\n             * @public\n             * @memberof WebApiInstance#\n             *\n             * @param {Object} parameters\n             * @param {String} parameters.userDictionary - User dictionary name.\n             * @param {String} parameters.customDictionary - Custom dictionary name.\n             * @param {GetDictionariesModifyTime} parameters.success - Handler successful response from the server.\n             * @param {RequestCallback} parameters.error - Handler unsuccessful response from the server.\n             * @returns {Object} - Transport object.\n             * @example\n             * wscWebApiInstance.getDictionariesModifyTime({\n             *      userDictionary: 'udName',\n             *      customDictionary: '1',\n             *      success: function(data) {\n             *          console.log(data); // {\"customDicts\":{},\"userDicts\":{\"udName\": 1513613189}}\n             *      },\n             *      error: function(error) {\n             *          console.log(error);\n             *      }\n             * })\n             */\n            getDictionariesModifyTime: function(parameters) {\n                return this._request({\n                        command: this._commands.getDictionariesModifyTime,\n                        UDName: parameters.userDictionary,\n                        customDictionary: parameters.customDictionary\n                    },\n                    parameters\n                );\n            },\n        };\n\n        /**\n         * UserDictionary constructor.\n         * Encapsulates the construction of a query for UD request.\n         *\n         * @typedef {(Object)} UserDictionary\n         * @namespace UserDictionary\n         * @property {String} parameters.name - List of available UD actions.\n         * @property {function} parameters.wordlist - List of words in current dictionary.\n         * @property {function} parameters.makeUdAction - Request-maker function.\n         */\n        function UserDictionary(parameters) {\n            this.name = parameters.name;\n            this.wordlist = parameters.wordlist;\n            this.modificationTime = parameters.modificationTime;\n            this.makeUdAction = parameters.makeUdAction;\n        }\n\n        UserDictionary.prototype = {\n            constructor: UserDictionary,\n            _action: function(actionName, parameters) {\n                this.makeUdAction(actionName, Object.assign({\n                    name: this.name\n                }, parameters) );\n            },\n            /**\n             *  Add word to current user dictionary.\n             *\n             * @property {Object} parameters\n             * @memberof UserDictionary\n             *\n             * @property {String} parameters.word - Word what will be added to UD.\n             * @property {UserDictionaryCallback} parameters.success - Handler successful response from the server.\n             * @property {RequestCallback} parameters.error - Handler unsuccessful response from the server.\n             */\n            addWord: function(parameters) {\n                var success = parameters.success,\n                    self = this;\n\n                parameters.success = function(responseInfo) {\n                    self.wordlist.push(parameters.word);\n                    success(self);\n                };\n                this._action('addWord', parameters);\n            },\n            /**\n             *  Delete word to current user dictionary.\n             *\n             * @memberof UserDictionary\n             * @param {Object} parameters\n             *\n             * @param {String} parameters.word - Word what will be deleted from UD.\n             * @param {UserDictionaryCallback} parameters.success - Handler successful response from the server.\n             * @param {RequestCallback} parameters.error - Handler unsuccessful response from the server.\n             */\n            deleteWord: function(parameters) {\n                var success = parameters.success,\n                    word = parameters.word,\n                    self = this;\n\n                parameters.success = function(responseInfo) {\n                    var wordlist = [];\n\n                    for (var i = 0; i < self.wordlist.length; i += 1) {\n                        if (self.wordlist[i] !== word) {\n                            wordlist.push(wordlist[i]);\n                        }\n                    }\n\n                    self.wordlist = wordlist;\n                    success(self);\n                };\n                this._action('deleteWord', parameters);\n            },\n            /**\n             *  Delete current user dictionary.\n             *\n             * @memberof UserDictionary\n             * @param {Object} parameters\n             *\n             * @param {UserDictionaryCallback} parameters.success - Handler successful response from the server.\n             * @param {RequestCallback} parameters.error - Handler unsuccessful response from the server.\n             */\n            'delete': function(parameters) {\n                var success = parameters.success,\n                    self = this;\n\n                parameters.success = function(responseInfo) {\n                    this.name = undefined;\n                    this.wordlist = undefined;\n                    success(self);\n                };\n                this._action('delete', parameters);\n            },\n            /**\n             *  Rename current user dictionary.\n             *\n             * @memberof UserDictionary\n             * @param {Object} parameters\n             *\n             * @param {String} parameters.newName - New Ud name.\n             * @param {UserDictionaryCallback} parameters.success - Handler successful response from the server.\n             * @param {RequestCallback} parameters.error - Handler unsuccessful response from the server.\n             */\n            rename: function(parameters) {\n                var success = parameters.success,\n                    self = this;\n\n                parameters.success = function(responseInfo) {\n                    self.name = parameters.newName;\n                    success(self);\n                };\n                this._action('rename', parameters);\n            },\n            /**\n             *  Return UD Word list.\n             * @memberof UserDictionary\n             *\n             * @returns {Array} UD word list.\n             */\n            getWordList: function() {\n                return this.wordlist.slice();\n            }\n        };\n\n        /**\n         * Method check client options and return WebApi instance.\n         * @memberof WEBSPELLCHECKER\n         * @method WEBSPELLCHECKER.initWebApi\n         * @param {Object} options\n         * <start options doc>\n         * @property {string} [options.lang='en_US'] - The parameter sets the default spell checking language for WEBSPELLCHECKER. Possible values are:\n         * 'en_US', 'en_GB', 'pt_BR', 'da_DK',\n         * 'nl_NL', 'en_CA', 'fi_FI', 'fr_FR',\n         * 'fr_CA', 'de_DE', 'el_GR', 'it_IT',\n         * 'nb_NO', 'pt_PT', 'es_ES', 'sv_SE'.\n         *\n         * @property {string} [options.serviceProtocol='http'] - The parameter allows specifying a protocol for the WSC service (the entry point is ssrv.cgi) full path.\n         *\n         * @property {string} [options.serviceHost='svc.webspellchecker.net'] - The parameter allows specifying a host for the WSC service (the entry point is ssrv.cgi) full path.\n         *\n         * @property {number} [options.servicePort='80'] - The parameter allows specifying a default port for the WSC service (the entry point is ssrv.cgi) full path.\n         *\n         * @property {string} [options.servicePath='spellcheck31/script/ssrv.cgi'] - The parameter is used to specify a path to the WSC service (the entry point is ssrv.cgi) full path.\n         *\n         * @property {number} [options.minWordLength=3] - The parameter defines minimum length of the letters that will be collected from container's text for spell checking.\n         * Possible value is any positive number.\n         *\n         * @property {string} [options.customDictionaryIds=''] - The parameter links WEBSPELLCHECKER to custom dictionaries. Here is a string containing dictionary IDs separated by commas (',').\n         * Further details can be found at [link](http://wiki.webspellchecker.net/doku.php?id=installationandconfiguration:customdictionaries:licensed).\n         *\n         * @property {string} [options.userDictionaryName=''] - The parameter activates a User Dictionary in WEBSPELLCHECKER.\n         *\n         * @property {string} [options.serviceId=''] - The parameter sets the service ID for WEBSPELLCHECKER. It used for a migration from free,\n         * ad-supported version to paid, ad-free version.\n         *\n         * @property {String} [options.customPunctuation=''] - The parameter that receives a string with characters that will considered as separators.\n         *\n         * <end options doc>\n         * @returns {WebApiInstance} - WebApi Instance.\n         */\n        Namespace.initWebApi = function(options) {\n            return new WebApi(options);\n        };\n    }\n\n    if (typeof window === 'undefined') {\n        module.exports = init;\n    }\n\n\tif (typeof WEBSPELLCHECKER !== 'undefined' && !('initWebApi' in WEBSPELLCHECKER)) {\n        init(WEBSPELLCHECKER);\n    }\n})();\n// TextProcessor.js\n/**\n * @fileoverview Static Module. TextProcessor.\n */\n(function(){\n    'use strict';\n\tfunction init( Namespace ) {\n\n        var RegularsManager = Namespace.RegularsManager,\n            StringUtils = Namespace.Utils.StringUtils;\n\n        /**\n         * Represents TextProcessor Module.\n         *\n         * @constructor\n         * @alias WEBSPELLCHECKER.TextProcessor\n         *\n         * @param {String} moduleId - Moduloe name;\n         * @param {Object} appInstance - Instance of main app.\n         * @private\n         */\n        function TextProcessor(moduleId, appInstance) {\n            this.moduleId = moduleId;\n            this.appInstance = appInstance;\n\n            RegularsManager.textPunctuation.store('punctuationRegExp');\n        }\n\n        TextProcessor.prototype = {\n            constructor: TextProcessor,\n            /**\n             * Method what replacing separators(punctuation, symbols, quots) on spacces* Method for placing separators(punctuation, symbols, quotes) on spaces.\n             * @memberof WEBSPELLCHECKER.TextProcessor#\n             *\n             * @param {String} text - Text for replacing separators.\n             *\n             * @returns {String} - text without separators.\n             * @private\n             */\n            replaceSepatators: function(text) {\n                var _situationalSepSetGlob,\n                    punctuationRegExp = RegularsManager.punctuationRegExp;\n\n                text = RegularsManager.HtmlSpaceSymbol.compositionGraph([\n                    punctuationRegExp,\n                    RegularsManager.EOL,\n                    RegularsManager.wrap( this.appInstance.getOption('customPunctuation') )\n                ]).g().set().replace(text, ' ');\n\n                _situationalSepSetGlob = RegularsManager.situationalSeparators\n                    .set().g();\n\n                // replace(/([\\.\\-\\']{2,})/g, '#$1#')\n                text = _situationalSepSetGlob\n                    .composition(RegularsManager.twoAndMore)\n                    .init(text)\n                    .wrapInclude(\"#\")\n                    .getString();\n\n                // replace(/#[\\.\\-\\']|[\\.\\-\\']#/g, ' ')\n                text = _situationalSepSetGlob\n                    .init(text)\n                    .replaceLeftWrapped('#', ' ')\n                    .replaceRightWrapped('#', ' ')\n                    .getString();\n\n                // replace( new RegExp( ' [\\-\\'\\.]|[\\-\\'\\.] ', 'g' ), '  ' )\n                // replace( new RegExp( '^[\\-\\'\\.]|[\\-\\'\\.]$', 'g' ), ' ' )\n                text = _situationalSepSetGlob\n                    .init(text)\n                    .replaceRightWrapped(' ', '  ')\n                    .replaceLeftWrapped(' ', '  ')\n                    .start().or( _situationalSepSetGlob.end() )\n                    .replace(' ')\n                    .getString();\n\n                return text;\n            },\n            /**\n             * Method what remove special characters.\n             * @memberof WEBSPELLCHECKER.TextProcessor#\n             *\n             * @param {String} text - Text for removing special characters.\n             *\n             * @returns {String} - Text without special characters.\n             * @private\n             */\n            removeSpecialCharacters: function(text) {\n                return RegularsManager.specialCharacters\n                    .set().g().replace(text, '');\n            },\n            /**\n             * Method what collect offsets in text for current word.\n             * @memberof WEBSPELLCHECKER.TextProcessor#\n             *\n             * @param {String} word - Words for which we are looking for offsets.\n             * @param {String} text - Text with words.\n             *\n             * @returns {Object} - Start and end offsets.\n             * @private\n             */\n            getWordOffsets: function(word, text) {\n                var startOffset = text.indexOf(word),\n                    endOffset = startOffset + word.length;\n\n                return {\n                    startOffset: startOffset,\n                    endOffset: endOffset\n                };\n            },\n            /**\n             * API method what collect words from original text.\n             * @memberof WEBSPELLCHECKER.TextProcessor#\n             *\n             * @param {String} text - Original text.\n             *\n             * @returns {Object} - Object with array of words and collection of words offsets.\n             */\n            getWordsFromString: function(text) {\n                var minWordLength = this.appInstance.getOption('minWordLength'),\n                    wordsCollection = [],\n                    wordsOffsets,\n                    result,\n                    self = this;\n\n                text = this.replaceSepatators(text);\n                text = this.removeSpecialCharacters(text);\n\n\n                wordsOffsets = RegularsManager.space\n                    .init(text)\n                    .split()\n                    .reduce(function(prev, word) {\n                        var wordObject;\n                        if (word !== '' && word.length >= minWordLength ) {\n                            if( !wordsCollection.includes(word) ) {\n                                wordsCollection.push(word);\n                            }\n                            wordObject = self.getWordOffsets(word, text);\n                            wordObject.word = word;\n                            prev.push(wordObject);\n                            text = StringUtils.replaceFromTo(text, wordObject.startOffset, wordObject.endOffset, new Array(word.length + 1).join(' ') );\n                        }\n                        return prev;\n                    }, []);\n\n                return {\n                    wordsOffsets: wordsOffsets,\n                    wordsCollection: wordsCollection\n                };\n            }\n\n        };\n\n        Namespace.TextProcessor = TextProcessor;\n    }\n    if(typeof window === 'undefined') {module.exports = init;}\n\tif(typeof WEBSPELLCHECKER !== 'undefined' && !('Connection' in WEBSPELLCHECKER)) {init(WEBSPELLCHECKER);}\n})();\n// Connection.js\n/**\n * @fileoverview Connection module.\n */\n(function(){\n    'use strict';\n\tfunction init( Namespace ) {\n\n        var IO = Namespace.IO,\n            _parametersMap = {\n                serviceId: 'customerid',\n                command: 'cmd',\n                communicationFormat: 'format',\n                userDictionary: 'user_dictionary',\n                customDictionary: 'custom_dictionary',\n                UDAction: 'action',\n                UDName: 'name',\n                newUDName: 'new_name',\n                removeUDCookie: 'remove_ud_cookie',\n                UDWord: 'word',\n                userWordlist: 'user_wordlist',\n                wordList: 'wordlist',\n                language: 'slang',\n                outType: 'out_type',\n                text: 'text',\n                sentences: 'sentences',\n                appType: 'app_type'\n            },\n            _commandsMap = {\n                spellCheck: 'check_spelling',\n                grammarCheck: 'grammar_check',\n                userDictionary: 'user_dictionary',\n                getLangList: 'get_lang_list',\n                getInfo: 'get_info',\n                getDictionariesModifyTime: 'get_dicts_modify_time'\n            },\n            _UDActionsMap = {\n                create: 'create',\n                'delete': 'delete',\n                rename: 'rename',\n                check: 'check',\n                addWord: 'addword',\n                deleteWord: 'deleteword',\n                getDict: 'getdict'\n            };\n        /**\n         * Represents Connection Module.\n         * Module for working with server commands and preparing request info.\n         * @constructor\n         * @alias WEBSPELLCHECKER.Connection\n         *\n         * @param {String} moduleId - Moduloe name;\n         * @param {Object} appInstance - Instance of main app.\n         * @private\n         */\n        function Connection(moduleId, appInstance) {\n            this.moduleId = moduleId;\n            this.appInstance = appInstance;\n\n            this.url = new IO.URL({\n\t\t\t\tprotocol \t: appInstance.getOption('serviceProtocol'),\n\t\t\t\thost \t\t: appInstance.getOption('serviceHost'),\n\t\t\t\tport \t\t: appInstance.getOption('servicePort'),\n\t\t\t\tpath \t\t: appInstance.getOption('servicePath')\n            });\n\n            this.defaultParameters = this.setDefaults(['serviceId', 'communicationFormat', 'appType'], _parametersMap);\n        }\n\n        Connection.prototype = {\n            constructor: Connection,\n            /**\n             * Accessor for map of cmd request parameter values.\n             * @memberof WEBSPELLCHECKER.Connection#\n             *\n             * @returns {Object} - List of server commands.\n             * @private\n             */\n            getCommands: function() {\n                return _commandsMap;\n            },\n            /**\n             * Accessor for map of user dictionary actions.\n             * @memberof WEBSPELLCHECKER.Connection#\n             *\n             * @returns {Object} - List of UD actions.\n             * @private\n             */\n            getUdActions: function() {\n                return _UDActionsMap;\n            },\n            /**\n             * Define common parameters for each request.\n             * @memberof WEBSPELLCHECKER.Connection#\n             *\n             * @private\n             */\n            setDefaults: function(paramsNames, map) {\n                var storage = {};\n                paramsNames.forEach(function(name) {\n                    storage[ map[name] ] = this.appInstance.getOption(name);\n                }, this);\n                return storage;\n            },\n            /**\n             * Return clone of url object for request.\n             * @memberof WEBSPELLCHECKER.Connection#\n             *\n             * @returns {Object} - Clone of IO url object.\n             * @private\n             */\n            getURL: function() {\n                return this.url.clear();\n            },\n            /**\n             * Prepare client parameters before request.\n             * Collect request parameters from _parametersMap.\n             * @memberof WEBSPELLCHECKER.Connection#\n             *\n             * @param {Object} parameters - Wrapped requst parameters.\n             * @param {Object} map - map to server parameters names.\n             *\n             * @returns {Object} - Requst parameters.\n             * @private\n             */\n            prepareParameters: function(parameters, map) {\n                var result = {},\n                    paramName;\n\n                for(var k in parameters) {\n                    paramName = map[k];\n                    if(!paramName) {\n                        throw new Error('parameter ' + k + ' is not specified.');\n                    }\n                    result[paramName] = parameters[k];\n                }\n                result = Object.assign({}, this.defaultParameters, result);\n\n                // Now we have the bag with get_lang_list command.\n                // It's doesn't work for some reasons in server side with \"format=json\" parameter.\n                // we should remove this parametr for get_lang_list command;\n                if(result[map.command] === _commandsMap.getLangList) {\n                    delete result[map.communicationFormat];\n                }\n\n                return result;\n            },\n            /**\n             * Make requst to the server using IO object.\n             * @memberof WEBSPELLCHECKER.Connection#\n             *\n             * @param {Object} parameters - Wrapped requst parameters.\n             * @param {Function} onSuccess - Handler successful response from the server.\n             * @param {Function} onError - Handler unsuccessful response from the server.\n             *\n             * @returns {Object} - Transport object.\n             * @private\n             */\n            request: function(parameters, onSuccess, onError) {\n                return IO.get(\n                    this.getURL()\n                        .addParameters( this.prepareParameters(parameters, _parametersMap) )\n                        .addMetaParameters( this.defaultMetaParameters ),\n                    onSuccess,\n                    onError\n                );\n            }\n        };\n\n        Namespace.Connection = Connection;\n    }\n\n    if(typeof window === 'undefined') {module.exports = init;}\n\tif(typeof WEBSPELLCHECKER !== 'undefined' && !('Connection' in WEBSPELLCHECKER)) {init(WEBSPELLCHECKER);}\n})();\nWEBSPELLCHECKER.signals = function(){\n/*\n\n JS Signals <http://millermedeiros.github.com/js-signals/>\n Released under the MIT license\n Author: Miller Medeiros\n Version: 1.1.1 - Build: 275 (2019/01/21 04:37 PM)\n*/\n(function(g){function f(a,b,c,h,d){this._listener=b;this._isOnce=c;this.context=h;this._signal=a;this._priority=d||0}function e(a,b){if(\"function\"!==typeof a)throw Error(\"listener is a required param of {fn}() and should be a Function.\".replace(\"{fn}\",b));}function d(){this._bindings=[];this._prevParams=null;var a=this;this.dispatch=function(){d.prototype.dispatch.apply(a,arguments)}}f.prototype={active:!0,params:null,execute:function(a){var b;if(this.active&&this._listener){a=this.params?this.params.concat(a):\na;try{b=this._listener.apply(this.context,a)}catch(c){setTimeout(function(){throw c;},0)}finally{this._isOnce&&this.detach()}}return b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return\"[SignalBinding isOnce:\"+\nthis._isOnce+\", isBound:\"+this.isBound()+\", active:\"+this.active+\"]\"}};d.prototype={VERSION:\"1.1.1\",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(a,b,c,d){var e=this._indexOfListener(a,c);if(-1!==e){if(a=this._bindings[e],a.isOnce()!==b)throw Error(\"You cannot add\"+(b?\"\":\"Once\")+\"() then add\"+(b?\"Once\":\"\")+\"() the same listener without removing the relationship first.\");}else a=new f(this,a,b,c,d),this._addBinding(a);this.memorize&&this._prevParams&&a.execute(this._prevParams);\nreturn a},_addBinding:function(a){var b=this._bindings.length;do--b;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){for(var c=this._bindings.length,d;c--;)if(d=this._bindings[c],d._listener===a&&d.context===b)return c;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,c){e(a,\"add\");return this._registerListener(a,!1,b,c)},addOnce:function(a,b,c){e(a,\"addOnce\");return this._registerListener(a,\n!0,b,c)},remove:function(a,b){e(a,\"remove\");var c=this._indexOfListener(a,b);-1!==c&&(this._bindings[c]._destroy(),this._bindings.splice(c,1));return a},removeAll:function(){for(var a=this._bindings.length;a--;)this._bindings[a]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active){for(var a=arguments.length,b=Array(a),c=0;c<a;++c)b[c]=arguments[c];a=this._bindings.length;this.memorize&&\n(this._prevParams=b);if(a){c=this._bindings.slice();this._shouldPropagate=!0;do a--;while(c[a]&&this._shouldPropagate&&!1!==c[a].execute(b))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll();delete this._bindings;delete this._prevParams},toString:function(){return\"[Signal active:\"+this.active+\" numListeners:\"+this.getNumListeners()+\"]\"}};d.Signal=d;g.signals=d})(this);\n\n};\nWEBSPELLCHECKER.signals();\nWEBSPELLCHECKER.rangy = function(){\n/**\n * Rangy, a cross-browser JavaScript range and selection library\n * https://github.com/timdown/rangy\n *\n * Copyright 2019, Tim Down\n * Licensed under the MIT license.\n * Version: 1.3.0\n * Build date: 21 January 2019\n */\n\n(function(global) {\n\n    var OBJECT = \"object\", FUNCTION = \"function\", UNDEFINED = \"undefined\";\n\n    // Minimal set of properties required for DOM Level 2 Range compliance. Comparison constants such as START_TO_START\n    // are omitted because ranges in KHTML do not have them but otherwise work perfectly well. See issue 113.\n    var domRangeProperties = [\"startContainer\", \"startOffset\", \"endContainer\", \"endOffset\", \"collapsed\",\n        \"commonAncestorContainer\"];\n\n    // Minimal set of methods required for DOM Level 2 Range compliance\n    var domRangeMethods = [\"setStart\", \"setStartBefore\", \"setStartAfter\", \"setEnd\", \"setEndBefore\",\n        \"setEndAfter\", \"collapse\", \"selectNode\", \"selectNodeContents\", \"compareBoundaryPoints\", \"deleteContents\",\n        \"extractContents\", \"cloneContents\", \"insertNode\", \"surroundContents\", \"cloneRange\", \"toString\", \"detach\"];\n\n    var textRangeProperties = [\"boundingHeight\", \"boundingLeft\", \"boundingTop\", \"boundingWidth\", \"htmlText\", \"text\"];\n\n    // Subset of TextRange's full set of methods that we're interested in\n    var textRangeMethods = [\"collapse\", \"compareEndPoints\", \"duplicate\", \"moveToElementText\", \"parentElement\", \"select\",\n        \"setEndPoint\", \"getBoundingClientRect\"];\n\n    /*----------------------------------------------------------------------------------------------------------------*/\n\n    // Trio of functions taken from Peter Michaux's article:\n    // http://peter.michaux.ca/articles/feature-detection-state-of-the-art-browser-scripting\n    function isHostMethod(o, p) {\n        var t = typeof o[p];\n        return t == FUNCTION || (!!(t == OBJECT && o[p])) || t == \"unknown\";\n    }\n\n    function isHostObject(o, p) {\n        return !!(typeof o[p] == OBJECT && o[p]);\n    }\n\n    function isHostProperty(o, p) {\n        return typeof o[p] != UNDEFINED;\n    }\n\n    // Creates a convenience function to save verbose repeated calls to tests functions\n    function createMultiplePropertyTest(testFunc) {\n        return function(o, props) {\n            var i = props.length;\n            while (i--) {\n                if (!testFunc(o, props[i])) {\n                    return false;\n                }\n            }\n            return true;\n        };\n    }\n\n    // Next trio of functions are a convenience to save verbose repeated calls to previous two functions\n    var areHostMethods = createMultiplePropertyTest(isHostMethod);\n    var areHostObjects = createMultiplePropertyTest(isHostObject);\n    var areHostProperties = createMultiplePropertyTest(isHostProperty);\n\n    function isTextRange(range) {\n        return range && areHostMethods(range, textRangeMethods) && areHostProperties(range, textRangeProperties);\n    }\n\n    function getBody(doc) {\n        return isHostObject(doc, \"body\") ? doc.body : doc.getElementsByTagName(\"body\")[0];\n    }\n\n    var forEach = [].forEach ?\n        function(arr, func) {\n            arr.forEach(func);\n        } :\n        function(arr, func) {\n            for (var i = 0, len = arr.length; i < len; ++i) {\n                func(arr[i], i);\n            }\n        };\n\n    var modules = {};\n\n    var isBrowser = (typeof window != UNDEFINED && typeof document != UNDEFINED);\n\n    var util = {\n        isHostMethod: isHostMethod,\n        isHostObject: isHostObject,\n        isHostProperty: isHostProperty,\n        areHostMethods: areHostMethods,\n        areHostObjects: areHostObjects,\n        areHostProperties: areHostProperties,\n        isTextRange: isTextRange,\n        getBody: getBody,\n        forEach: forEach\n    };\n\n    var api = {\n        version: \"1.3.0\",\n        initialized: false,\n        isBrowser: isBrowser,\n        supported: true,\n        util: util,\n        features: {},\n        modules: modules,\n        config: {\n            alertOnFail: false,\n            alertOnWarn: false,\n            preferTextRange: false,\n            autoInitialize: (typeof rangyAutoInitialize == UNDEFINED) ? true : rangyAutoInitialize\n        }\n    };\n\n    function consoleLog(msg) {\n        if (typeof console != UNDEFINED && isHostMethod(console, \"log\")) {\n            console.log(msg);\n        }\n    }\n\n    function alertOrLog(msg, shouldAlert) {\n        if (isBrowser && shouldAlert) {\n            alert(msg);\n        } else  {\n            consoleLog(msg);\n        }\n    }\n\n    function fail(reason) {\n        api.initialized = true;\n        api.supported = false;\n        alertOrLog(\"Rangy is not supported in this environment. Reason: \" + reason, api.config.alertOnFail);\n    }\n\n    api.fail = fail;\n\n    function warn(msg) {\n        alertOrLog(\"Rangy warning: \" + msg, api.config.alertOnWarn);\n    }\n\n    api.warn = warn;\n\n    // Add utility extend() method\n    var extend;\n    if ({}.hasOwnProperty) {\n        util.extend = extend = function(obj, props, deep) {\n            var o, p;\n            for (var i in props) {\n                if (props.hasOwnProperty(i)) {\n                    o = obj[i];\n                    p = props[i];\n                    if (deep && o !== null && typeof o == \"object\" && p !== null && typeof p == \"object\") {\n                        extend(o, p, true);\n                    }\n                    obj[i] = p;\n                }\n            }\n            // Special case for toString, which does not show up in for...in loops in IE <= 8\n            if (props.hasOwnProperty(\"toString\")) {\n                obj.toString = props.toString;\n            }\n            return obj;\n        };\n\n        util.createOptions = function(optionsParam, defaults) {\n            var options = {};\n            extend(options, defaults);\n            if (optionsParam) {\n                extend(options, optionsParam);\n            }\n            return options;\n        };\n    } else {\n        fail(\"hasOwnProperty not supported\");\n    }\n\n    // Test whether we're in a browser and bail out if not\n    if (!isBrowser) {\n        fail(\"Rangy can only run in a browser\");\n    }\n\n    // Test whether Array.prototype.slice can be relied on for NodeLists and use an alternative toArray() if not\n    (function() {\n        var toArray;\n\n        if (isBrowser) {\n            var el = document.createElement(\"div\");\n            el.appendChild(document.createElement(\"span\"));\n            var slice = [].slice;\n            try {\n                if (slice.call(el.childNodes, 0)[0].nodeType == 1) {\n                    toArray = function(arrayLike) {\n                        return slice.call(arrayLike, 0);\n                    };\n                }\n            } catch (e) {}\n        }\n\n        if (!toArray) {\n            toArray = function(arrayLike) {\n                var arr = [];\n                for (var i = 0, len = arrayLike.length; i < len; ++i) {\n                    arr[i] = arrayLike[i];\n                }\n                return arr;\n            };\n        }\n\n        util.toArray = toArray;\n    })();\n\n    // Very simple event handler wrapper function that doesn't attempt to solve issues such as \"this\" handling or\n    // normalization of event properties\n    var addListener;\n    if (isBrowser) {\n        if (isHostMethod(document, \"addEventListener\")) {\n            addListener = function(obj, eventType, listener) {\n                obj.addEventListener(eventType, listener, false);\n            };\n        } else if (isHostMethod(document, \"attachEvent\")) {\n            addListener = function(obj, eventType, listener) {\n                obj.attachEvent(\"on\" + eventType, listener);\n            };\n        } else {\n            fail(\"Document does not have required addEventListener or attachEvent method\");\n        }\n\n        util.addListener = addListener;\n    }\n\n    var initListeners = [];\n\n    function getErrorDesc(ex) {\n        return ex.message || ex.description || String(ex);\n    }\n\n    // Initialization\n    function init() {\n        if (!isBrowser || api.initialized) {\n            return;\n        }\n        var testRange;\n        var implementsDomRange = false, implementsTextRange = false;\n\n        // First, perform basic feature tests\n\n        if (isHostMethod(document, \"createRange\")) {\n            testRange = document.createRange();\n            if (areHostMethods(testRange, domRangeMethods) && areHostProperties(testRange, domRangeProperties)) {\n                implementsDomRange = true;\n            }\n        }\n\n        var body = getBody(document);\n        if (!body || body.nodeName.toLowerCase() != \"body\") {\n            fail(\"No body element found\");\n            return;\n        }\n\n        if (body && isHostMethod(body, \"createTextRange\")) {\n            testRange = body.createTextRange();\n            if (isTextRange(testRange)) {\n                implementsTextRange = true;\n            }\n        }\n\n        if (!implementsDomRange && !implementsTextRange) {\n            fail(\"Neither Range nor TextRange are available\");\n            return;\n        }\n\n        api.initialized = true;\n        api.features = {\n            implementsDomRange: implementsDomRange,\n            implementsTextRange: implementsTextRange\n        };\n\n        // Initialize modules\n        var module, errorMessage;\n        for (var moduleName in modules) {\n            if ( (module = modules[moduleName]) instanceof Module ) {\n                module.init(module, api);\n            }\n        }\n\n        // Call init listeners\n        for (var i = 0, len = initListeners.length; i < len; ++i) {\n            try {\n                initListeners[i](api);\n            } catch (ex) {\n                errorMessage = \"Rangy init listener threw an exception. Continuing. Detail: \" + getErrorDesc(ex);\n                consoleLog(errorMessage);\n            }\n        }\n    }\n\n    function deprecationNotice(deprecated, replacement, module) {\n        if (module) {\n            deprecated += \" in module \" + module.name;\n        }\n        api.warn(\"DEPRECATED: \" + deprecated + \" is deprecated. Please use \" +\n        replacement + \" instead.\");\n    }\n\n    function createAliasForDeprecatedMethod(owner, deprecated, replacement, module) {\n        owner[deprecated] = function() {\n            deprecationNotice(deprecated, replacement, module);\n            return owner[replacement].apply(owner, util.toArray(arguments));\n        };\n    }\n\n    util.deprecationNotice = deprecationNotice;\n    util.createAliasForDeprecatedMethod = createAliasForDeprecatedMethod;\n\n    // Allow external scripts to initialize this library in case it's loaded after the document has loaded\n    api.init = init;\n\n    // Execute listener immediately if already initialized\n    api.addInitListener = function(listener) {\n        if (api.initialized) {\n            listener(api);\n        } else {\n            initListeners.push(listener);\n        }\n    };\n\n    var shimListeners = [];\n\n    api.addShimListener = function(listener) {\n        shimListeners.push(listener);\n    };\n\n    function shim(win) {\n        win = win || window;\n        init();\n\n        // Notify listeners\n        for (var i = 0, len = shimListeners.length; i < len; ++i) {\n            shimListeners[i](win);\n        }\n    }\n\n    if (isBrowser) {\n        api.shim = api.createMissingNativeApi = shim;\n        createAliasForDeprecatedMethod(api, \"createMissingNativeApi\", \"shim\");\n    }\n\n    function Module(name, dependencies, initializer) {\n        this.name = name;\n        this.dependencies = dependencies;\n        this.initialized = false;\n        this.supported = false;\n        this.initializer = initializer;\n    }\n\n    Module.prototype = {\n        init: function() {\n            var requiredModuleNames = this.dependencies || [];\n            for (var i = 0, len = requiredModuleNames.length, requiredModule, moduleName; i < len; ++i) {\n                moduleName = requiredModuleNames[i];\n\n                requiredModule = modules[moduleName];\n                if (!requiredModule || !(requiredModule instanceof Module)) {\n                    throw new Error(\"required module '\" + moduleName + \"' not found\");\n                }\n\n                requiredModule.init();\n\n                if (!requiredModule.supported) {\n                    throw new Error(\"required module '\" + moduleName + \"' not supported\");\n                }\n            }\n\n            // Now run initializer\n            this.initializer(this);\n        },\n\n        fail: function(reason) {\n            this.initialized = true;\n            this.supported = false;\n            throw new Error(reason);\n        },\n\n        warn: function(msg) {\n            api.warn(\"Module \" + this.name + \": \" + msg);\n        },\n\n        deprecationNotice: function(deprecated, replacement) {\n            api.warn(\"DEPRECATED: \" + deprecated + \" in module \" + this.name + \" is deprecated. Please use \" +\n                replacement + \" instead\");\n        },\n\n        createError: function(msg) {\n            return new Error(\"Error in Rangy \" + this.name + \" module: \" + msg);\n        }\n    };\n\n    function createModule(name, dependencies, initFunc) {\n        var newModule = new Module(name, dependencies, function(module) {\n            if (!module.initialized) {\n                module.initialized = true;\n                try {\n                    initFunc(api, module);\n                    module.supported = true;\n                } catch (ex) {\n                    var errorMessage = \"Module '\" + name + \"' failed to load: \" + getErrorDesc(ex);\n                    consoleLog(errorMessage);\n                    if (ex.stack) {\n                        consoleLog(ex.stack);\n                    }\n                }\n            }\n        });\n        modules[name] = newModule;\n        return newModule;\n    }\n\n    api.createModule = function(name) {\n        // Allow 2 or 3 arguments (second argument is an optional array of dependencies)\n        var initFunc, dependencies;\n        if (arguments.length == 2) {\n            initFunc = arguments[1];\n            dependencies = [];\n        } else {\n            initFunc = arguments[2];\n            dependencies = arguments[1];\n        }\n\n        var module = createModule(name, dependencies, initFunc);\n\n        // Initialize the module immediately if the core is already initialized\n        if (api.initialized && api.supported) {\n            module.init();\n        }\n    };\n\n    api.createCoreModule = function(name, dependencies, initFunc) {\n        createModule(name, dependencies, initFunc);\n    };\n\n    /*----------------------------------------------------------------------------------------------------------------*/\n\n    // Ensure rangy.rangePrototype and rangy.selectionPrototype are available immediately\n\n    function RangePrototype() {}\n    api.RangePrototype = RangePrototype;\n    api.rangePrototype = new RangePrototype();\n\n    function SelectionPrototype() {}\n    api.selectionPrototype = new SelectionPrototype();\n\n    /*----------------------------------------------------------------------------------------------------------------*/\n\n    // DOM utility methods used by Rangy\n    api.createCoreModule(\"DomUtil\", [], function(api, module) {\n        var UNDEF = \"undefined\";\n        var util = api.util;\n        var getBody = util.getBody;\n\n        // Perform feature tests\n        if (!util.areHostMethods(document, [\"createDocumentFragment\", \"createElement\", \"createTextNode\"])) {\n            module.fail(\"document missing a Node creation method\");\n        }\n\n        if (!util.isHostMethod(document, \"getElementsByTagName\")) {\n            module.fail(\"document missing getElementsByTagName method\");\n        }\n\n        var el = document.createElement(\"div\");\n        if (!util.areHostMethods(el, [\"insertBefore\", \"appendChild\", \"cloneNode\"] ||\n                !util.areHostObjects(el, [\"previousSibling\", \"nextSibling\", \"childNodes\", \"parentNode\"]))) {\n            module.fail(\"Incomplete Element implementation\");\n        }\n\n        // innerHTML is required for Range's createContextualFragment method\n        if (!util.isHostProperty(el, \"innerHTML\")) {\n            module.fail(\"Element is missing innerHTML property\");\n        }\n\n        var textNode = document.createTextNode(\"test\");\n        if (!util.areHostMethods(textNode, [\"splitText\", \"deleteData\", \"insertData\", \"appendData\", \"cloneNode\"] ||\n                !util.areHostObjects(el, [\"previousSibling\", \"nextSibling\", \"childNodes\", \"parentNode\"]) ||\n                !util.areHostProperties(textNode, [\"data\"]))) {\n            module.fail(\"Incomplete Text Node implementation\");\n        }\n\n        /*----------------------------------------------------------------------------------------------------------------*/\n\n        // Removed use of indexOf because of a bizarre bug in Opera that is thrown in one of the Acid3 tests. I haven't been\n        // able to replicate it outside of the test. The bug is that indexOf returns -1 when called on an Array that\n        // contains just the document as a single element and the value searched for is the document.\n        var arrayContains = /*Array.prototype.indexOf ?\n            function(arr, val) {\n                return arr.indexOf(val) > -1;\n            }:*/\n\n            function(arr, val) {\n                var i = arr.length;\n                while (i--) {\n                    if (arr[i] === val) {\n                        return true;\n                    }\n                }\n                return false;\n            };\n\n        // Opera 11 puts HTML elements in the null namespace, it seems, and IE 7 has undefined namespaceURI\n        function isHtmlNamespace(node) {\n            var ns;\n            return typeof node.namespaceURI == UNDEF || ((ns = node.namespaceURI) === null || ns == \"http://www.w3.org/1999/xhtml\");\n        }\n\n        function parentElement(node) {\n            var parent = node.parentNode;\n            return (parent.nodeType == 1) ? parent : null;\n        }\n\n        function getNodeIndex(node) {\n            var i = 0;\n            while( (node = node.previousSibling) ) {\n                ++i;\n            }\n            return i;\n        }\n\n        function getNodeLength(node) {\n            switch (node.nodeType) {\n                case 7:\n                case 10:\n                    return 0;\n                case 3:\n                case 8:\n                    return node.length;\n                default:\n                    return node.childNodes.length;\n            }\n        }\n\n        function getCommonAncestor(node1, node2) {\n            var ancestors = [], n;\n            for (n = node1; n; n = n.parentNode) {\n                ancestors.push(n);\n            }\n\n            for (n = node2; n; n = n.parentNode) {\n                if (arrayContains(ancestors, n)) {\n                    return n;\n                }\n            }\n\n            return null;\n        }\n\n        function isAncestorOf(ancestor, descendant, selfIsAncestor) {\n            var n = selfIsAncestor ? descendant : descendant.parentNode;\n            while (n) {\n                if (n === ancestor) {\n                    return true;\n                } else {\n                    n = n.parentNode;\n                }\n            }\n            return false;\n        }\n\n        function isOrIsAncestorOf(ancestor, descendant) {\n            return isAncestorOf(ancestor, descendant, true);\n        }\n\n        function getClosestAncestorIn(node, ancestor, selfIsAncestor) {\n            var p, n = selfIsAncestor ? node : node.parentNode;\n            while (n) {\n                p = n.parentNode;\n                if (p === ancestor) {\n                    return n;\n                }\n                n = p;\n            }\n            return null;\n        }\n\n        function isCharacterDataNode(node) {\n            var t = node.nodeType;\n            return t == 3 || t == 4 || t == 8 ; // Text, CDataSection or Comment\n        }\n\n        function isTextOrCommentNode(node) {\n            if (!node) {\n                return false;\n            }\n            var t = node.nodeType;\n            return t == 3 || t == 8 ; // Text or Comment\n        }\n\n        function insertAfter(node, precedingNode) {\n            var nextNode = precedingNode.nextSibling, parent = precedingNode.parentNode;\n            if (nextNode) {\n                parent.insertBefore(node, nextNode);\n            } else {\n                parent.appendChild(node);\n            }\n            return node;\n        }\n\n        // Note that we cannot use splitText() because it is bugridden in IE 9.\n        function splitDataNode(node, index, positionsToPreserve) {\n            var newNode = node.cloneNode(false);\n            newNode.deleteData(0, index);\n            node.deleteData(index, node.length - index);\n            insertAfter(newNode, node);\n\n            // Preserve positions\n            if (positionsToPreserve) {\n                for (var i = 0, position; position = positionsToPreserve[i++]; ) {\n                    // Handle case where position was inside the portion of node after the split point\n                    if (position.node == node && position.offset > index) {\n                        position.node = newNode;\n                        position.offset -= index;\n                    }\n                    // Handle the case where the position is a node offset within node's parent\n                    else if (position.node == node.parentNode && position.offset > getNodeIndex(node)) {\n                        ++position.offset;\n                    }\n                }\n            }\n            return newNode;\n        }\n\n        function getDocument(node) {\n            if (node.nodeType == 9) {\n                return node;\n            } else if (typeof node.ownerDocument != UNDEF) {\n                return node.ownerDocument;\n            } else if (typeof node.document != UNDEF) {\n                return node.document;\n            } else if (node.parentNode) {\n                return getDocument(node.parentNode);\n            } else {\n                throw module.createError(\"getDocument: no document found for node\");\n            }\n        }\n\n        function getWindow(node) {\n            var doc = getDocument(node);\n            if (typeof doc.defaultView != UNDEF) {\n                return doc.defaultView;\n            } else if (typeof doc.parentWindow != UNDEF) {\n                return doc.parentWindow;\n            } else {\n                throw module.createError(\"Cannot get a window object for node\");\n            }\n        }\n\n        function getIframeDocument(iframeEl) {\n            if (typeof iframeEl.contentDocument != UNDEF) {\n                return iframeEl.contentDocument;\n            } else if (typeof iframeEl.contentWindow != UNDEF) {\n                return iframeEl.contentWindow.document;\n            } else {\n                throw module.createError(\"getIframeDocument: No Document object found for iframe element\");\n            }\n        }\n\n        function getIframeWindow(iframeEl) {\n            if (typeof iframeEl.contentWindow != UNDEF) {\n                return iframeEl.contentWindow;\n            } else if (typeof iframeEl.contentDocument != UNDEF) {\n                return iframeEl.contentDocument.defaultView;\n            } else {\n                throw module.createError(\"getIframeWindow: No Window object found for iframe element\");\n            }\n        }\n\n        // This looks bad. Is it worth it?\n        function isWindow(obj) {\n            return obj && util.isHostMethod(obj, \"setTimeout\") && util.isHostObject(obj, \"document\");\n        }\n\n        function getContentDocument(obj, module, methodName) {\n            var doc;\n\n            if (!obj) {\n                doc = document;\n            }\n\n            // Test if a DOM node has been passed and obtain a document object for it if so\n            else if (util.isHostProperty(obj, \"nodeType\")) {\n                doc = (obj.nodeType == 1 && obj.tagName.toLowerCase() == \"iframe\") ?\n                    getIframeDocument(obj) : getDocument(obj);\n            }\n\n            // Test if the doc parameter appears to be a Window object\n            else if (isWindow(obj)) {\n                doc = obj.document;\n            }\n\n            if (!doc) {\n                throw module.createError(methodName + \"(): Parameter must be a Window object or DOM node\");\n            }\n\n            return doc;\n        }\n\n        function getRootContainer(node) {\n            var parent;\n            while ( (parent = node.parentNode) ) {\n                node = parent;\n            }\n            return node;\n        }\n\n        function comparePoints(nodeA, offsetA, nodeB, offsetB) {\n            // See http://www.w3.org/TR/DOM-Level-2-Traversal-Range/ranges.html#Level-2-Range-Comparing\n            var nodeC, root, childA, childB, n;\n            if (nodeA == nodeB) {\n                // Case 1: nodes are the same\n                return offsetA === offsetB ? 0 : (offsetA < offsetB) ? -1 : 1;\n            } else if ( (nodeC = getClosestAncestorIn(nodeB, nodeA, true)) ) {\n                // Case 2: node C (container B or an ancestor) is a child node of A\n                return offsetA <= getNodeIndex(nodeC) ? -1 : 1;\n            } else if ( (nodeC = getClosestAncestorIn(nodeA, nodeB, true)) ) {\n                // Case 3: node C (container A or an ancestor) is a child node of B\n                return getNodeIndex(nodeC) < offsetB  ? -1 : 1;\n            } else {\n                root = getCommonAncestor(nodeA, nodeB);\n                if (!root) {\n                    throw new Error(\"comparePoints error: nodes have no common ancestor\");\n                }\n\n                // Case 4: containers are siblings or descendants of siblings\n                childA = (nodeA === root) ? root : getClosestAncestorIn(nodeA, root, true);\n                childB = (nodeB === root) ? root : getClosestAncestorIn(nodeB, root, true);\n\n                if (childA === childB) {\n                    // This shouldn't be possible\n                    throw module.createError(\"comparePoints got to case 4 and childA and childB are the same!\");\n                } else {\n                    n = root.firstChild;\n                    while (n) {\n                        if (n === childA) {\n                            return -1;\n                        } else if (n === childB) {\n                            return 1;\n                        }\n                        n = n.nextSibling;\n                    }\n                }\n            }\n        }\n\n        /*----------------------------------------------------------------------------------------------------------------*/\n\n        // Test for IE's crash (IE 6/7) or exception (IE >= 8) when a reference to garbage-collected text node is queried\n        var crashyTextNodes = false;\n\n        function isBrokenNode(node) {\n            var n;\n            try {\n                n = node.parentNode;\n                return false;\n            } catch (e) {\n                return true;\n            }\n        }\n\n        (function() {\n            var el = document.createElement(\"b\");\n            el.innerHTML = \"1\";\n            var textNode = el.firstChild;\n            el.innerHTML = \"<br />\";\n            crashyTextNodes = isBrokenNode(textNode);\n\n            api.features.crashyTextNodes = crashyTextNodes;\n        })();\n\n        /*----------------------------------------------------------------------------------------------------------------*/\n\n        function inspectNode(node) {\n            if (!node) {\n                return \"[No node]\";\n            }\n            if (crashyTextNodes && isBrokenNode(node)) {\n                return \"[Broken node]\";\n            }\n            if (isCharacterDataNode(node)) {\n                return '\"' + node.data + '\"';\n            }\n            if (node.nodeType == 1) {\n                var idAttr = node.id ? ' id=\"' + node.id + '\"' : \"\";\n                return \"<\" + node.nodeName + idAttr + \">[index:\" + getNodeIndex(node) + \",length:\" + node.childNodes.length + \"][\" + (node.innerHTML || \"[innerHTML not supported]\").slice(0, 25) + \"]\";\n            }\n            return node.nodeName;\n        }\n\n        function fragmentFromNodeChildren(node) {\n            var fragment = getDocument(node).createDocumentFragment(), child;\n            while ( (child = node.firstChild) ) {\n                fragment.appendChild(child);\n            }\n            return fragment;\n        }\n\n        var getComputedStyleProperty;\n        if (typeof window.getComputedStyle != UNDEF) {\n            getComputedStyleProperty = function(el, propName) {\n                return getWindow(el).getComputedStyle(el, null)[propName];\n            };\n        } else if (typeof document.documentElement.currentStyle != UNDEF) {\n            getComputedStyleProperty = function(el, propName) {\n                return el.currentStyle ? el.currentStyle[propName] : \"\";\n            };\n        } else {\n            module.fail(\"No means of obtaining computed style properties found\");\n        }\n\n        function createTestElement(doc, html, contentEditable) {\n            var body = getBody(doc);\n            var el = doc.createElement(\"div\");\n            el.contentEditable = \"\" + !!contentEditable;\n            if (html) {\n                el.innerHTML = html;\n            }\n\n            // Insert the test element at the start of the body to prevent scrolling to the bottom in iOS (issue #292)\n            var bodyFirstChild = body.firstChild;\n            if (bodyFirstChild) {\n                body.insertBefore(el, bodyFirstChild);\n            } else {\n                body.appendChild(el);\n            }\n\n            return el;\n        }\n\n        function removeNode(node) {\n            return node.parentNode.removeChild(node);\n        }\n\n        function NodeIterator(root) {\n            this.root = root;\n            this._next = root;\n        }\n\n        NodeIterator.prototype = {\n            _current: null,\n\n            hasNext: function() {\n                return !!this._next;\n            },\n\n            next: function() {\n                var n = this._current = this._next;\n                var child, next;\n                if (this._current) {\n                    child = n.firstChild;\n                    if (child) {\n                        this._next = child;\n                    } else {\n                        next = null;\n                        while ((n !== this.root) && !(next = n.nextSibling)) {\n                            n = n.parentNode;\n                        }\n                        this._next = next;\n                    }\n                }\n                return this._current;\n            },\n\n            detach: function() {\n                this._current = this._next = this.root = null;\n            }\n        };\n\n        function createIterator(root) {\n            return new NodeIterator(root);\n        }\n\n        function DomPosition(node, offset) {\n            this.node = node;\n            this.offset = offset;\n        }\n\n        DomPosition.prototype = {\n            equals: function(pos) {\n                return !!pos && this.node === pos.node && this.offset == pos.offset;\n            },\n\n            inspect: function() {\n                return \"[DomPosition(\" + inspectNode(this.node) + \":\" + this.offset + \")]\";\n            },\n\n            toString: function() {\n                return this.inspect();\n            }\n        };\n\n        function DOMException(codeName) {\n            this.code = this[codeName];\n            this.codeName = codeName;\n            this.message = \"DOMException: \" + this.codeName;\n        }\n\n        DOMException.prototype = {\n            INDEX_SIZE_ERR: 1,\n            HIERARCHY_REQUEST_ERR: 3,\n            WRONG_DOCUMENT_ERR: 4,\n            NO_MODIFICATION_ALLOWED_ERR: 7,\n            NOT_FOUND_ERR: 8,\n            NOT_SUPPORTED_ERR: 9,\n            INVALID_STATE_ERR: 11,\n            INVALID_NODE_TYPE_ERR: 24\n        };\n\n        DOMException.prototype.toString = function() {\n            return this.message;\n        };\n\n        api.dom = {\n            arrayContains: arrayContains,\n            isHtmlNamespace: isHtmlNamespace,\n            parentElement: parentElement,\n            getNodeIndex: getNodeIndex,\n            getNodeLength: getNodeLength,\n            getCommonAncestor: getCommonAncestor,\n            isAncestorOf: isAncestorOf,\n            isOrIsAncestorOf: isOrIsAncestorOf,\n            getClosestAncestorIn: getClosestAncestorIn,\n            isCharacterDataNode: isCharacterDataNode,\n            isTextOrCommentNode: isTextOrCommentNode,\n            insertAfter: insertAfter,\n            splitDataNode: splitDataNode,\n            getDocument: getDocument,\n            getWindow: getWindow,\n            getIframeWindow: getIframeWindow,\n            getIframeDocument: getIframeDocument,\n            getBody: getBody,\n            isWindow: isWindow,\n            getContentDocument: getContentDocument,\n            getRootContainer: getRootContainer,\n            comparePoints: comparePoints,\n            isBrokenNode: isBrokenNode,\n            inspectNode: inspectNode,\n            getComputedStyleProperty: getComputedStyleProperty,\n            createTestElement: createTestElement,\n            removeNode: removeNode,\n            fragmentFromNodeChildren: fragmentFromNodeChildren,\n            createIterator: createIterator,\n            DomPosition: DomPosition\n        };\n\n        api.DOMException = DOMException;\n    });\n\n    /*----------------------------------------------------------------------------------------------------------------*/\n\n    // Pure JavaScript implementation of DOM Range\n    api.createCoreModule(\"DomRange\", [\"DomUtil\"], function(api, module) {\n        var dom = api.dom;\n        var util = api.util;\n        var DomPosition = dom.DomPosition;\n        var DOMException = api.DOMException;\n\n        var isCharacterDataNode = dom.isCharacterDataNode;\n        var getNodeIndex = dom.getNodeIndex;\n        var isOrIsAncestorOf = dom.isOrIsAncestorOf;\n        var getDocument = dom.getDocument;\n        var comparePoints = dom.comparePoints;\n        var splitDataNode = dom.splitDataNode;\n        var getClosestAncestorIn = dom.getClosestAncestorIn;\n        var getNodeLength = dom.getNodeLength;\n        var arrayContains = dom.arrayContains;\n        var getRootContainer = dom.getRootContainer;\n        var crashyTextNodes = api.features.crashyTextNodes;\n\n        var removeNode = dom.removeNode;\n\n        /*----------------------------------------------------------------------------------------------------------------*/\n\n        // Utility functions\n\n        function isNonTextPartiallySelected(node, range) {\n            return (node.nodeType != 3) &&\n                   (isOrIsAncestorOf(node, range.startContainer) || isOrIsAncestorOf(node, range.endContainer));\n        }\n\n        function getRangeDocument(range) {\n            return range.document || getDocument(range.startContainer);\n        }\n\n        function getRangeRoot(range) {\n            return getRootContainer(range.startContainer);\n        }\n\n        function getBoundaryBeforeNode(node) {\n            return new DomPosition(node.parentNode, getNodeIndex(node));\n        }\n\n        function getBoundaryAfterNode(node) {\n            return new DomPosition(node.parentNode, getNodeIndex(node) + 1);\n        }\n\n        function insertNodeAtPosition(node, n, o) {\n            var firstNodeInserted = node.nodeType == 11 ? node.firstChild : node;\n            if (isCharacterDataNode(n)) {\n                if (o == n.length) {\n                    dom.insertAfter(node, n);\n                } else {\n                    n.parentNode.insertBefore(node, o == 0 ? n : splitDataNode(n, o));\n                }\n            } else if (o >= n.childNodes.length) {\n                n.appendChild(node);\n            } else {\n                n.insertBefore(node, n.childNodes[o]);\n            }\n            return firstNodeInserted;\n        }\n\n        function rangesIntersect(rangeA, rangeB, touchingIsIntersecting) {\n            assertRangeValid(rangeA);\n            assertRangeValid(rangeB);\n\n            if (getRangeDocument(rangeB) != getRangeDocument(rangeA)) {\n                throw new DOMException(\"WRONG_DOCUMENT_ERR\");\n            }\n\n            var startComparison = comparePoints(rangeA.startContainer, rangeA.startOffset, rangeB.endContainer, rangeB.endOffset),\n                endComparison = comparePoints(rangeA.endContainer, rangeA.endOffset, rangeB.startContainer, rangeB.startOffset);\n\n            return touchingIsIntersecting ? startComparison <= 0 && endComparison >= 0 : startComparison < 0 && endComparison > 0;\n        }\n\n        function cloneSubtree(iterator) {\n            var partiallySelected;\n            for (var node, frag = getRangeDocument(iterator.range).createDocumentFragment(), subIterator; node = iterator.next(); ) {\n                partiallySelected = iterator.isPartiallySelectedSubtree();\n                node = node.cloneNode(!partiallySelected);\n                if (partiallySelected) {\n                    subIterator = iterator.getSubtreeIterator();\n                    node.appendChild(cloneSubtree(subIterator));\n                    subIterator.detach();\n                }\n\n                if (node.nodeType == 10) { // DocumentType\n                    throw new DOMException(\"HIERARCHY_REQUEST_ERR\");\n                }\n                frag.appendChild(node);\n            }\n            return frag;\n        }\n\n        function iterateSubtree(rangeIterator, func, iteratorState) {\n            var it, n;\n            iteratorState = iteratorState || { stop: false };\n            for (var node, subRangeIterator; node = rangeIterator.next(); ) {\n                if (rangeIterator.isPartiallySelectedSubtree()) {\n                    if (func(node) === false) {\n                        iteratorState.stop = true;\n                        return;\n                    } else {\n                        // The node is partially selected by the Range, so we can use a new RangeIterator on the portion of\n                        // the node selected by the Range.\n                        subRangeIterator = rangeIterator.getSubtreeIterator();\n                        iterateSubtree(subRangeIterator, func, iteratorState);\n                        subRangeIterator.detach();\n                        if (iteratorState.stop) {\n                            return;\n                        }\n                    }\n                } else {\n                    // The whole node is selected, so we can use efficient DOM iteration to iterate over the node and its\n                    // descendants\n                    it = dom.createIterator(node);\n                    while ( (n = it.next()) ) {\n                        if (func(n) === false) {\n                            iteratorState.stop = true;\n                            return;\n                        }\n                    }\n                }\n            }\n        }\n\n        function deleteSubtree(iterator) {\n            var subIterator;\n            while (iterator.next()) {\n                if (iterator.isPartiallySelectedSubtree()) {\n                    subIterator = iterator.getSubtreeIterator();\n                    deleteSubtree(subIterator);\n                    subIterator.detach();\n                } else {\n                    iterator.remove();\n                }\n            }\n        }\n\n        function extractSubtree(iterator) {\n            for (var node, frag = getRangeDocument(iterator.range).createDocumentFragment(), subIterator; node = iterator.next(); ) {\n\n                if (iterator.isPartiallySelectedSubtree()) {\n                    node = node.cloneNode(false);\n                    subIterator = iterator.getSubtreeIterator();\n                    node.appendChild(extractSubtree(subIterator));\n                    subIterator.detach();\n                } else {\n                    iterator.remove();\n                }\n                if (node.nodeType == 10) { // DocumentType\n                    throw new DOMException(\"HIERARCHY_REQUEST_ERR\");\n                }\n                frag.appendChild(node);\n            }\n            return frag;\n        }\n\n        function getNodesInRange(range, nodeTypes, filter) {\n            var filterNodeTypes = !!(nodeTypes && nodeTypes.length), regex;\n            var filterExists = !!filter;\n            if (filterNodeTypes) {\n                regex = new RegExp(\"^(\" + nodeTypes.join(\"|\") + \")$\");\n            }\n\n            var nodes = [];\n            iterateSubtree(new RangeIterator(range, false), function(node) {\n                if (filterNodeTypes && !regex.test(node.nodeType)) {\n                    return;\n                }\n                if (filterExists && !filter(node)) {\n                    return;\n                }\n                // Don't include a boundary container if it is a character data node and the range does not contain any\n                // of its character data. See issue 190.\n                var sc = range.startContainer;\n                if (node == sc && isCharacterDataNode(sc) && range.startOffset == sc.length) {\n                    return;\n                }\n\n                var ec = range.endContainer;\n                if (node == ec && isCharacterDataNode(ec) && range.endOffset == 0) {\n                    return;\n                }\n\n                nodes.push(node);\n            });\n            return nodes;\n        }\n\n        function inspect(range) {\n            var name = (typeof range.getName == \"undefined\") ? \"Range\" : range.getName();\n            return \"[\" + name + \"(\" + dom.inspectNode(range.startContainer) + \":\" + range.startOffset + \", \" +\n                    dom.inspectNode(range.endContainer) + \":\" + range.endOffset + \")]\";\n        }\n\n        /*----------------------------------------------------------------------------------------------------------------*/\n\n        // RangeIterator code partially borrows from IERange by Tim Ryan (http://github.com/timcameronryan/IERange)\n\n        function RangeIterator(range, clonePartiallySelectedTextNodes) {\n            this.range = range;\n            this.clonePartiallySelectedTextNodes = clonePartiallySelectedTextNodes;\n\n\n            if (!range.collapsed) {\n                this.sc = range.startContainer;\n                this.so = range.startOffset;\n                this.ec = range.endContainer;\n                this.eo = range.endOffset;\n                var root = range.commonAncestorContainer;\n\n                if (this.sc === this.ec && isCharacterDataNode(this.sc)) {\n                    this.isSingleCharacterDataNode = true;\n                    this._first = this._last = this._next = this.sc;\n                } else {\n                    this._first = this._next = (this.sc === root && !isCharacterDataNode(this.sc)) ?\n                        this.sc.childNodes[this.so] : getClosestAncestorIn(this.sc, root, true);\n                    this._last = (this.ec === root && !isCharacterDataNode(this.ec)) ?\n                        this.ec.childNodes[this.eo - 1] : getClosestAncestorIn(this.ec, root, true);\n                }\n            }\n        }\n\n        RangeIterator.prototype = {\n            _current: null,\n            _next: null,\n            _first: null,\n            _last: null,\n            isSingleCharacterDataNode: false,\n\n            reset: function() {\n                this._current = null;\n                this._next = this._first;\n            },\n\n            hasNext: function() {\n                return !!this._next;\n            },\n\n            next: function() {\n                // Move to next node\n                var current = this._current = this._next;\n                if (current) {\n                    this._next = (current !== this._last) ? current.nextSibling : null;\n\n                    // Check for partially selected text nodes\n                    if (isCharacterDataNode(current) && this.clonePartiallySelectedTextNodes) {\n                        if (current === this.ec) {\n                            (current = current.cloneNode(true)).deleteData(this.eo, current.length - this.eo);\n                        }\n                        if (this._current === this.sc) {\n                            (current = current.cloneNode(true)).deleteData(0, this.so);\n                        }\n                    }\n                }\n\n                return current;\n            },\n\n            remove: function() {\n                var current = this._current, start, end;\n\n                if (isCharacterDataNode(current) && (current === this.sc || current === this.ec)) {\n                    start = (current === this.sc) ? this.so : 0;\n                    end = (current === this.ec) ? this.eo : current.length;\n                    if (start != end) {\n                        current.deleteData(start, end - start);\n                    }\n                } else {\n                    if (current.parentNode) {\n                        removeNode(current);\n                    } else {\n                    }\n                }\n            },\n\n            // Checks if the current node is partially selected\n            isPartiallySelectedSubtree: function() {\n                var current = this._current;\n                return isNonTextPartiallySelected(current, this.range);\n            },\n\n            getSubtreeIterator: function() {\n                var subRange;\n                if (this.isSingleCharacterDataNode) {\n                    subRange = this.range.cloneRange();\n                    subRange.collapse(false);\n                } else {\n                    subRange = new Range(getRangeDocument(this.range));\n                    var current = this._current;\n                    var startContainer = current, startOffset = 0, endContainer = current, endOffset = getNodeLength(current);\n\n                    if (isOrIsAncestorOf(current, this.sc)) {\n                        startContainer = this.sc;\n                        startOffset = this.so;\n                    }\n                    if (isOrIsAncestorOf(current, this.ec)) {\n                        endContainer = this.ec;\n                        endOffset = this.eo;\n                    }\n\n                    updateBoundaries(subRange, startContainer, startOffset, endContainer, endOffset);\n                }\n                return new RangeIterator(subRange, this.clonePartiallySelectedTextNodes);\n            },\n\n            detach: function() {\n                this.range = this._current = this._next = this._first = this._last = this.sc = this.so = this.ec = this.eo = null;\n            }\n        };\n\n        /*----------------------------------------------------------------------------------------------------------------*/\n\n        var beforeAfterNodeTypes = [1, 3, 4, 5, 7, 8, 10];\n        var rootContainerNodeTypes = [2, 9, 11];\n        var readonlyNodeTypes = [5, 6, 10, 12];\n        var insertableNodeTypes = [1, 3, 4, 5, 7, 8, 10, 11];\n        var surroundNodeTypes = [1, 3, 4, 5, 7, 8];\n\n        function createAncestorFinder(nodeTypes) {\n            return function(node, selfIsAncestor) {\n                var t, n = selfIsAncestor ? node : node.parentNode;\n                while (n) {\n                    t = n.nodeType;\n                    if (arrayContains(nodeTypes, t)) {\n                        return n;\n                    }\n                    n = n.parentNode;\n                }\n                return null;\n            };\n        }\n\n        var getDocumentOrFragmentContainer = createAncestorFinder( [9, 11] );\n        var getReadonlyAncestor = createAncestorFinder(readonlyNodeTypes);\n        var getDocTypeNotationEntityAncestor = createAncestorFinder( [6, 10, 12] );\n\n        function assertNoDocTypeNotationEntityAncestor(node, allowSelf) {\n            if (getDocTypeNotationEntityAncestor(node, allowSelf)) {\n                throw new DOMException(\"INVALID_NODE_TYPE_ERR\");\n            }\n        }\n\n        function assertValidNodeType(node, invalidTypes) {\n            if (!arrayContains(invalidTypes, node.nodeType)) {\n                throw new DOMException(\"INVALID_NODE_TYPE_ERR\");\n            }\n        }\n\n        function assertValidOffset(node, offset) {\n            if (offset < 0 || offset > (isCharacterDataNode(node) ? node.length : node.childNodes.length)) {\n                throw new DOMException(\"INDEX_SIZE_ERR\");\n            }\n        }\n\n        function assertSameDocumentOrFragment(node1, node2) {\n            if (getDocumentOrFragmentContainer(node1, true) !== getDocumentOrFragmentContainer(node2, true)) {\n                throw new DOMException(\"WRONG_DOCUMENT_ERR\");\n            }\n        }\n\n        function assertNodeNotReadOnly(node) {\n            if (getReadonlyAncestor(node, true)) {\n                throw new DOMException(\"NO_MODIFICATION_ALLOWED_ERR\");\n            }\n        }\n\n        function assertNode(node, codeName) {\n            if (!node) {\n                throw new DOMException(codeName);\n            }\n        }\n\n        function isValidOffset(node, offset) {\n            return offset <= (isCharacterDataNode(node) ? node.length : node.childNodes.length);\n        }\n\n        function isRangeValid(range) {\n            return (!!range.startContainer && !!range.endContainer &&\n                    !(crashyTextNodes && (dom.isBrokenNode(range.startContainer) || dom.isBrokenNode(range.endContainer))) &&\n                    getRootContainer(range.startContainer) == getRootContainer(range.endContainer) &&\n                    isValidOffset(range.startContainer, range.startOffset) &&\n                    isValidOffset(range.endContainer, range.endOffset));\n        }\n\n        function assertRangeValid(range) {\n            if (!isRangeValid(range)) {\n                throw new Error(\"Range error: Range is not valid. This usually happens after DOM mutation. Range: (\" + range.inspect() + \")\");\n            }\n        }\n\n        /*----------------------------------------------------------------------------------------------------------------*/\n\n        // Test the browser's innerHTML support to decide how to implement createContextualFragment\n        var styleEl = document.createElement(\"style\");\n        var htmlParsingConforms = false;\n        try {\n            styleEl.innerHTML = \"<b>x</b>\";\n            htmlParsingConforms = (styleEl.firstChild.nodeType == 3); // Opera incorrectly creates an element node\n        } catch (e) {\n            // IE 6 and 7 throw\n        }\n\n        api.features.htmlParsingConforms = htmlParsingConforms;\n\n        var createContextualFragment = htmlParsingConforms ?\n\n            // Implementation as per HTML parsing spec, trusting in the browser's implementation of innerHTML. See\n            // discussion and base code for this implementation at issue 67.\n            // Spec: http://html5.org/specs/dom-parsing.html#extensions-to-the-range-interface\n            // Thanks to Aleks Williams.\n            function(fragmentStr) {\n                // \"Let node the context object's start's node.\"\n                var node = this.startContainer;\n                var doc = getDocument(node);\n\n                // \"If the context object's start's node is null, raise an INVALID_STATE_ERR\n                // exception and abort these steps.\"\n                if (!node) {\n                    throw new DOMException(\"INVALID_STATE_ERR\");\n                }\n\n                // \"Let element be as follows, depending on node's interface:\"\n                // Document, Document Fragment: null\n                var el = null;\n\n                // \"Element: node\"\n                if (node.nodeType == 1) {\n                    el = node;\n\n                // \"Text, Comment: node's parentElement\"\n                } else if (isCharacterDataNode(node)) {\n                    el = dom.parentElement(node);\n                }\n\n                // \"If either element is null or element's ownerDocument is an HTML document\n                // and element's local name is \"html\" and element's namespace is the HTML\n                // namespace\"\n                if (el === null || (\n                    el.nodeName == \"HTML\" &&\n                    dom.isHtmlNamespace(getDocument(el).documentElement) &&\n                    dom.isHtmlNamespace(el)\n                )) {\n\n                // \"let element be a new Element with \"body\" as its local name and the HTML\n                // namespace as its namespace.\"\"\n                    el = doc.createElement(\"body\");\n                } else {\n                    el = el.cloneNode(false);\n                }\n\n                // \"If the node's document is an HTML document: Invoke the HTML fragment parsing algorithm.\"\n                // \"If the node's document is an XML document: Invoke the XML fragment parsing algorithm.\"\n                // \"In either case, the algorithm must be invoked with fragment as the input\n                // and element as the context element.\"\n                el.innerHTML = fragmentStr;\n\n                // \"If this raises an exception, then abort these steps. Otherwise, let new\n                // children be the nodes returned.\"\n\n                // \"Let fragment be a new DocumentFragment.\"\n                // \"Append all new children to fragment.\"\n                // \"Return fragment.\"\n                return dom.fragmentFromNodeChildren(el);\n            } :\n\n            // In this case, innerHTML cannot be trusted, so fall back to a simpler, non-conformant implementation that\n            // previous versions of Rangy used (with the exception of using a body element rather than a div)\n            function(fragmentStr) {\n                var doc = getRangeDocument(this);\n                var el = doc.createElement(\"body\");\n                el.innerHTML = fragmentStr;\n\n                return dom.fragmentFromNodeChildren(el);\n            };\n\n        function splitRangeBoundaries(range, positionsToPreserve) {\n            assertRangeValid(range);\n\n            var sc = range.startContainer, so = range.startOffset, ec = range.endContainer, eo = range.endOffset;\n            var startEndSame = (sc === ec);\n\n            if (isCharacterDataNode(ec) && eo > 0 && eo < ec.length) {\n                splitDataNode(ec, eo, positionsToPreserve);\n            }\n\n            if (isCharacterDataNode(sc) && so > 0 && so < sc.length) {\n                sc = splitDataNode(sc, so, positionsToPreserve);\n                if (startEndSame) {\n                    eo -= so;\n                    ec = sc;\n                } else if (ec == sc.parentNode && eo >= getNodeIndex(sc)) {\n                    eo++;\n                }\n                so = 0;\n            }\n            range.setStartAndEnd(sc, so, ec, eo);\n        }\n\n        function rangeToHtml(range) {\n            assertRangeValid(range);\n            var container = range.commonAncestorContainer.parentNode.cloneNode(false);\n            container.appendChild( range.cloneContents() );\n            return container.innerHTML;\n        }\n\n        /*----------------------------------------------------------------------------------------------------------------*/\n\n        var rangeProperties = [\"startContainer\", \"startOffset\", \"endContainer\", \"endOffset\", \"collapsed\",\n            \"commonAncestorContainer\"];\n\n        var s2s = 0, s2e = 1, e2e = 2, e2s = 3;\n        var n_b = 0, n_a = 1, n_b_a = 2, n_i = 3;\n\n        util.extend(api.rangePrototype, {\n            compareBoundaryPoints: function(how, range) {\n                assertRangeValid(this);\n                assertSameDocumentOrFragment(this.startContainer, range.startContainer);\n\n                var nodeA, offsetA, nodeB, offsetB;\n                var prefixA = (how == e2s || how == s2s) ? \"start\" : \"end\";\n                var prefixB = (how == s2e || how == s2s) ? \"start\" : \"end\";\n                nodeA = this[prefixA + \"Container\"];\n                offsetA = this[prefixA + \"Offset\"];\n                nodeB = range[prefixB + \"Container\"];\n                offsetB = range[prefixB + \"Offset\"];\n                return comparePoints(nodeA, offsetA, nodeB, offsetB);\n            },\n\n            insertNode: function(node) {\n                assertRangeValid(this);\n                assertValidNodeType(node, insertableNodeTypes);\n                assertNodeNotReadOnly(this.startContainer);\n\n                if (isOrIsAncestorOf(node, this.startContainer)) {\n                    throw new DOMException(\"HIERARCHY_REQUEST_ERR\");\n                }\n\n                // No check for whether the container of the start of the Range is of a type that does not allow\n                // children of the type of node: the browser's DOM implementation should do this for us when we attempt\n                // to add the node\n\n                var firstNodeInserted = insertNodeAtPosition(node, this.startContainer, this.startOffset);\n                this.setStartBefore(firstNodeInserted);\n            },\n\n            cloneContents: function() {\n                assertRangeValid(this);\n\n                var clone, frag;\n                if (this.collapsed) {\n                    return getRangeDocument(this).createDocumentFragment();\n                } else {\n                    if (this.startContainer === this.endContainer && isCharacterDataNode(this.startContainer)) {\n                        clone = this.startContainer.cloneNode(true);\n                        clone.data = clone.data.slice(this.startOffset, this.endOffset);\n                        frag = getRangeDocument(this).createDocumentFragment();\n                        frag.appendChild(clone);\n                        return frag;\n                    } else {\n                        var iterator = new RangeIterator(this, true);\n                        clone = cloneSubtree(iterator);\n                        iterator.detach();\n                    }\n                    return clone;\n                }\n            },\n\n            canSurroundContents: function() {\n                assertRangeValid(this);\n                assertNodeNotReadOnly(this.startContainer);\n                assertNodeNotReadOnly(this.endContainer);\n\n                // Check if the contents can be surrounded. Specifically, this means whether the range partially selects\n                // no non-text nodes.\n                var iterator = new RangeIterator(this, true);\n                var boundariesInvalid = (iterator._first && (isNonTextPartiallySelected(iterator._first, this)) ||\n                        (iterator._last && isNonTextPartiallySelected(iterator._last, this)));\n                iterator.detach();\n                return !boundariesInvalid;\n            },\n\n            surroundContents: function(node) {\n                assertValidNodeType(node, surroundNodeTypes);\n\n                if (!this.canSurroundContents()) {\n                    throw new DOMException(\"INVALID_STATE_ERR\");\n                }\n\n                // Extract the contents\n                var content = this.extractContents();\n\n                // Clear the children of the node\n                if (node.hasChildNodes()) {\n                    while (node.lastChild) {\n                        node.removeChild(node.lastChild);\n                    }\n                }\n\n                // Insert the new node and add the extracted contents\n                insertNodeAtPosition(node, this.startContainer, this.startOffset);\n                node.appendChild(content);\n\n                this.selectNode(node);\n            },\n\n            cloneRange: function() {\n                assertRangeValid(this);\n                var range = new Range(getRangeDocument(this));\n                var i = rangeProperties.length, prop;\n                while (i--) {\n                    prop = rangeProperties[i];\n                    range[prop] = this[prop];\n                }\n                return range;\n            },\n\n            toString: function() {\n                assertRangeValid(this);\n                var sc = this.startContainer;\n                if (sc === this.endContainer && isCharacterDataNode(sc)) {\n                    return (sc.nodeType == 3 || sc.nodeType == 4) ? sc.data.slice(this.startOffset, this.endOffset) : \"\";\n                } else {\n                    var textParts = [], iterator = new RangeIterator(this, true);\n                    iterateSubtree(iterator, function(node) {\n                        // Accept only text or CDATA nodes, not comments\n                        if (node.nodeType == 3 || node.nodeType == 4) {\n                            textParts.push(node.data);\n                        }\n                    });\n                    iterator.detach();\n                    return textParts.join(\"\");\n                }\n            },\n\n            // The methods below are all non-standard. The following batch were introduced by Mozilla but have since\n            // been removed from Mozilla.\n\n            compareNode: function(node) {\n                assertRangeValid(this);\n\n                var parent = node.parentNode;\n                var nodeIndex = getNodeIndex(node);\n\n                if (!parent) {\n                    throw new DOMException(\"NOT_FOUND_ERR\");\n                }\n\n                var startComparison = this.comparePoint(parent, nodeIndex),\n                    endComparison = this.comparePoint(parent, nodeIndex + 1);\n\n                if (startComparison < 0) { // Node starts before\n                    return (endComparison > 0) ? n_b_a : n_b;\n                } else {\n                    return (endComparison > 0) ? n_a : n_i;\n                }\n            },\n\n            comparePoint: function(node, offset) {\n                assertRangeValid(this);\n                assertNode(node, \"HIERARCHY_REQUEST_ERR\");\n                assertSameDocumentOrFragment(node, this.startContainer);\n\n                if (comparePoints(node, offset, this.startContainer, this.startOffset) < 0) {\n                    return -1;\n                } else if (comparePoints(node, offset, this.endContainer, this.endOffset) > 0) {\n                    return 1;\n                }\n                return 0;\n            },\n\n            createContextualFragment: createContextualFragment,\n\n            toHtml: function() {\n                return rangeToHtml(this);\n            },\n\n            // touchingIsIntersecting determines whether this method considers a node that borders a range intersects\n            // with it (as in WebKit) or not (as in Gecko pre-1.9, and the default)\n            intersectsNode: function(node, touchingIsIntersecting) {\n                assertRangeValid(this);\n                if (getRootContainer(node) != getRangeRoot(this)) {\n                    return false;\n                }\n\n                var parent = node.parentNode, offset = getNodeIndex(node);\n                if (!parent) {\n                    return true;\n                }\n\n                var startComparison = comparePoints(parent, offset, this.endContainer, this.endOffset),\n                    endComparison = comparePoints(parent, offset + 1, this.startContainer, this.startOffset);\n\n                return touchingIsIntersecting ? startComparison <= 0 && endComparison >= 0 : startComparison < 0 && endComparison > 0;\n            },\n\n            isPointInRange: function(node, offset) {\n                assertRangeValid(this);\n                assertNode(node, \"HIERARCHY_REQUEST_ERR\");\n                assertSameDocumentOrFragment(node, this.startContainer);\n\n                return (comparePoints(node, offset, this.startContainer, this.startOffset) >= 0) &&\n                       (comparePoints(node, offset, this.endContainer, this.endOffset) <= 0);\n            },\n\n            // The methods below are non-standard and invented by me.\n\n            // Sharing a boundary start-to-end or end-to-start does not count as intersection.\n            intersectsRange: function(range) {\n                return rangesIntersect(this, range, false);\n            },\n\n            // Sharing a boundary start-to-end or end-to-start does count as intersection.\n            intersectsOrTouchesRange: function(range) {\n                return rangesIntersect(this, range, true);\n            },\n\n            intersection: function(range) {\n                if (this.intersectsRange(range)) {\n                    var startComparison = comparePoints(this.startContainer, this.startOffset, range.startContainer, range.startOffset),\n                        endComparison = comparePoints(this.endContainer, this.endOffset, range.endContainer, range.endOffset);\n\n                    var intersectionRange = this.cloneRange();\n                    if (startComparison == -1) {\n                        intersectionRange.setStart(range.startContainer, range.startOffset);\n                    }\n                    if (endComparison == 1) {\n                        intersectionRange.setEnd(range.endContainer, range.endOffset);\n                    }\n                    return intersectionRange;\n                }\n                return null;\n            },\n\n            union: function(range) {\n                if (this.intersectsOrTouchesRange(range)) {\n                    var unionRange = this.cloneRange();\n                    if (comparePoints(range.startContainer, range.startOffset, this.startContainer, this.startOffset) == -1) {\n                        unionRange.setStart(range.startContainer, range.startOffset);\n                    }\n                    if (comparePoints(range.endContainer, range.endOffset, this.endContainer, this.endOffset) == 1) {\n                        unionRange.setEnd(range.endContainer, range.endOffset);\n                    }\n                    return unionRange;\n                } else {\n                    throw new DOMException(\"Ranges do not intersect\");\n                }\n            },\n\n            containsNode: function(node, allowPartial) {\n                if (allowPartial) {\n                    return this.intersectsNode(node, false);\n                } else {\n                    return this.compareNode(node) == n_i;\n                }\n            },\n\n            containsNodeContents: function(node) {\n                return this.comparePoint(node, 0) >= 0 && this.comparePoint(node, getNodeLength(node)) <= 0;\n            },\n\n            containsRange: function(range) {\n                var intersection = this.intersection(range);\n                return intersection !== null && range.equals(intersection);\n            },\n\n            containsNodeText: function(node) {\n                var nodeRange = this.cloneRange();\n                nodeRange.selectNode(node);\n                var textNodes = nodeRange.getNodes([3]);\n                if (textNodes.length > 0) {\n                    nodeRange.setStart(textNodes[0], 0);\n                    var lastTextNode = textNodes.pop();\n                    nodeRange.setEnd(lastTextNode, lastTextNode.length);\n                    return this.containsRange(nodeRange);\n                } else {\n                    return this.containsNodeContents(node);\n                }\n            },\n\n            getNodes: function(nodeTypes, filter) {\n                assertRangeValid(this);\n                return getNodesInRange(this, nodeTypes, filter);\n            },\n\n            getDocument: function() {\n                return getRangeDocument(this);\n            },\n\n            collapseBefore: function(node) {\n                this.setEndBefore(node);\n                this.collapse(false);\n            },\n\n            collapseAfter: function(node) {\n                this.setStartAfter(node);\n                this.collapse(true);\n            },\n\n            getBookmark: function(containerNode) {\n                var doc = getRangeDocument(this);\n                var preSelectionRange = api.createRange(doc);\n                containerNode = containerNode || dom.getBody(doc);\n                preSelectionRange.selectNodeContents(containerNode);\n                var range = this.intersection(preSelectionRange);\n                var start = 0, end = 0;\n                if (range) {\n                    preSelectionRange.setEnd(range.startContainer, range.startOffset);\n                    start = preSelectionRange.toString().length;\n                    end = start + range.toString().length;\n                }\n\n                return {\n                    start: start,\n                    end: end,\n                    containerNode: containerNode\n                };\n            },\n\n            moveToBookmark: function(bookmark) {\n                var containerNode = bookmark.containerNode;\n                var charIndex = 0;\n                this.setStart(containerNode, 0);\n                this.collapse(true);\n                var nodeStack = [containerNode], node, foundStart = false, stop = false;\n                var nextCharIndex, i, childNodes;\n\n                while (!stop && (node = nodeStack.pop())) {\n                    if (node.nodeType == 3) {\n                        nextCharIndex = charIndex + node.length;\n                        if (!foundStart && bookmark.start >= charIndex && bookmark.start <= nextCharIndex) {\n                            this.setStart(node, bookmark.start - charIndex);\n                            foundStart = true;\n                        }\n                        if (foundStart && bookmark.end >= charIndex && bookmark.end <= nextCharIndex) {\n                            this.setEnd(node, bookmark.end - charIndex);\n                            stop = true;\n                        }\n                        charIndex = nextCharIndex;\n                    } else {\n                        childNodes = node.childNodes;\n                        i = childNodes.length;\n                        while (i--) {\n                            nodeStack.push(childNodes[i]);\n                        }\n                    }\n                }\n            },\n\n            getName: function() {\n                return \"DomRange\";\n            },\n\n            equals: function(range) {\n                return Range.rangesEqual(this, range);\n            },\n\n            isValid: function() {\n                return isRangeValid(this);\n            },\n\n            inspect: function() {\n                return inspect(this);\n            },\n\n            detach: function() {\n                // In DOM4, detach() is now a no-op.\n            }\n        });\n\n        function copyComparisonConstantsToObject(obj) {\n            obj.START_TO_START = s2s;\n            obj.START_TO_END = s2e;\n            obj.END_TO_END = e2e;\n            obj.END_TO_START = e2s;\n\n            obj.NODE_BEFORE = n_b;\n            obj.NODE_AFTER = n_a;\n            obj.NODE_BEFORE_AND_AFTER = n_b_a;\n            obj.NODE_INSIDE = n_i;\n        }\n\n        function copyComparisonConstants(constructor) {\n            copyComparisonConstantsToObject(constructor);\n            copyComparisonConstantsToObject(constructor.prototype);\n        }\n\n        function createRangeContentRemover(remover, boundaryUpdater) {\n            return function() {\n                assertRangeValid(this);\n\n                var sc = this.startContainer, so = this.startOffset, root = this.commonAncestorContainer;\n\n                var iterator = new RangeIterator(this, true);\n\n                // Work out where to position the range after content removal\n                var node, boundary;\n                if (sc !== root) {\n                    node = getClosestAncestorIn(sc, root, true);\n                    boundary = getBoundaryAfterNode(node);\n                    sc = boundary.node;\n                    so = boundary.offset;\n                }\n\n                // Check none of the range is read-only\n                iterateSubtree(iterator, assertNodeNotReadOnly);\n\n                iterator.reset();\n\n                // Remove the content\n                var returnValue = remover(iterator);\n                iterator.detach();\n\n                // Move to the new position\n                boundaryUpdater(this, sc, so, sc, so);\n\n                return returnValue;\n            };\n        }\n\n        function createPrototypeRange(constructor, boundaryUpdater) {\n            function createBeforeAfterNodeSetter(isBefore, isStart) {\n                return function(node) {\n                    assertValidNodeType(node, beforeAfterNodeTypes);\n                    assertValidNodeType(getRootContainer(node), rootContainerNodeTypes);\n\n                    var boundary = (isBefore ? getBoundaryBeforeNode : getBoundaryAfterNode)(node);\n                    (isStart ? setRangeStart : setRangeEnd)(this, boundary.node, boundary.offset);\n                };\n            }\n\n            function setRangeStart(range, node, offset) {\n                var ec = range.endContainer, eo = range.endOffset;\n                if (node !== range.startContainer || offset !== range.startOffset) {\n                    // Check the root containers of the range and the new boundary, and also check whether the new boundary\n                    // is after the current end. In either case, collapse the range to the new position\n                    if (getRootContainer(node) != getRootContainer(ec) || comparePoints(node, offset, ec, eo) == 1) {\n                        ec = node;\n                        eo = offset;\n                    }\n                    boundaryUpdater(range, node, offset, ec, eo);\n                }\n            }\n\n            function setRangeEnd(range, node, offset) {\n                var sc = range.startContainer, so = range.startOffset;\n                if (node !== range.endContainer || offset !== range.endOffset) {\n                    // Check the root containers of the range and the new boundary, and also check whether the new boundary\n                    // is after the current end. In either case, collapse the range to the new position\n                    if (getRootContainer(node) != getRootContainer(sc) || comparePoints(node, offset, sc, so) == -1) {\n                        sc = node;\n                        so = offset;\n                    }\n                    boundaryUpdater(range, sc, so, node, offset);\n                }\n            }\n\n            // Set up inheritance\n            var F = function() {};\n            F.prototype = api.rangePrototype;\n            constructor.prototype = new F();\n\n            util.extend(constructor.prototype, {\n                setStart: function(node, offset) {\n                    assertNoDocTypeNotationEntityAncestor(node, true);\n                    assertValidOffset(node, offset);\n\n                    setRangeStart(this, node, offset);\n                },\n\n                setEnd: function(node, offset) {\n                    assertNoDocTypeNotationEntityAncestor(node, true);\n                    assertValidOffset(node, offset);\n\n                    setRangeEnd(this, node, offset);\n                },\n\n                /**\n                 * Convenience method to set a range's start and end boundaries. Overloaded as follows:\n                 * - Two parameters (node, offset) creates a collapsed range at that position\n                 * - Three parameters (node, startOffset, endOffset) creates a range contained with node starting at\n                 *   startOffset and ending at endOffset\n                 * - Four parameters (startNode, startOffset, endNode, endOffset) creates a range starting at startOffset in\n                 *   startNode and ending at endOffset in endNode\n                 */\n                setStartAndEnd: function() {\n                    var args = arguments;\n                    var sc = args[0], so = args[1], ec = sc, eo = so;\n\n                    switch (args.length) {\n                        case 3:\n                            eo = args[2];\n                            break;\n                        case 4:\n                            ec = args[2];\n                            eo = args[3];\n                            break;\n                    }\n\n                    boundaryUpdater(this, sc, so, ec, eo);\n                },\n\n                setBoundary: function(node, offset, isStart) {\n                    this[\"set\" + (isStart ? \"Start\" : \"End\")](node, offset);\n                },\n\n                setStartBefore: createBeforeAfterNodeSetter(true, true),\n                setStartAfter: createBeforeAfterNodeSetter(false, true),\n                setEndBefore: createBeforeAfterNodeSetter(true, false),\n                setEndAfter: createBeforeAfterNodeSetter(false, false),\n\n                collapse: function(isStart) {\n                    assertRangeValid(this);\n                    if (isStart) {\n                        boundaryUpdater(this, this.startContainer, this.startOffset, this.startContainer, this.startOffset);\n                    } else {\n                        boundaryUpdater(this, this.endContainer, this.endOffset, this.endContainer, this.endOffset);\n                    }\n                },\n\n                selectNodeContents: function(node) {\n                    assertNoDocTypeNotationEntityAncestor(node, true);\n\n                    boundaryUpdater(this, node, 0, node, getNodeLength(node));\n                },\n\n                selectNode: function(node) {\n                    assertNoDocTypeNotationEntityAncestor(node, false);\n                    assertValidNodeType(node, beforeAfterNodeTypes);\n\n                    var start = getBoundaryBeforeNode(node), end = getBoundaryAfterNode(node);\n                    boundaryUpdater(this, start.node, start.offset, end.node, end.offset);\n                },\n\n                extractContents: createRangeContentRemover(extractSubtree, boundaryUpdater),\n\n                deleteContents: createRangeContentRemover(deleteSubtree, boundaryUpdater),\n\n                canSurroundContents: function() {\n                    assertRangeValid(this);\n                    assertNodeNotReadOnly(this.startContainer);\n                    assertNodeNotReadOnly(this.endContainer);\n\n                    // Check if the contents can be surrounded. Specifically, this means whether the range partially selects\n                    // no non-text nodes.\n                    var iterator = new RangeIterator(this, true);\n                    var boundariesInvalid = (iterator._first && isNonTextPartiallySelected(iterator._first, this) ||\n                            (iterator._last && isNonTextPartiallySelected(iterator._last, this)));\n                    iterator.detach();\n                    return !boundariesInvalid;\n                },\n\n                splitBoundaries: function() {\n                    splitRangeBoundaries(this);\n                },\n\n                splitBoundariesPreservingPositions: function(positionsToPreserve) {\n                    splitRangeBoundaries(this, positionsToPreserve);\n                },\n\n                normalizeBoundaries: function() {\n                    assertRangeValid(this);\n\n                    var sc = this.startContainer, so = this.startOffset, ec = this.endContainer, eo = this.endOffset;\n\n                    var mergeForward = function(node) {\n                        var sibling = node.nextSibling;\n                        if (sibling && sibling.nodeType == node.nodeType) {\n                            ec = node;\n                            eo = node.length;\n                            node.appendData(sibling.data);\n                            removeNode(sibling);\n                        }\n                    };\n\n                    var mergeBackward = function(node) {\n                        var sibling = node.previousSibling;\n                        if (sibling && sibling.nodeType == node.nodeType) {\n                            sc = node;\n                            var nodeLength = node.length;\n                            so = sibling.length;\n                            node.insertData(0, sibling.data);\n                            removeNode(sibling);\n                            if (sc == ec) {\n                                eo += so;\n                                ec = sc;\n                            } else if (ec == node.parentNode) {\n                                var nodeIndex = getNodeIndex(node);\n                                if (eo == nodeIndex) {\n                                    ec = node;\n                                    eo = nodeLength;\n                                } else if (eo > nodeIndex) {\n                                    eo--;\n                                }\n                            }\n                        }\n                    };\n\n                    var normalizeStart = true;\n                    var sibling;\n\n                    if (isCharacterDataNode(ec)) {\n                        if (eo == ec.length) {\n                            mergeForward(ec);\n                        } else if (eo == 0) {\n                            sibling = ec.previousSibling;\n                            if (sibling && sibling.nodeType == ec.nodeType) {\n                                eo = sibling.length;\n                                if (sc == ec) {\n                                    normalizeStart = false;\n                                }\n                                sibling.appendData(ec.data);\n                                removeNode(ec);\n                                ec = sibling;\n                            }\n                        }\n                    } else {\n                        if (eo > 0) {\n                            var endNode = ec.childNodes[eo - 1];\n                            if (endNode && isCharacterDataNode(endNode)) {\n                                mergeForward(endNode);\n                            }\n                        }\n                        normalizeStart = !this.collapsed;\n                    }\n\n                    if (normalizeStart) {\n                        if (isCharacterDataNode(sc)) {\n                            if (so == 0) {\n                                mergeBackward(sc);\n                            } else if (so == sc.length) {\n                                sibling = sc.nextSibling;\n                                if (sibling && sibling.nodeType == sc.nodeType) {\n                                    if (ec == sibling) {\n                                        ec = sc;\n                                        eo += sc.length;\n                                    }\n                                    sc.appendData(sibling.data);\n                                    removeNode(sibling);\n                                }\n                            }\n                        } else {\n                            if (so < sc.childNodes.length) {\n                                var startNode = sc.childNodes[so];\n                                if (startNode && isCharacterDataNode(startNode)) {\n                                    mergeBackward(startNode);\n                                }\n                            }\n                        }\n                    } else {\n                        sc = ec;\n                        so = eo;\n                    }\n\n                    boundaryUpdater(this, sc, so, ec, eo);\n                },\n\n                collapseToPoint: function(node, offset) {\n                    assertNoDocTypeNotationEntityAncestor(node, true);\n                    assertValidOffset(node, offset);\n                    this.setStartAndEnd(node, offset);\n                }\n            });\n\n            copyComparisonConstants(constructor);\n        }\n\n        /*----------------------------------------------------------------------------------------------------------------*/\n\n        // Updates commonAncestorContainer and collapsed after boundary change\n        function updateCollapsedAndCommonAncestor(range) {\n            range.collapsed = (range.startContainer === range.endContainer && range.startOffset === range.endOffset);\n            range.commonAncestorContainer = range.collapsed ?\n                range.startContainer : dom.getCommonAncestor(range.startContainer, range.endContainer);\n        }\n\n        function updateBoundaries(range, startContainer, startOffset, endContainer, endOffset) {\n            range.startContainer = startContainer;\n            range.startOffset = startOffset;\n            range.endContainer = endContainer;\n            range.endOffset = endOffset;\n            range.document = dom.getDocument(startContainer);\n\n            updateCollapsedAndCommonAncestor(range);\n        }\n\n        function Range(doc) {\n            this.startContainer = doc;\n            this.startOffset = 0;\n            this.endContainer = doc;\n            this.endOffset = 0;\n            this.document = doc;\n            updateCollapsedAndCommonAncestor(this);\n        }\n\n        createPrototypeRange(Range, updateBoundaries);\n\n        util.extend(Range, {\n            rangeProperties: rangeProperties,\n            RangeIterator: RangeIterator,\n            copyComparisonConstants: copyComparisonConstants,\n            createPrototypeRange: createPrototypeRange,\n            inspect: inspect,\n            toHtml: rangeToHtml,\n            getRangeDocument: getRangeDocument,\n            rangesEqual: function(r1, r2) {\n                return r1.startContainer === r2.startContainer &&\n                    r1.startOffset === r2.startOffset &&\n                    r1.endContainer === r2.endContainer &&\n                    r1.endOffset === r2.endOffset;\n            }\n        });\n\n        api.DomRange = Range;\n    });\n\n    /*----------------------------------------------------------------------------------------------------------------*/\n\n    // Wrappers for the browser's native DOM Range and/or TextRange implementation\n    api.createCoreModule(\"WrappedRange\", [\"DomRange\"], function(api, module) {\n        var WrappedRange, WrappedTextRange;\n        var dom = api.dom;\n        var util = api.util;\n        var DomPosition = dom.DomPosition;\n        var DomRange = api.DomRange;\n        var getBody = dom.getBody;\n        var getContentDocument = dom.getContentDocument;\n        var isCharacterDataNode = dom.isCharacterDataNode;\n\n\n        /*----------------------------------------------------------------------------------------------------------------*/\n\n        if (api.features.implementsDomRange) {\n            // This is a wrapper around the browser's native DOM Range. It has two aims:\n            // - Provide workarounds for specific browser bugs\n            // - provide convenient extensions, which are inherited from Rangy's DomRange\n\n            (function() {\n                var rangeProto;\n                var rangeProperties = DomRange.rangeProperties;\n\n                function updateRangeProperties(range) {\n                    var i = rangeProperties.length, prop;\n                    while (i--) {\n                        prop = rangeProperties[i];\n                        range[prop] = range.nativeRange[prop];\n                    }\n                    // Fix for broken collapsed property in IE 9.\n                    range.collapsed = (range.startContainer === range.endContainer && range.startOffset === range.endOffset);\n                }\n\n                function updateNativeRange(range, startContainer, startOffset, endContainer, endOffset) {\n                    var startMoved = (range.startContainer !== startContainer || range.startOffset != startOffset);\n                    var endMoved = (range.endContainer !== endContainer || range.endOffset != endOffset);\n                    var nativeRangeDifferent = !range.equals(range.nativeRange);\n\n                    // Always set both boundaries for the benefit of IE9 (see issue 35)\n                    if (startMoved || endMoved || nativeRangeDifferent) {\n                        range.setEnd(endContainer, endOffset);\n                        range.setStart(startContainer, startOffset);\n                    }\n                }\n\n                var createBeforeAfterNodeSetter;\n\n                WrappedRange = function(range) {\n                    if (!range) {\n                        throw module.createError(\"WrappedRange: Range must be specified\");\n                    }\n                    this.nativeRange = range;\n                    updateRangeProperties(this);\n                };\n\n                DomRange.createPrototypeRange(WrappedRange, updateNativeRange);\n\n                rangeProto = WrappedRange.prototype;\n\n                rangeProto.selectNode = function(node) {\n                    this.nativeRange.selectNode(node);\n                    updateRangeProperties(this);\n                };\n\n                rangeProto.cloneContents = function() {\n                    return this.nativeRange.cloneContents();\n                };\n\n                // Due to a long-standing Firefox bug that I have not been able to find a reliable way to detect,\n                // insertNode() is never delegated to the native range.\n\n                rangeProto.surroundContents = function(node) {\n                    this.nativeRange.surroundContents(node);\n                    updateRangeProperties(this);\n                };\n\n                rangeProto.collapse = function(isStart) {\n                    this.nativeRange.collapse(isStart);\n                    updateRangeProperties(this);\n                };\n\n                rangeProto.cloneRange = function() {\n                    return new WrappedRange(this.nativeRange.cloneRange());\n                };\n\n                rangeProto.refresh = function() {\n                    updateRangeProperties(this);\n                };\n\n                rangeProto.toString = function() {\n                    return this.nativeRange.toString();\n                };\n\n                // Create test range and node for feature detection\n\n                var testTextNode = document.createTextNode(\"test\");\n                getBody(document).appendChild(testTextNode);\n                var range = document.createRange();\n\n                /*--------------------------------------------------------------------------------------------------------*/\n\n                // Test for Firefox 2 bug that prevents moving the start of a Range to a point after its current end and\n                // correct for it\n\n                range.setStart(testTextNode, 0);\n                range.setEnd(testTextNode, 0);\n\n                try {\n                    range.setStart(testTextNode, 1);\n\n                    rangeProto.setStart = function(node, offset) {\n                        this.nativeRange.setStart(node, offset);\n                        updateRangeProperties(this);\n                    };\n\n                    rangeProto.setEnd = function(node, offset) {\n                        this.nativeRange.setEnd(node, offset);\n                        updateRangeProperties(this);\n                    };\n\n                    createBeforeAfterNodeSetter = function(name) {\n                        return function(node) {\n                            this.nativeRange[name](node);\n                            updateRangeProperties(this);\n                        };\n                    };\n\n                } catch(ex) {\n\n                    rangeProto.setStart = function(node, offset) {\n                        try {\n                            this.nativeRange.setStart(node, offset);\n                        } catch (ex) {\n                            this.nativeRange.setEnd(node, offset);\n                            this.nativeRange.setStart(node, offset);\n                        }\n                        updateRangeProperties(this);\n                    };\n\n                    rangeProto.setEnd = function(node, offset) {\n                        try {\n                            this.nativeRange.setEnd(node, offset);\n                        } catch (ex) {\n                            this.nativeRange.setStart(node, offset);\n                            this.nativeRange.setEnd(node, offset);\n                        }\n                        updateRangeProperties(this);\n                    };\n\n                    createBeforeAfterNodeSetter = function(name, oppositeName) {\n                        return function(node) {\n                            try {\n                                this.nativeRange[name](node);\n                            } catch (ex) {\n                                this.nativeRange[oppositeName](node);\n                                this.nativeRange[name](node);\n                            }\n                            updateRangeProperties(this);\n                        };\n                    };\n                }\n\n                rangeProto.setStartBefore = createBeforeAfterNodeSetter(\"setStartBefore\", \"setEndBefore\");\n                rangeProto.setStartAfter = createBeforeAfterNodeSetter(\"setStartAfter\", \"setEndAfter\");\n                rangeProto.setEndBefore = createBeforeAfterNodeSetter(\"setEndBefore\", \"setStartBefore\");\n                rangeProto.setEndAfter = createBeforeAfterNodeSetter(\"setEndAfter\", \"setStartAfter\");\n\n                /*--------------------------------------------------------------------------------------------------------*/\n\n                // Always use DOM4-compliant selectNodeContents implementation: it's simpler and less code than testing\n                // whether the native implementation can be trusted\n                rangeProto.selectNodeContents = function(node) {\n                    this.setStartAndEnd(node, 0, dom.getNodeLength(node));\n                };\n\n                /*--------------------------------------------------------------------------------------------------------*/\n\n                // Test for and correct WebKit bug that has the behaviour of compareBoundaryPoints round the wrong way for\n                // constants START_TO_END and END_TO_START: https://bugs.webkit.org/show_bug.cgi?id=20738\n\n                range.selectNodeContents(testTextNode);\n                range.setEnd(testTextNode, 3);\n\n                var range2 = document.createRange();\n                range2.selectNodeContents(testTextNode);\n                range2.setEnd(testTextNode, 4);\n                range2.setStart(testTextNode, 2);\n\n                if (range.compareBoundaryPoints(range.START_TO_END, range2) == -1 &&\n                        range.compareBoundaryPoints(range.END_TO_START, range2) == 1) {\n                    // This is the wrong way round, so correct for it\n\n                    rangeProto.compareBoundaryPoints = function(type, range) {\n                        range = range.nativeRange || range;\n                        if (type == range.START_TO_END) {\n                            type = range.END_TO_START;\n                        } else if (type == range.END_TO_START) {\n                            type = range.START_TO_END;\n                        }\n                        return this.nativeRange.compareBoundaryPoints(type, range);\n                    };\n                } else {\n                    rangeProto.compareBoundaryPoints = function(type, range) {\n                        return this.nativeRange.compareBoundaryPoints(type, range.nativeRange || range);\n                    };\n                }\n\n                /*--------------------------------------------------------------------------------------------------------*/\n\n                // Test for IE deleteContents() and extractContents() bug and correct it. See issue 107.\n\n                var el = document.createElement(\"div\");\n                el.innerHTML = \"123\";\n                var textNode = el.firstChild;\n                var body = getBody(document);\n                body.appendChild(el);\n\n                range.setStart(textNode, 1);\n                range.setEnd(textNode, 2);\n                range.deleteContents();\n\n                if (textNode.data == \"13\") {\n                    // Behaviour is correct per DOM4 Range so wrap the browser's implementation of deleteContents() and\n                    // extractContents()\n                    rangeProto.deleteContents = function() {\n                        this.nativeRange.deleteContents();\n                        updateRangeProperties(this);\n                    };\n\n                    rangeProto.extractContents = function() {\n                        var frag = this.nativeRange.extractContents();\n                        updateRangeProperties(this);\n                        return frag;\n                    };\n                } else {\n                }\n\n                body.removeChild(el);\n                body = null;\n\n                /*--------------------------------------------------------------------------------------------------------*/\n\n                // Test for existence of createContextualFragment and delegate to it if it exists\n                if (util.isHostMethod(range, \"createContextualFragment\")) {\n                    rangeProto.createContextualFragment = function(fragmentStr) {\n                        return this.nativeRange.createContextualFragment(fragmentStr);\n                    };\n                }\n\n                /*--------------------------------------------------------------------------------------------------------*/\n\n                // Clean up\n                getBody(document).removeChild(testTextNode);\n\n                rangeProto.getName = function() {\n                    return \"WrappedRange\";\n                };\n\n                api.WrappedRange = WrappedRange;\n\n                api.createNativeRange = function(doc) {\n                    doc = getContentDocument(doc, module, \"createNativeRange\");\n                    return doc.createRange();\n                };\n            })();\n        }\n\n        if (api.features.implementsTextRange) {\n            /*\n            This is a workaround for a bug where IE returns the wrong container element from the TextRange's parentElement()\n            method. For example, in the following (where pipes denote the selection boundaries):\n\n            <ul id=\"ul\"><li id=\"a\">| a </li><li id=\"b\"> b |</li></ul>\n\n            var range = document.selection.createRange();\n            alert(range.parentElement().id); // Should alert \"ul\" but alerts \"b\"\n\n            This method returns the common ancestor node of the following:\n            - the parentElement() of the textRange\n            - the parentElement() of the textRange after calling collapse(true)\n            - the parentElement() of the textRange after calling collapse(false)\n            */\n            var getTextRangeContainerElement = function(textRange) {\n                var parentEl = textRange.parentElement();\n                var range = textRange.duplicate();\n                range.collapse(true);\n                var startEl = range.parentElement();\n                range = textRange.duplicate();\n                range.collapse(false);\n                var endEl = range.parentElement();\n                var startEndContainer = (startEl == endEl) ? startEl : dom.getCommonAncestor(startEl, endEl);\n\n                return startEndContainer == parentEl ? startEndContainer : dom.getCommonAncestor(parentEl, startEndContainer);\n            };\n\n            var textRangeIsCollapsed = function(textRange) {\n                return textRange.compareEndPoints(\"StartToEnd\", textRange) == 0;\n            };\n\n            // Gets the boundary of a TextRange expressed as a node and an offset within that node. This function started\n            // out as an improved version of code found in Tim Cameron Ryan's IERange (http://code.google.com/p/ierange/)\n            // but has grown, fixing problems with line breaks in preformatted text, adding workaround for IE TextRange\n            // bugs, handling for inputs and images, plus optimizations.\n            var getTextRangeBoundaryPosition = function(textRange, wholeRangeContainerElement, isStart, isCollapsed, startInfo) {\n                var workingRange = textRange.duplicate();\n                workingRange.collapse(isStart);\n                var containerElement = workingRange.parentElement();\n\n                // Sometimes collapsing a TextRange that's at the start of a text node can move it into the previous node, so\n                // check for that\n                if (!dom.isOrIsAncestorOf(wholeRangeContainerElement, containerElement)) {\n                    containerElement = wholeRangeContainerElement;\n                }\n\n\n                // Deal with nodes that cannot \"contain rich HTML markup\". In practice, this means form inputs, images and\n                // similar. See http://msdn.microsoft.com/en-us/library/aa703950%28VS.85%29.aspx\n                if (!containerElement.canHaveHTML) {\n                    var pos = new DomPosition(containerElement.parentNode, dom.getNodeIndex(containerElement));\n                    return {\n                        boundaryPosition: pos,\n                        nodeInfo: {\n                            nodeIndex: pos.offset,\n                            containerElement: pos.node\n                        }\n                    };\n                }\n\n                var workingNode = dom.getDocument(containerElement).createElement(\"span\");\n\n                // Workaround for HTML5 Shiv's insane violation of document.createElement(). See Rangy issue 104 and HTML5\n                // Shiv issue 64: https://github.com/aFarkas/html5shiv/issues/64\n                if (workingNode.parentNode) {\n                    dom.removeNode(workingNode);\n                }\n\n                var comparison, workingComparisonType = isStart ? \"StartToStart\" : \"StartToEnd\";\n                var previousNode, nextNode, boundaryPosition, boundaryNode;\n                var start = (startInfo && startInfo.containerElement == containerElement) ? startInfo.nodeIndex : 0;\n                var childNodeCount = containerElement.childNodes.length;\n                var end = childNodeCount;\n\n                // Check end first. Code within the loop assumes that the endth child node of the container is definitely\n                // after the range boundary.\n                var nodeIndex = end;\n\n                while (true) {\n                    if (nodeIndex == childNodeCount) {\n                        containerElement.appendChild(workingNode);\n                    } else {\n                        containerElement.insertBefore(workingNode, containerElement.childNodes[nodeIndex]);\n                    }\n                    workingRange.moveToElementText(workingNode);\n                    comparison = workingRange.compareEndPoints(workingComparisonType, textRange);\n                    if (comparison == 0 || start == end) {\n                        break;\n                    } else if (comparison == -1) {\n                        if (end == start + 1) {\n                            // We know the endth child node is after the range boundary, so we must be done.\n                            break;\n                        } else {\n                            start = nodeIndex;\n                        }\n                    } else {\n                        end = (end == start + 1) ? start : nodeIndex;\n                    }\n                    nodeIndex = Math.floor((start + end) / 2);\n                    containerElement.removeChild(workingNode);\n                }\n\n\n                // We've now reached or gone past the boundary of the text range we're interested in\n                // so have identified the node we want\n                boundaryNode = workingNode.nextSibling;\n\n                if (comparison == -1 && boundaryNode && isCharacterDataNode(boundaryNode)) {\n                    // This is a character data node (text, comment, cdata). The working range is collapsed at the start of\n                    // the node containing the text range's boundary, so we move the end of the working range to the\n                    // boundary point and measure the length of its text to get the boundary's offset within the node.\n                    workingRange.setEndPoint(isStart ? \"EndToStart\" : \"EndToEnd\", textRange);\n\n                    var offset;\n\n                    if (/[\\r\\n]/.test(boundaryNode.data)) {\n                        /*\n                        For the particular case of a boundary within a text node containing rendered line breaks (within a\n                        <pre> element, for example), we need a slightly complicated approach to get the boundary's offset in\n                        IE. The facts:\n\n                        - Each line break is represented as \\r in the text node's data/nodeValue properties\n                        - Each line break is represented as \\r\\n in the TextRange's 'text' property\n                        - The 'text' property of the TextRange does not contain trailing line breaks\n\n                        To get round the problem presented by the final fact above, we can use the fact that TextRange's\n                        moveStart() and moveEnd() methods return the actual number of characters moved, which is not\n                        necessarily the same as the number of characters it was instructed to move. The simplest approach is\n                        to use this to store the characters moved when moving both the start and end of the range to the\n                        start of the document body and subtracting the start offset from the end offset (the\n                        \"move-negative-gazillion\" method). However, this is extremely slow when the document is large and\n                        the range is near the end of it. Clearly doing the mirror image (i.e. moving the range boundaries to\n                        the end of the document) has the same problem.\n\n                        Another approach that works is to use moveStart() to move the start boundary of the range up to the\n                        end boundary one character at a time and incrementing a counter with the value returned by the\n                        moveStart() call. However, the check for whether the start boundary has reached the end boundary is\n                        expensive, so this method is slow (although unlike \"move-negative-gazillion\" is largely unaffected\n                        by the location of the range within the document).\n\n                        The approach used below is a hybrid of the two methods above. It uses the fact that a string\n                        containing the TextRange's 'text' property with each \\r\\n converted to a single \\r character cannot\n                        be longer than the text of the TextRange, so the start of the range is moved that length initially\n                        and then a character at a time to make up for any trailing line breaks not contained in the 'text'\n                        property. This has good performance in most situations compared to the previous two methods.\n                        */\n                        var tempRange = workingRange.duplicate();\n                        var rangeLength = tempRange.text.replace(/\\r\\n/g, \"\\r\").length;\n\n                        offset = tempRange.moveStart(\"character\", rangeLength);\n                        while ( (comparison = tempRange.compareEndPoints(\"StartToEnd\", tempRange)) == -1) {\n                            offset++;\n                            tempRange.moveStart(\"character\", 1);\n                        }\n                    } else {\n                        offset = workingRange.text.length;\n                    }\n                    boundaryPosition = new DomPosition(boundaryNode, offset);\n                } else {\n\n                    // If the boundary immediately follows a character data node and this is the end boundary, we should favour\n                    // a position within that, and likewise for a start boundary preceding a character data node\n                    previousNode = (isCollapsed || !isStart) && workingNode.previousSibling;\n                    nextNode = (isCollapsed || isStart) && workingNode.nextSibling;\n                    if (nextNode && isCharacterDataNode(nextNode)) {\n                        boundaryPosition = new DomPosition(nextNode, 0);\n                    } else if (previousNode && isCharacterDataNode(previousNode)) {\n                        boundaryPosition = new DomPosition(previousNode, previousNode.data.length);\n                    } else {\n                        boundaryPosition = new DomPosition(containerElement, dom.getNodeIndex(workingNode));\n                    }\n                }\n\n                // Clean up\n                dom.removeNode(workingNode);\n\n                return {\n                    boundaryPosition: boundaryPosition,\n                    nodeInfo: {\n                        nodeIndex: nodeIndex,\n                        containerElement: containerElement\n                    }\n                };\n            };\n\n            // Returns a TextRange representing the boundary of a TextRange expressed as a node and an offset within that\n            // node. This function started out as an optimized version of code found in Tim Cameron Ryan's IERange\n            // (http://code.google.com/p/ierange/)\n            var createBoundaryTextRange = function(boundaryPosition, isStart) {\n                var boundaryNode, boundaryParent, boundaryOffset = boundaryPosition.offset;\n                var doc = dom.getDocument(boundaryPosition.node);\n                var workingNode, childNodes, workingRange = getBody(doc).createTextRange();\n                var nodeIsDataNode = isCharacterDataNode(boundaryPosition.node);\n\n                if (nodeIsDataNode) {\n                    boundaryNode = boundaryPosition.node;\n                    boundaryParent = boundaryNode.parentNode;\n                } else {\n                    childNodes = boundaryPosition.node.childNodes;\n                    boundaryNode = (boundaryOffset < childNodes.length) ? childNodes[boundaryOffset] : null;\n                    boundaryParent = boundaryPosition.node;\n                }\n\n                // Position the range immediately before the node containing the boundary\n                workingNode = doc.createElement(\"span\");\n\n                // Making the working element non-empty element persuades IE to consider the TextRange boundary to be within\n                // the element rather than immediately before or after it\n                workingNode.innerHTML = \"&#feff;\";\n\n                // insertBefore is supposed to work like appendChild if the second parameter is null. However, a bug report\n                // for IERange suggests that it can crash the browser: http://code.google.com/p/ierange/issues/detail?id=12\n                if (boundaryNode) {\n                    boundaryParent.insertBefore(workingNode, boundaryNode);\n                } else {\n                    boundaryParent.appendChild(workingNode);\n                }\n\n                workingRange.moveToElementText(workingNode);\n                workingRange.collapse(!isStart);\n\n                // Clean up\n                boundaryParent.removeChild(workingNode);\n\n                // Move the working range to the text offset, if required\n                if (nodeIsDataNode) {\n                    workingRange[isStart ? \"moveStart\" : \"moveEnd\"](\"character\", boundaryOffset);\n                }\n\n                return workingRange;\n            };\n\n            /*------------------------------------------------------------------------------------------------------------*/\n\n            // This is a wrapper around a TextRange, providing full DOM Range functionality using rangy's DomRange as a\n            // prototype\n\n            WrappedTextRange = function(textRange) {\n                this.textRange = textRange;\n                this.refresh();\n            };\n\n            WrappedTextRange.prototype = new DomRange(document);\n\n            WrappedTextRange.prototype.refresh = function() {\n                var start, end, startBoundary;\n\n                // TextRange's parentElement() method cannot be trusted. getTextRangeContainerElement() works around that.\n                var rangeContainerElement = getTextRangeContainerElement(this.textRange);\n\n                if (textRangeIsCollapsed(this.textRange)) {\n                    end = start = getTextRangeBoundaryPosition(this.textRange, rangeContainerElement, true,\n                        true).boundaryPosition;\n                } else {\n                    startBoundary = getTextRangeBoundaryPosition(this.textRange, rangeContainerElement, true, false);\n                    start = startBoundary.boundaryPosition;\n\n                    // An optimization used here is that if the start and end boundaries have the same parent element, the\n                    // search scope for the end boundary can be limited to exclude the portion of the element that precedes\n                    // the start boundary\n                    end = getTextRangeBoundaryPosition(this.textRange, rangeContainerElement, false, false,\n                        startBoundary.nodeInfo).boundaryPosition;\n                }\n\n                this.setStart(start.node, start.offset);\n                this.setEnd(end.node, end.offset);\n            };\n\n            WrappedTextRange.prototype.getName = function() {\n                return \"WrappedTextRange\";\n            };\n\n            DomRange.copyComparisonConstants(WrappedTextRange);\n\n            var rangeToTextRange = function(range) {\n                if (range.collapsed) {\n                    return createBoundaryTextRange(new DomPosition(range.startContainer, range.startOffset), true);\n                } else {\n                    var startRange = createBoundaryTextRange(new DomPosition(range.startContainer, range.startOffset), true);\n                    var endRange = createBoundaryTextRange(new DomPosition(range.endContainer, range.endOffset), false);\n                    var textRange = getBody( DomRange.getRangeDocument(range) ).createTextRange();\n                    textRange.setEndPoint(\"StartToStart\", startRange);\n                    textRange.setEndPoint(\"EndToEnd\", endRange);\n                    return textRange;\n                }\n            };\n\n            WrappedTextRange.rangeToTextRange = rangeToTextRange;\n\n            WrappedTextRange.prototype.toTextRange = function() {\n                return rangeToTextRange(this);\n            };\n\n            api.WrappedTextRange = WrappedTextRange;\n\n            // IE 9 and above have both implementations and Rangy makes both available. The next few lines sets which\n            // implementation to use by default.\n            if (!api.features.implementsDomRange || api.config.preferTextRange) {\n                // Add WrappedTextRange as the Range property of the global object to allow expression like Range.END_TO_END to work\n                var globalObj = (function(f) { return f(\"return this;\")(); })(Function);\n                if (typeof globalObj.Range == \"undefined\") {\n                    globalObj.Range = WrappedTextRange;\n                }\n\n                api.createNativeRange = function(doc) {\n                    doc = getContentDocument(doc, module, \"createNativeRange\");\n                    return getBody(doc).createTextRange();\n                };\n\n                api.WrappedRange = WrappedTextRange;\n            }\n        }\n\n        api.createRange = function(doc) {\n            doc = getContentDocument(doc, module, \"createRange\");\n            return new api.WrappedRange(api.createNativeRange(doc));\n        };\n\n        api.createRangyRange = function(doc) {\n            doc = getContentDocument(doc, module, \"createRangyRange\");\n            return new DomRange(doc);\n        };\n\n        util.createAliasForDeprecatedMethod(api, \"createIframeRange\", \"createRange\");\n        util.createAliasForDeprecatedMethod(api, \"createIframeRangyRange\", \"createRangyRange\");\n\n        api.addShimListener(function(win) {\n            var doc = win.document;\n            if (typeof doc.createRange == \"undefined\") {\n                doc.createRange = function() {\n                    return api.createRange(doc);\n                };\n            }\n            doc = win = null;\n        });\n    });\n\n    /*----------------------------------------------------------------------------------------------------------------*/\n\n    // This module creates a selection object wrapper that conforms as closely as possible to the Selection specification\n    // in the HTML Editing spec (http://dvcs.w3.org/hg/editing/raw-file/tip/editing.html#selections)\n    api.createCoreModule(\"WrappedSelection\", [\"DomRange\", \"WrappedRange\"], function(api, module) {\n        api.config.checkSelectionRanges = true;\n\n        var BOOLEAN = \"boolean\";\n        var NUMBER = \"number\";\n        var dom = api.dom;\n        var util = api.util;\n        var isHostMethod = util.isHostMethod;\n        var DomRange = api.DomRange;\n        var WrappedRange = api.WrappedRange;\n        var DOMException = api.DOMException;\n        var DomPosition = dom.DomPosition;\n        var getNativeSelection;\n        var selectionIsCollapsed;\n        var features = api.features;\n        var CONTROL = \"Control\";\n        var getDocument = dom.getDocument;\n        var getBody = dom.getBody;\n        var rangesEqual = DomRange.rangesEqual;\n\n\n        // Utility function to support direction parameters in the API that may be a string (\"backward\", \"backwards\",\n        // \"forward\" or \"forwards\") or a Boolean (true for backwards).\n        function isDirectionBackward(dir) {\n            return (typeof dir == \"string\") ? /^backward(s)?$/i.test(dir) : !!dir;\n        }\n\n        function getWindow(win, methodName) {\n            if (!win) {\n                return window;\n            } else if (dom.isWindow(win)) {\n                return win;\n            } else if (win instanceof WrappedSelection) {\n                return win.win;\n            } else {\n                var doc = dom.getContentDocument(win, module, methodName);\n                return dom.getWindow(doc);\n            }\n        }\n\n        function getWinSelection(winParam) {\n            return getWindow(winParam, \"getWinSelection\").getSelection();\n        }\n\n        function getDocSelection(winParam) {\n            return getWindow(winParam, \"getDocSelection\").document.selection;\n        }\n\n        function winSelectionIsBackward(sel) {\n            var backward = false;\n            if (sel.anchorNode) {\n                backward = (dom.comparePoints(sel.anchorNode, sel.anchorOffset, sel.focusNode, sel.focusOffset) == 1);\n            }\n            return backward;\n        }\n\n        // Test for the Range/TextRange and Selection features required\n        // Test for ability to retrieve selection\n        var implementsWinGetSelection = isHostMethod(window, \"getSelection\"),\n            implementsDocSelection = util.isHostObject(document, \"selection\");\n\n        features.implementsWinGetSelection = implementsWinGetSelection;\n        features.implementsDocSelection = implementsDocSelection;\n\n        var useDocumentSelection = implementsDocSelection && (!implementsWinGetSelection || api.config.preferTextRange);\n\n        if (useDocumentSelection) {\n            getNativeSelection = getDocSelection;\n            api.isSelectionValid = function(winParam) {\n                var doc = getWindow(winParam, \"isSelectionValid\").document, nativeSel = doc.selection;\n\n                // Check whether the selection TextRange is actually contained within the correct document\n                return (nativeSel.type != \"None\" || getDocument(nativeSel.createRange().parentElement()) == doc);\n            };\n        } else if (implementsWinGetSelection) {\n            getNativeSelection = getWinSelection;\n            api.isSelectionValid = function() {\n                return true;\n            };\n        } else {\n            module.fail(\"Neither document.selection or window.getSelection() detected.\");\n            return false;\n        }\n\n        api.getNativeSelection = getNativeSelection;\n\n        var testSelection = getNativeSelection();\n\n        // In Firefox, the selection is null in an iframe with display: none. See issue #138.\n        if (!testSelection) {\n            module.fail(\"Native selection was null (possibly issue 138?)\");\n            return false;\n        }\n\n        var testRange = api.createNativeRange(document);\n        var body = getBody(document);\n\n        // Obtaining a range from a selection\n        var selectionHasAnchorAndFocus = util.areHostProperties(testSelection,\n            [\"anchorNode\", \"focusNode\", \"anchorOffset\", \"focusOffset\"]);\n\n        features.selectionHasAnchorAndFocus = selectionHasAnchorAndFocus;\n\n        // Test for existence of native selection extend() method\n        var selectionHasExtend = isHostMethod(testSelection, \"extend\");\n        features.selectionHasExtend = selectionHasExtend;\n\n        // Test if rangeCount exists\n        var selectionHasRangeCount = (typeof testSelection.rangeCount == NUMBER);\n        features.selectionHasRangeCount = selectionHasRangeCount;\n\n        var selectionSupportsMultipleRanges = ( /firefox/i.test(navigator.userAgent) ) ? true : false;\n        var collapsedNonEditableSelectionsSupported = true;\n\n        var addRangeBackwardToNative = selectionHasExtend ?\n            function(nativeSelection, range) {\n                var doc = DomRange.getRangeDocument(range);\n                var endRange = api.createRange(doc);\n                endRange.collapseToPoint(range.endContainer, range.endOffset);\n                nativeSelection.addRange(getNativeRange(endRange));\n                nativeSelection.extend(range.startContainer, range.startOffset);\n            } : null;\n\n        // #79499: Iframe editor lose selection when rangy try to check multiple ranges in selection\n        // and collapsed non editable selections support.\n        // All browsers (Chrome, Safari, Firefox, IE8/9/10/11) don't collapse non editable selections\n        // and don't support multiple ranges in selection except Firefox for multiple ranges.\n        /*if (util.areHostMethods(testSelection, [\"addRange\", \"getRangeAt\", \"removeAllRanges\"]) &&\n                typeof testSelection.rangeCount == NUMBER && features.implementsDomRange) {\n\n            (function() {\n                // Previously an iframe was used but this caused problems in some circumstances in IE, so tests are\n                // performed on the current document's selection. See issue 109.\n\n                // Note also that if a selection previously existed, it is wiped and later restored by these tests. This\n                // will result in the selection direction begin reversed if the original selection was backwards and the\n                // browser does not support setting backwards selections (Internet Explorer, I'm looking at you).\n                var sel = window.getSelection();\n                if (sel) {\n                    // Store the current selection\n                    var originalSelectionRangeCount = sel.rangeCount;\n                    var selectionHasMultipleRanges = (originalSelectionRangeCount > 1);\n                    var originalSelectionRanges = [];\n                    var originalSelectionBackward = winSelectionIsBackward(sel);\n                    for (var i = 0; i < originalSelectionRangeCount; ++i) {\n                        originalSelectionRanges[i] = sel.getRangeAt(i);\n                    }\n\n                    // Create some test elements\n                    var testEl = dom.createTestElement(document, \"\", false);\n                    var textNode = testEl.appendChild( document.createTextNode(\"\\u00a0\\u00a0\\u00a0\") );\n\n                    // Test whether the native selection will allow a collapsed selection within a non-editable element\n                    var r1 = document.createRange();\n\n                    r1.setStart(textNode, 1);\n                    r1.collapse(true);\n                    sel.removeAllRanges();\n                    sel.addRange(r1);\n                    collapsedNonEditableSelectionsSupported = (sel.rangeCount == 1);\n                    sel.removeAllRanges();\n\n                    // Test whether the native selection is capable of supporting multiple ranges.\n                    if (!selectionHasMultipleRanges) {\n                        // Doing the original feature test here in Chrome 36 (and presumably later versions) prints a\n                        // console error of \"Discontiguous selection is not supported.\" that cannot be suppressed. There's\n                        // nothing we can do about this while retaining the feature test so we have to resort to a browser\n                        // sniff. I'm not happy about it. See\n                        // https://code.google.com/p/chromium/issues/detail?id=399791\n                        var chromeMatch = window.navigator.appVersion.match(/Chrome\\/(.*?) /);\n                        if (chromeMatch && parseInt(chromeMatch[1]) >= 36) {\n                            selectionSupportsMultipleRanges = false;\n                        } else {\n                            var r2 = r1.cloneRange();\n                            r1.setStart(textNode, 0);\n                            r2.setEnd(textNode, 3);\n                            r2.setStart(textNode, 2);\n                            sel.addRange(r1);\n                            sel.addRange(r2);\n                            selectionSupportsMultipleRanges = (sel.rangeCount == 2);\n                        }\n                    }\n\n                    // Clean up\n                    dom.removeNode(testEl);\n                    sel.removeAllRanges();\n\n                    for (i = 0; i < originalSelectionRangeCount; ++i) {\n                        if (i == 0 && originalSelectionBackward) {\n                            if (addRangeBackwardToNative) {\n                                addRangeBackwardToNative(sel, originalSelectionRanges[i]);\n                            } else {\n                                api.warn(\"Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend\");\n                                sel.addRange(originalSelectionRanges[i]);\n                            }\n                        } else {\n                            sel.addRange(originalSelectionRanges[i]);\n                        }\n                    }\n                }\n            })();\n        }*/\n\n        features.selectionSupportsMultipleRanges = selectionSupportsMultipleRanges;\n        features.collapsedNonEditableSelectionsSupported = collapsedNonEditableSelectionsSupported;\n\n        // ControlRanges\n        var implementsControlRange = false, testControlRange;\n\n        if (body && isHostMethod(body, \"createControlRange\")) {\n            testControlRange = body.createControlRange();\n            if (util.areHostProperties(testControlRange, [\"item\", \"add\"])) {\n                implementsControlRange = true;\n            }\n        }\n        features.implementsControlRange = implementsControlRange;\n\n        // Selection collapsedness\n        if (selectionHasAnchorAndFocus) {\n            selectionIsCollapsed = function(sel) {\n                return sel.anchorNode === sel.focusNode && sel.anchorOffset === sel.focusOffset;\n            };\n        } else {\n            selectionIsCollapsed = function(sel) {\n                return sel.rangeCount ? sel.getRangeAt(sel.rangeCount - 1).collapsed : false;\n            };\n        }\n\n        function updateAnchorAndFocusFromRange(sel, range, backward) {\n            var anchorPrefix = backward ? \"end\" : \"start\", focusPrefix = backward ? \"start\" : \"end\";\n            sel.anchorNode = range[anchorPrefix + \"Container\"];\n            sel.anchorOffset = range[anchorPrefix + \"Offset\"];\n            sel.focusNode = range[focusPrefix + \"Container\"];\n            sel.focusOffset = range[focusPrefix + \"Offset\"];\n        }\n\n        function updateAnchorAndFocusFromNativeSelection(sel) {\n            var nativeSel = sel.nativeSelection;\n            sel.anchorNode = nativeSel.anchorNode;\n            sel.anchorOffset = nativeSel.anchorOffset;\n            sel.focusNode = nativeSel.focusNode;\n            sel.focusOffset = nativeSel.focusOffset;\n        }\n\n        function updateEmptySelection(sel) {\n            sel.anchorNode = sel.focusNode = null;\n            sel.anchorOffset = sel.focusOffset = 0;\n            sel.rangeCount = 0;\n            sel.isCollapsed = true;\n            sel._ranges.length = 0;\n        }\n\n        function getNativeRange(range) {\n            var nativeRange;\n            if (range instanceof DomRange) {\n                nativeRange = api.createNativeRange(range.getDocument());\n                nativeRange.setEnd(range.endContainer, range.endOffset);\n                nativeRange.setStart(range.startContainer, range.startOffset);\n            } else if (range instanceof WrappedRange) {\n                nativeRange = range.nativeRange;\n            } else if (features.implementsDomRange && (range instanceof dom.getWindow(range.startContainer).Range)) {\n                nativeRange = range;\n            }\n            return nativeRange;\n        }\n\n        function rangeContainsSingleElement(rangeNodes) {\n            if (!rangeNodes.length || rangeNodes[0].nodeType != 1) {\n                return false;\n            }\n            for (var i = 1, len = rangeNodes.length; i < len; ++i) {\n                if (!dom.isAncestorOf(rangeNodes[0], rangeNodes[i])) {\n                    return false;\n                }\n            }\n            return true;\n        }\n\n        function getSingleElementFromRange(range) {\n            var nodes = range.getNodes();\n            if (!rangeContainsSingleElement(nodes)) {\n                throw module.createError(\"getSingleElementFromRange: range \" + range.inspect() + \" did not consist of a single element\");\n            }\n            return nodes[0];\n        }\n\n        // Simple, quick test which only needs to distinguish between a TextRange and a ControlRange\n        function isTextRange(range) {\n            return !!range && typeof range.text != \"undefined\";\n        }\n\n        function updateFromTextRange(sel, range) {\n            // Create a Range from the selected TextRange\n            var wrappedRange = new WrappedRange(range);\n            sel._ranges = [wrappedRange];\n\n            updateAnchorAndFocusFromRange(sel, wrappedRange, false);\n            sel.rangeCount = 1;\n            sel.isCollapsed = wrappedRange.collapsed;\n        }\n\n        function updateControlSelection(sel) {\n            // Update the wrapped selection based on what's now in the native selection\n            sel._ranges.length = 0;\n            if (sel.docSelection.type == \"None\") {\n                updateEmptySelection(sel);\n            } else {\n                var controlRange = sel.docSelection.createRange();\n                if (isTextRange(controlRange)) {\n                    // This case (where the selection type is \"Control\" and calling createRange() on the selection returns\n                    // a TextRange) can happen in IE 9. It happens, for example, when all elements in the selected\n                    // ControlRange have been removed from the ControlRange and removed from the document.\n                    updateFromTextRange(sel, controlRange);\n                } else {\n                    sel.rangeCount = controlRange.length;\n                    var range, doc = getDocument(controlRange.item(0));\n                    for (var i = 0; i < sel.rangeCount; ++i) {\n                        range = api.createRange(doc);\n                        range.selectNode(controlRange.item(i));\n                        sel._ranges.push(range);\n                    }\n                    sel.isCollapsed = sel.rangeCount == 1 && sel._ranges[0].collapsed;\n                    updateAnchorAndFocusFromRange(sel, sel._ranges[sel.rangeCount - 1], false);\n                }\n            }\n        }\n\n        function addRangeToControlSelection(sel, range) {\n            var controlRange = sel.docSelection.createRange();\n            var rangeElement = getSingleElementFromRange(range);\n\n            // Create a new ControlRange containing all the elements in the selected ControlRange plus the element\n            // contained by the supplied range\n            var doc = getDocument(controlRange.item(0));\n            var newControlRange = getBody(doc).createControlRange();\n            for (var i = 0, len = controlRange.length; i < len; ++i) {\n                newControlRange.add(controlRange.item(i));\n            }\n            try {\n                newControlRange.add(rangeElement);\n            } catch (ex) {\n                throw module.createError(\"addRange(): Element within the specified Range could not be added to control selection (does it have layout?)\");\n            }\n            newControlRange.select();\n\n            // Update the wrapped selection based on what's now in the native selection\n            updateControlSelection(sel);\n        }\n\n        var getSelectionRangeAt;\n\n        if (isHostMethod(testSelection, \"getRangeAt\")) {\n            // try/catch is present because getRangeAt() must have thrown an error in some browser and some situation.\n            // Unfortunately, I didn't write a comment about the specifics and am now scared to take it out. Let that be a\n            // lesson to us all, especially me.\n            getSelectionRangeAt = function(sel, index) {\n                try {\n                    return sel.getRangeAt(index);\n                } catch (ex) {\n                    return null;\n                }\n            };\n        } else if (selectionHasAnchorAndFocus) {\n            getSelectionRangeAt = function(sel) {\n                var doc = getDocument(sel.anchorNode);\n                var range = api.createRange(doc);\n                range.setStartAndEnd(sel.anchorNode, sel.anchorOffset, sel.focusNode, sel.focusOffset);\n\n                // Handle the case when the selection was selected backwards (from the end to the start in the\n                // document)\n                if (range.collapsed !== this.isCollapsed) {\n                    range.setStartAndEnd(sel.focusNode, sel.focusOffset, sel.anchorNode, sel.anchorOffset);\n                }\n\n                return range;\n            };\n        }\n\n        function WrappedSelection(selection, docSelection, win) {\n            this.nativeSelection = selection;\n            this.docSelection = docSelection;\n            this._ranges = [];\n            this.win = win;\n            this.refresh();\n        }\n\n        WrappedSelection.prototype = api.selectionPrototype;\n\n        function deleteProperties(sel) {\n            sel.win = sel.anchorNode = sel.focusNode = sel._ranges = null;\n            sel.rangeCount = sel.anchorOffset = sel.focusOffset = 0;\n            sel.detached = true;\n        }\n\n        var cachedRangySelections = [];\n\n        function actOnCachedSelection(win, action) {\n            var i = cachedRangySelections.length, cached, sel;\n            while (i--) {\n                cached = cachedRangySelections[i];\n                sel = cached.selection;\n                if (action == \"deleteAll\") {\n                    deleteProperties(sel);\n                } else if (cached.win == win) {\n                    if (action == \"delete\") {\n                        cachedRangySelections.splice(i, 1);\n                        return true;\n                    } else {\n                        return sel;\n                    }\n                }\n            }\n            if (action == \"deleteAll\") {\n                cachedRangySelections.length = 0;\n            }\n            return null;\n        }\n\n        var getSelection = function(win) {\n            // Check if the parameter is a Rangy Selection object\n            if (win && win instanceof WrappedSelection) {\n                win.refresh();\n                return win;\n            }\n\n            win = getWindow(win, \"getNativeSelection\");\n\n            var sel = actOnCachedSelection(win);\n            var nativeSel = getNativeSelection(win), docSel = implementsDocSelection ? getDocSelection(win) : null;\n            if (sel) {\n                sel.nativeSelection = nativeSel;\n                sel.docSelection = docSel;\n                sel.refresh();\n            } else {\n                sel = new WrappedSelection(nativeSel, docSel, win);\n                cachedRangySelections.push( { win: win, selection: sel } );\n            }\n            return sel;\n        };\n\n        api.getSelection = getSelection;\n\n        util.createAliasForDeprecatedMethod(api, \"getIframeSelection\", \"getSelection\");\n\n        var selProto = WrappedSelection.prototype;\n\n        function createControlSelection(sel, ranges) {\n            // Ensure that the selection becomes of type \"Control\"\n            var doc = getDocument(ranges[0].startContainer);\n            var controlRange = getBody(doc).createControlRange();\n            for (var i = 0, el, len = ranges.length; i < len; ++i) {\n                el = getSingleElementFromRange(ranges[i]);\n                try {\n                    controlRange.add(el);\n                } catch (ex) {\n                    throw module.createError(\"setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)\");\n                }\n            }\n            controlRange.select();\n\n            // Update the wrapped selection based on what's now in the native selection\n            updateControlSelection(sel);\n        }\n\n        // Selecting a range\n        if (!useDocumentSelection && selectionHasAnchorAndFocus && util.areHostMethods(testSelection, [\"removeAllRanges\", \"addRange\"])) {\n            selProto.removeAllRanges = function() {\n                this.nativeSelection.removeAllRanges();\n                updateEmptySelection(this);\n            };\n\n            var addRangeBackward = function(sel, range) {\n                addRangeBackwardToNative(sel.nativeSelection, range);\n                sel.refresh();\n            };\n\n            if (selectionHasRangeCount) {\n                selProto.addRange = function(range, direction) {\n                    if (implementsControlRange && implementsDocSelection && this.docSelection.type == CONTROL) {\n                        addRangeToControlSelection(this, range);\n                    } else {\n                        if (isDirectionBackward(direction) && selectionHasExtend) {\n                            addRangeBackward(this, range);\n                        } else {\n                            var previousRangeCount;\n                            if (selectionSupportsMultipleRanges) {\n                                previousRangeCount = this.rangeCount;\n                            } else {\n                                this.removeAllRanges();\n                                previousRangeCount = 0;\n                            }\n                            // Clone the native range so that changing the selected range does not affect the selection.\n                            // This is contrary to the spec but is the only way to achieve consistency between browsers. See\n                            // issue 80.\n                            var clonedNativeRange = getNativeRange(range).cloneRange();\n                            try {\n                                this.nativeSelection.addRange(clonedNativeRange);\n                            } catch (ex) {\n                            }\n\n                            // Check whether adding the range was successful\n                            this.rangeCount = this.nativeSelection.rangeCount;\n\n                            if (this.rangeCount == previousRangeCount + 1) {\n                                // The range was added successfully\n\n                                // Check whether the range that we added to the selection is reflected in the last range extracted from\n                                // the selection\n                                if (api.config.checkSelectionRanges) {\n                                    var nativeRange = getSelectionRangeAt(this.nativeSelection, this.rangeCount - 1);\n                                    if (nativeRange && !rangesEqual(nativeRange, range)) {\n                                        // Happens in WebKit with, for example, a selection placed at the start of a text node\n                                        range = new WrappedRange(nativeRange);\n                                    }\n                                }\n                                this._ranges[this.rangeCount - 1] = range;\n                                updateAnchorAndFocusFromRange(this, range, selectionIsBackward(this.nativeSelection));\n                                this.isCollapsed = selectionIsCollapsed(this);\n                            } else {\n                                // The range was not added successfully. The simplest thing is to refresh\n                                this.refresh();\n                            }\n                        }\n                    }\n                };\n            } else {\n                selProto.addRange = function(range, direction) {\n                    if (isDirectionBackward(direction) && selectionHasExtend) {\n                        addRangeBackward(this, range);\n                    } else {\n                        this.nativeSelection.addRange(getNativeRange(range));\n                        this.refresh();\n                    }\n                };\n            }\n\n            selProto.setRanges = function(ranges) {\n                if (implementsControlRange && implementsDocSelection && ranges.length > 1) {\n                    createControlSelection(this, ranges);\n                } else {\n                    this.removeAllRanges();\n                    for (var i = 0, len = ranges.length; i < len; ++i) {\n                        this.addRange(ranges[i]);\n                    }\n                }\n            };\n        } else if (isHostMethod(testSelection, \"empty\") && isHostMethod(testRange, \"select\") &&\n                   implementsControlRange && useDocumentSelection) {\n\n            selProto.removeAllRanges = function() {\n                // Added try/catch as fix for issue #21\n                try {\n                    this.docSelection.empty();\n\n                    // Check for empty() not working (issue #24)\n                    if (this.docSelection.type != \"None\") {\n                        // Work around failure to empty a control selection by instead selecting a TextRange and then\n                        // calling empty()\n                        var doc;\n                        if (this.anchorNode) {\n                            doc = getDocument(this.anchorNode);\n                        } else if (this.docSelection.type == CONTROL) {\n                            var controlRange = this.docSelection.createRange();\n                            if (controlRange.length) {\n                                doc = getDocument( controlRange.item(0) );\n                            }\n                        }\n                        if (doc) {\n                            var textRange = getBody(doc).createTextRange();\n                            textRange.select();\n                            this.docSelection.empty();\n                        }\n                    }\n                } catch(ex) {}\n                updateEmptySelection(this);\n            };\n\n            selProto.addRange = function(range) {\n                if (this.docSelection.type == CONTROL) {\n                    addRangeToControlSelection(this, range);\n                } else {\n                    api.WrappedTextRange.rangeToTextRange(range).select();\n                    this._ranges[0] = range;\n                    this.rangeCount = 1;\n                    this.isCollapsed = this._ranges[0].collapsed;\n                    updateAnchorAndFocusFromRange(this, range, false);\n                }\n            };\n\n            selProto.setRanges = function(ranges) {\n                this.removeAllRanges();\n                var rangeCount = ranges.length;\n                if (rangeCount > 1) {\n                    createControlSelection(this, ranges);\n                } else if (rangeCount) {\n                    this.addRange(ranges[0]);\n                }\n            };\n        } else {\n            module.fail(\"No means of selecting a Range or TextRange was found\");\n            return false;\n        }\n\n        selProto.getRangeAt = function(index) {\n            if (index < 0 || index >= this.rangeCount) {\n                throw new DOMException(\"INDEX_SIZE_ERR\");\n            } else {\n                // Clone the range to preserve selection-range independence. See issue 80.\n                return this._ranges[index].cloneRange();\n            }\n        };\n\n        var refreshSelection;\n\n        if (useDocumentSelection) {\n            refreshSelection = function(sel) {\n                var range;\n                if (api.isSelectionValid(sel.win)) {\n                    range = sel.docSelection.createRange();\n                } else {\n                    range = getBody(sel.win.document).createTextRange();\n                    range.collapse(true);\n                }\n\n                if (sel.docSelection.type == CONTROL) {\n                    updateControlSelection(sel);\n                } else if (isTextRange(range)) {\n                    updateFromTextRange(sel, range);\n                } else {\n                    updateEmptySelection(sel);\n                }\n            };\n        } else if (isHostMethod(testSelection, \"getRangeAt\") && typeof testSelection.rangeCount == NUMBER) {\n            refreshSelection = function(sel) {\n                if (implementsControlRange && implementsDocSelection && sel.docSelection.type == CONTROL) {\n                    updateControlSelection(sel);\n                } else {\n                    sel._ranges.length = sel.rangeCount = sel.nativeSelection.rangeCount;\n                    if (sel.rangeCount) {\n                        for (var i = 0, len = sel.rangeCount; i < len; ++i) {\n                            sel._ranges[i] = new api.WrappedRange(sel.nativeSelection.getRangeAt(i));\n                        }\n                        updateAnchorAndFocusFromRange(sel, sel._ranges[sel.rangeCount - 1], selectionIsBackward(sel.nativeSelection));\n                        sel.isCollapsed = selectionIsCollapsed(sel);\n                    } else {\n                        updateEmptySelection(sel);\n                    }\n                }\n            };\n        } else if (selectionHasAnchorAndFocus && typeof testSelection.isCollapsed == BOOLEAN && typeof testRange.collapsed == BOOLEAN && features.implementsDomRange) {\n            refreshSelection = function(sel) {\n                var range, nativeSel = sel.nativeSelection;\n                if (nativeSel.anchorNode) {\n                    range = getSelectionRangeAt(nativeSel, 0);\n                    sel._ranges = [range];\n                    sel.rangeCount = 1;\n                    updateAnchorAndFocusFromNativeSelection(sel);\n                    sel.isCollapsed = selectionIsCollapsed(sel);\n                } else {\n                    updateEmptySelection(sel);\n                }\n            };\n        } else {\n            module.fail(\"No means of obtaining a Range or TextRange from the user's selection was found\");\n            return false;\n        }\n\n        selProto.refresh = function(checkForChanges) {\n            var oldRanges = checkForChanges ? this._ranges.slice(0) : null;\n            var oldAnchorNode = this.anchorNode, oldAnchorOffset = this.anchorOffset;\n\n            refreshSelection(this);\n            if (checkForChanges) {\n                // Check the range count first\n                var i = oldRanges.length;\n                if (i != this._ranges.length) {\n                    return true;\n                }\n\n                // Now check the direction. Checking the anchor position is the same is enough since we're checking all the\n                // ranges after this\n                if (this.anchorNode != oldAnchorNode || this.anchorOffset != oldAnchorOffset) {\n                    return true;\n                }\n\n                // Finally, compare each range in turn\n                while (i--) {\n                    if (!rangesEqual(oldRanges[i], this._ranges[i])) {\n                        return true;\n                    }\n                }\n                return false;\n            }\n        };\n\n        // Removal of a single range\n        var removeRangeManually = function(sel, range) {\n            var ranges = sel.getAllRanges();\n            sel.removeAllRanges();\n            for (var i = 0, len = ranges.length; i < len; ++i) {\n                if (!rangesEqual(range, ranges[i])) {\n                    sel.addRange(ranges[i]);\n                }\n            }\n            if (!sel.rangeCount) {\n                updateEmptySelection(sel);\n            }\n        };\n\n        if (implementsControlRange && implementsDocSelection) {\n            selProto.removeRange = function(range) {\n                if (this.docSelection.type == CONTROL) {\n                    var controlRange = this.docSelection.createRange();\n                    var rangeElement = getSingleElementFromRange(range);\n\n                    // Create a new ControlRange containing all the elements in the selected ControlRange minus the\n                    // element contained by the supplied range\n                    var doc = getDocument(controlRange.item(0));\n                    var newControlRange = getBody(doc).createControlRange();\n                    var el, removed = false;\n                    for (var i = 0, len = controlRange.length; i < len; ++i) {\n                        el = controlRange.item(i);\n                        if (el !== rangeElement || removed) {\n                            newControlRange.add(controlRange.item(i));\n                        } else {\n                            removed = true;\n                        }\n                    }\n                    newControlRange.select();\n\n                    // Update the wrapped selection based on what's now in the native selection\n                    updateControlSelection(this);\n                } else {\n                    removeRangeManually(this, range);\n                }\n            };\n        } else {\n            selProto.removeRange = function(range) {\n                removeRangeManually(this, range);\n            };\n        }\n\n        // Detecting if a selection is backward\n        var selectionIsBackward;\n        if (!useDocumentSelection && selectionHasAnchorAndFocus && features.implementsDomRange) {\n            selectionIsBackward = winSelectionIsBackward;\n\n            selProto.isBackward = function() {\n                return selectionIsBackward(this);\n            };\n        } else {\n            selectionIsBackward = selProto.isBackward = function() {\n                return false;\n            };\n        }\n\n        // Create an alias for backwards compatibility. From 1.3, everything is \"backward\" rather than \"backwards\"\n        selProto.isBackwards = selProto.isBackward;\n\n        // Selection stringifier\n        // This is conformant to the old HTML5 selections draft spec but differs from WebKit and Mozilla's implementation.\n        // The current spec does not yet define this method.\n        selProto.toString = function() {\n            var rangeTexts = [];\n            for (var i = 0, len = this.rangeCount; i < len; ++i) {\n                rangeTexts[i] = \"\" + this._ranges[i];\n            }\n            return rangeTexts.join(\"\");\n        };\n\n        function assertNodeInSameDocument(sel, node) {\n            if (sel.win.document != getDocument(node)) {\n                throw new DOMException(\"WRONG_DOCUMENT_ERR\");\n            }\n        }\n\n        // No current browser conforms fully to the spec for this method, so Rangy's own method is always used\n        selProto.collapse = function(node, offset) {\n            assertNodeInSameDocument(this, node);\n            var range = api.createRange(node);\n            range.collapseToPoint(node, offset);\n            this.setSingleRange(range);\n            this.isCollapsed = true;\n        };\n\n        selProto.collapseToStart = function() {\n            if (this.rangeCount) {\n                var range = this._ranges[0];\n                this.collapse(range.startContainer, range.startOffset);\n            } else {\n                throw new DOMException(\"INVALID_STATE_ERR\");\n            }\n        };\n\n        selProto.collapseToEnd = function() {\n            if (this.rangeCount) {\n                var range = this._ranges[this.rangeCount - 1];\n                this.collapse(range.endContainer, range.endOffset);\n            } else {\n                throw new DOMException(\"INVALID_STATE_ERR\");\n            }\n        };\n\n        // The spec is very specific on how selectAllChildren should be implemented and not all browsers implement it as\n        // specified so the native implementation is never used by Rangy.\n        selProto.selectAllChildren = function(node) {\n            assertNodeInSameDocument(this, node);\n            var range = api.createRange(node);\n            range.selectNodeContents(node);\n            this.setSingleRange(range);\n        };\n\n        selProto.deleteFromDocument = function() {\n            // Sepcial behaviour required for IE's control selections\n            if (implementsControlRange && implementsDocSelection && this.docSelection.type == CONTROL) {\n                var controlRange = this.docSelection.createRange();\n                var element;\n                while (controlRange.length) {\n                    element = controlRange.item(0);\n                    controlRange.remove(element);\n                    dom.removeNode(element);\n                }\n                this.refresh();\n            } else if (this.rangeCount) {\n                var ranges = this.getAllRanges();\n                if (ranges.length) {\n                    this.removeAllRanges();\n                    for (var i = 0, len = ranges.length; i < len; ++i) {\n                        ranges[i].deleteContents();\n                    }\n                    // The spec says nothing about what the selection should contain after calling deleteContents on each\n                    // range. Firefox moves the selection to where the final selected range was, so we emulate that\n                    this.addRange(ranges[len - 1]);\n                }\n            }\n        };\n\n        // The following are non-standard extensions\n        selProto.eachRange = function(func, returnValue) {\n            for (var i = 0, len = this._ranges.length; i < len; ++i) {\n                if ( func( this.getRangeAt(i) ) ) {\n                    return returnValue;\n                }\n            }\n        };\n\n        selProto.getAllRanges = function() {\n            var ranges = [];\n            this.eachRange(function(range) {\n                ranges.push(range);\n            });\n            return ranges;\n        };\n\n        selProto.setSingleRange = function(range, direction) {\n            this.removeAllRanges();\n            this.addRange(range, direction);\n        };\n\n        selProto.callMethodOnEachRange = function(methodName, params) {\n            var results = [];\n            this.eachRange( function(range) {\n                results.push( range[methodName].apply(range, params || []) );\n            } );\n            return results;\n        };\n\n        function createStartOrEndSetter(isStart) {\n            return function(node, offset) {\n                var range;\n                if (this.rangeCount) {\n                    range = this.getRangeAt(0);\n                    range[\"set\" + (isStart ? \"Start\" : \"End\")](node, offset);\n                } else {\n                    range = api.createRange(this.win.document);\n                    range.setStartAndEnd(node, offset);\n                }\n                this.setSingleRange(range, this.isBackward());\n            };\n        }\n\n        selProto.setStart = createStartOrEndSetter(true);\n        selProto.setEnd = createStartOrEndSetter(false);\n\n        // Add select() method to Range prototype. Any existing selection will be removed.\n        api.rangePrototype.select = function(direction) {\n            getSelection( this.getDocument() ).setSingleRange(this, direction);\n        };\n\n        selProto.changeEachRange = function(func) {\n            var ranges = [];\n            var backward = this.isBackward();\n\n            this.eachRange(function(range) {\n                func(range);\n                ranges.push(range);\n            });\n\n            this.removeAllRanges();\n            if (backward && ranges.length == 1) {\n                this.addRange(ranges[0], \"backward\");\n            } else {\n                this.setRanges(ranges);\n            }\n        };\n\n        selProto.containsNode = function(node, allowPartial) {\n            return this.eachRange( function(range) {\n                return range.containsNode(node, allowPartial);\n            }, true ) || false;\n        };\n\n        selProto.getBookmark = function(containerNode) {\n            return {\n                backward: this.isBackward(),\n                rangeBookmarks: this.callMethodOnEachRange(\"getBookmark\", [containerNode])\n            };\n        };\n\n        selProto.moveToBookmark = function(bookmark) {\n            var selRanges = [];\n            for (var i = 0, rangeBookmark, range; rangeBookmark = bookmark.rangeBookmarks[i++]; ) {\n                range = api.createRange(this.win);\n                range.moveToBookmark(rangeBookmark);\n                selRanges.push(range);\n            }\n            if (bookmark.backward) {\n                this.setSingleRange(selRanges[0], \"backward\");\n            } else {\n                this.setRanges(selRanges);\n            }\n        };\n\n        selProto.saveRanges = function() {\n            return {\n                backward: this.isBackward(),\n                ranges: this.callMethodOnEachRange(\"cloneRange\")\n            };\n        };\n\n        selProto.restoreRanges = function(selRanges) {\n            this.removeAllRanges();\n            for (var i = 0, range; range = selRanges.ranges[i]; ++i) {\n                this.addRange(range, (selRanges.backward && i == 0));\n            }\n        };\n\n        selProto.toHtml = function() {\n            var rangeHtmls = [];\n            this.eachRange(function(range) {\n                rangeHtmls.push( DomRange.toHtml(range) );\n            });\n            return rangeHtmls.join(\"\");\n        };\n\n        if (features.implementsTextRange) {\n            selProto.getNativeTextRange = function() {\n                var sel, textRange;\n                if ( (sel = this.docSelection) ) {\n                    var range = sel.createRange();\n                    if (isTextRange(range)) {\n                        return range;\n                    } else {\n                        throw module.createError(\"getNativeTextRange: selection is a control selection\");\n                    }\n                } else if (this.rangeCount > 0) {\n                    return api.WrappedTextRange.rangeToTextRange( this.getRangeAt(0) );\n                } else {\n                    throw module.createError(\"getNativeTextRange: selection contains no range\");\n                }\n            };\n        }\n\n        function inspect(sel) {\n            var rangeInspects = [];\n            var anchor = new DomPosition(sel.anchorNode, sel.anchorOffset);\n            var focus = new DomPosition(sel.focusNode, sel.focusOffset);\n            var name = (typeof sel.getName == \"function\") ? sel.getName() : \"Selection\";\n\n            if (typeof sel.rangeCount != \"undefined\") {\n                for (var i = 0, len = sel.rangeCount; i < len; ++i) {\n                    rangeInspects[i] = DomRange.inspect(sel.getRangeAt(i));\n                }\n            }\n            return \"[\" + name + \"(Ranges: \" + rangeInspects.join(\", \") +\n                    \")(anchor: \" + anchor.inspect() + \", focus: \" + focus.inspect() + \"]\";\n        }\n\n        selProto.getName = function() {\n            return \"WrappedSelection\";\n        };\n\n        selProto.inspect = function() {\n            return inspect(this);\n        };\n\n        selProto.detach = function() {\n            actOnCachedSelection(this.win, \"delete\");\n            deleteProperties(this);\n        };\n\n        WrappedSelection.detachAll = function() {\n            actOnCachedSelection(null, \"deleteAll\");\n        };\n\n        WrappedSelection.inspect = inspect;\n        WrappedSelection.isDirectionBackward = isDirectionBackward;\n\n        api.Selection = WrappedSelection;\n\n        api.selectionPrototype = selProto;\n\n        api.addShimListener(function(win) {\n            if (typeof win.getSelection == \"undefined\") {\n                win.getSelection = function() {\n                    return getSelection(win);\n                };\n            }\n            win = null;\n        });\n    });\n    \n\n    /*----------------------------------------------------------------------------------------------------------------*/\n\n    // Wait for document to load before initializing\n    var docReady = false;\n\n    var loadHandler = function(e) {\n        if (!docReady) {\n            docReady = true;\n            if (!api.initialized && api.config.autoInitialize) {\n                init();\n            }\n        }\n    };\n\n    if (isBrowser) {\n        // Test whether the document has already been loaded and initialize immediately if so\n        if (document.readyState == \"complete\") {\n            loadHandler();\n        } else {\n            if (isHostMethod(document, \"addEventListener\")) {\n                document.addEventListener(\"DOMContentLoaded\", loadHandler, false);\n            }\n\n            // Add a fallback in case the DOMContentLoaded event isn't supported\n            addListener(window, \"load\", loadHandler);\n        }\n    }\n\n    global.rangy = api;\n})(this);\n/**\n * Selection save and restore module for Rangy.\n * Saves and restores user selections using marker invisible elements in the DOM.\n *\n * Part of Rangy, a cross-browser JavaScript range and selection library\n * https://github.com/timdown/rangy\n *\n * Depends on Rangy core.\n *\n * Copyright 2019, Tim Down\n * Licensed under the MIT license.\n * Version: 1.3.0\n * Build date: 21 January 2019\n */\n(function(rangy) {\n    rangy.createModule(\"SaveRestore\", [\"WrappedRange\"], function(api, module) {\n        var dom = api.dom;\n        var removeNode = dom.removeNode;\n        var isDirectionBackward = api.Selection.isDirectionBackward;\n        var markerTextChar = \"\\ufeff\";\n\n        function gEBI(id, doc) {\n            return (doc || document).getElementById(id);\n        }\n\n        function insertRangeBoundaryMarker(range, atStart) {\n            var markerId = \"selectionBoundary_\" + (+new Date()) + \"_\" + (\"\" + Math.random()).slice(2);\n            var markerEl;\n            var doc = dom.getDocument(range.startContainer);\n\n            // Clone the Range and collapse to the appropriate boundary point\n            var boundaryRange = range.cloneRange();\n            boundaryRange.collapse(atStart);\n\n            // Create the marker element containing a single invisible character using DOM methods and insert it\n            markerEl = doc.createElement(\"span\");\n            markerEl.id = markerId;\n            markerEl.style.lineHeight = \"0\";\n            markerEl.style.display = \"none\";\n            markerEl.className = \"rangySelectionBoundary\";\n            markerEl.appendChild(doc.createTextNode(markerTextChar));\n\n            boundaryRange.insertNode(markerEl);\n            return markerEl;\n        }\n\n        function setRangeBoundary(doc, range, markerId, atStart) {\n            var markerEl = gEBI(markerId, doc);\n            if (markerEl) {\n                range[atStart ? \"setStartBefore\" : \"setEndBefore\"](markerEl);\n                removeNode(markerEl);\n            } else {\n                module.warn(\"Marker element has been removed. Cannot restore selection.\");\n            }\n        }\n\n        function compareRanges(r1, r2) {\n            return r2.compareBoundaryPoints(r1.START_TO_START, r1);\n        }\n\n        function saveRange(range, direction) {\n            var startEl, endEl, doc = api.DomRange.getRangeDocument(range), text = range.toString();\n            var backward = isDirectionBackward(direction);\n\n            if (range.collapsed) {\n                endEl = insertRangeBoundaryMarker(range, false);\n                return {\n                    document: doc,\n                    markerId: endEl.id,\n                    collapsed: true\n                };\n            } else {\n                endEl = insertRangeBoundaryMarker(range, false);\n                startEl = insertRangeBoundaryMarker(range, true);\n\n                return {\n                    document: doc,\n                    startMarkerId: startEl.id,\n                    endMarkerId: endEl.id,\n                    collapsed: false,\n                    backward: backward,\n                    toString: function() {\n                        return \"original text: '\" + text + \"', new text: '\" + range.toString() + \"'\";\n                    }\n                };\n            }\n        }\n\n        function restoreRange(rangeInfo, normalize) {\n            var doc = rangeInfo.document;\n            if (typeof normalize == \"undefined\") {\n                normalize = true;\n            }\n            var range = api.createRange(doc);\n            if (rangeInfo.collapsed) {\n                var markerEl = gEBI(rangeInfo.markerId, doc);\n                if (markerEl) {\n                    markerEl.style.display = \"inline\";\n                    var previousNode = markerEl.previousSibling;\n\n                    // Workaround for issue 17\n                    if (previousNode && previousNode.nodeType == 3) {\n                        removeNode(markerEl);\n                        range.collapseToPoint(previousNode, previousNode.length);\n                    } else {\n                        range.collapseBefore(markerEl);\n                        removeNode(markerEl);\n                    }\n                } else {\n                    module.warn(\"Marker element has been removed. Cannot restore selection.\");\n                }\n            } else {\n                setRangeBoundary(doc, range, rangeInfo.startMarkerId, true);\n                setRangeBoundary(doc, range, rangeInfo.endMarkerId, false);\n            }\n\n            if (normalize) {\n                range.normalizeBoundaries();\n            }\n\n            return range;\n        }\n\n        function saveRanges(ranges, direction) {\n            var rangeInfos = [], range, doc;\n            var backward = isDirectionBackward(direction);\n\n            // Order the ranges by position within the DOM, latest first, cloning the array to leave the original untouched\n            ranges = ranges.slice(0);\n            ranges.sort(compareRanges);\n\n            for (var i = 0, len = ranges.length; i < len; ++i) {\n                rangeInfos[i] = saveRange(ranges[i], backward);\n            }\n\n            // Now that all the markers are in place and DOM manipulation over, adjust each range's boundaries to lie\n            // between its markers\n            for (i = len - 1; i >= 0; --i) {\n                range = ranges[i];\n                doc = api.DomRange.getRangeDocument(range);\n                if (range.collapsed) {\n                    range.collapseAfter(gEBI(rangeInfos[i].markerId, doc));\n                } else {\n                    range.setEndBefore(gEBI(rangeInfos[i].endMarkerId, doc));\n                    range.setStartAfter(gEBI(rangeInfos[i].startMarkerId, doc));\n                }\n            }\n\n            return rangeInfos;\n        }\n\n        function saveSelection(win) {\n            if (!api.isSelectionValid(win)) {\n                module.warn(\"Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus.\");\n                return null;\n            }\n            var sel = api.getSelection(win);\n            var ranges = sel.getAllRanges();\n            var backward = (ranges.length == 1 && sel.isBackward());\n\n            var rangeInfos = saveRanges(ranges, backward);\n\n            // Ensure current selection is unaffected\n            if (backward) {\n                sel.setSingleRange(ranges[0], backward);\n            } else {\n                sel.setRanges(ranges);\n            }\n\n            return {\n                win: win,\n                rangeInfos: rangeInfos,\n                restored: false\n            };\n        }\n\n        function restoreRanges(rangeInfos) {\n            var ranges = [];\n\n            // Ranges are in reverse order of appearance in the DOM. We want to restore earliest first to avoid\n            // normalization affecting previously restored ranges.\n            var rangeCount = rangeInfos.length;\n\n            for (var i = rangeCount - 1; i >= 0; i--) {\n                ranges[i] = restoreRange(rangeInfos[i], true);\n            }\n\n            return ranges;\n        }\n\n        function restoreSelection(savedSelection, preserveDirection) {\n            if (!savedSelection.restored) {\n                var rangeInfos = savedSelection.rangeInfos;\n                var sel = api.getSelection(savedSelection.win);\n                var ranges = restoreRanges(rangeInfos), rangeCount = rangeInfos.length;\n\n                if (rangeCount == 1 && preserveDirection && api.features.selectionHasExtend && rangeInfos[0].backward) {\n                    sel.removeAllRanges();\n                    sel.addRange(ranges[0], true);\n                } else {\n                    sel.setRanges(ranges);\n                }\n\n                savedSelection.restored = true;\n            }\n        }\n\n        function removeMarkerElement(doc, markerId) {\n            var markerEl = gEBI(markerId, doc);\n            if (markerEl) {\n                removeNode(markerEl);\n            }\n        }\n\n        function removeMarkers(savedSelection) {\n            var rangeInfos = savedSelection.rangeInfos;\n            for (var i = 0, len = rangeInfos.length, rangeInfo; i < len; ++i) {\n                rangeInfo = rangeInfos[i];\n                if (rangeInfo.collapsed) {\n                    removeMarkerElement(savedSelection.doc, rangeInfo.markerId);\n                } else {\n                    removeMarkerElement(savedSelection.doc, rangeInfo.startMarkerId);\n                    removeMarkerElement(savedSelection.doc, rangeInfo.endMarkerId);\n                }\n            }\n        }\n\n        api.util.extend(api, {\n            saveRange: saveRange,\n            restoreRange: restoreRange,\n            saveRanges: saveRanges,\n            restoreRanges: restoreRanges,\n            saveSelection: saveSelection,\n            restoreSelection: restoreSelection,\n            removeMarkerElement: removeMarkerElement,\n            removeMarkers: removeMarkers\n        });\n    });\n    \n    return rangy;\n})(this.rangy);\n/**\n * Text range module for Rangy.\n * Text-based manipulation and searching of ranges and selections.\n *\n * Features\n *\n * - Ability to move range boundaries by character or word offsets\n * - Customizable word tokenizer\n * - Ignores text nodes inside <script> or <style> elements or those hidden by CSS display and visibility properties\n * - Range findText method to search for text or regex within the page or within a range. Flags for whole words and case\n *   sensitivity\n * - Selection and range save/restore as text offsets within a node\n * - Methods to return visible text within a range or selection\n * - innerText method for elements\n *\n * References\n *\n * https://www.w3.org/Bugs/Public/show_bug.cgi?id=13145\n * http://aryeh.name/spec/innertext/innertext.html\n * http://dvcs.w3.org/hg/editing/raw-file/tip/editing.html\n *\n * Part of Rangy, a cross-browser JavaScript range and selection library\n * https://github.com/timdown/rangy\n *\n * Depends on Rangy core.\n *\n * Copyright 2019, Tim Down\n * Licensed under the MIT license.\n * Version: 1.3.0\n * Build date: 21 January 2019\n */\n\n/**\n * Problem: handling of trailing spaces before line breaks is handled inconsistently between browsers.\n *\n * First, a <br>: this is relatively simple. For the following HTML:\n *\n * 1 <br>2\n *\n * - IE and WebKit render the space, include it in the selection (i.e. when the content is selected and pasted into a\n *   textarea, the space is present) and allow the caret to be placed after it.\n * - Firefox does not acknowledge the space in the selection but it is possible to place the caret after it.\n * - Opera does not render the space but has two separate caret positions on either side of the space (left and right\n *   arrow keys show this) and includes the space in the selection.\n *\n * The other case is the line break or breaks implied by block elements. For the following HTML:\n *\n * <p>1 </p><p>2<p>\n *\n * - WebKit does not acknowledge the space in any way\n * - Firefox, IE and Opera as per <br>\n *\n * One more case is trailing spaces before line breaks in elements with white-space: pre-line. For the following HTML:\n *\n * <p style=\"white-space: pre-line\">1\n * 2</p>\n *\n * - Firefox and WebKit include the space in caret positions\n * - IE does not support pre-line up to and including version 9\n * - Opera ignores the space\n * - Trailing space only renders if there is a non-collapsed character in the line\n *\n * Problem is whether Rangy should ever acknowledge the space and if so, when. Another problem is whether this can be\n * feature-tested\n */\n(function(rangy) {\n    rangy.createModule(\"TextRange\", [\"WrappedSelection\"], function(api, module) {\n        var UNDEF = \"undefined\";\n        var CHARACTER = \"character\", WORD = \"word\";\n        var dom = api.dom, util = api.util;\n        var extend = util.extend;\n        var createOptions = util.createOptions;\n        var getBody = dom.getBody;\n\n\n        var spacesRegex = /^[ \\t\\f\\r\\n]+$/;\n        var spacesMinusLineBreaksRegex = /^[ \\t\\f\\r]+$/;\n        var allWhiteSpaceRegex = /^[\\t-\\r \\u0085\\u00A0\\u1680\\u180E\\u2000-\\u200B\\u2028\\u2029\\u202F\\u205F\\u3000]+$/;\n        var nonLineBreakWhiteSpaceRegex = /^[\\t \\u00A0\\u1680\\u180E\\u2000-\\u200B\\u202F\\u205F\\u3000]+$/;\n        var lineBreakRegex = /^[\\n-\\r\\u0085\\u2028\\u2029]$/;\n\n        var defaultLanguage = \"en\";\n\n        var isDirectionBackward = api.Selection.isDirectionBackward;\n\n        // Properties representing whether trailing spaces inside blocks are completely collapsed (as they are in WebKit,\n        // but not other browsers). Also test whether trailing spaces before <br> elements are collapsed.\n        var trailingSpaceInBlockCollapses = ( /Safari/.test(navigator.userAgent) && /Apple Computer/.test(navigator.vendor) ) ? true : false;\n        var trailingSpaceBeforeBrCollapses = false;\n        var trailingSpaceBeforeBlockCollapses = false;\n        var trailingSpaceBeforeLineBreakInPreLineCollapses = true;\n\n        // #79499: Inline editor lose focus when rangy try to check trailing spaces.\n        // All browsers (Chrome, Safari, Firefox, IE8/9/10/11) don't collapse trailing spaces\n        // except Safari for space in block (trailingSpaceInBlockCollapses).\n        /*(function() {\n            var el = dom.createTestElement(document, \"<p>1 </p><p></p>\", true);\n            var p = el.firstChild;\n            var sel = api.getSelection();\n            sel.collapse(p.lastChild, 2);\n            sel.setStart(p.firstChild, 0);\n            trailingSpaceInBlockCollapses = (\"\" + sel).length == 1;\n\n            el.innerHTML = \"1 <br />\";\n            sel.collapse(el, 2);\n            sel.setStart(el.firstChild, 0);\n            trailingSpaceBeforeBrCollapses = (\"\" + sel).length == 1;\n\n            el.innerHTML = \"1 <p>1</p>\";\n            sel.collapse(el, 2);\n            sel.setStart(el.firstChild, 0);\n            trailingSpaceBeforeBlockCollapses = (\"\" + sel).length == 1;\n\n            dom.removeNode(el);\n            sel.removeAllRanges();\n        })();*/\n\n        /*----------------------------------------------------------------------------------------------------------------*/\n\n        // This function must create word and non-word tokens for the whole of the text supplied to it\n        function defaultTokenizer(chars, wordOptions) {\n            var word = chars.join(\"\"), result, tokenRanges = [];\n\n            function createTokenRange(start, end, isWord) {\n                tokenRanges.push( { start: start, end: end, isWord: isWord } );\n            }\n\n            // Match words and mark characters\n            var lastWordEnd = 0, wordStart, wordEnd;\n            while ( (result = wordOptions.wordRegex.exec(word)) ) {\n                wordStart = result.index;\n                wordEnd = wordStart + result[0].length;\n\n                // Create token for non-word characters preceding this word\n                if (wordStart > lastWordEnd) {\n                    createTokenRange(lastWordEnd, wordStart, false);\n                }\n\n                // Get trailing space characters for word\n                if (wordOptions.includeTrailingSpace) {\n                    while ( nonLineBreakWhiteSpaceRegex.test(chars[wordEnd]) ) {\n                        ++wordEnd;\n                    }\n                }\n                createTokenRange(wordStart, wordEnd, true);\n                lastWordEnd = wordEnd;\n            }\n\n            // Create token for trailing non-word characters, if any exist\n            if (lastWordEnd < chars.length) {\n                createTokenRange(lastWordEnd, chars.length, false);\n            }\n\n            return tokenRanges;\n        }\n\n        function convertCharRangeToToken(chars, tokenRange) {\n            var tokenChars = chars.slice(tokenRange.start, tokenRange.end);\n            var token = {\n                isWord: tokenRange.isWord,\n                chars: tokenChars,\n                toString: function() {\n                    return tokenChars.join(\"\");\n                }\n            };\n            for (var i = 0, len = tokenChars.length; i < len; ++i) {\n                tokenChars[i].token = token;\n            }\n            return token;\n        }\n\n        function tokenize(chars, wordOptions, tokenizer) {\n            var tokenRanges = tokenizer(chars, wordOptions);\n            var tokens = [];\n            for (var i = 0, tokenRange; tokenRange = tokenRanges[i++]; ) {\n                tokens.push( convertCharRangeToToken(chars, tokenRange) );\n            }\n            return tokens;\n        }\n\n        var defaultCharacterOptions = {\n            includeBlockContentTrailingSpace: true,\n            includeSpaceBeforeBr: true,\n            includeSpaceBeforeBlock: true,\n            includePreLineTrailingSpace: true,\n            ignoreCharacters: \"\"\n        };\n\n        function normalizeIgnoredCharacters(ignoredCharacters) {\n            // Check if character is ignored\n            var ignoredChars = ignoredCharacters || \"\";\n\n            // Normalize ignored characters into a string consisting of characters in ascending order of character code\n            var ignoredCharsArray = (typeof ignoredChars == \"string\") ? ignoredChars.split(\"\") : ignoredChars;\n            ignoredCharsArray.sort(function(char1, char2) {\n                return char1.charCodeAt(0) - char2.charCodeAt(0);\n            });\n\n            /// Convert back to a string and remove duplicates\n            return ignoredCharsArray.join(\"\").replace(/(.)\\1+/g, \"$1\");\n        }\n\n        var defaultCaretCharacterOptions = {\n            includeBlockContentTrailingSpace: !trailingSpaceBeforeLineBreakInPreLineCollapses,\n            includeSpaceBeforeBr: !trailingSpaceBeforeBrCollapses,\n            includeSpaceBeforeBlock: !trailingSpaceBeforeBlockCollapses,\n            includePreLineTrailingSpace: true\n        };\n\n        var defaultWordOptions = {\n            \"en\": {\n                wordRegex: /[a-z0-9]+('[a-z0-9]+)*/gi,\n                includeTrailingSpace: false,\n                tokenizer: defaultTokenizer\n            }\n        };\n\n        var defaultFindOptions = {\n            caseSensitive: false,\n            withinRange: null,\n            wholeWordsOnly: false,\n            wrap: false,\n            direction: \"forward\",\n            wordOptions: null,\n            characterOptions: null\n        };\n\n        var defaultMoveOptions = {\n            wordOptions: null,\n            characterOptions: null\n        };\n\n        var defaultExpandOptions = {\n            wordOptions: null,\n            characterOptions: null,\n            trim: false,\n            trimStart: true,\n            trimEnd: true\n        };\n\n        var defaultWordIteratorOptions = {\n            wordOptions: null,\n            characterOptions: null,\n            direction: \"forward\"\n        };\n\n        function createWordOptions(options) {\n            var lang, defaults;\n            if (!options) {\n                return defaultWordOptions[defaultLanguage];\n            } else {\n                lang = options.language || defaultLanguage;\n                defaults = {};\n                extend(defaults, defaultWordOptions[lang] || defaultWordOptions[defaultLanguage]);\n                extend(defaults, options);\n                return defaults;\n            }\n        }\n\n        function createNestedOptions(optionsParam, defaults) {\n            var options = createOptions(optionsParam, defaults);\n            if (defaults.hasOwnProperty(\"wordOptions\")) {\n                options.wordOptions = createWordOptions(options.wordOptions);\n            }\n            if (defaults.hasOwnProperty(\"characterOptions\")) {\n                options.characterOptions = createOptions(options.characterOptions, defaultCharacterOptions);\n            }\n            return options;\n        }\n\n        /*----------------------------------------------------------------------------------------------------------------*/\n\n        /* DOM utility functions */\n        var getComputedStyleProperty = dom.getComputedStyleProperty;\n\n        // Create cachable versions of DOM functions\n\n        // Test for old IE's incorrect display properties\n        var tableCssDisplayBlock;\n        (function() {\n            var table = document.createElement(\"table\");\n            var body = getBody(document);\n            body.appendChild(table);\n            tableCssDisplayBlock = (getComputedStyleProperty(table, \"display\") == \"block\");\n            body.removeChild(table);\n        })();\n\n        var defaultDisplayValueForTag = {\n            table: \"table\",\n            caption: \"table-caption\",\n            colgroup: \"table-column-group\",\n            col: \"table-column\",\n            thead: \"table-header-group\",\n            tbody: \"table-row-group\",\n            tfoot: \"table-footer-group\",\n            tr: \"table-row\",\n            td: \"table-cell\",\n            th: \"table-cell\"\n        };\n\n        // Corrects IE's \"block\" value for table-related elements\n        function getComputedDisplay(el, win) {\n            var display = getComputedStyleProperty(el, \"display\", win);\n            var tagName = el.tagName.toLowerCase();\n            return (display == \"block\" &&\n                    tableCssDisplayBlock &&\n                    defaultDisplayValueForTag.hasOwnProperty(tagName)) ?\n                defaultDisplayValueForTag[tagName] : display;\n        }\n\n        function isHidden(node) {\n            var ancestors = getAncestorsAndSelf(node);\n            for (var i = 0, len = ancestors.length; i < len; ++i) {\n                if (ancestors[i].nodeType == 1 && getComputedDisplay(ancestors[i]) == \"none\") {\n                    return true;\n                }\n            }\n\n            return false;\n        }\n\n        function isVisibilityHiddenTextNode(textNode) {\n            var el;\n            return textNode.nodeType == 3 &&\n                (el = textNode.parentNode) &&\n                getComputedStyleProperty(el, \"visibility\") == \"hidden\";\n        }\n\n        /*----------------------------------------------------------------------------------------------------------------*/\n\n    \n        // \"A block node is either an Element whose \"display\" property does not have\n        // resolved value \"inline\" or \"inline-block\" or \"inline-table\" or \"none\", or a\n        // Document, or a DocumentFragment.\"\n        function isBlockNode(node) {\n            return node &&\n                ((node.nodeType == 1 && !/^(inline(-block|-table)?|none)$/.test(getComputedDisplay(node))) ||\n                node.nodeType == 9 || node.nodeType == 11);\n        }\n\n        function getLastDescendantOrSelf(node) {\n            var lastChild = node.lastChild;\n            return lastChild ? getLastDescendantOrSelf(lastChild) : node;\n        }\n\n        function containsPositions(node) {\n            return dom.isCharacterDataNode(node) ||\n                !/^(area|base|basefont|br|col|frame|hr|img|input|isindex|link|meta|param)$/i.test(node.nodeName);\n        }\n\n        function getAncestors(node) {\n            var ancestors = [];\n            while (node.parentNode) {\n                ancestors.unshift(node.parentNode);\n                node = node.parentNode;\n            }\n            return ancestors;\n        }\n\n        function getAncestorsAndSelf(node) {\n            return getAncestors(node).concat([node]);\n        }\n\n        function nextNodeDescendants(node) {\n            while (node && !node.nextSibling) {\n                node = node.parentNode;\n            }\n            if (!node) {\n                return null;\n            }\n            return node.nextSibling;\n        }\n\n        function nextNode(node, excludeChildren) {\n            if (!excludeChildren && node.hasChildNodes()) {\n                return node.firstChild;\n            }\n            return nextNodeDescendants(node);\n        }\n\n        function previousNode(node) {\n            var previous = node.previousSibling;\n            if (previous) {\n                node = previous;\n                while (node.hasChildNodes()) {\n                    node = node.lastChild;\n                }\n                return node;\n            }\n            var parent = node.parentNode;\n            if (parent && parent.nodeType == 1) {\n                return parent;\n            }\n            return null;\n        }\n\n        // Adpated from Aryeh's code.\n        // \"A whitespace node is either a Text node whose data is the empty string; or\n        // a Text node whose data consists only of one or more tabs (0x0009), line\n        // feeds (0x000A), carriage returns (0x000D), and/or spaces (0x0020), and whose\n        // parent is an Element whose resolved value for \"white-space\" is \"normal\" or\n        // \"nowrap\"; or a Text node whose data consists only of one or more tabs\n        // (0x0009), carriage returns (0x000D), and/or spaces (0x0020), and whose\n        // parent is an Element whose resolved value for \"white-space\" is \"pre-line\".\"\n        function isWhitespaceNode(node) {\n            if (!node || node.nodeType != 3) {\n                return false;\n            }\n            var text = node.data;\n            if (text === \"\") {\n                return true;\n            }\n            var parent = node.parentNode;\n            if (!parent || parent.nodeType != 1) {\n                return false;\n            }\n            var computedWhiteSpace = getComputedStyleProperty(node.parentNode, \"whiteSpace\");\n\n            return (/^[\\t\\n\\r ]+$/.test(text) && /^(normal|nowrap)$/.test(computedWhiteSpace)) ||\n                (/^[\\t\\r ]+$/.test(text) && computedWhiteSpace == \"pre-line\");\n        }\n\n        // Adpated from Aryeh's code.\n        // \"node is a collapsed whitespace node if the following algorithm returns\n        // true:\"\n        function isCollapsedWhitespaceNode(node) {\n            // \"If node's data is the empty string, return true.\"\n            if (node.data === \"\") {\n                return true;\n            }\n\n            // \"If node is not a whitespace node, return false.\"\n            if (!isWhitespaceNode(node)) {\n                return false;\n            }\n\n            // \"Let ancestor be node's parent.\"\n            var ancestor = node.parentNode;\n\n            // \"If ancestor is null, return true.\"\n            if (!ancestor) {\n                return true;\n            }\n\n            // \"If the \"display\" property of some ancestor of node has resolved value \"none\", return true.\"\n            if (isHidden(node)) {\n                return true;\n            }\n\n            return false;\n        }\n\n        function isCollapsedNode(node) {\n            var type = node.nodeType;\n            return type == 7 /* PROCESSING_INSTRUCTION */ ||\n                type == 8 /* COMMENT */ ||\n                isHidden(node) ||\n                /^(script|style)$/i.test(node.nodeName) ||\n                isVisibilityHiddenTextNode(node) ||\n                isCollapsedWhitespaceNode(node);\n        }\n\n        function isIgnoredNode(node, win) {\n            var type = node.nodeType;\n            return type == 7 /* PROCESSING_INSTRUCTION */ ||\n                type == 8 /* COMMENT */ ||\n                (type == 1 && getComputedDisplay(node, win) == \"none\");\n        }\n\n        /*----------------------------------------------------------------------------------------------------------------*/\n\n        // Possibly overengineered caching system to prevent repeated DOM calls slowing everything down\n\n        function Cache() {\n            this.store = {};\n        }\n\n        Cache.prototype = {\n            get: function(key) {\n                return this.store.hasOwnProperty(key) ? this.store[key] : null;\n            },\n\n            set: function(key, value) {\n                return this.store[key] = value;\n            }\n        };\n\n        var cachedCount = 0, uncachedCount = 0;\n\n        function createCachingGetter(methodName, func, objProperty) {\n            return function(args) {\n                var cache = this.cache;\n                if (cache.hasOwnProperty(methodName)) {\n                    cachedCount++;\n                    return cache[methodName];\n                } else {\n                    uncachedCount++;\n                    var value = func.call(this, objProperty ? this[objProperty] : this, args);\n                    cache[methodName] = value;\n                    return value;\n                }\n            };\n        }\n\n        /*----------------------------------------------------------------------------------------------------------------*/\n\n        function NodeWrapper(node, session) {\n            this.node = node;\n            this.session = session;\n            this.cache = new Cache();\n            this.positions = new Cache();\n        }\n\n        var nodeProto = {\n            getPosition: function(offset) {\n                var positions = this.positions;\n                return positions.get(offset) || positions.set(offset, new Position(this, offset));\n            },\n\n            toString: function() {\n                return \"[NodeWrapper(\" + dom.inspectNode(this.node) + \")]\";\n            }\n        };\n\n        NodeWrapper.prototype = nodeProto;\n\n        var EMPTY = \"EMPTY\",\n            NON_SPACE = \"NON_SPACE\",\n            UNCOLLAPSIBLE_SPACE = \"UNCOLLAPSIBLE_SPACE\",\n            COLLAPSIBLE_SPACE = \"COLLAPSIBLE_SPACE\",\n            TRAILING_SPACE_BEFORE_BLOCK = \"TRAILING_SPACE_BEFORE_BLOCK\",\n            TRAILING_SPACE_IN_BLOCK = \"TRAILING_SPACE_IN_BLOCK\",\n            TRAILING_SPACE_BEFORE_BR = \"TRAILING_SPACE_BEFORE_BR\",\n            PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK = \"PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK\",\n            TRAILING_LINE_BREAK_AFTER_BR = \"TRAILING_LINE_BREAK_AFTER_BR\",\n            INCLUDED_TRAILING_LINE_BREAK_AFTER_BR = \"INCLUDED_TRAILING_LINE_BREAK_AFTER_BR\";\n\n        extend(nodeProto, {\n            isCharacterDataNode: createCachingGetter(\"isCharacterDataNode\", dom.isCharacterDataNode, \"node\"),\n            getNodeIndex: createCachingGetter(\"nodeIndex\", dom.getNodeIndex, \"node\"),\n            getLength: createCachingGetter(\"nodeLength\", dom.getNodeLength, \"node\"),\n            containsPositions: createCachingGetter(\"containsPositions\", containsPositions, \"node\"),\n            isWhitespace: createCachingGetter(\"isWhitespace\", isWhitespaceNode, \"node\"),\n            isCollapsedWhitespace: createCachingGetter(\"isCollapsedWhitespace\", isCollapsedWhitespaceNode, \"node\"),\n            getComputedDisplay: createCachingGetter(\"computedDisplay\", getComputedDisplay, \"node\"),\n            isCollapsed: createCachingGetter(\"collapsed\", isCollapsedNode, \"node\"),\n            isIgnored: createCachingGetter(\"ignored\", isIgnoredNode, \"node\"),\n            next: createCachingGetter(\"nextPos\", nextNode, \"node\"),\n            previous: createCachingGetter(\"previous\", previousNode, \"node\"),\n\n            getTextNodeInfo: createCachingGetter(\"textNodeInfo\", function(textNode) {\n                var spaceRegex = null, collapseSpaces = false;\n                var cssWhitespace = getComputedStyleProperty(textNode.parentNode, \"whiteSpace\");\n                var preLine = (cssWhitespace == \"pre-line\");\n                if (preLine) {\n                    spaceRegex = spacesMinusLineBreaksRegex;\n                    collapseSpaces = true;\n                } else if (cssWhitespace == \"normal\" || cssWhitespace == \"nowrap\") {\n                    spaceRegex = spacesRegex;\n                    collapseSpaces = true;\n                }\n\n                return {\n                    node: textNode,\n                    text: textNode.data,\n                    spaceRegex: spaceRegex,\n                    collapseSpaces: collapseSpaces,\n                    preLine: preLine\n                };\n            }, \"node\"),\n\n            hasInnerText: createCachingGetter(\"hasInnerText\", function(el, backward) {\n                var session = this.session;\n                var posAfterEl = session.getPosition(el.parentNode, this.getNodeIndex() + 1);\n                var firstPosInEl = session.getPosition(el, 0);\n\n                var pos = backward ? posAfterEl : firstPosInEl;\n                var endPos = backward ? firstPosInEl : posAfterEl;\n\n                /*\n                 <body><p>X  </p><p>Y</p></body>\n\n                 Positions:\n\n                 body:0:\"\"\n                 p:0:\"\"\n                 text:0:\"\"\n                 text:1:\"X\"\n                 text:2:TRAILING_SPACE_IN_BLOCK\n                 text:3:COLLAPSED_SPACE\n                 p:1:\"\"\n                 body:1:\"\\n\"\n                 p:0:\"\"\n                 text:0:\"\"\n                 text:1:\"Y\"\n\n                 A character is a TRAILING_SPACE_IN_BLOCK iff:\n\n                 - There is no uncollapsed character after it within the visible containing block element\n\n                 A character is a TRAILING_SPACE_BEFORE_BR iff:\n\n                 - There is no uncollapsed character after it preceding a <br> element\n\n                 An element has inner text iff\n\n                 - It is not hidden\n                 - It contains an uncollapsed character\n\n                 All trailing spaces (pre-line, before <br>, end of block) require definite non-empty characters to render.\n                 */\n\n                while (pos !== endPos) {\n                    pos.prepopulateChar();\n                    if (pos.isDefinitelyNonEmpty()) {\n                        return true;\n                    }\n                    pos = backward ? pos.previousVisible() : pos.nextVisible();\n                }\n\n                return false;\n            }, \"node\"),\n\n            isRenderedBlock: createCachingGetter(\"isRenderedBlock\", function(el) {\n                // Ensure that a block element containing a <br> is considered to have inner text\n                var brs = el.getElementsByTagName(\"br\");\n                for (var i = 0, len = brs.length; i < len; ++i) {\n                    if (!isCollapsedNode(brs[i])) {\n                        return true;\n                    }\n                }\n                return this.hasInnerText();\n            }, \"node\"),\n\n            getTrailingSpace: createCachingGetter(\"trailingSpace\", function(el) {\n                if (el.tagName.toLowerCase() == \"br\") {\n                    return \"\";\n                } else {\n                    switch (this.getComputedDisplay()) {\n                        case \"inline\":\n                            var child = el.lastChild;\n                            while (child) {\n                                if (!isIgnoredNode(child)) {\n                                    return (child.nodeType == 1) ? this.session.getNodeWrapper(child).getTrailingSpace() : \"\";\n                                }\n                                child = child.previousSibling;\n                            }\n                            break;\n                        case \"inline-block\":\n                        case \"inline-table\":\n                        case \"none\":\n                        case \"table-column\":\n                        case \"table-column-group\":\n                            break;\n                        case \"table-cell\":\n                            return \"\\t\";\n                        default:\n                            return this.isRenderedBlock(true) ? \"\\n\" : \"\";\n                    }\n                }\n                return \"\";\n            }, \"node\"),\n\n            getLeadingSpace: createCachingGetter(\"leadingSpace\", function(el) {\n                switch (this.getComputedDisplay()) {\n                    case \"inline\":\n                    case \"inline-block\":\n                    case \"inline-table\":\n                    case \"none\":\n                    case \"table-column\":\n                    case \"table-column-group\":\n                    case \"table-cell\":\n                        break;\n                    default:\n                        return this.isRenderedBlock(false) ? \"\\n\" : \"\";\n                }\n                return \"\";\n            }, \"node\")\n        });\n\n        /*----------------------------------------------------------------------------------------------------------------*/\n\n        function Position(nodeWrapper, offset) {\n            this.offset = offset;\n            this.nodeWrapper = nodeWrapper;\n            this.node = nodeWrapper.node;\n            this.session = nodeWrapper.session;\n            this.cache = new Cache();\n        }\n\n        function inspectPosition() {\n            return \"[Position(\" + dom.inspectNode(this.node) + \":\" + this.offset + \")]\";\n        }\n\n        var positionProto = {\n            character: \"\",\n            characterType: EMPTY,\n            isBr: false,\n\n            /*\n            This method:\n            - Fully populates positions that have characters that can be determined independently of any other characters.\n            - Populates most types of space positions with a provisional character. The character is finalized later.\n             */\n            prepopulateChar: function() {\n                var pos = this;\n                if (!pos.prepopulatedChar) {\n                    var node = pos.node, offset = pos.offset;\n                    var visibleChar = \"\", charType = EMPTY;\n                    var finalizedChar = false;\n                    if (offset > 0) {\n                        if (node.nodeType == 3) {\n                            var text = node.data;\n                            var textChar = text.charAt(offset - 1);\n\n                            var nodeInfo = pos.nodeWrapper.getTextNodeInfo();\n                            var spaceRegex = nodeInfo.spaceRegex;\n                            if (nodeInfo.collapseSpaces) {\n                                if (spaceRegex.test(textChar)) {\n                                    // \"If the character at position is from set, append a single space (U+0020) to newdata and advance\n                                    // position until the character at position is not from set.\"\n\n                                    // We also need to check for the case where we're in a pre-line and we have a space preceding a\n                                    // line break, because such spaces are collapsed in some browsers\n                                    if (offset > 1 && spaceRegex.test(text.charAt(offset - 2))) {\n                                    } else if (nodeInfo.preLine && text.charAt(offset) === \"\\n\") {\n                                        visibleChar = \" \";\n                                        charType = PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK;\n                                    } else {\n                                        visibleChar = \" \";\n                                        //pos.checkForFollowingLineBreak = true;\n                                        charType = COLLAPSIBLE_SPACE;\n                                    }\n                                } else {\n                                    visibleChar = textChar;\n                                    charType = NON_SPACE;\n                                    finalizedChar = true;\n                                }\n                            } else {\n                                visibleChar = textChar;\n                                charType = UNCOLLAPSIBLE_SPACE;\n                                finalizedChar = true;\n                            }\n                        } else {\n                            var nodePassed = node.childNodes[offset - 1];\n                            if (nodePassed && nodePassed.nodeType == 1 && !isCollapsedNode(nodePassed)) {\n                                if (nodePassed.tagName.toLowerCase() == \"br\") {\n                                    visibleChar = \"\\n\";\n                                    pos.isBr = true;\n                                    charType = COLLAPSIBLE_SPACE;\n                                    finalizedChar = false;\n                                } else {\n                                    pos.checkForTrailingSpace = true;\n                                }\n                            }\n\n                            // Check the leading space of the next node for the case when a block element follows an inline\n                            // element or text node. In that case, there is an implied line break between the two nodes.\n                            if (!visibleChar) {\n                                var nextNode = node.childNodes[offset];\n                                if (nextNode && nextNode.nodeType == 1 && !isCollapsedNode(nextNode)) {\n                                    pos.checkForLeadingSpace = true;\n                                }\n                            }\n                        }\n                    }\n\n                    pos.prepopulatedChar = true;\n                    pos.character = visibleChar;\n                    pos.characterType = charType;\n                    pos.isCharInvariant = finalizedChar;\n                }\n            },\n\n            isDefinitelyNonEmpty: function() {\n                var charType = this.characterType;\n                return charType == NON_SPACE || charType == UNCOLLAPSIBLE_SPACE;\n            },\n\n            // Resolve leading and trailing spaces, which may involve prepopulating other positions\n            resolveLeadingAndTrailingSpaces: function() {\n                if (!this.prepopulatedChar) {\n                    this.prepopulateChar();\n                }\n                if (this.checkForTrailingSpace) {\n                    var trailingSpace = this.session.getNodeWrapper(this.node.childNodes[this.offset - 1]).getTrailingSpace();\n                    if (trailingSpace) {\n                        this.isTrailingSpace = true;\n                        this.character = trailingSpace;\n                        this.characterType = COLLAPSIBLE_SPACE;\n                    }\n                    this.checkForTrailingSpace = false;\n                }\n                if (this.checkForLeadingSpace) {\n                    var leadingSpace = this.session.getNodeWrapper(this.node.childNodes[this.offset]).getLeadingSpace();\n                    if (leadingSpace) {\n                        this.isLeadingSpace = true;\n                        this.character = leadingSpace;\n                        this.characterType = COLLAPSIBLE_SPACE;\n                    }\n                    this.checkForLeadingSpace = false;\n                }\n            },\n\n            getPrecedingUncollapsedPosition: function(characterOptions) {\n                var pos = this, character;\n                while ( (pos = pos.previousVisible()) ) {\n                    character = pos.getCharacter(characterOptions);\n                    if (character !== \"\") {\n                        return pos;\n                    }\n                }\n\n                return null;\n            },\n\n            getCharacter: function(characterOptions) {\n                this.resolveLeadingAndTrailingSpaces();\n\n                var thisChar = this.character, returnChar;\n\n                // Check if character is ignored\n                var ignoredChars = normalizeIgnoredCharacters(characterOptions.ignoreCharacters);\n                var isIgnoredCharacter = (thisChar !== \"\" && ignoredChars.indexOf(thisChar) > -1);\n\n                // Check if this position's  character is invariant (i.e. not dependent on character options) and return it\n                // if so\n                if (this.isCharInvariant) {\n                    returnChar = isIgnoredCharacter ? \"\" : thisChar;\n                    return returnChar;\n                }\n\n                var cacheKey = [\"character\", characterOptions.includeSpaceBeforeBr, characterOptions.includeBlockContentTrailingSpace, characterOptions.includePreLineTrailingSpace, ignoredChars].join(\"_\");\n                var cachedChar = this.cache.get(cacheKey);\n                if (cachedChar !== null) {\n                    return cachedChar;\n                }\n\n                // We need to actually get the character now\n                var character = \"\";\n                var collapsible = (this.characterType == COLLAPSIBLE_SPACE);\n\n                var nextPos, previousPos;\n                var gotPreviousPos = false;\n                var pos = this;\n\n                function getPreviousPos() {\n                    if (!gotPreviousPos) {\n                        previousPos = pos.getPrecedingUncollapsedPosition(characterOptions);\n                        gotPreviousPos = true;\n                    }\n                    return previousPos;\n                }\n\n                // Disallow a collapsible space that is followed by a line break or is the last character\n                if (collapsible) {\n                    // Allow a trailing space that we've previously determined should be included\n                    if (this.type == INCLUDED_TRAILING_LINE_BREAK_AFTER_BR) {\n                        character = \"\\n\";\n                    }\n                    // Disallow a collapsible space that follows a trailing space or line break, or is the first character,\n                    // or follows a collapsible included space\n                    else if (thisChar == \" \" &&\n                            (!getPreviousPos() || previousPos.isTrailingSpace || previousPos.character == \"\\n\" || (previousPos.character == \" \" && previousPos.characterType == COLLAPSIBLE_SPACE))) {\n                    }\n                    // Allow a leading line break unless it follows a line break\n                    else if (thisChar == \"\\n\" && this.isLeadingSpace) {\n                        if (getPreviousPos() && previousPos.character != \"\\n\") {\n                            character = \"\\n\";\n                        } else {\n                        }\n                    } else {\n                        nextPos = this.nextUncollapsed();\n                        if (nextPos) {\n                            if (nextPos.isBr) {\n                                this.type = TRAILING_SPACE_BEFORE_BR;\n                            } else if (nextPos.isTrailingSpace && nextPos.character == \"\\n\") {\n                                this.type = TRAILING_SPACE_IN_BLOCK;\n                            } else if (nextPos.isLeadingSpace && nextPos.character == \"\\n\") {\n                                this.type = TRAILING_SPACE_BEFORE_BLOCK;\n                            }\n\n                            if (nextPos.character == \"\\n\") {\n                                if (this.type == TRAILING_SPACE_BEFORE_BR && !characterOptions.includeSpaceBeforeBr) {\n                                } else if (this.type == TRAILING_SPACE_BEFORE_BLOCK && !characterOptions.includeSpaceBeforeBlock) {\n                                } else if (this.type == TRAILING_SPACE_IN_BLOCK && nextPos.isTrailingSpace && !characterOptions.includeBlockContentTrailingSpace) {\n                                } else if (this.type == PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK && nextPos.type == NON_SPACE && !characterOptions.includePreLineTrailingSpace) {\n                                } else if (thisChar == \"\\n\") {\n                                    if (nextPos.isTrailingSpace) {\n                                        if (this.isTrailingSpace) {\n                                        } else if (this.isBr) {\n                                            nextPos.type = TRAILING_LINE_BREAK_AFTER_BR;\n\n                                            if (getPreviousPos() && previousPos.isLeadingSpace && !previousPos.isTrailingSpace && previousPos.character == \"\\n\") {\n                                                nextPos.character = \"\";\n                                            } else {\n                                                nextPos.type = INCLUDED_TRAILING_LINE_BREAK_AFTER_BR;\n                                            }\n                                        }\n                                    } else {\n                                        character = \"\\n\";\n                                    }\n                                } else if (thisChar == \" \") {\n                                    character = \" \";\n                                } else {\n                                }\n                            } else {\n                                character = thisChar;\n                            }\n                        } else {\n                        }\n                    }\n                }\n\n                if (ignoredChars.indexOf(character) > -1) {\n                    character = \"\";\n                }\n\n\n                this.cache.set(cacheKey, character);\n\n                return character;\n            },\n\n            equals: function(pos) {\n                return !!pos && this.node === pos.node && this.offset === pos.offset;\n            },\n\n            inspect: inspectPosition,\n\n            toString: function() {\n                return this.character;\n            }\n        };\n\n        Position.prototype = positionProto;\n\n        extend(positionProto, {\n            next: createCachingGetter(\"nextPos\", function(pos) {\n                var nodeWrapper = pos.nodeWrapper, node = pos.node, offset = pos.offset, session = nodeWrapper.session;\n                if (!node) {\n                    return null;\n                }\n                var nextNode, nextOffset, child;\n                if (offset == nodeWrapper.getLength()) {\n                    // Move onto the next node\n                    nextNode = node.parentNode;\n                    nextOffset = nextNode ? nodeWrapper.getNodeIndex() + 1 : 0;\n                } else {\n                    if (nodeWrapper.isCharacterDataNode()) {\n                        nextNode = node;\n                        nextOffset = offset + 1;\n                    } else {\n                        child = node.childNodes[offset];\n                        // Go into the children next, if children there are\n                        if (session.getNodeWrapper(child).containsPositions()) {\n                            nextNode = child;\n                            nextOffset = 0;\n                        } else {\n                            nextNode = node;\n                            nextOffset = offset + 1;\n                        }\n                    }\n                }\n\n                return nextNode ? session.getPosition(nextNode, nextOffset) : null;\n            }),\n\n            previous: createCachingGetter(\"previous\", function(pos) {\n                var nodeWrapper = pos.nodeWrapper, node = pos.node, offset = pos.offset, session = nodeWrapper.session;\n                var previousNode, previousOffset, child;\n                if (offset == 0) {\n                    previousNode = node.parentNode;\n                    previousOffset = previousNode ? nodeWrapper.getNodeIndex() : 0;\n                } else {\n                    if (nodeWrapper.isCharacterDataNode()) {\n                        previousNode = node;\n                        previousOffset = offset - 1;\n                    } else {\n                        child = node.childNodes[offset - 1];\n                        // Go into the children next, if children there are\n                        if (session.getNodeWrapper(child).containsPositions()) {\n                            previousNode = child;\n                            previousOffset = dom.getNodeLength(child);\n                        } else {\n                            previousNode = node;\n                            previousOffset = offset - 1;\n                        }\n                    }\n                }\n                return previousNode ? session.getPosition(previousNode, previousOffset) : null;\n            }),\n\n            /*\n             Next and previous position moving functions that filter out\n\n             - Hidden (CSS visibility/display) elements\n             - Script and style elements\n             */\n            nextVisible: createCachingGetter(\"nextVisible\", function(pos) {\n                var next = pos.next();\n                if (!next) {\n                    return null;\n                }\n                var nodeWrapper = next.nodeWrapper, node = next.node;\n                var newPos = next;\n                if (nodeWrapper.isCollapsed()) {\n                    // We're skipping this node and all its descendants\n                    newPos = nodeWrapper.session.getPosition(node.parentNode, nodeWrapper.getNodeIndex() + 1);\n                }\n                return newPos;\n            }),\n\n            nextUncollapsed: createCachingGetter(\"nextUncollapsed\", function(pos) {\n                var nextPos = pos;\n                while ( (nextPos = nextPos.nextVisible()) ) {\n                    nextPos.resolveLeadingAndTrailingSpaces();\n                    if (nextPos.character !== \"\") {\n                        return nextPos;\n                    }\n                }\n                return null;\n            }),\n\n            previousVisible: createCachingGetter(\"previousVisible\", function(pos) {\n                var previous = pos.previous();\n                if (!previous) {\n                    return null;\n                }\n                var nodeWrapper = previous.nodeWrapper, node = previous.node;\n                var newPos = previous;\n                if (nodeWrapper.isCollapsed()) {\n                    // We're skipping this node and all its descendants\n                    newPos = nodeWrapper.session.getPosition(node.parentNode, nodeWrapper.getNodeIndex());\n                }\n                return newPos;\n            })\n        });\n\n        /*----------------------------------------------------------------------------------------------------------------*/\n\n        var currentSession = null;\n\n        var Session = (function() {\n            function createWrapperCache(nodeProperty) {\n                var cache = new Cache();\n\n                return {\n                    get: function(node) {\n                        var wrappersByProperty = cache.get(node[nodeProperty]);\n                        if (wrappersByProperty) {\n                            for (var i = 0, wrapper; wrapper = wrappersByProperty[i++]; ) {\n                                if (wrapper.node === node) {\n                                    return wrapper;\n                                }\n                            }\n                        }\n                        return null;\n                    },\n\n                    set: function(nodeWrapper) {\n                        var property = nodeWrapper.node[nodeProperty];\n                        var wrappersByProperty = cache.get(property) || cache.set(property, []);\n                        wrappersByProperty.push(nodeWrapper);\n                    }\n                };\n            }\n\n            var uniqueIDSupported = util.isHostProperty(document.documentElement, \"uniqueID\");\n\n            function Session() {\n                this.initCaches();\n            }\n\n            Session.prototype = {\n                initCaches: function() {\n                    this.elementCache = uniqueIDSupported ? (function() {\n                        var elementsCache = new Cache();\n\n                        return {\n                            get: function(el) {\n                                return elementsCache.get(el.uniqueID);\n                            },\n\n                            set: function(elWrapper) {\n                                elementsCache.set(elWrapper.node.uniqueID, elWrapper);\n                            }\n                        };\n                    })() : createWrapperCache(\"tagName\");\n\n                    // Store text nodes keyed by data, although we may need to truncate this\n                    this.textNodeCache = createWrapperCache(\"data\");\n                    this.otherNodeCache = createWrapperCache(\"nodeName\");\n                },\n\n                getNodeWrapper: function(node) {\n                    var wrapperCache;\n                    switch (node.nodeType) {\n                        case 1:\n                            wrapperCache = this.elementCache;\n                            break;\n                        case 3:\n                            wrapperCache = this.textNodeCache;\n                            break;\n                        default:\n                            wrapperCache = this.otherNodeCache;\n                            break;\n                    }\n\n                    var wrapper = wrapperCache.get(node);\n                    if (!wrapper) {\n                        wrapper = new NodeWrapper(node, this);\n                        wrapperCache.set(wrapper);\n                    }\n                    return wrapper;\n                },\n\n                getPosition: function(node, offset) {\n                    return this.getNodeWrapper(node).getPosition(offset);\n                },\n\n                getRangeBoundaryPosition: function(range, isStart) {\n                    var prefix = isStart ? \"start\" : \"end\";\n                    return this.getPosition(range[prefix + \"Container\"], range[prefix + \"Offset\"]);\n                },\n\n                detach: function() {\n                    this.elementCache = this.textNodeCache = this.otherNodeCache = null;\n                }\n            };\n\n            return Session;\n        })();\n\n        /*----------------------------------------------------------------------------------------------------------------*/\n\n        function startSession() {\n            endSession();\n            return (currentSession = new Session());\n        }\n\n        function getSession() {\n            return currentSession || startSession();\n        }\n\n        function endSession() {\n            if (currentSession) {\n                currentSession.detach();\n            }\n            currentSession = null;\n        }\n\n        /*----------------------------------------------------------------------------------------------------------------*/\n\n        // Extensions to the rangy.dom utility object\n\n        extend(dom, {\n            nextNode: nextNode,\n            previousNode: previousNode\n        });\n\n        /*----------------------------------------------------------------------------------------------------------------*/\n\n        function createCharacterIterator(startPos, backward, endPos, characterOptions) {\n\n            // Adjust the end position to ensure that it is actually reached\n            if (endPos) {\n                if (backward) {\n                    if (isCollapsedNode(endPos.node)) {\n                        endPos = startPos.previousVisible();\n                    }\n                } else {\n                    if (isCollapsedNode(endPos.node)) {\n                        endPos = endPos.nextVisible();\n                    }\n                }\n            }\n\n            var pos = startPos, finished = false;\n\n            function next() {\n                var charPos = null;\n                if (backward) {\n                    charPos = pos;\n                    if (!finished) {\n                        pos = pos.previousVisible();\n                        finished = !pos || (endPos && pos.equals(endPos));\n                    }\n                } else {\n                    if (!finished) {\n                        charPos = pos = pos.nextVisible();\n                        finished = !pos || (endPos && pos.equals(endPos));\n                    }\n                }\n                if (finished) {\n                    pos = null;\n                }\n                return charPos;\n            }\n\n            var previousTextPos, returnPreviousTextPos = false;\n\n            return {\n                next: function() {\n                    if (returnPreviousTextPos) {\n                        returnPreviousTextPos = false;\n                        return previousTextPos;\n                    } else {\n                        var pos, character;\n                        while ( (pos = next()) ) {\n                            character = pos.getCharacter(characterOptions);\n                            if (character) {\n                                previousTextPos = pos;\n                                return pos;\n                            }\n                        }\n                        return null;\n                    }\n                },\n\n                rewind: function() {\n                    if (previousTextPos) {\n                        returnPreviousTextPos = true;\n                    } else {\n                        throw module.createError(\"createCharacterIterator: cannot rewind. Only one position can be rewound.\");\n                    }\n                },\n\n                dispose: function() {\n                    startPos = endPos = null;\n                }\n            };\n        }\n\n        var arrayIndexOf = Array.prototype.indexOf ?\n            function(arr, val) {\n                return arr.indexOf(val);\n            } :\n            function(arr, val) {\n                for (var i = 0, len = arr.length; i < len; ++i) {\n                    if (arr[i] === val) {\n                        return i;\n                    }\n                }\n                return -1;\n            };\n\n        // Provides a pair of iterators over text positions, tokenized. Transparently requests more text when next()\n        // is called and there is no more tokenized text\n        function createTokenizedTextProvider(pos, characterOptions, wordOptions) {\n            var forwardIterator = createCharacterIterator(pos, false, null, characterOptions);\n            var backwardIterator = createCharacterIterator(pos, true, null, characterOptions);\n            var tokenizer = wordOptions.tokenizer;\n\n            // Consumes a word and the whitespace beyond it\n            function consumeWord(forward) {\n                var pos, textChar;\n                var newChars = [], it = forward ? forwardIterator : backwardIterator;\n\n                var passedWordBoundary = false, insideWord = false;\n\n                while ( (pos = it.next()) ) {\n                    textChar = pos.character;\n\n\n                    if (allWhiteSpaceRegex.test(textChar)) {\n                        if (insideWord) {\n                            insideWord = false;\n                            passedWordBoundary = true;\n                        }\n                    } else {\n                        if (passedWordBoundary) {\n                            it.rewind();\n                            break;\n                        } else {\n                            insideWord = true;\n                        }\n                    }\n                    newChars.push(pos);\n                }\n\n\n                return newChars;\n            }\n\n            // Get initial word surrounding initial position and tokenize it\n            var forwardChars = consumeWord(true);\n            var backwardChars = consumeWord(false).reverse();\n            var tokens = tokenize(backwardChars.concat(forwardChars), wordOptions, tokenizer);\n\n            // Create initial token buffers\n            var forwardTokensBuffer = forwardChars.length ?\n                tokens.slice(arrayIndexOf(tokens, forwardChars[0].token)) : [];\n\n            var backwardTokensBuffer = backwardChars.length ?\n                tokens.slice(0, arrayIndexOf(tokens, backwardChars.pop().token) + 1) : [];\n\n            function inspectBuffer(buffer) {\n                var textPositions = [\"[\" + buffer.length + \"]\"];\n                for (var i = 0; i < buffer.length; ++i) {\n                    textPositions.push(\"(word: \" + buffer[i] + \", is word: \" + buffer[i].isWord + \")\");\n                }\n                return textPositions;\n            }\n\n\n            return {\n                nextEndToken: function() {\n                    var lastToken, forwardChars;\n\n                    // If we're down to the last token, consume character chunks until we have a word or run out of\n                    // characters to consume\n                    while ( forwardTokensBuffer.length == 1 &&\n                        !(lastToken = forwardTokensBuffer[0]).isWord &&\n                        (forwardChars = consumeWord(true)).length > 0) {\n\n                        // Merge trailing non-word into next word and tokenize\n                        forwardTokensBuffer = tokenize(lastToken.chars.concat(forwardChars), wordOptions, tokenizer);\n                    }\n\n                    return forwardTokensBuffer.shift();\n                },\n\n                previousStartToken: function() {\n                    var lastToken, backwardChars;\n\n                    // If we're down to the last token, consume character chunks until we have a word or run out of\n                    // characters to consume\n                    while ( backwardTokensBuffer.length == 1 &&\n                        !(lastToken = backwardTokensBuffer[0]).isWord &&\n                        (backwardChars = consumeWord(false)).length > 0) {\n\n                        // Merge leading non-word into next word and tokenize\n                        backwardTokensBuffer = tokenize(backwardChars.reverse().concat(lastToken.chars), wordOptions, tokenizer);\n                    }\n\n                    return backwardTokensBuffer.pop();\n                },\n\n                dispose: function() {\n                    forwardIterator.dispose();\n                    backwardIterator.dispose();\n                    forwardTokensBuffer = backwardTokensBuffer = null;\n                }\n            };\n        }\n\n        function movePositionBy(pos, unit, count, characterOptions, wordOptions) {\n            var unitsMoved = 0, currentPos, newPos = pos, charIterator, nextPos, absCount = Math.abs(count), token;\n            if (count !== 0) {\n                var backward = (count < 0);\n\n                switch (unit) {\n                    case CHARACTER:\n                        charIterator = createCharacterIterator(pos, backward, null, characterOptions);\n                        while ( (currentPos = charIterator.next()) && unitsMoved < absCount ) {\n                            ++unitsMoved;\n                            newPos = currentPos;\n                        }\n                        nextPos = currentPos;\n                        charIterator.dispose();\n                        break;\n                    case WORD:\n                        var tokenizedTextProvider = createTokenizedTextProvider(pos, characterOptions, wordOptions);\n                        var next = backward ? tokenizedTextProvider.previousStartToken : tokenizedTextProvider.nextEndToken;\n\n                        while ( (token = next()) && unitsMoved < absCount ) {\n                            if (token.isWord) {\n                                ++unitsMoved;\n                                newPos = backward ? token.chars[0] : token.chars[token.chars.length - 1];\n                            }\n                        }\n                        break;\n                    default:\n                        throw new Error(\"movePositionBy: unit '\" + unit + \"' not implemented\");\n                }\n\n                // Perform any necessary position tweaks\n                if (backward) {\n                    newPos = newPos.previousVisible();\n                    unitsMoved = -unitsMoved;\n                } else if (newPos && newPos.isLeadingSpace && !newPos.isTrailingSpace) {\n                    // Tweak the position for the case of a leading space. The problem is that an uncollapsed leading space\n                    // before a block element (for example, the line break between \"1\" and \"2\" in the following HTML:\n                    // \"1<p>2</p>\") is considered to be attached to the position immediately before the block element, which\n                    // corresponds with a different selection position in most browsers from the one we want (i.e. at the\n                    // start of the contents of the block element). We get round this by advancing the position returned to\n                    // the last possible equivalent visible position.\n                    if (unit == WORD) {\n                        charIterator = createCharacterIterator(pos, false, null, characterOptions);\n                        nextPos = charIterator.next();\n                        charIterator.dispose();\n                    }\n                    if (nextPos) {\n                        newPos = nextPos.previousVisible();\n                    }\n                }\n            }\n\n\n            return {\n                position: newPos,\n                unitsMoved: unitsMoved\n            };\n        }\n\n        function createRangeCharacterIterator(session, range, characterOptions, backward) {\n            var rangeStart = session.getRangeBoundaryPosition(range, true);\n            var rangeEnd = session.getRangeBoundaryPosition(range, false);\n            var itStart = backward ? rangeEnd : rangeStart;\n            var itEnd = backward ? rangeStart : rangeEnd;\n\n            return createCharacterIterator(itStart, !!backward, itEnd, characterOptions);\n        }\n\n        function getRangeCharacters(session, range, characterOptions) {\n\n            var chars = [], it = createRangeCharacterIterator(session, range, characterOptions), pos;\n            while ( (pos = it.next()) ) {\n                chars.push(pos);\n            }\n\n            it.dispose();\n            return chars;\n        }\n\n        function isWholeWord(startPos, endPos, wordOptions) {\n            var range = api.createRange(startPos.node);\n            range.setStartAndEnd(startPos.node, startPos.offset, endPos.node, endPos.offset);\n            return !range.expand(\"word\", { wordOptions: wordOptions });\n        }\n\n        function findTextFromPosition(initialPos, searchTerm, isRegex, searchScopeRange, findOptions) {\n            var backward = isDirectionBackward(findOptions.direction);\n            var it = createCharacterIterator(\n                initialPos,\n                backward,\n                initialPos.session.getRangeBoundaryPosition(searchScopeRange, backward),\n                findOptions.characterOptions\n            );\n            var text = \"\", chars = [], pos, currentChar, matchStartIndex, matchEndIndex;\n            var result, insideRegexMatch;\n            var returnValue = null;\n\n            function handleMatch(startIndex, endIndex) {\n                var startPos = chars[startIndex].previousVisible();\n                var endPos = chars[endIndex - 1];\n                var valid = (!findOptions.wholeWordsOnly || isWholeWord(startPos, endPos, findOptions.wordOptions));\n\n                return {\n                    startPos: startPos,\n                    endPos: endPos,\n                    valid: valid\n                };\n            }\n\n            while ( (pos = it.next()) ) {\n                currentChar = pos.character;\n                if (!isRegex && !findOptions.caseSensitive) {\n                    currentChar = currentChar.toLowerCase();\n                }\n\n                if (backward) {\n                    chars.unshift(pos);\n                    text = currentChar + text;\n                } else {\n                    chars.push(pos);\n                    text += currentChar;\n                }\n\n                if (isRegex) {\n                    result = searchTerm.exec(text);\n                    if (result) {\n                        matchStartIndex = result.index;\n                        matchEndIndex = matchStartIndex + result[0].length;\n                        if (insideRegexMatch) {\n                            // Check whether the match is now over\n                            if ((!backward && matchEndIndex < text.length) || (backward && matchStartIndex > 0)) {\n                                returnValue = handleMatch(matchStartIndex, matchEndIndex);\n                                break;\n                            }\n                        } else {\n                            insideRegexMatch = true;\n                        }\n                    }\n                } else if ( (matchStartIndex = text.indexOf(searchTerm)) != -1 ) {\n                    returnValue = handleMatch(matchStartIndex, matchStartIndex + searchTerm.length);\n                    break;\n                }\n            }\n\n            // Check whether regex match extends to the end of the range\n            if (insideRegexMatch) {\n                returnValue = handleMatch(matchStartIndex, matchEndIndex);\n            }\n            it.dispose();\n\n            return returnValue;\n        }\n\n        function createEntryPointFunction(func) {\n            return function() {\n                var sessionRunning = !!currentSession;\n                var session = getSession();\n                var args = [session].concat( util.toArray(arguments) );\n                var returnValue = func.apply(this, args);\n                if (!sessionRunning) {\n                    endSession();\n                }\n                return returnValue;\n            };\n        }\n\n        /*----------------------------------------------------------------------------------------------------------------*/\n\n        // Extensions to the Rangy Range object\n\n        function createRangeBoundaryMover(isStart, collapse) {\n            /*\n             Unit can be \"character\" or \"word\"\n             Options:\n\n             - includeTrailingSpace\n             - wordRegex\n             - tokenizer\n             - collapseSpaceBeforeLineBreak\n             */\n            return createEntryPointFunction(\n                function(session, unit, count, moveOptions) {\n                    if (typeof count == UNDEF) {\n                        count = unit;\n                        unit = CHARACTER;\n                    }\n                    moveOptions = createNestedOptions(moveOptions, defaultMoveOptions);\n\n                    var boundaryIsStart = isStart;\n                    if (collapse) {\n                        boundaryIsStart = (count >= 0);\n                        this.collapse(!boundaryIsStart);\n                    }\n                    var moveResult = movePositionBy(session.getRangeBoundaryPosition(this, boundaryIsStart), unit, count, moveOptions.characterOptions, moveOptions.wordOptions);\n                    var newPos = moveResult.position;\n                    this[boundaryIsStart ? \"setStart\" : \"setEnd\"](newPos.node, newPos.offset);\n                    return moveResult.unitsMoved;\n                }\n            );\n        }\n\n        function createRangeTrimmer(isStart) {\n            return createEntryPointFunction(\n                function(session, characterOptions) {\n                    characterOptions = createOptions(characterOptions, defaultCharacterOptions);\n                    var pos;\n                    var it = createRangeCharacterIterator(session, this, characterOptions, !isStart);\n                    var trimCharCount = 0;\n                    while ( (pos = it.next()) && allWhiteSpaceRegex.test(pos.character) ) {\n                        ++trimCharCount;\n                    }\n                    it.dispose();\n                    var trimmed = (trimCharCount > 0);\n                    if (trimmed) {\n                        this[isStart ? \"moveStart\" : \"moveEnd\"](\n                            \"character\",\n                            isStart ? trimCharCount : -trimCharCount,\n                            { characterOptions: characterOptions }\n                        );\n                    }\n                    return trimmed;\n                }\n            );\n        }\n\n        extend(api.rangePrototype, {\n            moveStart: createRangeBoundaryMover(true, false),\n\n            moveEnd: createRangeBoundaryMover(false, false),\n\n            move: createRangeBoundaryMover(true, true),\n\n            trimStart: createRangeTrimmer(true),\n\n            trimEnd: createRangeTrimmer(false),\n\n            trim: createEntryPointFunction(\n                function(session, characterOptions) {\n                    var startTrimmed = this.trimStart(characterOptions), endTrimmed = this.trimEnd(characterOptions);\n                    return startTrimmed || endTrimmed;\n                }\n            ),\n\n            expand: createEntryPointFunction(\n                function(session, unit, expandOptions) {\n                    var moved = false;\n                    expandOptions = createNestedOptions(expandOptions, defaultExpandOptions);\n                    var characterOptions = expandOptions.characterOptions;\n                    if (!unit) {\n                        unit = CHARACTER;\n                    }\n                    if (unit == WORD) {\n                        var wordOptions = expandOptions.wordOptions;\n                        var startPos = session.getRangeBoundaryPosition(this, true);\n                        var endPos = session.getRangeBoundaryPosition(this, false);\n\n                        var startTokenizedTextProvider = createTokenizedTextProvider(startPos, characterOptions, wordOptions);\n                        var startToken = startTokenizedTextProvider.nextEndToken();\n                        var newStartPos = startToken.chars[0].previousVisible();\n                        var endToken, newEndPos;\n\n                        if (this.collapsed) {\n                            endToken = startToken;\n                        } else {\n                            var endTokenizedTextProvider = createTokenizedTextProvider(endPos, characterOptions, wordOptions);\n                            endToken = endTokenizedTextProvider.previousStartToken();\n                        }\n                        newEndPos = endToken.chars[endToken.chars.length - 1];\n\n                        if (!newStartPos.equals(startPos)) {\n                            this.setStart(newStartPos.node, newStartPos.offset);\n                            moved = true;\n                        }\n                        if (newEndPos && !newEndPos.equals(endPos)) {\n                            this.setEnd(newEndPos.node, newEndPos.offset);\n                            moved = true;\n                        }\n\n                        if (expandOptions.trim) {\n                            if (expandOptions.trimStart) {\n                                moved = this.trimStart(characterOptions) || moved;\n                            }\n                            if (expandOptions.trimEnd) {\n                                moved = this.trimEnd(characterOptions) || moved;\n                            }\n                        }\n\n                        return moved;\n                    } else {\n                        return this.moveEnd(CHARACTER, 1, expandOptions);\n                    }\n                }\n            ),\n\n            text: createEntryPointFunction(\n                function(session, characterOptions) {\n                    return this.collapsed ?\n                        \"\" : getRangeCharacters(session, this, createOptions(characterOptions, defaultCharacterOptions)).join(\"\");\n                }\n            ),\n\n            selectCharacters: createEntryPointFunction(\n                function(session, containerNode, startIndex, endIndex, characterOptions) {\n                    var moveOptions = { characterOptions: characterOptions };\n                    if (!containerNode) {\n                        containerNode = getBody( this.getDocument() );\n                    }\n                    this.selectNodeContents(containerNode);\n                    this.collapse(true);\n                    this.moveStart(\"character\", startIndex, moveOptions);\n                    this.collapse(true);\n                    this.moveEnd(\"character\", endIndex - startIndex, moveOptions);\n                }\n            ),\n\n            // Character indexes are relative to the start of node\n            toCharacterRange: createEntryPointFunction(\n                function(session, containerNode, characterOptions) {\n                    if (!containerNode) {\n                        containerNode = getBody( this.getDocument() );\n                    }\n                    var parent = containerNode.parentNode, nodeIndex = dom.getNodeIndex(containerNode);\n                    var rangeStartsBeforeNode = (dom.comparePoints(this.startContainer, this.endContainer, parent, nodeIndex) == -1);\n                    var rangeBetween = this.cloneRange();\n                    var startIndex, endIndex;\n                    if (rangeStartsBeforeNode) {\n                        rangeBetween.setStartAndEnd(this.startContainer, this.startOffset, parent, nodeIndex);\n                        startIndex = -rangeBetween.text(characterOptions).length;\n                    } else {\n                        rangeBetween.setStartAndEnd(parent, nodeIndex, this.startContainer, this.startOffset);\n                        startIndex = rangeBetween.text(characterOptions).length;\n                    }\n                    endIndex = startIndex + this.text(characterOptions).length;\n\n                    return {\n                        start: startIndex,\n                        end: endIndex\n                    };\n                }\n            ),\n\n            findText: createEntryPointFunction(\n                function(session, searchTermParam, findOptions) {\n                    // Set up options\n                    findOptions = createNestedOptions(findOptions, defaultFindOptions);\n\n                    // Create word options if we're matching whole words only\n                    if (findOptions.wholeWordsOnly) {\n                        // We don't ever want trailing spaces for search results\n                        findOptions.wordOptions.includeTrailingSpace = false;\n                    }\n\n                    var backward = isDirectionBackward(findOptions.direction);\n\n                    // Create a range representing the search scope if none was provided\n                    var searchScopeRange = findOptions.withinRange;\n                    if (!searchScopeRange) {\n                        searchScopeRange = api.createRange();\n                        searchScopeRange.selectNodeContents(this.getDocument());\n                    }\n\n                    // Examine and prepare the search term\n                    var searchTerm = searchTermParam, isRegex = false;\n                    if (typeof searchTerm == \"string\") {\n                        if (!findOptions.caseSensitive) {\n                            searchTerm = searchTerm.toLowerCase();\n                        }\n                    } else {\n                        isRegex = true;\n                    }\n\n                    var initialPos = session.getRangeBoundaryPosition(this, !backward);\n\n                    // Adjust initial position if it lies outside the search scope\n                    var comparison = searchScopeRange.comparePoint(initialPos.node, initialPos.offset);\n\n                    if (comparison === -1) {\n                        initialPos = session.getRangeBoundaryPosition(searchScopeRange, true);\n                    } else if (comparison === 1) {\n                        initialPos = session.getRangeBoundaryPosition(searchScopeRange, false);\n                    }\n\n                    var pos = initialPos;\n                    var wrappedAround = false;\n\n                    // Try to find a match and ignore invalid ones\n                    var findResult;\n                    while (true) {\n                        findResult = findTextFromPosition(pos, searchTerm, isRegex, searchScopeRange, findOptions);\n\n                        if (findResult) {\n                            if (findResult.valid) {\n                                this.setStartAndEnd(findResult.startPos.node, findResult.startPos.offset, findResult.endPos.node, findResult.endPos.offset);\n                                return true;\n                            } else {\n                                // We've found a match that is not a whole word, so we carry on searching from the point immediately\n                                // after the match\n                                pos = backward ? findResult.startPos : findResult.endPos;\n                            }\n                        } else if (findOptions.wrap && !wrappedAround) {\n                            // No result found but we're wrapping around and limiting the scope to the unsearched part of the range\n                            searchScopeRange = searchScopeRange.cloneRange();\n                            pos = session.getRangeBoundaryPosition(searchScopeRange, !backward);\n                            searchScopeRange.setBoundary(initialPos.node, initialPos.offset, backward);\n                            wrappedAround = true;\n                        } else {\n                            // Nothing found and we can't wrap around, so we're done\n                            return false;\n                        }\n                    }\n                }\n            ),\n\n            pasteHtml: function(html) {\n                this.deleteContents();\n                if (html) {\n                    var frag = this.createContextualFragment(html);\n                    var lastChild = frag.lastChild;\n                    this.insertNode(frag);\n                    this.collapseAfter(lastChild);\n                }\n            }\n        });\n\n        /*----------------------------------------------------------------------------------------------------------------*/\n\n        // Extensions to the Rangy Selection object\n\n        function createSelectionTrimmer(methodName) {\n            return createEntryPointFunction(\n                function(session, characterOptions) {\n                    var trimmed = false;\n                    this.changeEachRange(function(range) {\n                        trimmed = range[methodName](characterOptions) || trimmed;\n                    });\n                    return trimmed;\n                }\n            );\n        }\n\n        extend(api.selectionPrototype, {\n            expand: createEntryPointFunction(\n                function(session, unit, expandOptions) {\n                    this.changeEachRange(function(range) {\n                        range.expand(unit, expandOptions);\n                    });\n                }\n            ),\n\n            move: createEntryPointFunction(\n                function(session, unit, count, options) {\n                    var unitsMoved = 0;\n                    if (this.focusNode) {\n                        this.collapse(this.focusNode, this.focusOffset);\n                        var range = this.getRangeAt(0);\n                        if (!options) {\n                            options = {};\n                        }\n                        options.characterOptions = createOptions(options.characterOptions, defaultCaretCharacterOptions);\n                        unitsMoved = range.move(unit, count, options);\n                        this.setSingleRange(range);\n                    }\n                    return unitsMoved;\n                }\n            ),\n\n            trimStart: createSelectionTrimmer(\"trimStart\"),\n            trimEnd: createSelectionTrimmer(\"trimEnd\"),\n            trim: createSelectionTrimmer(\"trim\"),\n\n            selectCharacters: createEntryPointFunction(\n                function(session, containerNode, startIndex, endIndex, direction, characterOptions) {\n                    var range = api.createRange(containerNode);\n                    range.selectCharacters(containerNode, startIndex, endIndex, characterOptions);\n                    this.setSingleRange(range, direction);\n                }\n            ),\n\n            saveCharacterRanges: createEntryPointFunction(\n                function(session, containerNode, characterOptions) {\n                    var ranges = this.getAllRanges(), rangeCount = ranges.length;\n                    var rangeInfos = [];\n\n                    var backward = rangeCount == 1 && this.isBackward();\n\n                    for (var i = 0, len = ranges.length; i < len; ++i) {\n                        rangeInfos[i] = {\n                            characterRange: ranges[i].toCharacterRange(containerNode, characterOptions),\n                            backward: backward,\n                            characterOptions: characterOptions\n                        };\n                    }\n\n                    return rangeInfos;\n                }\n            ),\n\n            restoreCharacterRanges: createEntryPointFunction(\n                function(session, containerNode, saved) {\n                    this.removeAllRanges();\n                    for (var i = 0, len = saved.length, range, rangeInfo, characterRange; i < len; ++i) {\n                        rangeInfo = saved[i];\n                        characterRange = rangeInfo.characterRange;\n                        range = api.createRange(containerNode);\n                        range.selectCharacters(containerNode, characterRange.start, characterRange.end, rangeInfo.characterOptions);\n                        this.addRange(range, rangeInfo.backward);\n                    }\n                }\n            ),\n\n            text: createEntryPointFunction(\n                function(session, characterOptions) {\n                    var rangeTexts = [];\n                    for (var i = 0, len = this.rangeCount; i < len; ++i) {\n                        rangeTexts[i] = this.getRangeAt(i).text(characterOptions);\n                    }\n                    return rangeTexts.join(\"\");\n                }\n            )\n        });\n\n        /*----------------------------------------------------------------------------------------------------------------*/\n\n        // Extensions to the core rangy object\n\n        api.innerText = function(el, characterOptions) {\n            var range = api.createRange(el);\n            range.selectNodeContents(el);\n            var text = range.text(characterOptions);\n            return text;\n        };\n\n        api.createWordIterator = function(startNode, startOffset, iteratorOptions) {\n            var session = getSession();\n            iteratorOptions = createNestedOptions(iteratorOptions, defaultWordIteratorOptions);\n            var startPos = session.getPosition(startNode, startOffset);\n            var tokenizedTextProvider = createTokenizedTextProvider(startPos, iteratorOptions.characterOptions, iteratorOptions.wordOptions);\n            var backward = isDirectionBackward(iteratorOptions.direction);\n\n            return {\n                next: function() {\n                    return backward ? tokenizedTextProvider.previousStartToken() : tokenizedTextProvider.nextEndToken();\n                },\n\n                dispose: function() {\n                    tokenizedTextProvider.dispose();\n                    this.next = function() {};\n                }\n            };\n        };\n\n        /*----------------------------------------------------------------------------------------------------------------*/\n\n        api.noMutation = function(func) {\n            var session = getSession();\n            func(session);\n            endSession();\n        };\n\n        api.noMutation.createEntryPointFunction = createEntryPointFunction;\n\n        api.textRange = {\n            isBlockNode: isBlockNode,\n            isCollapsedWhitespaceNode: isCollapsedWhitespaceNode,\n\n            createPosition: createEntryPointFunction(\n                function(session, node, offset) {\n                    return session.getPosition(node, offset);\n                }\n            )\n        };\n    });\n    \n    return rangy;\n})(this.rangy);\n};\nWEBSPELLCHECKER.rangy();\n(function(global){var _$ = window[\"$\"], _jquip = window[\"jquip\"];\n/*jshint sub:true, regexdash:true, laxbreak: true, expr: true*/\r\nwindow['$'] = window['jquip'] = (function(){\r\n  var win = window,\r\n      queryShimCdn = \"http://cdnjs.cloudflare.com/ajax/libs/sizzle/1.4.4/sizzle.min.js\",\r\n      queryEngines = function(){ return win[\"Sizzle\"] || win[\"qwery\"]; },\r\n      doc = document, docEl = doc.documentElement,\r\n      scriptFns=[], load=[], sLoaded,\r\n      runtil = /Until$/, rmultiselector = /,/,\r\n      rparentsprev = /^(?:parents|prevUntil|prevAll)/,\r\n      rtagname = /<([\\w:]+)/,\r\n      rclass = /[\\n\\t\\r]/g,\r\n      rtagSelector = /^[\\w-]+$/,\r\n      ridSelector = /^#[\\w-]+$/,\r\n      rclassSelector = /^\\.[\\w-]+$/,\r\n      rspace = /\\s+/,\r\n      rdigit = /\\d/,\r\n      rnotwhite = /\\S/,\r\n      rReturn = /\\r\\n/g,\r\n      rsingleTag = /^<(\\w+)\\s*\\/?>(?:<\\/\\1>)?$/,\r\n      rCRLF = /\\r?\\n/g,\r\n      rselectTextarea = /^(?:select|textarea)/i,\r\n      rinput = /^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,\r\n      strim = String.prototype.trim, trim,\r\n      trimLeft = /^\\s+/,\r\n      trimRight = /\\s+$/,\r\n      contains, sortOrder,\r\n      guaranteedUnique = { children: true, contents: true, next: true, prev: true },\r\n      toString = Object.prototype.toString,\r\n      class2type = {},\r\n      hasDup = false, baseHasDup = true,\r\n      wrapMap = {\r\n        option: [1, \"<select multiple='multiple'>\", \"</select>\"],\r\n        legend: [1, \"<fieldset>\", \"</fieldset>\"],\r\n        thead: [1, \"<table>\", \"</table>\"],\r\n        tr: [2, \"<table><tbody>\", \"</tbody></table>\"],\r\n        td: [3, \"<table><tbody><tr>\", \"</tr></tbody></table>\"],\r\n        col: [2, \"<table><tbody></tbody><colgroup>\", \"</colgroup></table>\"],\r\n        area: [1, \"<map>\", \"</map>\"],\r\n        _default: [0, \"\", \"\"] },\r\n      breaker = {},\r\n      ArrayProto = Array.prototype, ObjProto = Object.prototype,\r\n      hasOwn = ObjProto.hasOwnProperty,\r\n      slice = ArrayProto.slice,\r\n      push = ArrayProto.push,\r\n      indexOf = ArrayProto.indexOf,\r\n      nativeForEach = ArrayProto.forEach,\r\n      nativeFilter = ArrayProto.filter,\r\n      nativeIndexOf = ArrayProto.indexOf,\r\n      expando = 'jq-' + (+new Date()),\r\n      fosterNode = doc.createElement('p');\r\n\r\n  if (rnotwhite.test(\"\\xA0\")){\r\n    trimLeft = /^[\\s\\xA0]+/;\r\n    trimRight = /[\\s\\xA0]+$/;\r\n  }\r\n\r\n  /**\r\n   * @constructor\r\n   * @param {Object|Element|string|Array.<string>} sel\r\n   * @param {Object=} ctx\r\n   */\r\n  function J(sel, ctx){\r\n    var ret;\r\n    for(var i = 0, l = ctors.length; i < l; i++)\r\n      if (ctors[i].apply(this, arguments)) return this;\r\n\r\n    if (!sel) return this;\r\n    if (isF(sel)){\r\n      if (sLoaded) sel();\r\n      else scriptFns.push(sel);\r\n      return this;\r\n    } else if (isA(sel)) return this['make'](sel);\r\n    if (sel.nodeType || isWin(sel)) return this['make']([sel]);\r\n    if (sel == \"body\" && !ctx && doc.body) {\r\n      this['context'] = sel['context'];\r\n      this[0] = doc.body;\r\n      this.length = 1;\r\n      this['selector'] = sel;\r\n      return this;\r\n    }\r\n    if (sel['selector'] !== undefined) {\r\n      this['context'] = sel['context'];\r\n      this['selector'] = sel['selector'];\r\n      return this['make'](sel);\r\n    }\r\n    sel = isS(sel) && sel.charAt(0) === \"<\"\r\n      ? (ret = rsingleTag.exec(sel))\r\n        ? [doc.createElement(ret[1])]\r\n        : htmlFrag(sel).childNodes\r\n      : $$((this['selector'] = sel), ctx);\r\n\r\n    this['make'](sel);\r\n    if (isPlainObj(ctx)) this['attr'](ctx);\r\n    return this;\r\n  }\r\n\r\n  var ctors=[], plugins={}, jquid=1, _cache={_id:0}, _display = {}, p;\r\n  function $(sel, ctx){\r\n    return new J(sel, ctx);\r\n  }\r\n\r\n  p = J.prototype = $.prototype = $['fn'] = {\r\n    constructor: $,\r\n    'selector': \"\",\r\n    'length': 0,\r\n    dm: function(args, tbl, cb){\r\n      var value = args[0], parent, frag, first, l, i;\r\n      if (value){\r\n        if (this[0]) {\r\n          if (!(frag = (value.nodeType === 1 || value.nodeType === 3) && value)){\r\n            parent = value && value.parentNode;\r\n            frag = parent && parent.nodeType === 11 && parent.childNodes.length === this.length\r\n              ? parent\r\n              : htmlFrag(value);\r\n            first = frag.firstChild;\r\n            if (frag.childNodes.length === 1) frag = first;\r\n            if (!first) return this;\r\n          }\r\n          for (i=0, l=this.length; i<l; i++)\r\n\t\t\tcb.call(this[i],(i == 0 ? frag : frag.cloneNode(true)));\r\n        }\r\n      }\r\n      return this;\r\n    },\r\n    /**\r\n     * @param {Object} els\r\n     * @param {string=} name\r\n     * @param {string=} selector\r\n     * */\r\n    ps: function(els, name, selector){\r\n      var ret = this.constructor();\r\n      if (isA(els)) push.apply(ret, els);\r\n      else merge(ret, els);\r\n      ret.prevObject = this;\r\n      ret.context = this.context;\r\n      if (name === \"find\")\r\n        ret.selector = this['selector'] + (this['selector'] ? \" \" : \"\") + selector;\r\n      else if (name)\r\n        ret.selector = this['selector'] + \".\" + name + \"(\" + selector + \")\";\r\n      return ret;\r\n    }\r\n  };\r\n\r\n  p['make'] = function(els){\r\n    make(this, els);\r\n    return this;\r\n  };\r\n  p['toArray'] = function() {\r\n    return slice.call(this, 0);\r\n  };\r\n  p['get'] = function(num){\r\n    return isDefined(num)\r\n      ? (num < 0 ? this[this.length + num] : this[num])\r\n      : this['toArray']();\r\n  };\r\n  p['add'] = function(sel, ctx){\r\n    var set = typeof sel == \"string\"\r\n      ? $(sel, ctx)\r\n      : makeArray(sel && sel.nodeType ? [sel] : sel),\r\n      all = merge(this.get(), set);\r\n    return this.ps(detached(set[0]) || detached(all[0]) ? all : unique(all));\r\n  };\r\n  function detached(el) {\r\n    return !el || !el.parentNode || el.parentNode.nodeType == 11;\r\n  }\r\n  p['each'] = function(fn){\r\n      if (!isF(fn)) return this;\r\n      for(var i = 0, l = this.length; i < l; i++)\r\n        if ( fn.call(this[i], i, this[i]) === false )\r\n          break;\r\n      return this;\r\n  };\r\n  p['attr'] = function(name, val){\r\n    var el = this[0];\r\n    return (isS(name) && val === undefined)\r\n          ? attr(el, name)\r\n      : this['each'](function(idx){\r\n        var nt = this.nodeType;\r\n        if (nt !== 3 && nt !== 8 && nt !== 2){\r\n          if (isO(name)) for(var k in name)\r\n            if (val === null)\r\n              this.removeAttribute(name);\r\n            else\r\n              this.setAttribute(k, name[k]);\r\n          else this.setAttribute(name, isF(val) ? val.call(this, idx, this.getAttribute(name)) : val);\r\n      }\r\n    });\r\n  };\r\n  p['removeAttr'] = function(name){\r\n    return this['each'](function(){\r\n      if (this.nodeType == 1) this.removeAttribute(name);\r\n    });\r\n  };\r\n  p['data'] = function(name, setVal){\r\n    return  (setVal === undefined)\r\n            ? data(this[0], name)\r\n            : this['each'](function(){\r\n        data(this, name, setVal);\r\n      });\r\n  };\r\n  p['append'] = function(){\r\n    return this.dm(arguments, true, function(el){\r\n      if (this.nodeType === 1)\r\n        this.appendChild(el);\r\n    });\r\n  };\r\n  p['prepend'] = function(){\r\n    return this.dm(arguments, true, function(el){\r\n      if (this.nodeType === 1)\r\n        this.insertBefore(el, this.firstChild);\r\n    });\r\n  };\r\n  p['before'] = function(){\r\n    if (this[0] && this[0].parentNode) {\r\n      return this.dm(arguments, false, function(el){\r\n        this.parentNode.insertBefore(el, this);\r\n      });\r\n    }\r\n    return this;\r\n  };\r\n  p['after'] = function(){\r\n    if (this[0] && this[0].parentNode){\r\n      return this.dm(arguments, false, function(el){\r\n        this.parentNode.insertBefore(el, this.nextSibling);\r\n      });\r\n    }\r\n    return this;\r\n  };\r\n  p['replaceWith'] = function(val){\r\n    var self = this, isFunc = isF(val);\r\n    return this['each'](function(i) {\r\n        var next = this.nextSibling,\r\n            parent = this.parentNode,\r\n            value = isFunc ? val.call(this, i, this) : val;\r\n        if (parent && parent.nodeType != 11) {\r\n            parent.removeChild(this);\r\n            (next ? $(next).before(value) : $(parent).append(value));\r\n        } else { // detached\r\n            self[i] = $(value).clone()[0];\r\n        }\r\n      });\r\n  };\r\n  p['hide'] = function(){\r\n    return this['each'](function(){\r\n      if (this.style.display == \"none\") return;\r\n      cache(this, \"display\", this.style.display);\r\n      this.style.display = \"none\";\r\n    });\r\n  };\r\n  p['show'] = function(){\r\n    return this['each'](function(){\r\n      this.style.display = cache(this, \"display\") || display(this.tagName);\r\n    });\r\n  };\r\n  p['toggle'] = function(){\r\n    return this['each'](function(){\r\n      var el = $(this);\r\n      $['Expr']['hidden'](this) ? el.show() : el.hide();\r\n    });\r\n  };\r\n  p['eq'] = function(i){\r\n    return i === -1 ? this.slice(i) : this.slice(i, +i + 1);\r\n  };\r\n  p['first'] = function(){\r\n    return this['eq'](0);\r\n  };\r\n  p['last'] = function(){\r\n    return this['eq'](-1);\r\n  };\r\n  p['slice'] = function(){\r\n    return this.ps(slice.apply(this, arguments),\r\n      \"slice\", slice.call(arguments).join(\",\"));\r\n  };\r\n  p['map'] = function(cb) {\r\n    return this.ps(map(this, function(el, i) {\r\n      return cb.call(el, i, el);\r\n    }));\r\n  };\r\n  p['find'] = function(sel){\r\n    var self = this, i, l;\r\n    if (!isS(sel)){\r\n      return $(sel).filter(function(){\r\n        for(i = 0, l = self.length; i < l; i++)\r\n          if (contains(self[i], this)) return true;\r\n      });\r\n    }\r\n    var ret = this.ps(\"\", \"find\", sel), len, n, r;\r\n    for(i=0, l=this.length; i<l; i++){\r\n      len = ret.length;\r\n      merge(ret, $(sel, this[i]));\r\n      if (i === 0){\r\n        for(n = len; n < ret.length; n++)\r\n          for(r = 0; r < len; r++)\r\n            if (ret[r] === ret[n]){\r\n              ret.splice(n--, 1);\r\n              break;\r\n            }\r\n      }\r\n    }\r\n    return ret;\r\n  };\r\n  p['not'] = function(sel){\r\n    return this.ps(winnow(this, sel, false), \"not\", sel);\r\n  };\r\n  p['filter'] = function(sel){\r\n    return this.ps(winnow(this, sel, true), \"filter\", sel);\r\n  };\r\n  p['indexOf'] = function(val){\r\n    return _indexOf(this, val);\r\n  };\r\n  p['is'] = function(sel){\r\n    return this.length > 0 && $(this[0]).filter(sel).length > 0;\r\n  };\r\n  p['remove'] = function(){\r\n    for(var i = 0, el; isDefined(el = this[i]); i++) {\r\n      if (el.parentNode) el.parentNode.removeChild(el);\r\n    }\r\n    return this;\r\n  };\r\n  p['closest'] = function(sel, ctx) {\r\n    var ret=[], i, l, cur;\r\n    for (i=0, l=this.length; i<l; i++){\r\n      cur = this[i];\r\n      while (cur){\r\n        if (filter(sel, [cur]).length>0){\r\n          ret.push(cur);\r\n          break;\r\n        }else{\r\n          cur = cur.parentNode;\r\n          if (!cur || !cur.ownerDocument || cur === ctx|| cur.nodeType === 11)\r\n            break;\r\n        }\r\n      }\r\n    }\r\n    ret = ret.length > 1 ? unique(ret) : ret;\r\n    return this.ps(ret, \"closest\", sel);\r\n  };\r\n  p['val'] = function(setVal){\r\n    if (!isDefined(setVal)) return (this[0] && this[0].value) || \"\";\r\n    return this['each'](function(){\r\n      this.value = setVal;\r\n    });\r\n  };\r\n  p['html'] = function(setHtml){\r\n    if (!isDefined(setHtml)) return (this[0] && this[0].innerHTML) || \"\";\r\n    if (!isS(setHtml))\r\n      return this.empty().append(setHtml);\r\n    return this['each'](function(){\r\n      this.innerHTML = setHtml;\r\n    });\r\n  };\r\n  p['text'] = function(val){\r\n    var el = this[0], nt;\r\n    return isDefined(val)\r\n      ? this['empty']()['append']((el && el.ownerDocument || doc).createTextNode(val))\r\n      : (el && (nt = el.nodeType)\r\n        ? ((nt === 1 || nt === 9)\r\n          ? (isS(el.textContent) ? el.textContent : el.innerText.replace(rReturn, ''))\r\n          : (nt === 3 || nt === 4) ? el.nodeValue : null)\r\n        : null);\r\n  };\r\n  p['empty'] = function(){\r\n    var i, el;\r\n    for(i = 0; isDefined(el = this[i]); i++)\r\n      while (el.firstChild)\r\n        el.removeChild(el.firstChild);\r\n    return this;\r\n  };\r\n  p['addClass'] = function(val){\r\n    var cls, i, l, el, setClass, c, cl;\r\n    if (isF(val))\r\n      return this['each'](function(j){\r\n        $(this)['addClass'](val.call(this, j, this.className));\r\n      });\r\n    if (val && isS(val)){\r\n      cls = val.split(rspace);\r\n      for(i = 0, l = this.length; i < l; i++){\r\n        el = this[i];\r\n        if (el && el.nodeType === 1){\r\n          if (!el.className && cls.length === 1)\r\n            el.className = val;\r\n          else {\r\n            setClass = \" \" + el.className + \" \";\r\n            for(c = 0, cl = cls.length; c < cl; c++){\r\n              if (!~setClass.indexOf(\" \" + cls[c] + \" \"))\r\n                setClass += cls[c] + \" \";\r\n            }\r\n            el.className = trim(setClass);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return this;\r\n  };\r\n  p['removeClass'] = function(val){\r\n    var clss, i, l, el, cls, c, cl;\r\n    if (isF(val)) return this['each'](function(j){\r\n      $(this)['removeClass'](val.call(this, j, this.className));\r\n    });\r\n    if ((val && isS(val)) || val === undefined){\r\n      clss = (val || \"\").split(rspace);\r\n      for(i = 0, l = this.length; i < l; i++){\r\n        el = this[i];\r\n        if (el.nodeType === 1 && el.className){\r\n          if (val){\r\n            cls = (\" \" + el.className + \" \").replace(rclass, \" \");\r\n            for(c = 0, cl = clss.length; c < cl; c++)\r\n              cls = cls.replace(\" \" + clss[c] + \" \", \" \");\r\n            el.className = trim(cls);\r\n          }\r\n          else el.className = \"\";\r\n        }\r\n      }\r\n    }\r\n    return this;\r\n  };\r\n  p['hasClass'] = function(sel){\r\n    return hasClass(this, sel);\r\n  };\r\n  p['fadeIn'] = function(){\r\n    this['each'](function(){\r\n      $(this)['show']();\r\n    });\r\n  };\r\n  p['fadeOut'] = function(){\r\n    this['each'](function(){\r\n      $(this)['hide']();\r\n    });\r\n  };\r\n  p['serializeArray'] = function() {\r\n    return this['map'](function(){\r\n      return this.elements ? makeArray(this.elements) : this;\r\n    }).filter(function(){\r\n      return this.name && !this.disabled &&\r\n        (this.checked || rselectTextarea.test(this.nodeName) || rinput.test(this.type));\r\n    }).map(function(i, el){\r\n      var val = $(this)['val']();\r\n      return val == null || isA(val)\r\n        ? map(val, function(val){\r\n          return { name: el.name, value: val.replace(rCRLF, \"\\r\\n\") };\r\n                  })\r\n        : { name: el.name, value: val.replace(rCRLF, \"\\r\\n\") };\r\n    }).get();\r\n  };\r\n  p['wrap'] = function(wrapper) {\r\n    return this['each'](function() {\r\n      var wrapperClone = $($(wrapper)[0].cloneNode(false));\r\n      $(this).before(wrapperClone);\r\n      wrapperClone.append($(this));\r\n    });\r\n  };\r\n  p['prop'] = function(name, setVal) {\r\n    if (isDefined(setVal))\r\n      return this.each(function() { this[name] = setVal; });\r\n    return this[0] && this[0][name];\r\n  };\r\n  p['clone'] = function() {\r\n    return $(this.map(function() { return this.cloneNode(true); }));\r\n  };\r\n  p['toggleClass'] = function(className, val) {\r\n    return this['each'](function() {\r\n      var el = $(this);\r\n      (isDefined(val) ? val : !el.hasClass(className))\r\n        ? el.addClass(className) : el.removeClass(className);\r\n    });\r\n  };\r\n\r\n  $['Expr'] = {\r\n    'hidden': function(el){\r\n      return ($[\"css\"] && $[\"css\"](el,\"display\") || el.style.display) === \"none\";\r\n    },\r\n    'visible': function(el) {\r\n      return !$['Expr']['hidden'](el);\r\n    }\r\n  };\r\n\r\n  function winnow(els, sel, keep){\r\n    sel = sel || 0;\r\n    if (isF(sel))\r\n      return grep(els, function(el, i){\r\n        return !!sel.call(el, i, el) === keep;\r\n      });\r\n    else if (sel.nodeType)\r\n      return grep(els, function(el){\r\n        return (el === sel) === keep;\r\n      });\r\n    else if (isS(sel)) {\r\n      var expr = sel.charAt(0) == \":\" && $['Expr'][sel.substring(1)];\r\n      return grep(els, function(el) {\r\n        var parentNode = el.parentNode,\r\n            orphan = !parentNode,\r\n            result;\r\n        if (orphan) {\r\n          parentNode = fosterNode;\r\n          parentNode.appendChild(el);\r\n        }\r\n        result = expr\r\n          ? expr(el)\r\n          : el.parentNode && _indexOf($$(sel, el.parentNode), el) >= 0;\r\n        orphan && parentNode.removeChild(el);\r\n        return result;\r\n      });\r\n    }\r\n    return grep(els, function(el) {\r\n      return (_indexOf(sel, el) >= 0) === keep;\r\n    });\r\n  }\r\n  function cache(el, name, val)\r\n  {\r\n    var id = el[expando];\r\n    if (!isDefined(val))\r\n      return id && _cache[id] && (name ? _cache[id][name] : _cache[id]);\r\n\r\n    if (!id) id = el[expando] = jquid++;\r\n    return (_cache[id] || (_cache[id]={}))[name] = val;\r\n  }\r\n  function display(tag) {\r\n    if (!_display[tag]) {\r\n      var el = $(\"<\" + tag + \">\")['appendTo'](doc.body),\r\n        d = ($['css'] && $['css'](el[0], \"display\")) || el[0].style.display;\r\n      el.remove();\r\n      _display[tag] = d;\r\n    }\r\n    return _display[tag];\r\n  }\r\n  function make(arr, els){\r\n    arr.length = (els && els.length || 0);\r\n    if (arr.length === 0) return arr;\r\n    for(var i = 0, l = els.length; i < l; i++)\r\n      arr[i] = els[i];\r\n    return arr;\r\n  }\r\n  function hasClass(els, cls){\r\n    cls = \" \" + cls + \" \";\r\n    for(var i = 0, l = els.length; i < l; i++)\r\n      if (eqClass(els[i], cls))\r\n        return true;\r\n    return false;\r\n  } $['hasClass'] = hasClass;\r\n  function eqClass(el, cls){\r\n    return el.nodeType === 1 && (\" \" + el.className + \" \").replace(rclass, \" \").indexOf(cls) > -1;\r\n  }\r\n  function walk(fn, ctx, ret){\r\n    ctx = ctx || doc;\r\n    ret = ret || [];\r\n    if (ctx.nodeType == 1)\r\n      if (fn(ctx)) ret.push(ctx);\r\n    var els = ctx.childNodes;\r\n    for(var i = 0, l = els.length; i < l; i++){\r\n      var subEl = els[i];\r\n      if (subEl.nodeType == 1)\r\n        walk(fn, subEl, ret);\r\n    }\r\n    return ret;\r\n  } $['walk'] = walk;\r\n\r\n  /**\r\n   * @param {string} html\r\n   * @param {Object=} ctx\r\n   * @param {Object=} qry\r\n   * */\r\n  function $$(sel, ctx, qry){\r\n    if (sel && isS(sel)){\r\n      if (ctx instanceof $) ctx = ctx[0];\r\n      ctx = ctx || doc;\r\n      qry = qry || $['query'];\r\n      var el, rest = sel.substring(1);\r\n      return ridSelector.test(sel) && ctx === doc\r\n        ? ((el = doc.getElementById(rest)) ? [el] : [])\r\n        : makeArray(\r\n          rclassSelector.test(sel) && ctx.getElementsByClassName\r\n            ? ctx.getElementsByClassName(rest)\r\n            : rtagSelector.test(sel)\r\n              ? ctx.getElementsByTagName(sel)\r\n              : qry(sel, ctx));\r\n    }\r\n    return sel.nodeType == 1 || sel.nodeType == 9 ? [sel] : [];\r\n  } $['$$'] = $$;\r\n\r\n  $['setQuery'] = function(qry){\r\n    $['query'] = function(sel, ctx){\r\n      return $$(sel, ctx, (qry || function(sel, ctx){ return ctx.querySelectorAll(sel); }));\r\n    };\r\n  };\r\n\r\n  var useQuery = queryEngines();\r\n  $['setQuery'](useQuery || function(sel, ctx){\r\n    return (ctx = ctx || doc).querySelectorAll ? makeArray(ctx.querySelectorAll(sel)) : [];\r\n  });\r\n\r\n  function loadScript(url, cb, async){\r\n    var h = doc.head || doc.getElementsByTagName('head')[0] || docEl,\r\n      s = doc.createElement('script'), rs;\r\n    if (async) s.async = \"async\";\r\n      s.onreadystatechange = function () {\r\n        if (!(rs = s.readyState) || rs == \"loaded\" || rs == \"complete\"){\r\n          s.onload = s.onreadystatechange = null;\r\n          if (h && s.parentNode)\r\n              h.removeChild(s);\r\n          s = undefined;\r\n          if (cb) cb();\r\n        }\r\n      };\r\n    s.onload = cb;\r\n    s.src = url;\r\n    h.insertBefore(s, h.firstChild);\r\n  } $['loadScript'] = loadScript;\r\n\r\n  /** @param {...string} var_args */\r\n  function warn(var_args){ win.console && win.console.warn(arguments); }\r\n\r\n  $['each'] = function(o, cb, args){\r\n    var k, i = 0, l = o.length, isObj = l === undefined || isF(o);\r\n    if (args){\r\n      if (isObj) {\r\n        for(k in o)\r\n          if (cb.apply(o[k], args) === false) break;\r\n      } else\r\n        for(; i < l;)\r\n          if (cb.apply(o[i++], args) === false) break;\r\n    } else {\r\n      if (isObj) {\r\n        for(k in o)\r\n          if (cb.call(o[k], k, o[k]) === false) break;\r\n      }\r\n      else\r\n        for(; i < l;)\r\n          if (cb.call(o[i], i, o[i++]) === false) break;\r\n    }\r\n    return o;\r\n  };\r\n  function _each(o, fn, ctx){\r\n    if (o == null) return;\r\n    if (nativeForEach && o.forEach === nativeForEach)\r\n      o.forEach(fn, ctx);\r\n    else if (o.length === +o.length){\r\n      for(var i = 0, l = o.length; i < l; i++)\r\n        if (i in o && fn.call(ctx, o[i], i, o) === breaker) return;\r\n    } else {\r\n      for(var key in o)\r\n        if (hasOwn.call(o, key))\r\n          if (fn.call(ctx, o[key], key, o) === breaker) return;\r\n    }\r\n  } $['_each'] = _each;\r\n  function attr(el, name) {\r\n    if (!el || !el.getAttribute || !name) return; // text nodes or comment nodes don't have attributes\r\n    var ret = el.hasAttribute && el.hasAttribute(name) ? el.getAttribute(name) : el[name];\r\n    return (ret === null ? undefined : ret); // el.getAttribute inconsistently return null for non-defined attributes\r\n  }\r\n  function filter(sel, els) {\r\n    return isDefined(sel) ? $(els).filter(sel) : $(els);\r\n  } $['filter'] = filter;\r\n  function _indexOf(arr, val){\r\n    if (arr == null) return -1;\r\n    var i, l;\r\n    if (nativeIndexOf && arr.indexOf === nativeIndexOf) return arr.indexOf(val);\r\n    for(i = 0, l = arr.length; i < l; i++) if (arr[i] === val) return i;\r\n    return -1;\r\n  } $['_indexOf'] = _indexOf;\r\n  $['_defaults'] = function(obj){\r\n    _each(slice.call(arguments, 1), function(o){\r\n      for(var k in o)\r\n        if (obj[k] == null) obj[k] = o[k];\r\n    });\r\n    return obj;\r\n  };\r\n  function _filter(o, fn, ctx){\r\n    var ret = [];\r\n    if (o == null) return ret;\r\n    if (nativeFilter && o.filter === nativeFilter) return o.filter(fn, ctx);\r\n    _each(o, function(val, i, arr){\r\n      if (fn.call(ctx, val, i, arr)) ret[ret.length] = val;\r\n    });\r\n    return ret;\r\n  } $['_filter'] = _filter;\r\n  $['proxy'] = function(fn, ctx){\r\n    if (typeof ctx == \"string\"){\r\n      var tmp = fn[ctx];\r\n      ctx = fn;\r\n      fn = tmp;\r\n    }\r\n    if (isF(fn)){\r\n      var args = slice.call(arguments, 2),\r\n        proxy = function(){\r\n          return fn.apply(ctx, args.concat(slice.call(arguments))); };\r\n      proxy.guid = fn.guid = fn.guid || proxy.guid || jquid++;\r\n      return proxy;\r\n    }\r\n  };\r\n  function dir(el, prop, until){\r\n    var matched = [], cur = el[prop];\r\n    while (cur && cur.nodeType !== 9 && (until === undefined || cur.nodeType !== 1 || !$(cur).is(until))){\r\n      if (cur.nodeType === 1) matched.push(cur);\r\n      cur = cur[prop];\r\n    }\r\n    return matched;\r\n  } $['dir'] = dir;\r\n  function nth(cur, res, dir){\r\n    res = res || 1;\r\n    var num = 0;\r\n    for(; cur; cur = cur[dir])\r\n      if (cur.nodeType === 1 && ++num === res) break;\r\n    return cur;\r\n  } $['nth'] = nth;\r\n  function sibling(n, el){\r\n    var r = [];\r\n    for(; n; n = n.nextSibling) if (n.nodeType === 1 && n !== el) r.push(n);\r\n    return r;\r\n  } $['sibling'] = sibling;\r\n\r\n  function grep(els, cb, inv){\r\n    var ret = [], retVal;\r\n    inv = !!inv;\r\n    for(var i=0, l=els.length; i<l; i++){\r\n      retVal = !!cb(els[i], i);\r\n      if (inv !== retVal)\r\n        ret.push(els[i]);\r\n    }\r\n    return ret;\r\n  } $['grep'] = grep;\r\n  /**\r\n   * @param {Object} els\r\n   * @param {function} cb\r\n   * @param {Object=} arg\r\n   * */\r\n  function map(els, cb, arg){\r\n    var value, key, ret = [], i = 0, length = els.length,\r\n      isArray = els instanceof $\r\n        || typeof length == \"number\"\r\n        && ((length > 0 && els[0] && els[length - 1]) || length === 0 || isA(els));\r\n    if (isArray){\r\n      for(; i < length; i++){\r\n        value = cb(els[i], i, arg);\r\n        if (value != null)\r\n          ret[ret.length] = value;\r\n      }\r\n    } else {\r\n      for(key in els){\r\n        value = cb(els[key], key, arg);\r\n        if (value != null)\r\n          ret[ret.length] = value;\r\n      }\r\n    }\r\n    return ret.concat.apply([], ret);\r\n  } $['map'] = map;\r\n  function data(el, name, setVal){\r\n    if (!el) return {};\r\n    var res = cache(el, name, setVal);\r\n    return res || attrs(el)['data-' + name];\r\n  } $['data'] = data;\r\n  function attrs(el){\r\n    var o = {};\r\n    if (el.nodeType == 1)\r\n      for(var i = 0, elAttrs = el.attributes, len = elAttrs.length; i < len; i++)\r\n        o[elAttrs.item(i).nodeName] = elAttrs.item(i).nodeValue;\r\n    return o;\r\n  } $['attrs'] = attrs;\r\n  function eqSI(str1, str2){\r\n    return !str1 || !str2 ? str1 == str2 : str1.toLowerCase() === str2.toLowerCase();\r\n  } $['eqSI'] = eqSI;\r\n trim = strim\r\n  ? function(text){ return text == null ? \"\" : strim.call(text); }\r\n  : function(text){ return text == null ? \"\" : text.toString().replace(trimLeft, \"\").replace(trimRight, \"\"); };\r\n  $['trim'] = trim;\r\n  $['indexOf'] = $['inArray'] = function(el, arr){\r\n    if (!arr) return -1;\r\n    if (indexOf) return indexOf.call(arr, el);\r\n    for(var i = 0, length = arr.length; i < length; i++)\r\n      if (arr[i] === el)\r\n        return i;\r\n    return -1;\r\n  };\r\n  _each(\"Boolean Number String Function Array Date RegExp Object\".split(\" \"), function(name){\r\n    class2type[\"[object \" + name + \"]\"] = name.toLowerCase();\r\n    return this;\r\n  });\r\n\r\n  function typeOf(o){ return o == null ? String(o) : class2type[toString.call(o)] || \"object\"; } $['type'] = typeOf;\r\n  function isDefined(o){ return o !== void 0; }\r\n  function isS(o){ return typeof o == \"string\"; }\r\n  function isO(o){ return typeof o == \"object\"; }\r\n  function isF(o){ return typeof o == \"function\" || typeOf(o) === \"function\"; } $['isFunction'] = isF;\r\n  function isA(o){ return typeOf(o) === \"array\"; } $['isArray'] = Array.isArray || isA;\r\n  function isAL(o){ return !isS(o) && typeof o.length == 'number'; }\r\n  function isWin(o){ return o && typeof o == \"object\" && \"setInterval\" in o; } $['isWindow'] = isWin;\r\n  function isNan(obj){ return obj == null || !rdigit.test(obj) || isNaN(obj); } $['isNaN'] = isNan;\r\n  function isPlainObj(o){\r\n    if (!o || typeOf(o) !== \"object\" || o.nodeType || isWin(o)) return false;\r\n    try{\r\n      if (o.constructor && !hasOwn.call(o, \"constructor\") && !hasOwn.call(o.constructor.prototype, \"isPrototypeOf\"))\r\n        return false;\r\n    }catch(e){\r\n      return false;\r\n    }\r\n    var key;\r\n    for(key in o){}\r\n    return key === undefined || hasOwn.call(o, key);\r\n  }\r\n  function merge(a1, a2){\r\n    var i = a1.length, j = 0;\r\n    if (typeof a2.length == \"number\")\r\n      for(var l = a2.length; j < l; j++)\r\n        a1[i++] = a2[j];\r\n    else\r\n      while (a2[j] !== undefined)\r\n        a1[i++] = a2[j++];\r\n    a1.length = i;\r\n    return a1;\r\n  } $['merge'] = merge;\r\n  function extend(){\r\n    var opt, name, src, copy, copyIsArr, clone, args = arguments,\r\n      dst = args[0] || {}, i = 1, aLen = args.length, deep = false;\r\n    if (typeof dst == \"boolean\"){ deep = dst; dst = args[1] || {}; i = 2; }\r\n    if (typeof dst != \"object\" && !isF(dst)) dst = {};\r\n    if (aLen === i){ dst = this; --i; }\r\n    for(; i < aLen; i++){\r\n      if ((opt = args[i]) != null){\r\n        for(name in opt){\r\n          src = dst[name];\r\n          copy = opt[name];\r\n          if (dst === copy) continue;\r\n          if (deep && copy && (isPlainObj(copy) || (copyIsArr = isA(copy)))){\r\n            if (copyIsArr){\r\n              copyIsArr = false;\r\n              clone = src && isA(src) ? src : [];\r\n            } else\r\n              clone = src && isPlainObj(src) ? src : {};\r\n            dst[name] = extend(deep, clone, copy);\r\n          } else if (copy !== undefined)\r\n            dst[name] = copy;\r\n        }\r\n      }\r\n    }\r\n    return dst;\r\n  } $['extend'] = $['fn']['extend'] = extend;\r\n  function makeArray(arr, res){\r\n    var ret = res || [];\r\n    if (arr != null){\r\n      var type = typeOf(arr);\r\n      if (arr.length == null || type == \"string\" || type == \"function\" || type === \"regexp\" || isWin(arr))\r\n        push.call(ret, arr);\r\n      else\r\n        merge(ret, arr);\r\n    }\r\n    return ret;\r\n  } $['makeArray'] = makeArray;\r\n  /**\r\n   * @param {string} html\r\n   * @param {Object=} ctx\r\n   * @param {Object=} frag\r\n   * */\r\n  function htmlFrag(html, ctx, frag){\r\n    ctx = ((ctx || doc) || ctx.ownerDocument || ctx[0] && ctx[0].ownerDocument || doc);\r\n    frag = frag || ctx.createDocumentFragment();\r\n    if (isAL(html))\r\n      return clean(html, ctx, frag) && frag;\r\n    var div = fragDiv(html);\r\n    while (div.firstChild)\r\n      frag.appendChild(div.firstChild);\r\n    return frag;\r\n  } $['htmlFrag'] = htmlFrag;\r\n  /**\r\n   * @param {string} html\r\n   * @param {Object=} ctx\r\n   * */\r\n  function fragDiv(html, ctx){\r\n    var div = (ctx||doc).createElement('div'),\r\n      tag = (rtagname.exec(html) || [\"\", \"\"])[1].toLowerCase(),\r\n      wrap = wrapMap[tag] || wrapMap._default,\r\n      depth = wrap[0];\r\n    div.innerHTML = wrap[1] + html + wrap[2];\r\n    while (depth--)\r\n      div = div.lastChild;\r\n    return div;\r\n  }\r\n  function clean(els, ctx, frag){\r\n    var ret=[],i,el;\r\n    for (i=0; (el=els[i])!=null; i++){\r\n      if (isS(el))\r\n        el = fragDiv(el, ctx);\r\n      if (el.nodeType)\r\n        ret.push(el);\r\n      else\r\n        ret = merge(ret, el);\r\n    }\r\n    if (frag)\r\n      for (i=0; i<ret.length; i++)\r\n        if (ret[i].nodeType)\r\n          frag.appendChild(ret[i]);\r\n    return ret;\r\n  }\r\n  var sibChk = function(a, b, ret){\r\n    if (a === b) return ret;\r\n    var cur = a.nextSibling;\r\n    while (cur){\r\n      if (cur === b) return -1;\r\n      cur = cur.nextSibling;\r\n    }\r\n    return 1;\r\n  };\r\n  contains = $['contains'] = docEl.contains\r\n    ? function(a, b){\r\n      return a !== b && (a.contains ? a.contains(b) : true); }\r\n    : function(){ return false; };\r\n  sortOrder = docEl.compareDocumentPosition\r\n    ? (contains = function(a, b){ return !!(a.compareDocumentPosition(b) & 16); }) //assigning contains\r\n      && function(a, b){\r\n      if (a === b){ hasDup = true; return 0; }\r\n      if (!a.compareDocumentPosition || !b.compareDocumentPosition)\r\n        return a.compareDocumentPosition ? -1 : 1;\r\n      return a.compareDocumentPosition(b) & 4 ? -1 : 1;\r\n      }\r\n    : function(a, b){\r\n      if (a === b){ hasDup = true; return 0; }\r\n      else if (a.sourceIndex && b.sourceIndex) return a.sourceIndex - b.sourceIndex;\r\n      var al, bl, ap = [], bp = [], aup = a.parentNode, bup = b.parentNode, cur = aup;\r\n      if (aup === bup) return sibChk(a, b);\r\n      else if (!aup) return -1;\r\n      else if (!bup) return 1;\r\n      while (cur){ ap.unshift(cur); cur = cur.parentNode; }\r\n      cur = bup;\r\n      while (cur){ bp.unshift(cur); cur = cur.parentNode; }\r\n      al = ap.length;\r\n      bl = bp.length;\r\n      for(var i = 0; i < al && i < bl; i++)\r\n        if (ap[i] !== bp[i]) return sibChk(ap[i], bp[i]);\r\n      return i === al ? sibChk(a, bp[i], -1) : sibChk(ap[i], b, 1);\r\n     };\r\n  function unique(els){\r\n    if (sortOrder){\r\n      hasDup = baseHasDup;\r\n      els.sort(sortOrder);\r\n      if (hasDup)\r\n        for(var i = 1; i < els.length; i++)\r\n          if (els[i] === els[i - 1]) els.splice(i--, 1);\r\n    }\r\n    return els;\r\n  } $['unique'] = unique;\r\n  _each({\r\n    'parent': function(el){ var parent = el.parentNode; return parent && parent.nodeType !== 11 ? parent : null; },\r\n    'parents': function(el){ return dir(el, \"parentNode\"); },\r\n    'parentsUntil': function(el, i, until){ return dir(el, \"parentNode\", until); },\r\n    'next': function(el){ return nth(el, 2, \"nextSibling\"); },\r\n    'prev': function(el){ return nth(el, 2, \"previousSibling\"); },\r\n    'nextAll': function(el){ return dir(el, \"nextSibling\"); },\r\n    'prevAll': function(el){ return dir(el, \"previousSibling\"); },\r\n    'nextUntil': function(el, i, until){ return dir(el, \"nextSibling\", until); },\r\n    'prevUntil': function(el, i, until){ return dir(el, \"previousSibling\", until); },\r\n    'siblings': function(el){ return sibling(el['parentNode']['firstChild'], el); },\r\n    'children': function(el){ return sibling(el['firstChild']); },\r\n    'contents': function(el){\r\n      return el['nodeName'] === \"iframe\" ? el['contentDocument'] || el['contentWindow']['document '] : makeArray(el['childNodes']);\r\n    }\r\n  }, function(fn, name){\r\n    $['fn'][name] = function(until, sel){\r\n      var ret = map(this, fn, until), args = slice.call(arguments);\r\n      if (!runtil.test(name)) sel = until;\r\n      if (isS(sel)) ret = makeArray(filter(sel, ret));\r\n\r\n      ret = this.length > 1 && !guaranteedUnique[name] ? unique(ret) : ret;\r\n      if ((this.length > 1 || rmultiselector.test(sel)) && rparentsprev.test(name)) ret = ret.reverse();\r\n      return this.ps(ret, name, args.join(\",\"));\r\n    };\r\n  });\r\n  _each({\r\n    'appendTo': \"append\",\r\n    'prependTo': \"prepend\",\r\n    'insertBefore': \"before\",\r\n    'insertAfter': \"after\"\r\n  }, function(orig, name) {\r\n    $['fn'][name] = function(sel){\r\n      var ret = [], to = $(sel), i, els, l,\r\n        p = this.length === 1 && this[0].parentNode;\r\n      if (p && p.nodeType === 11 && p.childNodes.length === 1 && to.length === 1) {\r\n        to[orig](this[0]);\r\n        return this;\r\n      }else{\r\n        for(i=0, l=to.length; i<l; i++){\r\n          els = (i > 0 ? this.clone(true) : this).get();\r\n          $(to[i])[orig](els);\r\n          ret = ret.concat(els);\r\n        }\r\n        return this.ps(ret, name, to['selector']);\r\n      }\r\n    };\r\n  });\r\n\r\n  function boxmodel(){\r\n    if (!doc.body) return null; //in HEAD\r\n    var d = doc.createElement('div');\r\n    doc.body.appendChild(d);\r\n    d.style.width = '20px';\r\n    d.style.padding = '10px';\r\n    var w = d.offsetWidth;\r\n    doc.body.removeChild(d);\r\n    return w == 40;\r\n  }\r\n\r\n  (function(){\r\n    var div = document.createElement(\"div\");\r\n    div.style.display = \"none\";\r\n    div.innerHTML = \"   <link/><table></table><a href='/a' style='color:red;float:left;opacity:.55;'>a</a><input type='checkbox'/>\";\r\n    var a = div.getElementsByTagName(\"a\")[0];\r\n    $['support'] = {\r\n      boxModel: null,\r\n      opacity: /^0.55$/.test(a.style.opacity),\r\n      cssFloat: !!a.style.cssFloat\r\n    };\r\n\r\n    var rwebkit = /(webkit)[ \\/]([\\w.]+)/,\r\n      ropera = /(opera)(?:.*version)?[ \\/]([\\w.]+)/,\r\n      rmsie = /(msie) ([\\w.]+)/,\r\n      rmozilla = /(mozilla)(?:.*? rv:([\\w.]+))?/,\r\n      ua = navigator.userAgent.toLowerCase(),\r\n      match = rwebkit.exec(ua)\r\n         || ropera.exec( ua )\r\n         || rmsie.exec( ua )\r\n         || ua.indexOf(\"compatible\") < 0 && rmozilla.exec( ua ) || [],\r\n      b;\r\n    b = $['browser'] = { version: match[2] || \"0\" };\r\n    b[match[1] || \"\"] = true;\r\n  })();\r\n  $['scriptsLoaded'] = function(cb) {\r\n    if (isF(cb)) scriptFns.push(cb);\r\n  };\r\n  function loadAsync(url, cb){\r\n    load.push({url:url,cb:cb});\r\n  } $['loadAsync'] = loadAsync;\r\n\r\n  if (!useQuery && !doc.querySelectorAll)\r\n    loadAsync(queryShimCdn, function(){\r\n      $['setQuery'](queryEngines());\r\n    });\r\n\r\n  function fireSL(){\r\n    _each(scriptFns, function(cb){\r\n      cb();\r\n    });\r\n    sLoaded = true;\r\n  }\r\n\r\n  $['init'] = false;\r\n  $['onload'] = function(){\r\n    if (!$['init'])\r\n    try {\r\n      $['support']['boxModel'] = boxmodel();\r\n      var cbs = 0;\r\n      _each(load, function(o){\r\n        cbs++;\r\n        loadScript(o.url, function(){\r\n          try { if (o.cb) o.cb(); } catch(e){}\r\n          if (!--cbs)fireSL();\r\n        });\r\n      });\r\n      $['init'] = true;\r\n      if (!cbs)fireSL();\r\n    } catch(e){\r\n      warn(e);\r\n    }\r\n  };\r\n  if (doc['body'] && !$['init'])\r\n    setTimeout($['onload'],1); //let plugins loadAsync\r\n\r\n  $['hook'] = function(fn){\r\n    ctors.push(fn);\r\n  };\r\n  $['plug'] = function(meta, fn){\r\n    var name = isS(meta) ? meta : meta['name'];\r\n    fn = isF(meta) ? meta : fn;\r\n    if (!isF(fn)) throw \"Plugin fn required\";\r\n    if (name && fn) plugins[name] = fn;\r\n    fn($);\r\n  };\r\n\r\n  return $;\r\n})();\r\n;$['plug'](\"ajax\", function ($) {\r\n  var xhrs = [\r\n           function () { return new XMLHttpRequest(); },\r\n           function () { return new ActiveXObject(\"Microsoft.XMLHTTP\"); },\r\n           function () { return new ActiveXObject(\"MSXML2.XMLHTTP.3.0\"); },\r\n           function () { return new ActiveXObject(\"MSXML2.XMLHTTP\"); }\r\n      ],\r\n      _xhrf = null;\r\n\r\n  function _xhr() {\r\n    if (_xhrf != null) return _xhrf();\r\n    for (var i = 0, l = xhrs.length; i < l; i++) {\r\n      try {\r\n        var f = xhrs[i], req = f();\r\n        if (req != null) {\r\n          _xhrf = f;\r\n          return req;\r\n        }\r\n      } catch (e){}\r\n    }\r\n    return function () { };\r\n  } $['xhr'] = _xhr;\r\n\r\n  function _xhrResp(xhr, dataType) {\r\n    dataType = (dataType || xhr.getResponseHeader(\"Content-Type\").split(\";\")[0]).toLowerCase();\r\n    if (dataType.indexOf(\"json\") >= 0){\r\n      var j = false;\r\n      if(window.JSON){\r\n        j = window.JSON['parse'](xhr.responseText);\r\n      }else{\r\n        j = eval(xhr.responseText);\r\n      }\r\n      return j;\r\n    }\r\n    if (dataType.indexOf(\"script\") >= 0)\r\n      return eval(xhr.responseText);\r\n    if (dataType.indexOf(\"xml\") >= 0)\r\n      return xhr.responseXML;\r\n    return xhr.responseText;\r\n  } $['_xhrResp'] = _xhrResp;\r\n\r\n  $['formData'] = function formData(o) {\r\n    var kvps = [], regEx = /%20/g;\r\n    for (var k in o) kvps.push(encodeURIComponent(k).replace(regEx, \"+\") + \"=\" + encodeURIComponent(o[k].toString()).replace(regEx, \"+\"));\r\n    return kvps.join('&');\r\n  };\r\n\r\n  $['each'](\"ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend\".split(\" \"), function(i,o){\r\n    $['fn'][o] = function(f){\r\n      return this['bind'](o, f);\r\n    };\r\n  });\r\n\r\n  function ajax(url, o) {\r\n      var xhr = _xhr(), timer, n = 0;\r\n      if (typeof url === \"object\") o = url;\r\n      else o['url'] = url;\r\n      o = $['_defaults'](o, { 'userAgent': \"XMLHttpRequest\", 'lang': \"en\", 'type': \"GET\", 'data': null, 'contentType': \"application/x-www-form-urlencoded\", 'dataType': null, 'processData': true, 'headers': {\"X-Requested-With\": \"XMLHttpRequest\" }, 'cache': true });\r\n      if (o.timeout) timer = setTimeout(function () { xhr.abort(); if (o.timeoutFn) o.timeoutFn(o.url); }, o.timeout);\r\n      var cbCtx = $(o['context'] || document), evtCtx = cbCtx;\r\n      xhr.onreadystatechange = function() {\r\n          if (xhr.readyState == 4){\r\n              if (timer) clearTimeout(timer);\r\n              if (xhr.status < 300){\r\n                  var res, decode = true, dt = o.dataType || \"\";\r\n                  try{\r\n                      res = _xhrResp(xhr, dt, o);\r\n                  }catch(e){\r\n                      decode = false;\r\n                      if (o.error)\r\n                      o.error(xhr, xhr.status, xhr.statusText);\r\n                  evtCtx['trigger'](cbCtx, \"ajaxError\", [xhr, xhr.statusText, o]);\r\n                  }\r\n                  if (o['success'] && decode && (dt.indexOf('json')>=0 || !!res))\r\n                      o['success'](res);\r\n                  evtCtx['trigger'](cbCtx,\"ajaxSuccess\", [xhr, res, o]);\r\n\r\n              }\r\n              else {\r\n                  if (o.error)\r\n                      o.error(xhr, xhr.status, xhr.statusText);\r\n                  evtCtx['trigger'](cbCtx, \"ajaxError\", [xhr, xhr.statusText, o]);\r\n              }\r\n              if (o['complete'])\r\n                  o['complete'](xhr, xhr.statusText);\r\n              evtCtx['trigger'](cbCtx, \"ajaxComplete\", [xhr, o]);\r\n          }\r\n          else if (o['progress']) o['progress'](++n);\r\n      };\r\n      var url = o['url'], data = null;\r\n      var cache = o['cache']==true;\r\n      var isPost = o['type'] == \"POST\" || o['type'] == \"PUT\";\r\n      if( o['data'] && o['processData'] && typeof o['data'] == 'object' )\r\n          data = $['formData'](o['data']);\r\n\r\n      if (!isPost && data) {\r\n          url += \"?\" + data;\r\n          data = null;\r\n          if(!cache)\r\n            url=url+\"&_=\"+(new Date().getTime());\r\n      }else(!isPost && !cache)\r\n          url=url+\"?_=\"+(new Date().getTime());\r\n      cache=null;\r\n      xhr.open(o['type'], url);\r\n\r\n      try {\r\n          for (var i in o.headers)\r\n              xhr.setRequestHeader(i, o.headers[i]);\r\n      } catch(_) { console.log(_) }\r\n\r\n      if (isPost) {\r\n          if(o['contentType'].indexOf('json')>=0)\r\n              data = o['data'];\r\n          xhr.setRequestHeader(\"Content-Type\", o['contentType']);\r\n      }\r\n\r\n      xhr.send(data);\r\n  } $['ajax'] = ajax;\r\n\r\n  $['getJSON'] = function (url, data, success, error) {\r\n    if ($['isFunction'](data)){\r\n      error = success;\r\n      success = data;\r\n      data = null;\r\n    }\r\n    ajax({'url': url, 'data': data, 'success': success, 'dataType': 'json'});\r\n  };\r\n\r\n  $['get'] = function (url, data, success, dataType) {\r\n    if ($['isFunction'](data)) {\r\n      dataType = success;\r\n      success = data;\r\n      data = null;\r\n    }\r\n    ajax({'url': url, 'type': \"GET\", 'data': data, 'success': success, 'dataType': dataType || \"text/plain\"});\r\n  };\r\n\r\n  $['post'] = function (url, data, success, dataType) {\r\n    if ($['isFunction'](data)) {\r\n      dataType = success;\r\n      success = data;\r\n      data = null;\r\n    }\r\n    ajax({'url': url, 'type': \"POST\", 'data': data, 'success': success, 'dataType': dataType || \"text/plain\"});\r\n  };\r\n\r\n  $['getScript'] = function (url, success) {\r\n    return $['get'](url, undefined, success, \"script\");\r\n  };\r\n\r\n  if (!window.JSON)\r\n    $['loadAsync'](\"http://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js\");\r\n});\r\n;$['plug'](\"css\", function ($) {\r\n  var doc = document,\r\n      docEl = doc.documentElement,\r\n      ralpha = /alpha\\([^)]*\\)/i,\r\n      ropacity = /opacity=([^)]*)/,\r\n      rdashAlpha = /-([a-z])/ig,\r\n      rupper = /([A-Z])/g,\r\n      rnumpx = /^-?\\d+(?:px)?$/i,\r\n      rnum = /^-?\\d/,\r\n      rroot = /^(?:body|html)$/i,\r\n      cssShow = { position: \"absolute\", visibility: \"hidden\", display: \"block\" },\r\n      cssWidth = [ \"Left\", \"Right\" ],\r\n      cssHeight = [ \"Top\", \"Bottom\" ],\r\n      curCSS,\r\n      getComputedStyle,\r\n      currentStyle,\r\n      fcamelCase = function (all, l) { return l.toUpperCase(); };\r\n\r\n  $['cssHooks'] = {\r\n    'opacity': {\r\n      'get': function (el, comp) {\r\n        if (!comp) return el.style.opacity;\r\n        var ret = curCSS(el, \"opacity\", \"opacity\");\r\n        return ret === \"\" ? \"1\" : ret;\r\n      }\r\n    }\r\n  };\r\n\r\n  $['_each']([\"height\", \"width\"], function(k) {\r\n    $['cssHooks'][k] = {\r\n      get: function(el, comp, extra) {\r\n        var val;\r\n        if (comp) {\r\n          if (el.offsetWidth !== 0)\r\n            return getWH(el, k, extra);\r\n\r\n          swap(el, cssShow, function() {\r\n            val = getWH( el, k, extra );\r\n          });\r\n          return val;\r\n        }\r\n      },\r\n      set: function(el, val) {\r\n        if (rnumpx.test(val)) {\r\n          val = parseFloat( val );\r\n\r\n          if (val >= 0)\r\n            return val + \"px\";\r\n        } else\r\n          return val;\r\n      }\r\n    };\r\n  });\r\n\r\n  function getWH(el, name, extra) {\r\n    var val = name === \"width\" ? el.offsetWidth : el.offsetHeight,\r\n      which = name === \"width\" ? cssWidth : cssHeight;\r\n    if (val > 0) {\r\n      if (extra !== \"border\") {\r\n        $['each']( which, function() {\r\n          if ( !extra )\r\n            val -= parseFloat(css(el, \"padding\" + this) ) || 0;\r\n          if ( extra === \"margin\" )\r\n            val += parseFloat(css(el, extra + this) ) || 0;\r\n          else\r\n            val -= parseFloat(css(el, \"border\" + this + \"Width\") ) || 0;\r\n        });\r\n      }\r\n      return val + \"px\";\r\n    }\r\n    return \"\";\r\n  }\r\n\r\n  if (!$['support']['opacity']) {\r\n    $['support']['opacity'] = {\r\n          get: function (el, computed) {\r\n              return ropacity.test((computed && el.currentStyle ? el.currentStyle.filter : el.style.filter) || \"\")\r\n                  ? (parseFloat(RegExp.$1) / 100) + \"\"\r\n                  : computed ? \"1\" : \"\";\r\n          },\r\n          set: function (el, value) {\r\n              var s = el.style;\r\n              s.zoom = 1;\r\n              var opacity = $['isNaN'](value) ? \"\" : \"alpha(opacity=\" + value * 100 + \")\", filter = s.filter || \"\";\r\n              s.filter = ralpha.test(filter) ?\r\n        filter.replace(ralpha, opacity) :\r\n        s.filter + ' ' + opacity;\r\n          }\r\n      };\r\n  }\r\n\r\n  if (doc.defaultView && doc.defaultView.getComputedStyle) {\r\n    getComputedStyle = function (el, newName, name) {\r\n      var ret, defaultView, computedStyle;\r\n      name = name.replace(rupper, \"-$1\").toLowerCase();\r\n      if (!(defaultView = el.ownerDocument.defaultView)) return undefined;\r\n      if ((computedStyle = defaultView.getComputedStyle(el, null))) {\r\n        ret = computedStyle.getPropertyValue(name);\r\n        if (ret === \"\" && !$['contains'](el.ownerDocument.documentElement, el))\r\n          ret = $['style'](el, name);\r\n      }\r\n      return ret;\r\n    };\r\n  }\r\n\r\n  if (doc.documentElement.currentStyle) {\r\n      currentStyle = function (el, name) {\r\n          var left,\r\n          ret = el.currentStyle && el.currentStyle[name],\r\n          rsLeft = el.runtimeStyle && el.runtimeStyle[name],\r\n          style = el.style;\r\n          if (!rnumpx.test(ret) && rnum.test(ret)) {\r\n              left = style.left;\r\n              if (rsLeft) el.runtimeStyle.left = el.currentStyle.left;\r\n              style.left = name === \"fontSize\" ? \"1em\" : (ret || 0);\r\n              ret = style.pixelLeft + \"px\";\r\n              style.left = left;\r\n              if (rsLeft) el.runtimeStyle.left = rsLeft;\r\n          }\r\n          return ret === \"\" ? \"auto\" : ret;\r\n      };\r\n  }\r\n  curCSS = getComputedStyle || currentStyle;\r\n\r\n  $['fn']['css'] = function (name, value) {\r\n      if (arguments.length === 2 && value === undefined) return this;\r\n\r\n      return access(this, name, value, true, function (el, name, value) {\r\n          return value !== undefined ? style(el, name, value) : css(el, name);\r\n      });\r\n  };\r\n  $['cssNumber'] = { \"zIndex\": true, \"fontWeight\": true, \"opacity\": true, \"zoom\": true, \"lineHeight\": true };\r\n  $['cssProps'] = { \"float\": $['support']['cssFloat'] ? \"cssFloat\" : \"styleFloat\" };\r\n  function style(el, name, value, extra) {\r\n      if (!el || el.nodeType === 3 || el.nodeType === 8 || !el.style) return;\r\n      var ret, origName = camelCase(name), style = el.style, hooks = $['cssHooks'][origName];\r\n      name = $['cssProps'][origName] || origName;\r\n      if (value !== undefined) {\r\n          if (typeof value === \"number\" && isNaN(value) || value == null) return;\r\n          if (typeof value === \"number\" && !$['cssNumber'][origName]) value += \"px\";\r\n          if (!hooks || !(\"set\" in hooks) || (value = hooks.set(el, value)) !== undefined) {\r\n              try {\r\n                  style[name] = value;\r\n              } catch (e) { }\r\n          }\r\n      } else {\r\n          if (hooks && \"get\" in hooks && (ret = hooks.get(el, false, extra)) !== undefined)\r\n              return ret;\r\n          return style[name];\r\n      }\r\n  } $['style'] = style;\r\n\r\n  function css(el, name, extra) {\r\n      var ret, origName = camelCase(name), hooks = $['cssHooks'][origName];\r\n      name = $['cssProps'][origName] || origName;\r\n      if (hooks && \"get\" in hooks && (ret = hooks.get(el, true, extra)) !== undefined) return ret;\r\n      else if (curCSS) return curCSS(el, name, origName);\r\n  }$['css'] = css;\r\n\r\n  function swap(el, opt, cb) {\r\n      var old = {},k;\r\n      for (var k in opt) {\r\n          old[k] = el.style[k];\r\n          el.style[k] = opt[k];\r\n      }\r\n      cb.call(el);\r\n      for (k in opt) el.style[k] = old[k];\r\n  }$['swap'] = swap;\r\n\r\n  function camelCase(s) { return s.replace(rdashAlpha, fcamelCase); } $['camelCase'] = camelCase;\r\n\r\n  function access(els, key, value, exec, fn, pass) {\r\n      var l = els.length;\r\n      if (typeof key === \"object\") {\r\n          for (var k in key) {\r\n              access(els, k, key[k], exec, fn, value);\r\n          }\r\n          return els;\r\n      }\r\n      if (value !== undefined) {\r\n          exec = !pass && exec && $['isFunction'](value);\r\n          for (var i = 0; i < l; i++)\r\n              fn(els[i], key, exec ? value.call(els[i], i, fn(els[i], key)) : value, pass);\r\n          return els;\r\n      }\r\n      return l ? fn(els[0], key) : undefined;\r\n  }\r\n\r\n  var init, noMarginBodyOff, subBorderForOverflow, suppFixedPos, noAddBorder, noAddBorderForTables,\r\n      initialize = function() {\r\n        if (init) return;\r\n        var body = doc.body, c = doc.createElement(\"div\"), iDiv, cDiv , table, td, bodyMarginTop = parseFloat(css(body, \"marginTop\")) || 0,\r\n          html = \"<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>\";\r\n        $['extend'](c.style, { position: \"absolute\", top: 0, left: 0, margin: 0, border: 0, width: \"1px\", height: \"1px\", visibility: \"hidden\" });\r\n        c.innerHTML = html;\r\n        body.insertBefore(c, body.firstChild);\r\n        iDiv = c.firstChild;\r\n        cDiv = iDiv.firstChild;\r\n        td = iDiv.nextSibling.firstChild.firstChild;\r\n        noAddBorder = (cDiv .offsetTop !== 5);\r\n        noAddBorderForTables = (td.offsetTop === 5);\r\n        cDiv .style.position = \"fixed\";\r\n        cDiv .style.top = \"20px\";\r\n        suppFixedPos = (cDiv .offsetTop === 20 || cDiv .offsetTop === 15);\r\n        cDiv .style.position = cDiv .style.top = \"\";\r\n        iDiv.style.overflow = \"hidden\";\r\n        iDiv.style.position = \"relative\";\r\n        subBorderForOverflow = (cDiv .offsetTop === -5);\r\n        noMarginBodyOff = (body.offsetTop !== bodyMarginTop);\r\n        body.removeChild(c);\r\n        init = true;\r\n      },\r\n      bodyOffset = function(body){\r\n        var top = body.offsetTop, left = body.offsetLeft;\r\n        initialize();\r\n        if (noMarginBodyOff){\r\n          top  += parseFloat( css(body, \"marginTop\") ) || 0;\r\n          left += parseFloat( css(body, \"marginLeft\") ) || 0;\r\n        }\r\n        return { top: top, left: left };\r\n      };\r\n\r\n  $['fn']['offset'] = function(){\r\n    var el = this[0], box;\r\n    if (!el || !el.ownerDocument) return null;\r\n    if (el === el.ownerDocument.body) return bodyOffset(el);\r\n    try {\r\n      box = el.getBoundingClientRect();\r\n    } catch(e) {}\r\n    if (!box || !$['contains'](docEl, el))\r\n      return box ? { top: box.top, left: box.left } : { top: 0, left: 0 };\r\n    var body = doc.body,\r\n      win = getWin(doc),\r\n      clientTop  = docEl.clientTop  || body.clientTop  || 0,\r\n      clientLeft = docEl.clientLeft || body.clientLeft || 0,\r\n      scrollTop  = win['pageYOffset'] || $['support']['boxModel'] && docEl.scrollTop  || body.scrollTop,\r\n      scrollLeft = win['pageXOffset'] || $['support']['boxModel'] && docEl.scrollLeft || body.scrollLeft,\r\n      top  = box.top + scrollTop - clientTop,\r\n      left = box.left + scrollLeft - clientLeft;\r\n    return { top: top, left: left };\r\n  };\r\n\r\n  $['fn']['position'] = function() {\r\n    if (!this[0]) return null;\r\n    var el = this[0],\r\n    offPar = this['offsetParent'](),\r\n    off = this['offset'](),\r\n    parOff = rroot.test(offPar[0].nodeName) ? { top: 0, left: 0 } : offPar['offset']();\r\n    off.top -= parseFloat(css(el, \"marginTop\")) || 0;\r\n    off.left -= parseFloat(css(el, \"marginLeft\")) || 0;\r\n    parOff.top += parseFloat(css(offPar[0], \"borderTopWidth\")) || 0;\r\n    parOff.left += parseFloat(css(offPar[0], \"borderLeftWidth\")) || 0;\r\n    return { top: off.top - parOff.top, left: off.left - parOff.left };\r\n  };\r\n\r\n  $['fn']['offsetParent'] = function(){\r\n    return this['map'](function(){\r\n      var op = this.offsetParent || doc.body;\r\n      while (op && (!rroot.test(op.nodeName) && css(op,\"position\") === \"static\"))\r\n        op = op.offsetParent;\r\n      return op;\r\n    });\r\n  };\r\n\r\n  $['_each']([\"Height\", \"Width\"], function (name, i) {\r\n      var type = name.toLowerCase();\r\n      $['fn'][\"inner\" + name] = function () {\r\n          var el = this[0];\r\n          return el && el.style ? parseFloat(css(el, type, \"padding\")) : null;\r\n      };\r\n      $['fn'][\"outer\" + name] = function (margin) {\r\n          var el = this[0];\r\n          return el && el.style ? parseFloat(css(el, type, margin ? \"margin\" : \"border\")) : null;\r\n      };\r\n      $['fn'][type] = function (size) {\r\n          var el = this[0];\r\n          if (!el) return size == null ? null : this;\r\n          if ($['isFunction'](size))\r\n              return this['each'](function (i) {\r\n                  var self = $(this);\r\n                  self[type](size.call(this, i, self[type]()));\r\n              });\r\n          if ($['isWindow'](el)) {\r\n              var docElProp = el.document.documentElement[\"client\" + name], body = el.document.body;\r\n              return el.document.compatMode === \"CSS1Compat\" && docElProp || body && body[\"client\" + name] || docElProp;\r\n          } else if (el.nodeType === 9) {\r\n              return Math.max(\r\n            el.documentElement[\"client\" + name],\r\n            el.body[\"scroll\" + name], el.documentElement[\"scroll\" + name],\r\n            el.body[\"offset\" + name], el.documentElement[\"offset\" + name]);\r\n          } else if (size === undefined) {\r\n              var orig = css(el, type),\r\n                  ret = parseFloat(orig);\r\n              return $['isNaN'](ret) ? orig : ret;\r\n          }\r\n          else return this['css'](type, typeof size === \"string\" ? size : size + \"px\");\r\n      };\r\n  });\r\n\r\n  function getWin(el) { return $['isWindow'](el) ? el : el.nodeType === 9 ? el.defaultView || el.parentWindow : false; }\r\n\r\n  $['_each']([\"Left\", \"Top\"], function (name, i) {\r\n      var method = \"scroll\" + name;\r\n      $['fn'][method] = function (val) {\r\n          var el, win;\r\n          if (val === undefined) {\r\n              el = this[0];\r\n              if (!el) return null;\r\n              win = getWin(el);\r\n              return win ? (\"pageXOffset\" in win)\r\n                  ? win[i ? \"pageYOffset\" : \"pageXOffset\"]\r\n                  : $['support']['boxModel'] && win.document.documentElement[method] || win.document.body[method] : el[method];\r\n          }\r\n          return this['each'](function() {\r\n              win = getWin(this);\r\n              if (win)\r\n                  win['scrollTo'](!i ? val : $(win)['scrollLeft'](), i ? val : $(win)['scrollTop']());\r\n              else\r\n                  this[method] = val;\r\n          });\r\n      };\r\n  });\r\n\r\n});\r\n;$['plug'](\"custom\", function($){\r\n  var win=window, doc=document, qsMap = {}, \r\n      vars = win.location.search.substring(1).split(\"&\"),\r\n      Key = $['Key'] = function (keyCode) { this.keyCode = keyCode; };\r\n\r\n  for (var i = 0; i < vars.length; i++) {\r\n      var kvp = vars[i].split(\"=\");\r\n      qsMap[kvp[0]] = unescape(kvp[1]);\r\n  }\r\n\r\n  $['queryString'] = function (name) { return qsMap[name]; };\r\n\r\n  Key.namedKeys = {\r\n    Backspace: 8, Tab: 9, Enter: 13, Shift: 16, Ctrl: 17, Alt: 18, Pause: 19, Capslock: 20, Escape: 27, PageUp: 33, \r\n    PageDown: 34, End: 35, Home: 36, LeftArrow: 37, UpArrow: 38, RightArrow: 39, DownArrow: 40, Insert: 45, Delete: 46\r\n  };\r\n\r\n  $['_each'](Key.namedKeys, function (val, key) {\r\n    var keyCode = val;\r\n    Key.prototype['is' + key] = function () { return this.keyCode === keyCode; };\r\n  });\r\n\r\n  $.key = function (e) {\r\n    e = e || window.event;\r\n    return new Key(e.keyCode || e.which);\r\n  };\r\n\r\n  $['cancelEvent'] = function (e) {\r\n    if (!e) e = window.event;\r\n    e.cancelBubble = true;\r\n    e.returnValue = false;\r\n    if (e.stopPropagation) {\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n    }\r\n    return false;\r\n  };\r\n\r\n  $['templateSettings'] = {\r\n    evaluate    : /<%([\\s\\S]+?)%>/g,\r\n    interpolate : /<%=([\\s\\S]+?)%>/g,\r\n    escape      : /<%-([\\s\\S]+?)%>/g\r\n  };\r\n\r\n  $['_template'] = function(str, data) {\r\n      var c  = $['templateSettings'];\r\n      var tmpl = 'var __p=[],print=function(){__p.push.apply(__p,arguments);};' +\r\n        'with(obj||{}){__p.push(\\'' +\r\n        str.replace(/\\\\/g, '\\\\\\\\')\r\n           .replace(/'/g, \"\\\\'\")\r\n           .replace(c.escape, function(match, code) {\r\n             return \"',_.escape(\" + code.replace(/\\\\'/g, \"'\") + \"),'\";\r\n           })\r\n           .replace(c.interpolate, function(match, code) {\r\n             return \"',\" + code.replace(/\\\\'/g, \"'\") + \",'\";\r\n           })\r\n           .replace(c.evaluate || null, function(match, code) {\r\n             return \"');\" + code.replace(/\\\\'/g, \"'\")\r\n                                .replace(/[\\r\\n\\t]/g, ' ') + \";__p.push('\";\r\n           })\r\n           .replace(/\\r/g, '\\\\r')\r\n           .replace(/\\n/g, '\\\\n')\r\n           .replace(/\\t/g, '\\\\t')\r\n           + \"');}return __p.join('');\";\r\n      var func = new Function('obj', '$', tmpl);\r\n      return data ? func(data, $) : function(data) { return func(data, $) };\r\n  };\r\n});\r\n;$['plug'](\"docready\", function ($) {\r\n  var win = window,\r\n      doc = document,\r\n      DOMContentLoaded,\r\n      readyBound,\r\n      readyList = [],\r\n      isReady = false,\r\n      readyWait = 1;\r\n\r\n  $['hook'](function (sel, ctx) {\r\n      if (typeof sel == \"function\") {\r\n          this['ready'](sel);\r\n          return true;\r\n      }\r\n  });\r\n\r\n  function doScrollCheck() {\r\n    if (isReady) return;\r\n    try {\r\n      doc.documentElement.doScroll(\"left\");\r\n    } catch (e) {\r\n      setTimeout(doScrollCheck, 1);\r\n      return;\r\n    }\r\n    ready();\r\n  }\r\n\r\n  function ready(wait) {\r\n    if (wait === true) readyWait--;\r\n    if (!readyWait || (wait !== true && !isReady)) {\r\n      if (!doc.body) return setTimeout(ready, 1);\r\n      isReady = true;\r\n      if (wait !== true && --readyWait > 0) return;\r\n      if (readyList) {\r\n        var fn, i = 0, ready = readyList;\r\n        readyList = null;\r\n        while ((fn = ready[i++])) fn.call(doc, $);\r\n        if ($['fn']['trigger']) $(doc)['trigger'](\"ready\")['unbind'](\"ready\");\r\n      }\r\n    }\r\n  } $['ready'] = ready;\r\n\r\n  DOMContentLoaded = doc.addEventListener\r\n  ? function () {\r\n    doc.removeEventListener(\"DOMContentLoaded\", DOMContentLoaded, false);\r\n    ready(); }\r\n  : function () {\r\n    if (doc.readyState === \"complete\") {\r\n      doc.detachEvent(\"onreadystatechange\", DOMContentLoaded);\r\n      ready();\r\n    }\r\n  };\r\n\r\n  $['bindReady'] = function() {\r\n    if (readyBound) return;\r\n    readyBound = true;\r\n    if (doc.readyState === \"complete\") return setTimeout(ready, 1);\r\n\r\n    if (doc.addEventListener) {\r\n      doc.addEventListener(\"DOMContentLoaded\", DOMContentLoaded, false);\r\n      win.addEventListener(\"load\", ready, false);\r\n    } else if (doc.attachEvent) {\r\n      doc.attachEvent(\"onreadystatechange\", DOMContentLoaded);\r\n      win.attachEvent(\"onload\", ready);\r\n      var toplevel = false;\r\n      try { toplevel = window.frameElement == null; } catch (e) { }\r\n      if (doc.documentElement.doScroll && toplevel) doScrollCheck();\r\n    }\r\n  };\r\n\r\n  $['fn']['ready'] = function (fn) {\r\n    $['bindReady']();\r\n       if (isReady) fn.call(doc, $);\r\n       else if (readyList) readyList.push(fn);\r\n       return this;\r\n   };\r\n\r\n  if (!$['init']) $(document)['ready']($['onload']);\r\n});\r\n;$['plug'](\"events\", function($){\r\n   var doc = document, handlers = {}, _jquid = 1, _ieBindHandlers = {};\r\n  function jquid(el){\r\n    return el._jquid || (el._jquid = _jquid++);\r\n  }\r\n  function bind(o, type, fn){\r\n    if (o.addEventListener)\r\n      o.addEventListener(type, fn, false);\r\n    else {\r\n      _ieBindHandlers[type + fn] = function(){\r\n      fn(window.event);\r\n      };\r\n      o.attachEvent('on' + type, _ieBindHandlers[type + fn]);\r\n    }\r\n  } $['bind'] = bind;\r\n  function unbind(o, type, fn){\r\n    if (o.removeEventListener)\r\n      o.removeEventListener(type, fn, false);\r\n    else {\r\n      o.detachEvent('on' + type, _ieBindHandlers[type + fn]);\r\n      _ieBindHandlers[type + fn] = null;\r\n    }\r\n  } $['unbind'] = unbind;\r\n  function parseEvt(evt){\r\n    var parts = ('' + evt).split('.');\r\n    return {e: parts[0], ns: parts.slice(1).sort().join(' ')};\r\n  }\r\n  function matcherFor(ns){\r\n    return new RegExp('(?:^| )' + ns.replace(' ', ' .* ?') + '(?: |$)');\r\n  }\r\n  function findHdls(el, evt, fn, sel){\r\n    evt = parseEvt(evt);\r\n    if (evt.ns) var m = matcherFor(evt.ns);\r\n    return $['_filter'](handlers[jquid(el)] || [], function(hdl){\r\n      return hdl\r\n        && (!evt.e  || hdl.e == evt.e)\r\n        && (!evt.ns || m.test(hdl.ns))\r\n        && (!fn     || hdl.fn == fn)\r\n        && (!sel    || hdl.sel == sel);\r\n    });\r\n  }\r\n  function addEvt(el, evts, fn, sel, delegate){\r\n    var id = jquid(el), set = (handlers[id] || (handlers[id] = []));\r\n    $['_each'](evts.split(/\\s/), function(evt){\r\n      var handler = $['extend'](parseEvt(evt), {fn: fn, sel: sel, del: delegate, i: set.length});\r\n      set.push(handler);\r\n      bind(el, handler.e, delegate || fn);\r\n    });\r\n    el = null;\r\n  }\r\n  function remEvt(el, evts, fn, sel){\r\n    var id = jquid(el);\r\n    $['_each']((evts || '').split(/\\s/), function(evt){\r\n      $['_each'](findHdls(el, evt, fn, sel), function(hdl){\r\n        delete handlers[id][hdl.i];\r\n        unbind(el, hdl.e, hdl.del || hdl.fn);\r\n      });\r\n    });\r\n  }\r\n  var evtMethods = ['preventDefault', 'stopImmediatePropagation', 'stopPropagation'];\r\n  function createProxy(evt){\r\n    var proxy = $['extend']({originalEvent: evt}, evt);\r\n    $['_each'](evtMethods, function(key){\r\n      if(evt[key]){\r\n        proxy[key] = function(){\r\n          return evt[key].apply(evt, arguments);\r\n        };\r\n      }\r\n    });\r\n    return proxy;\r\n  }\r\n  var p = $['fn'];\r\n  $['_each']((\"blur focus focusin focusout load resize scroll unload click dblclick \" +\r\n    \"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave \" +\r\n    \"change select submit keydown keypress keyup error contextmenu\").split(\" \"),\r\n    function(name){\r\n      p[name] = function(fn, data){\r\n        return arguments.length > 0 ? this['bind'](name, fn, data) : this['trigger'](name);\r\n      };\r\n    }\r\n  );\r\n  p['bind'] = function(type, cb){\r\n    return this['each'](function(){\r\n      addEvt(this, type, cb);\r\n    });\r\n  };\r\n  p['unbind'] = function(type, cb){\r\n    return this['each'](function(){\r\n       remEvt(this, type, cb);\r\n    });\r\n  };\r\n  p['one'] = function(evt, cb){\r\n    return this['each'](function(){\r\n      var self = this;\r\n      addEvt(this, evt, function wrapper(){\r\n        cb.apply(self, arguments);\r\n        remEvt(self, evt, arguments.callee);\r\n      });\r\n    });\r\n  };\r\n  p['delegate'] = function(sel, evt, cb){\r\n    return this['each'](function(i, el){\r\n      addEvt(el, evt, cb, sel, function(e){\r\n        var target = e.target||e.srcElement, nodes = $['$$'](sel, el);\r\n        while (target && $['_indexOf'](nodes, target) < 0)\r\n          target = target.parentNode;\r\n        if (target && !(target === el) && !(target === document)){\r\n          cb.call(target, $['extend'](createProxy(e||window.event), {\r\n            currentTarget: target, liveFired: el\r\n          }));\r\n        }\r\n      });\r\n    });\r\n  };\r\n  p['undelegate'] = function(sel, evt, cb){\r\n    return this['each'](function(){\r\n       remEvt(this, evt, cb, sel);\r\n    });\r\n  };\r\n  p['live'] = function(evt, cb){\r\n    $(doc.body)['delegate'](this['selector'], evt, cb);\r\n    return this;\r\n  };\r\n  p['die'] = function(evt, cb){\r\n    $(doc.body)['undelegate'](this['selector'], evt, cb);\r\n    return this;\r\n  };\r\n\r\n  p['on'] = function(evt, sel, cb){\r\n    return typeof sel === 'function' ? this.bind(evt, sel) : this.delegate(sel, evt, cb);\r\n  };\r\n\r\n  p['off'] = function(evt, sel, cb){\r\n    return typeof sel === 'string' ? this.undelegate(sel, evt, cb) : this.unbind(evt, cb);\r\n  };\r\n    p['trigger'] = function (evt) {\r\n        return this['each'](function () {\r\n            if ((evt == \"click\") && this[evt])\r\n                return this[evt]();\r\n            if (doc.createEvent) {\r\n                var e = doc.createEvent('Events');\r\n                this.dispatchEvent(e, e.initEvent(evt, true, true));\r\n            } else if (this.fireEvent)\r\n                try {\r\n                    if (evt !== \"ready\") {\r\n                        this.fireEvent(\"on\" + evt);\r\n                    }\r\n                } catch (e) { }\r\n        });\r\n    };\r\n  if (!$['init']) $(window)['bind'](\"load\",$['onload']);\r\n});\r\n;\nglobal.jquip = window[\"jquip\"] || jquip;window[\"$\"] = _$;window[\"jquip\"]=_jquip})(WEBSPELLCHECKER);\nwindow.WEBSPELLCHECKER = window.WEBSPELLCHECKER || {};\r\n\r\n(function( Namespace ) {\r\n\tif(Namespace.CORE) { return; }\r\n\tvar\tCORE,\r\n\t\tOptionsManager = Namespace.OptionsManager,\r\n\t\toptionTypes = OptionsManager.optionTypes,\r\n\t\twebApiTemplate = OptionsManager.importOptionsTemplate('WebApiTemplate'),\r\n\t\tcoreOptionsTemplate,\r\n\t\toptionToStore,\r\n\t\tstoredValue,\r\n\t\toptions;\r\n\r\n\tOptionsManager.extendOptionTypes([\r\n\t\t{\r\n\t\t\tname: 'htmlContainer',\r\n\t\t\tvalidate: function(element) {\r\n\t\t\t\tvar unsupportedInputFieldTypes = ['email', 'password', 'submit', 'reset', 'radio', 'checkbox', 'button', 'color', 'date', 'datetime', 'datetime-local', 'month', 'number', 'range', 'tel', 'time', 'week', 'file', 'image', 'hidden'],\r\n\t\t\t\t\tunsuported = false;\r\n\r\n\t\t\t\tif(!element) { return false; }\r\n\t\t\t\tif (element.type) {\r\n\t\t\t\t\tunsuported = unsupportedInputFieldTypes.includes(element.type);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn element.nodeType && element.nodeType === 1 && !unsuported;\r\n\t\t\t}\r\n\t\t},{\r\n\t\t\tname: 'localization',\r\n\t\t\tvalidate: function(element) {\r\n\t\t\t\tvar localizationList = ['af', 'ar', 'bg', 'bn', 'bs', 'ca', 'cs', 'cy', 'da', 'de', 'el', 'en-us', 'en-au', 'en-ca', 'en-gb', 'en', 'eo', 'es', 'et', 'eu', 'fa', 'fi', 'fo', 'fr-ca', 'fr', 'gl', 'gu', 'he', 'hi', 'hr', 'hu', 'is', 'it', 'ja', 'ka', 'km', 'ko', 'lt', 'lv', 'mk', 'mn', 'ms', 'nb', 'nl', 'no', 'pl', 'pt-br', 'pt', 'ro', 'ru', 'sk', 'sl', 'sr-latn', 'sr', 'sv', 'th', 'tr', 'ug', 'uk','ku', 'vi', 'zh-cn', 'zh'];\r\n\t\t\t\treturn localizationList.includes(element);\r\n\t\t\t}\r\n\t\t},{\r\n\t\t\tname: 'proofreadOptions',\r\n\t\t\terroMessageTemplate: 'Your options list contains unaccepted option type.',\r\n\t\t\tvalidate: function(optionsList) {\r\n\t\t\t\tvar res = true;\r\n\t\t\t\tavalableOptions = ['ignoreAllCapsWords', 'ignoreDomainNames', 'ignoreWordsWithMixedCases', 'ignoreWordsWithNumbers'];\r\n\t\t\t\toptionsList.forEach(optionName => {\r\n\t\t\t\t\tif( avalableOptions.includes(optionName) === false ) {\r\n\t\t\t\t\t\tres = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t}\r\n\t]);\r\n\r\n\tcoreOptionsTemplate = {\r\n\t\tdebug: { defaultValue: false, type: optionTypes.boolean },\r\n\t\tfocused: { defaultValue: false, type: optionTypes.boolean },\r\n\t\tsuggestionsCount: { defaultValue: 3, type: optionTypes.positive },\r\n\t\tmoreSuggestionsCount: { defaultValue: 0, type: optionTypes.positive },\r\n\t\tlocalization: { defaultValue: 'en', type: optionTypes.string },\r\n\t\tlanguageNodeName: { defaultValue: 'span', type: optionTypes.string },// used for MLS. Defines language node name\r\n\t\tlanguageAttributeName: { defaultValue: 'lang', type: optionTypes.string }, // used for MLS. Defines language attribute name\r\n\t\tdata_attribute_name : { defaultValue: 'data-spelling-word', type: optionTypes.string},\r\n\t\tdata_attribute_name_backward: { defaultValue: 'data-scayt-word', type: optionTypes.defaultValue},\r\n\t\tdata_lang_attribute : { defaultValue: 'data-wsc-lang', type: optionTypes.string},\r\n\t\tmisspelled_word_class : { defaultValue: 'wsc-spelling-problem', type: optionTypes.string},\r\n\t\tinstance_class : { defaultValue: 'wsc-instance', type: optionTypes.string},\r\n\t\tiframe_quirks_class : { defaultValue: 'wsc-iframe-quirks', type: optionTypes.string},\r\n\t\tproblem_text_active : { defaultValue: 'problem-text--active', type: optionTypes.string},\r\n\t\tproblem_grammar_node: { defaultValue: 'span', type: optionTypes.string },\r\n\t\tmisspelled_word_node: { defaultValue: 'span', type: optionTypes.string },\r\n\t\tproblem_grammar_data_attribute : { defaultValue: 'data-grammar-phrase', type: optionTypes.string},\r\n\t\tproblem_grammar_data_attribute_backward: { defaultValue: 'data-grayt-phrase', type: optionTypes.defaultValue},\r\n\t\tproblem_grammar_data_attribute_rule : { defaultValue: 'data-grammar-rule', type: optionTypes.string},\r\n\t\tproblem_grammar_class : { defaultValue: 'wsc-grammar-problem', type: optionTypes.string},\r\n\t\tproblem_id_data_attribute: { defaultValue: 'data-problem-id', type: optionTypes.string},\r\n\t\toriginalContainer: { defaultValue: null, type: optionTypes.defaultValue },\r\n\t\tdocumentContainer: { defaultValue: null, type: optionTypes.defaultValue },\r\n\t\tfocusContainer: { defaultValue: null, type: optionTypes.defaultValue },\r\n\t\tcurrentDocument: { defaultValue: null, type: optionTypes.defaultValue },\r\n\t\tleftMouseButtonPressed: { defaultValue: false, type: optionTypes.defaultValue },\r\n\t\tdeleteKeyButtonPressed: { defaultValue: false, type: optionTypes.defaultValue },\r\n\t\tbackspaceKeyButtonPressed: { defaultValue: false, type: optionTypes.defaultValue },\r\n\t\tspaceKeyButtonPressed: { defaultValue: false, type: optionTypes.defaultValue },\r\n\t\tenterKeyButtonPressed: { defaultValue: false, type: optionTypes.defaultValue },\r\n\t\tisTextBasedContainer: { defaultValue: false, type: optionTypes.defaultValue },\r\n\t\tisTouchDevice: { defaultValue: false, type: optionTypes.defaultValue },\r\n\t\tisIframe: { defaultValue: false, type: optionTypes.defaultValue },\r\n\t\tfreeze: { defaultValue: false, type: optionTypes.defaultValue },\r\n\t\tbanner: { defaultValue: false, type: optionTypes.defaultValue },\r\n\t\tbannerInfo: { defaultValue: {\r\n\t\t\ttext: 'You are using the Trial version of WebSpellChecker Proofreader. Click Upgrade to get the Paid version now.',\r\n\t\t\tlinkHref: 'https://www.webspellchecker.net/signup/hosted-signup.html#webspellchecker-proofreader-paid',\r\n\t\t\tlinkText: 'Upgrade'\r\n\t\t}, type: optionTypes.defaultValue },\r\n\t\tsupportLocale: { defaultValue: true, type: optionTypes.defaultValue },\r\n\t\tisServiceHostDefault: { defaultValue: true, type: optionTypes.defaultValue},\r\n\t\tisMutationObserver: { defaultValue: ('MutationObserver' in window ? true : false), type: optionTypes.boolean},\r\n\t\tpaused: { defaultValue: false, type: optionTypes.defaultValue},\r\n\t\tappStarted: { defaultValue: false, type: optionTypes.defaultValue},\r\n\t\twordsLimit: { defaultValue: 5, type: optionTypes.defaultValue },\r\n\t\tmaxLength: { defaultValue: -1, type: optionTypes.defaultValue },\r\n\t\tnumberOfFailedRequest: { defaultValue: 0, type: optionTypes.defaultValue },\r\n\t\tspellCheckDelay: { defaultValue: 700, type: optionTypes.defaultValue },\r\n\t\tmainWSCdomain: { defaultValue: 'webspellchecker.net', type: optionTypes.defaultValue },\r\n\t\tuserDictionaryKey: { defaultValue: 'wsc_user_dictionary', type: optionTypes.defaultValue },\r\n\t\tuserDictionaryNameKey: { defaultValue: 'wsc_user_dictionary_name', type: optionTypes.defaultValue },\r\n\t\twscLogo: { defaultValue: 'css/logo.gif', type: optionTypes.defaultValue },\r\n\t\tcssPath: { defaultValue: 'css/wsc.css', type: optionTypes.defaultValue },\r\n\t\tproductName: { defaultValue: 'WebSpellChecker Proofreader', type: optionTypes.defaultValue },\r\n\t\twscVersion: { defaultValue: '1.4.3273', type: optionTypes.defaultValue },\r\n\t\twscSupportUrl: { defaultValue: 'http://www.webspellchecker.net/support', type: optionTypes.defaultValue },\r\n\t\tmoreLangUrl: { defaultValue: 'http://www.webspellchecker.net/additional-languages-support.html', type: optionTypes.defaultValue },\r\n\t\tECUserManual: { defaultValue: 'https://webspellchecker.net/user_manuals/webspellchecker_proofreader_for_editable_controls_user_manual.pdf', type: optionTypes.defaultValue },\r\n\t\tCKUserManual: { defaultValue: 'http://scayt.com/user_manual/scayt_plugin_for_ckeditor4_user_manual.pdf', type: optionTypes.defaultValue },\r\n\t\tuid: { defaultValue: '', type: optionTypes.defaultValue},\r\n\t\tmultiLanguageStyles: { defaultValue: {}, type: optionTypes.object },\r\n\t\tdetectLocalizationLanguage: { defaultValue: '', type: optionTypes.defaultValue },\r\n\t\tstyles: { defaultValue: '', type: optionTypes.defaultValue },\r\n\t\tlocalizationPath: { defaultValue: 'local/', type: optionTypes.defaultValue },\r\n\t\t// special characters that use the editors and that we have to handle\r\n\t\teventsBlockedState: { defaultValue: {}, type: optionTypes.defaultValue },// events blocked state storage\r\n\t\tspellingLangList: { defaultValue: {}, type: optionTypes.defaultValue },// defined with response from the server\r\n\t\tgrammarLangList: { defaultValue: {}, type: optionTypes.defaultValue },// defined with response from the server\r\n\t\tcdModificationTime: { defaultValue: 0, type: optionTypes.defaultValue },// defined with response from the server\r\n\t\tprogramVersion: { defaultValue: '', type: optionTypes.defaultValue },// defined with response from the server\r\n\t\tmodifierKeys: { // hardcoded as there is no appropriate command implemented yet for server request\r\n\t\t\tdefaultValue: {},\r\n\t\t\ttype: optionTypes.defaultValue\r\n\t\t},\r\n\t\tshortcutsList: { defaultValue: [], type: optionTypes.array },\r\n\t\tpermanentMinWordLength: { // hardcoded as there is no appropriate command implemented yet for server request\r\n\t\t\tdefaultValue: {// here are the languages list that has unchangeable minWordLength option\r\n\t\t\t\t'th_TH': 2,\r\n\t\t\t\t'ko_KR': 2\r\n\t\t\t},\r\n\t\t\ttype: optionTypes.defaultValue\r\n\t\t},\r\n\t\tlanguagesMap: { // hardcoded as there is no appropriate command implemented yet for server request\r\n\t\t\tdefaultValue: { // used for multilanguage support (MLS). Defines language codes associations between WCAG format and those we use in our app\r\n\t\t\t\t\"sw\": \"sw_TZ\", \"zu\": \"zu_ZA\", \"sq\": \"sq_AL\", \"ar\": \"ar_SA\", \"es\": \"es_ES\", \"de\": \"de_DE\", \"wa\": \"wa_BE\",\r\n\t\t\t\t\"qu\": \"qu_EC\", \"bg\": \"bg_BG\", \"hr\": \"hr_HR\", \"sr\": \"sr_LT\", \"cs\": \"cs_CZ\", \"ln\": \"ln_CD\", \"hy\": \"hy_AM\",\r\n\t\t\t\t\"en\": \"en_US\", \"et\": \"et_EE\", \"ti\": \"ti_ER\", \"om\": \"om_ET\", \"fo\": \"fo_FO\", \"fj\": \"fj_FJ\", \"sv\": \"sv_SE\",\r\n\t\t\t\t\"br\": \"br_FR\", \"gd\": \"gd_GB\", \"ht\": \"ht_HT\", \"he\": \"he_HE\", \"hi\": \"hi_IN\", \"hu\": \"hu_HU\", \"is\": \"is_IS\",\r\n\t\t\t\t\"as\": \"as_IN\", \"or\": \"or_IN\", \"id\": \"id_ID\", \"tet\": \"tet_ID\", \"fa\": \"fa_IR\", \"ga\": \"ga_IE\", \"gv\": \"gv_GB\",\r\n\t\t\t\t\"kk\": \"kk_KZ\", \"ky\": \"ky_KG\", \"lv\": \"lv_LV\", \"lt\": \"lt_LT\", \"lb\": \"lb_LU\", \"mi\": \"mi_NZ\", \"mg\": \"mg_MG\",\r\n\t\t\t\t\"ms\": \"ms_MY\", \"mn\": \"mn_MN\", \"ha\": \"ha_GH\", \"ur\": \"ur_PK\", \"tl\": \"tl_PH\", \"pl\": \"pl_PL\", \"csb\": \"csb_PL\",\r\n\t\t\t\t\"ro\": \"ro_RO\", \"ru\": \"ru_RU\", \"cv\": \"cv_RU\", \"rw\": \"rw_RW\", \"sk\": \"sk_SK\", \"sl\": \"sl_SI\", \"so\": \"so_SO\",\r\n\t\t\t\t\"cy\": \"cy_GB\", \"af\": \"af_ZA\", \"ss\": \"ss_ZA\", \"ts\": \"ts_ZA\", \"ve\": \"ve_ZA\", \"xh\": \"xh_ZA\", \"an\": \"an_ES\",\r\n\t\t\t\t\"ast\": \"ast_ES\", \"ca\": \"ca_ES\", \"gl\": \"gl_ES\", \"si\": \"si_LK\", \"tt\": \"tt_RU\", \"tpi\": \"tpi_PG\", \"th\": \"th_TH\",\r\n\t\t\t\t\"tr\": \"tr_TR\", \"ku\": \"ku_TR\", \"tk\": \"tk_TM\", \"uk\": \"uk_UA\", \"uz\": \"uz_UZ\", \"vi\": \"vi_VN\", \"sn\": \"sn_ZW\",\r\n\t\t\t\t\"eo\": \"eo_EO\", \"da\": \"da_DK\", \"fi\": \"fi_FI\", \"fr\": \"fr_FR\", \"it\": \"it_IT\", \"nl\": \"nl_NL\", \"pt\": \"pt_PT\",\r\n\t\t\t\t\"shs\": \"shs_CA\", \"mos\": \"mo_BF\", \"gsc\": \"gsc_FR\", \"fur\": \"fu_IT\", \"hil\": \"hl_PH\", \"sh\": \"sh_YU\", \"nso\": \"ns_ZA\",\r\n\t\t\t\t\"tn\": \"tn_ZA\", \"az\": \"az_AZ\", \"oc\": \"oc_FR\", \"grc\": \"grc_GR\", \"smj\": \"smj_NO\", \"fy\": \"fy_NL\", \"nn\": \"nn_NO\",\r\n\t\t\t\t\"se\": \"se_NO\", \"nr\": \"nr_ZA\", \"st\": \"st_ZA\", \"ia\": \"ia_XR\", \"el\": \"el_GR\", \"nb\": \"nb_NO\", \"ko\": \"ko_KR\",\r\n\t\t\t\t\"la\": \"la_VA\", \"mr\": \"mr_IN\", \"son\": \"son_ML\", \"bn\": \"bn_IN\", \"mk\": \"mk_MK\", \"be\": \"be_BY\", \"dsb\": \"dsb_DE\",\r\n\t\t\t\t\"hsb\": \"hsb_DE\", \"sa\": \"sa_IN\", \"te\": \"te_IN\", \"ta\": \"ta_IN\", \"ne\": \"ne_NP\", \"yi\": \"yi_YI\"\r\n\t\t\t},\r\n\t\t\ttype: optionTypes.defaultValue\r\n\t\t},\r\n\t\tcontainer: {\r\n\t\t\trequired: true,\r\n\t\t\ttype: optionTypes.htmlContainer\r\n\t\t},\r\n\t\tproofreadOptions: {defaultValue:['ignoreAllCapsWords', 'ignoreDomainNames', 'ignoreWordsWithMixedCases', 'ignoreWordsWithNumbers'], type: optionTypes.proofreadOptions },\r\n\t\tignoreAllCapsWords: { defaultValue: false, type: optionTypes.boolean },\r\n\t\tignoreDomainNames: { defaultValue: true, type: optionTypes.boolean },\r\n\t\tignoreWordsWithMixedCases: { defaultValue: false, type: optionTypes.boolean },\r\n\t\tignoreWordsWithNumbers:  { defaultValue: false, type: optionTypes.boolean },\r\n\t\tignoreElements: { defaultValue:'a', type: optionTypes.string },\r\n\t\tignoreGrammarElements: { defaultValue:'', type: optionTypes.boolean },\r\n\t\t'options-to-restore': {\r\n\t\t\tdefaultValue: ['lang', 'ignoreAllCapsWords', 'ignoreDomainNames', 'ignoreWordsWithMixedCases', 'ignoreWordsWithNumbers'],\r\n\t\t\ttype: optionTypes.array\r\n\t\t},\r\n\t\tundoDataSize: { defaultValue: 20, type: optionTypes.number },\r\n\t\tenableOnTouchDevices: { defaultValue: false, type: optionTypes.boolean },\r\n\t\tenableBadgeButton: { defaultValue: true, type: optionTypes.boolean },\r\n\t\tdisableProblemDescription: { defaultValue: false, type: optionTypes.boolean },\r\n\t\tactionItems: {\r\n\t\t\tdefaultValue: [\"addWord\", \"ignoreAll\", \"settings\", \"toggle\", \"proofreadDialog\"],\r\n\t\t\ttype: optionTypes.array\r\n\t\t},\r\n\t\tcontrolActions: {\r\n\t\t\tdefaultValue: [\"addWord\", \"ignoreAll\"],\r\n\t\t\ttype: optionTypes.defaultValue\r\n\t\t},\r\n\t\tstaticActions: {\r\n\t\t\tdefaultValue: [\"proofreadDialog\", \"settings\", \"toggle\"],\r\n\t\t\ttype: optionTypes.defaultValue\r\n\t\t},\r\n\t\tsettingsSections: {\r\n\t\t\tdefaultValue: [\"options\", \"languages\", \"dictionaries\"],\r\n\t\t\ttype: optionTypes.array\r\n\t\t},\r\n\t\tdefaultSettingsSections: {\r\n\t\t\tdefaultValue: [\"about\"],\r\n\t\t\ttype: optionTypes.defaultValue\r\n\t\t},\r\n\t\tmultiLanguageMode: { defaultValue: false, type: optionTypes.boolean },\r\n\t\tmirrorBasedInstance: { defaultValue: false, type: optionTypes.boolean },\r\n\t\tdisableCache: { defaultValue: false, type: optionTypes.boolean },\r\n\t\tcacheSize: { defaultValue: 4000, type: optionTypes.number },\r\n\t\tisProofreadInDialogActive: { defaultValue: false, type: optionTypes.boolean },\r\n\t\tproofreadAsYouType: { defaultValue: true, type: optionTypes.boolean },\r\n\t\tisModelEditor: { defaultValue: false, type: optionTypes.boolean }\r\n\t};\r\n\r\n\tcoreOptionsTemplate = OptionsManager.mergeOptionsTemplates(coreOptionsTemplate, webApiTemplate);\r\n\r\n\tOptionsManager.exportOptionsTemplate('CoreTemplate', coreOptionsTemplate);\r\n\t/**\r\n\t * WEBSPELLCHECKER (Core) constructor\r\n\t * @constructor\r\n\t * @instance\r\n\t * @param {Object} clientOptions\r\n\t * @param {String | Node} clientOptions.container Container with data\r\n\t * @param {String} [clientOptions.serviceId='1:WvF0D4-UtPqN1-43nkD4-NKvUm2-daQqk3-LmNiI-z7Ysb4-mwry24-T8YrS3-Q2tpq2'] Customer ID\r\n\t */\r\n\tCORE = function(clientOptions) {\r\n\t\t/** loaded modules */\r\n\t\tvar modules = {},\r\n\t\t\tcriticalMessage = '',\r\n\t\t\tself = this;\r\n\r\n\t\tif(typeof clientOptions.container === 'string') {\r\n\t\t\tclientOptions.container = document.getElementById(clientOptions.container);\r\n\t\t}\r\n\r\n\t\toptions = OptionsManager.createOptions(clientOptions, 'CoreTemplate', function(errors) {\r\n\t\t\terrors.reports.forEach(function(report) {\r\n\t\t\t\tif (report.critical) {\r\n\t\t\t\t\tcriticalMessage += report.message;\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t});\r\n\t\tif (criticalMessage !== '') {\r\n\t\t\treturn new Error(criticalMessage);\r\n\t\t}\r\n\r\n\t\toptions.modifierKeys = {\r\n\t\t\tALT:  CORE.ALT,\r\n\t\t\tCTRL: CORE.CTRL,\r\n\t\t\tSHIFT: CORE.SHIFT\r\n\t\t};\r\n\t\toptions.documentContainer = options.container;\r\n\t\toptions.isIframe = options.documentContainer.nodeName.toLowerCase() == 'iframe' ? true : false;\r\n\t\t/*\r\n\t\t* Hook for working with iframe, and support of literal 'id' or 'Node'\r\n\t\t* TODO: add check for right documentContainer, add exception if node not found\r\n\t\t* TODO: look for another realization\r\n\t\t*/\r\n\t\toptions.currentDocument = (options.isIframe === true) ? options.documentContainer.contentWindow.document : document;\r\n\t\t/* Detect and set absolute path to static resources\t*/\r\n\t\toptions.cssPath =  this.Utils.getUrl(options.cssPath, options.basePath);\r\n\t\toptions.isServiceHostDefault = options.serviceHost.includes(options.mainWSCdomain);\r\n\r\n\t\tif (options.isIframe) {\r\n\t\t\tif (options.documentContainer.contentDocument) {\r\n\t\t\t\toptions.container = options.documentContainer.contentDocument.getElementsByTagName('body')[0];\r\n\t\t\t} else {\r\n\t\t\t\toptions.container = options.documentContainer.contentWindow.document.getElementsByTagName('body')[0];\r\n\t\t\t}\r\n\t\t}\r\n\t\toptions.originalContainer = options.container;\r\n\t\toptions.focusContainer = options.documentContainer.contentWindow || options.container;\r\n\t\t// generate UID for each control\r\n\t\toptions.uid = this.instanceManager.getUniqueId(options.documentContainer);\r\n\r\n\t\tfor (var i = 0; i < options['options-to-restore'].length; i++) {\r\n\t\t\t//@TODO: check if name of option is already in {options}\r\n\t\t\toptionToStore = options['options-to-restore'][i];\r\n\r\n\t\t\tif (typeof options[optionToStore] !== 'undefined') {\r\n\t\t\t\tstoredValue = this.DataStorage.getData(options['uid'] + '_' + optionToStore);\r\n\t\t\t\tif (typeof storedValue !== 'undefined' && storedValue !== null) { // if option is already stored then restore this value to {core.options}\r\n\t\t\t\t\toptions[optionToStore] = storedValue;\r\n\t\t\t\t} else { // else set current {core.options} value to storage\r\n\t\t\t\t\tthis.DataStorage.setData(options['uid'] + '_' + optionToStore, options[optionToStore]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// delete related stored data if it is not in storage config\r\n\t\tfor (var option in options) {\r\n\t\t\tif (options['options-to-restore'].includes(option) === false) {\r\n\t\t\t\tthis.DataStorage.deleteData(options['uid'] + '_' + option);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.options = options;\r\n\r\n\t\t// core module dependencies\r\n\t\tvar _dependencies = [\r\n\t\t\t{name: 'Communication', module: CORE.Communication},\r\n\t\t\t{name: 'DOMCommunication', module: CORE.DOMCommunication},\r\n\t\t\t{name: 'WebApiAdapter', module: CORE.WebApiAdapter},\r\n\t\t\t{name: 'RegExpressions', module: CORE.RegExpressions},\r\n\t\t\t{name: 'RangeCreator', module: CORE.RangeCreator},\r\n\t\t\t{name: 'Deferred', module: CORE.Deferred},\r\n\t\t\t{name: 'StateController', module: CORE.StateController}\r\n\t\t];\r\n\r\n\t\t// if module implement decorator interface we change original module to decorated\r\n\t\tfunction decorateModules(instance) {\r\n\t\t\tvar service = instance,\r\n\t\t\t\tdecoratedService;\r\n\r\n\t\t\tif (service.decorator) {\r\n\t\t\t\tdecoratedService = modules[service.decoratorFor];\r\n\r\n\t\t\t\tif (decoratedService === undefined) {\r\n\t\t\t\t\tthrow new Error(moduleID + ' try to decorate undefined module ' + service.decoratorFor + '.');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (service.decorate  === undefined) {\r\n\t\t\t\t\tthrow new Error(moduleID + ' should define decorate method.');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmodules[service.decoratorFor].instance = service.decorate(decoratedService.instance);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction buildModules(modulesToInit) {\r\n\t\t\tmodulesToInit.forEach(function(moduleObj) {\r\n\t\t\t\tvar moduleID = moduleObj.name,\r\n\t\t\t\t\tmoduleConstructor = moduleObj.module,\r\n\t\t\t\t\tcreator, instance;\r\n\r\n\t\t\t\tself._register(moduleID, moduleConstructor);\r\n\t\t\t\tself._start(moduleID);\r\n\t\t\t\tinstance = modules[moduleID].instance;\r\n\t\t\t\tcreator = modules[moduleID].creator;\r\n\r\n\t\t\t\tif (instance.initialized) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tinstance.init && instance.init();\r\n\t\t\t\tinstance.ready = !creator.async;\r\n\t\t\t\tinstance.initialized = true;\r\n\r\n\t\t\t\tdecorateModules(instance);\r\n\t\t\t});\r\n\t\t}\r\n\t\t/**\r\n\t\t * Modules initialization function\r\n\t\t *\r\n\t\t * @param {object} modules Array with modules\r\n\t\t */\r\n\t\tfunction _initModules(modulesList) {\r\n\t\t\tvar syncModules = [],\r\n\t\t\t\tasyncModules = [],\r\n\t\t\t\tinstance,\r\n\t\t\t\tfireAllModulesReady = function() {\r\n\t\t\t\t\tself.allModulesReady = true;\r\n\t\t\t\t\tself.getService('Communication').fire({\r\n\t\t\t\t\t\tmoduleID: 'CORE',\r\n\t\t\t\t\t\teventType: 'allModulesReady'\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tasyncModulesReadyHandler = function() {\r\n\t\t\t\t\tbuildModules(syncModules);\r\n\t\t\t\t\tfireAllModulesReady();\r\n\t\t\t\t\tself.getService('Communication').unsubscribe({\r\n\t\t\t\t\t\tmoduleID: 'CORE',\r\n\t\t\t\t\t\teventType: 'asyncModulesReady',\r\n\t\t\t\t\t\thandler: asyncModulesReadyHandler\r\n\t\t\t\t\t});\r\n\t\t\t\t};\r\n\r\n\t\t\tmodulesList.forEach(function(moduleObj) {\r\n\t\t\t\tif (moduleObj.module.async) {\r\n\t\t\t\t\tasyncModules.push(moduleObj);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsyncModules.push(moduleObj);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (asyncModules.length !== 0) {\r\n\t\t\t\tself.getService('Communication').subscribe({\r\n\t\t\t\t\tmoduleID: 'CORE',\r\n\t\t\t\t\teventType: 'asyncModulesReady',\r\n\t\t\t\t\thandler: asyncModulesReadyHandler\r\n\t\t\t\t});\r\n\t\t\t\tbuildModules(asyncModules);\r\n\t\t\t} else {\r\n\t\t\t\tbuildModules(syncModules);\r\n\t\t\t\tfireAllModulesReady();\r\n\t\t\t}\r\n\t\t}\r\n\t\t/**\r\n\t\t* Module start function\r\n\t\t* @param {string} moduleID Identificator of module\r\n\t\t* @param {object} reference to CORE object\r\n\t\t*/\r\n\t\tfunction startModule(moduleID, core) {\r\n\t\t\tvar createModuleInstance = function() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tmodules[moduleID].instance = new modules[moduleID].creator(moduleID, new CORE.Sandbox(moduleID, core));\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\t// TODO: Create collection of error messages\r\n\t\t\t\t\tthrow new Error('Could not create Module instance with id: ' + moduleID + ' : ' + e.message);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tif (!modules[moduleID].instance) {\r\n\t\t\t\tcreateModuleInstance(moduleID, core);\r\n\t\t\t\t// module started\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\t// module already started\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t* Check modules ready state function. If all modules is ready will fire event \"allModulesIsReady\"\r\n\t\t* @param {object} reference to CORE object\r\n\t\t*/\r\n\t\tfunction checkModulesState(core) {\r\n\t\t\tvar instance, creator;\r\n\r\n\t\t\tfor (var moduleID in modules) {\r\n\t\t\t\tinstance = modules[moduleID].instance;\r\n\t\t\t\tcreator = modules[moduleID].creator;\r\n\r\n\t\t\t\tif (!instance) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (creator.async && instance.ready === false) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tcore.getService('Communication').fire({\r\n\t\t\t\tmoduleID: 'CORE',\r\n\t\t\t\teventType: 'asyncModulesReady'\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t/* Public properties*/\r\n\t\tthis.allModulesReady = false;\r\n\r\n\t\t/* Public methods */\r\n\t\tthis._register = function(moduleID, creator) {\r\n\t\t\tmodules[moduleID] = modules[moduleID] || {\r\n\t\t\t\tcreator: creator,\r\n\t\t\t\tinstance: null\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t\tthis.getService = function(moduleID) {\r\n\t\t\treturn modules[moduleID] ? modules[moduleID].instance : undefined;\r\n\t\t};\r\n\r\n\t\tthis._start = function(moduleID) {\r\n\t\t\tvar statusMessage = '',\r\n\t\t\t\tcommunication;\r\n\r\n\t\t\tif (startModule(moduleID, this)) {\r\n\t\t\t\tstatusMessage = moduleID + ' started.';\r\n\t\t\t} else {\r\n\t\t\t\tstatusMessage = moduleID + ' already started.';\r\n\t\t\t}\r\n\r\n\t\t\tcommunication = this.getService('Communication');\r\n\r\n\t\t\tif (communication.initialized) {\r\n\t\t\t\tcommunication.fire({\r\n\t\t\t\t\tmoduleID: 'CORE',\r\n\t\t\t\t\teventType: 'moduleStarted',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tstatusMessage: statusMessage\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t* Initialization of external dependency\r\n\t\t* @param {object} modulesList Object with modules\r\n\t\t*/\r\n\t\tthis.initModules = function(modulesList) {\r\n\t\t\t_initModules(modulesList);\r\n\t\t\tcheckModulesState(this);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t* Destroy modules\r\n\t\t*\r\n\t\t* @param {object} modulesList Object with modules\r\n\t\t*/\r\n\t\tthis.destroyModules = function(modulesList) {\r\n\t\t\tmodulesList = modulesList || modules;\r\n\r\n\t\t\tfor (var moduleID in modulesList) {\r\n\t\t\t\tif (modules[moduleID].instance.destroy) {\r\n\t\t\t\t\tmodules[moduleID].instance.destroy();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (var moduleID in modulesList) {\r\n\t\t\t\tmodules[moduleID].instance = null;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tbuildModules(_dependencies, true);\r\n\t\t// subscribe on event when module ready and check all modules\r\n\t\t// core had subscribed after init communication module\r\n\t\tthis.getService('Communication').subscribe({\r\n\t\t\tmoduleID: 'CORE',\r\n\t\t\teventType: 'moduleReady',\r\n\t\t\thandler: function(data) {\r\n\t\t\t\tmodules[data.moduleID].instance.ready = true;\r\n\t\t\t\tcheckModulesState(this);\r\n\t\t\t},\r\n\t\t\tcontext: this\r\n\t\t});\r\n\r\n\t};\r\n\r\n\tCORE.prototype.Utils = Namespace.Utils;\r\n\tCORE.prototype.OptionsManager = Namespace.OptionsManager;\r\n\tCORE.prototype.RegularsManager = Namespace.RegularsManager;\r\n\tCORE.prototype.IO = Namespace.IO;\r\n\tCORE.prototype.initWebApi = Namespace.initWebApi;\r\n\tCORE.prototype.logger = Namespace.logger;\r\n\r\n\tCORE.signals = Namespace.signals;\r\n\tCORE.jquip = Namespace.jquip;\r\n\tCORE.rangy = Namespace.rangy;\r\n\tNamespace.CORE = CORE;\r\n})( WEBSPELLCHECKER || {});\n/**\r\n * CORE Sandbox. Provides safe core API to module.\r\n *\r\n * @constructor\r\n * @param {string} moduleID \t- Module name\r\n * @param {Object} core \t\t- Core instance\r\n */\r\nWEBSPELLCHECKER.CORE.Sandbox = function(moduleID, core) {\r\n\t/**\r\n\t * @returns {CORE.RangeCreator.Range}\r\n\t */\r\n\r\n\tthis.getCommunication = function() {\r\n\t\treturn core.getService(\"Communication\");\r\n\t};\r\n\r\n\tthis.getContextMenu = function() {\r\n\t\tvar contextMenu = core.getService(\"ContextMenu\");\r\n\t\tvar result = {\r\n\t\t\taddItems: contextMenu.addItems,\r\n\t\t\tgetItem: contextMenu.getItem,\r\n\t\t\taddItem: contextMenu.addItem,\r\n\t\t\taddGroup: contextMenu.addGroup,\r\n\t\t\tgetDOMElement: contextMenu.getDOMElement,\r\n\t\t};\r\n\r\n\t\tfor(var k in result) {\r\n\t\t\tif( result.hasOwnProperty(k) ) {\r\n\t\t\t\tresult[k] = result[k].bind(contextMenu);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t};\r\n\r\n\tthis.getBadge = function() {\r\n\t\treturn core.getService(\"Badge\");\r\n\t};\r\n\r\n\tthis.createRange = function() {\r\n\r\n\t\tvar range = core.getService(\"RangeCreator\").createRange();\r\n\r\n\t\tcore.logger.log({\r\n\t\t\t'name': moduleID,\r\n\t\t\t'msg': 'Create the range',\r\n\t\t\t'data': range,\r\n\t\t\t'type': 'range'\r\n\t\t});\r\n\r\n\t\treturn range;\r\n\t};\r\n\r\n\t/**\r\n\t * @returns {CORE.RangeCreator.Selection}\r\n\t */\r\n\tthis.getSelection = function(inMainWindow) {\r\n\r\n\t\tvar getSelect = core.getService(\"RangeCreator\").getSelection(inMainWindow);\r\n\r\n\t\tcore.logger.log({\r\n\t\t\t'name': moduleID,\r\n\t\t\t'msg': 'Get the selection',\r\n\t\t\t'data': getSelect,\r\n\t\t\t'type': 'selection'\r\n\t\t});\r\n\r\n\t\treturn getSelect;\r\n\t};\r\n\r\n\t/**\r\n\t * @returns {object} \t- Bookmark object\r\n\t */\r\n\tthis.saveSelection = function() {\r\n\t\tvar savedSel;\r\n\r\n\t\tif(bookmarksIsEnabled.apply(this) && !this.getOption('mirrorBasedInstance')) {\r\n\t\t\t// Save/restore selection functionality does not broke nodes.\r\n\t\t\t// So we need to lock mutations listener.\r\n\t\t\tthis.fireInAllApps('lockMutationsListener', { lock: true });\r\n\t\t\t// if (core.options[\"focused\"].value) - // removed check for focused because we need to check it only during markup process (look at Markup module markupWords method)\r\n\t\t\tsavedSel = core.getService(\"RangeCreator\").getSelectionManager().saveSelection();\r\n\r\n\t\t\tcore.logger.log({\r\n\t\t\t\t'name': moduleID,\r\n\t\t\t\t'msg': 'Save the selection',\r\n\t\t\t\t'data': savedSel,\r\n\t\t\t\t'type': 'selection'\r\n\t\t\t});\r\n\r\n\t\t\t// Unlock mutations listener after save/restore selection functionality.\r\n\t\t\tthis.fireInAllApps('lockMutationsListener', {lock: false});\r\n\r\n\t\t\treturn savedSel;\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * @returns {boolean} \t- flag\r\n\t */\r\n\tthis.isSelectionCollapsed = function() {\r\n\t\tvar selection = this.getSelection(),\r\n\t\t\tisSelectionCollapsed = selection.rangeCount() ? selection.getRangeAt(0).collapsed() : true;\r\n\r\n\t\treturn isSelectionCollapsed;\r\n\t};\r\n\r\n\t/**\r\n\t * @returns {boolean} \t- Bookmark restoring status\r\n\t */\r\n\tthis.restoreSelection = function(savedSel, normalize) {\r\n\t\tvar restoredSel;\r\n\r\n\t\tif(savedSel && bookmarksIsEnabled.apply(this)) {\r\n\t\t\t// Save/restore selection functionality does not broke nodes.\r\n\t\t\t// So we need to lock mutations listener.\r\n\t\t\tthis.fireInAllApps('lockMutationsListener', {lock: true});\r\n\t\t\t// if (core.options[\"focused\"].value) - // removed check for focused because we need to check it only during markup process (look at Markup module markupWords method)\r\n\t\t\trestoredSel = core.getService(\"RangeCreator\").getSelectionManager().restoreSelection(savedSel);\r\n\r\n\t\t\tcore.logger.log({\r\n\t\t\t\t'name': moduleID,\r\n\t\t\t\t'msg': 'Restore the selection',\r\n\t\t\t\t'data': restoredSel,\r\n\t\t\t\t'type': 'selection'\r\n\t\t\t});\r\n\r\n\t\t\t// For some cases we need to put main container to normalized form\r\n\t\t\t// But only for Firefox and Chrome browsers\r\n\t\t\tif ( normalize && (this.Utils.Browser.gecko || this.Utils.Browser.chrome) ) {\r\n\t\t\t\tthis.getOption('container').normalize();\r\n\t\t\t}\r\n\r\n\t\t\tthis.fire('selectionIsChanged', {action: 'restoreSelection'});\r\n\t\t\t// Unlock mutations listener after save/restore selection functionality.\r\n\t\t\tthis.fireInAllApps('lockMutationsListener', { lock: false });\r\n\r\n\t\t\treturn restoredSel;\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * @returns {boolean} \t- Bookmark deletion status\r\n\t */\r\n\tthis.deleteStoredSelection = function(savedSel) {\r\n\t\tvar currentSelection,\r\n\t\t\tresult = false;\r\n\r\n\t\tif(savedSel) {\r\n\t\t\t// save current\r\n\t\t\tcurrentSelection = this.saveSelection();\r\n\t\t\t// delete previous markers\r\n\t\t\tthis.restoreSelection(savedSel);\r\n\t\t\t// restore current\r\n\t\t\tthis.restoreSelection(currentSelection);\r\n\r\n\t\t\tresult = true;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t};\r\n\r\n\t/**\r\n\t * @returns {boolean} \t-\r\n\t */\r\n\tthis.removeMarkers = function(savedSel) {\r\n\t\tvar result = core.getService(\"RangeCreator\").getSelectionManager().removeMarkers(savedSel);\r\n\r\n\t\tcore.logger.log({\r\n\t\t\t'name': moduleID,\r\n\t\t\t'msg': 'Removes the hidden marker',\r\n\t\t\t'data': result,\r\n\t\t\t'type': 'selection'\r\n\t\t});\r\n\r\n\t\treturn result;\r\n\t};\r\n\r\n\t/**\r\n\t * @returns {object} - Bookmark object\r\n\t */\r\n\tthis.getBookmark = function() {\r\n\t\tvar bookmark,\r\n\t\t\trange,\r\n\t\t\tselection;\r\n\r\n\t\tselection = core.getService(\"RangeCreator\").getSelection();\r\n\r\n\t\tif (selection.rangeCount()) {\r\n\t\t\trange = selection.getRangeAt(0);\r\n\t\t\tbookmark = range.getBookmark(this.getOption('container'));\r\n\r\n\t\t\tcore.logger.log({\r\n\t\t\t\t'name': moduleID,\r\n\t\t\t\t'msg': 'Save the bookmark',\r\n\t\t\t\t'data': bookmark,\r\n\t\t\t\t'type': 'range'\r\n\t\t\t});\r\n\r\n\t\t\treturn bookmark;\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * @returns {CORE.RangeCreator.Range} - Range\r\n\t */\r\n\tthis.moveToBookmark = function(bookmark) {\r\n\t\tvar range;\r\n\r\n\t\tif (bookmark) {\r\n\t\t\trange = core.getService(\"RangeCreator\").createRange();\r\n\t\t\trange = range.moveToBookmark(bookmark);\r\n\r\n\t\t\tcore.logger.log({\r\n\t\t\t\t'name': moduleID,\r\n\t\t\t\t'msg': 'Move to bookmark',\r\n\t\t\t\t'data': range,\r\n\t\t\t\t'type': 'range'\r\n\t\t\t});\r\n\r\n\t\t\treturn range;\r\n\t\t}\r\n\t};\r\n\r\n\tthis.getCaretRangeFromEvent = function(event) {\r\n\t\tvar x = event.clientX,\r\n\t\t\ty = event.clientY,\r\n\t\t\tid = 'wsc-caret-' + ( new Date() ).getTime(),\r\n\t\t\trange = this.createRange(),\r\n\t\t\tcurrentSelection = this.getSelection(),\r\n\t\t\tcurrentRange = currentSelection.rangeCount() > 0 ? currentSelection.getRangeAt(0) : undefined,\r\n\t\t\tdoc = this.Utils.getCurrentDocument( this.getOption('documentContainer') ),\r\n\t\t\ttextRange,\r\n\t\t\telement,\r\n\t\t\tcontainer = this.getOption('container'),\r\n\t\t\tstart;\r\n\r\n\t\tif (doc.caretPositionFromPoint) { // Caret position from point for Firefox\r\n\t\t\tstart = doc.caretPositionFromPoint(x, y);\r\n\t\t\trange.setStart(start.offsetNode, start.offset);\r\n\t\t\trange.collapse(true);\r\n\t\t} else if (doc.caretRangeFromPoint) { // Caret position from point for Chrome and Safari\r\n\t\t\tstart = doc.caretRangeFromPoint(x, y);\r\n\t\t\trange.setStart(start.startContainer, start.startOffset);\r\n\t\t\trange.collapse(true);\r\n\t\t} else if (doc.body.createTextRange) { // Caret position from point for IE\r\n\t\t\tthis.fire({\r\n\t\t\t\telement: container,\r\n\t\t\t\teventType: 'focus'\r\n\t\t\t});\r\n\t\t\ttextRange = doc.body.createTextRange();\r\n\r\n\t\t\ttry {\r\n\t\t\t\ttextRange.moveToPoint(x, y);\r\n\t\t\t\ttextRange.pasteHTML('<span id=\"' + id + '\">\\u200b</span>');\r\n\t\t\t\telement = this.UILib.find('#' + id, container)[0];\r\n\t\t\t\trange.setStartBefore(element);\r\n\t\t\t\trange.collapse(true);\r\n\t\t\t\tthis.UILib.remove(element);\r\n\t\t\t} catch (error) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn range;\r\n\t};\r\n\t// rangeCreator: core.rangeCreator,\r\n\r\n\t/**\r\n\t * Provides reference to IO module\r\n\t */\r\n\tthis.IO = Object.assign({}, core.IO);\r\n\t/**\r\n\t * Provides reference to OptionsManager module\r\n\t */\r\n\tthis.OptionsManager = core.OptionsManager;\r\n\t/**\r\n\t * Provides reference to RegularsManager module\r\n\t */\r\n\tthis.RegularsManager = core.RegularsManager;\r\n\t/**\r\n\t * Webapi initialization method\r\n\t */\r\n\tthis.initWebApi = core.initWebApi;\r\n\t/**\r\n\t * Provides reference to UTILS module\r\n\t */\r\n\tthis.Utils = core.Utils;\r\n\r\n\t/**\r\n\t * Provides reference to Logger module\r\n\t */\r\n\tthis.logger = core.logger.log, core.logger.isON(core.options[\"debug\"]);\r\n\r\n\t/**\r\n\t * Provides reference to Logger console method\r\n\t */\r\n\tthis.console = core.logger.console;\r\n\r\n\t/**\r\n\t * Provides reference to Logger module\r\n\t */\r\n\tthis.Localization = core.Localization;\r\n\r\n\t/**\r\n\t * Provides reference to Template module\r\n\t */\r\n\tthis.Template = core.Template;\r\n\r\n\t/**\r\n\t * Provides reference to DataStorage module\r\n\t */\r\n\tthis.clipboardManager = core.clipboardManager;\r\n\r\n\t/**\r\n\t * Provides reference to DataStorage module\r\n\t */\r\n\tthis.DataStorage = core.DataStorage;\r\n\t/**\r\n\t * Provides reference to UILib module\r\n\t */\r\n\tthis.FullUILib = core.UILib;\r\n\tvar UILibPrivats = [\r\n\t\t'cancelEvent',\r\n\t\t'preventDefault',\r\n\t\t'stopPropagation',\r\n\t\t'stopImmediatePropagation',\r\n\t\t'focus',\r\n\t\t'blur',\r\n\t\t'contextmenu',\r\n\t\t'on',\r\n\t\t'one',\r\n\t\t'off',\r\n\t\t'trigger'\r\n\t];\r\n\r\n\tthis.UILib = accessLimitation(this.FullUILib, UILibPrivats);\r\n\r\n\t/**\r\n\t * Provides reference to DataProcessor module\r\n\t */\r\n\tthis.DataProcessor = core.DataProcessor;\r\n\t/**\r\n\t * Provides reference to UIMetrics module\r\n\t */\r\n\tthis.UIMetrics = WEBSPELLCHECKER.CORE.UIMetrics;\r\n\r\n\tthis.getHtmlWithoutSpellingNodes = function(html) {\r\n\t\treturn this.DataProcessor.getHtmlWithoutSpellingNodes(html, this.getOption('misspelled_word_node'), this.getOption('misspelled_word_class') );\r\n\t}\r\n\r\n\tthis.getHtmlWithoutGrammarNodes = function(html) {\r\n\t\treturn this.DataProcessor.getHtmlWithoutGrammarNodes(html, this.getOption('problem_grammar_node'), this.getOption('problem_grammar_class') );\r\n\t}\r\n\r\n\tthis.getHtmlWithoutProblemNodes = function(html) {\r\n\t\thtml = this.getHtmlWithoutSpellingNodes(html);\r\n\t\thtml = this.getHtmlWithoutGrammarNodes(html);\r\n\r\n\t\treturn html;\r\n\t}\r\n\r\n\t// return words array from string\r\n\tthis.getWordsFromString = function(string) {\r\n\t\treturn  core.getService(\"WebApiAdapter\").getWordsFromString(string);\r\n\t};\r\n\r\n\t// replace all separators to space symbol\r\n\tthis.replaceSepatators = function(string) {\r\n\t\treturn  core.getService(\"WebApiAdapter\").replaceSepatators(string);\r\n\t};\r\n\r\n\t// remove all special characters.\r\n\tthis.removeSpecialCharacters = function(string) {\r\n\t\treturn  core.getService(\"WebApiAdapter\").removeSpecialCharacters(string);\r\n\t};\r\n\r\n\t// block specified events execution\r\n\tthis.blockEvents = function(eventsCollection) {\r\n\t\tvar eventsBlockedState = this.getOption('eventsBlockedState');\r\n\r\n\t\tfor(var i = 0; i < eventsCollection.length; i++) {\r\n\t\t\teventsBlockedState[eventsCollection[i]] = true;\r\n\t\t}\r\n\r\n\t\tthis.setOption('eventsBlockedState', eventsBlockedState);\r\n\t};\r\n\r\n\t// unblock specified events execution\r\n\tthis.unblockEvents = function(eventsCollection) {\r\n\t\tvar eventsBlockedState = this.getOption('eventsBlockedState');\r\n\r\n\t\tfor(var i = 0; i < eventsCollection.length; i++) {\r\n\t\t\teventsBlockedState[eventsCollection[i]] = false;\r\n\t\t}\r\n\r\n\t\tthis.setOption('eventsBlockedState', eventsBlockedState);\r\n\t};\r\n\r\n\tthis.getInstance = function() {\r\n\t\tvar uid = this.getOption('uid'),\r\n\t\t\tinstance = core.instanceManager.getInstance(uid).instance;\r\n\r\n\t\treturn instance;\r\n\t};\r\n\r\n\t// start Spell Check if all modules is ready\r\n\tthis.startSpellCheck = function () {\r\n\t\tif (!core.allModulesReady) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tthis.fire('startSpellCheck', {});\r\n\t};\r\n\r\n\t// start Grammar Check if all modules is ready\r\n\tthis.startGrammarCheck = function() {\r\n\t\tif (!core.allModulesReady) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tthis.fire('startGrammarCheck', {});\r\n\t};\r\n\r\n\t// start Problems Check if all modules is ready\r\n\tthis.startProblemsCheck = function() {\r\n\t\tthis.startSpellCheck();\r\n\t\tthis.startGrammarCheck();\r\n\r\n\t\t// Temporary solution for two markup mechanisms.\r\n\t\tif (core.allModulesReady) {\r\n\t\t\tthis.fire('startProblemsCheck', {});\r\n\t\t}\r\n\t};\r\n\r\n\t// set the markup mechanism to pause/unpause\r\n\tthis.setMarkupPaused = function(paused) {\r\n\t\tif (paused) {\r\n\t\t\tthis.setPaused(true);\r\n\t\t\tthis.removeAllDeferredFunctions();\r\n\t\t} else {\r\n\t\t\tthis.setPaused(false);\r\n\t\t\tthis.startProblemsCheck();\r\n\t\t}\r\n\t}\r\n\r\n\t// allow or block execution of all events\r\n\tthis.setPaused = function(paused) {\r\n\t\treturn core.options[\"paused\"] = paused;\r\n\t};\r\n\r\n\t// start application\r\n\tthis.startApp = function() {\r\n\t\tthis.getOption('proofreadAsYouType') && this.startMarkup();\r\n\t\tthis.setOption('appStarted', true);\r\n\t};\r\n\r\n\t// stop application\r\n\tthis.stopApp = function() {\r\n\t\tthis.stopMarkup();\r\n\t\tthis.setOption('appStarted', false);\r\n\t};\r\n\r\n\t// start markup\r\n\tthis.startMarkup = function() {\r\n\t\tif ( this.getOption('isModelEditor') && !this.getOption('isProofreadInDialogActive') ) {\r\n\t\t\t// If we are in model editor and not in Proofread Dialog\r\n\t\t\t// We need to set on pause basic markup and start alternative markup mechanism\r\n\t\t\tthis.setSpellingMarkupPaused(true);\r\n\t\t\tthis.setGrammarMarkupPaused(true);\r\n\t\t\tthis.setProblemMarkupPaused(false);\r\n\t\t} else {\r\n\t\t\t// If we are not in model editor or in modal editor with active Proofread Dialog\r\n\t\t\t// We need to set on pause alternative markup and start basic markup mechanism\r\n\t\t\tthis.setSpellingMarkupPaused(false);\r\n\t\t\tthis.getOption('enableGrammar') && this.setGrammarMarkupPaused(false);\r\n\t\t\tthis.setProblemMarkupPaused(true);\r\n\t\t}\r\n\r\n\t\tthis.startProblemsCheck();\r\n\t};\r\n\r\n\t// stop markup\r\n\tthis.stopMarkup = function() {\r\n\t\tthis.fire('removeMarkupInDocument', {});\r\n\t\tthis.fire('removeMarkupInContainer', {});\r\n\t\tthis.setSpellingMarkupPaused(true);\r\n\t\tthis.setGrammarMarkupPaused(true);\r\n\t\tthis.setProblemMarkupPaused(true);\r\n\t\tthis.removeAllDeferredFunctions();\r\n\t};\r\n\r\n\tthis.setSpellingMarkupPaused = function(paused) {\r\n\t\tvar spellingMarkupEventsCollection = [\r\n\t\t\t'startSpellCheck',\r\n\t\t\t'markupWords',\r\n\t\t\t'removeMarkupInDocument',\r\n\t\t\t'removeMarkupFromWords',\r\n\t\t\t'removeMarkupInSelectionNode',\r\n\t\t\t'replaceWord',\r\n\t\t\t'ignoreWord',\r\n\t\t\t'ignoreAllWords',\r\n\t\t\t'collectWords',\r\n\t\t\t'wordsCollected',\r\n\t\t\t'misspelledWordsFound'\r\n\t\t];\r\n\r\n\t\tthis[paused ? 'blockEvents' : 'unblockEvents'](spellingMarkupEventsCollection);\r\n\t};\r\n\r\n\tthis.setGrammarMarkupPaused = function(paused) {\r\n\t\tvar grammarEventsCollection = [\r\n\t\t\t'startGrammarCheck',\r\n\t\t\t'markupPhrase',\r\n\t\t\t'removeMarkupFromPhrases',\r\n\t\t\t'removeGrammarMarkupInSelectionNode',\r\n\t\t\t'replacePhrase',\r\n\t\t\t'ignorePhrase',\r\n\t\t\t'ignoreAllPhrases',\r\n\t\t\t'sentencesCollected',\r\n\t\t\t'problemSentencesFound',\r\n\t\t\t'collectSentences'\r\n\t\t];\r\n\r\n\t\tthis[paused ? 'blockEvents' : 'unblockEvents'](grammarEventsCollection);\r\n\t};\r\n\r\n\tthis.setProblemMarkupPaused = function(paused) {\r\n\t\tvar problemMarkupEventsCollection = [\r\n\t\t\t'startProblemsCheck',\r\n\t\t\t'replaceProblem',\r\n\t\t\t'ignoreAllProblems',\r\n\t\t\t'problemsFound',\r\n\t\t\t'problemsCollected',\r\n\t\t\t'removeMarkupInContainer',\r\n\t\t\t'removeMarkupFromProblems'\r\n\t\t];\r\n\r\n\t\tthis[paused ? 'blockEvents' : 'unblockEvents'](problemMarkupEventsCollection);\r\n\t};\r\n\r\n\tthis.removeSentencesFromCache = function(sentences) {\r\n\t\tvar sentencesDictionary = core.getService(\"SentencesDictionary\");\r\n\r\n\t\tfor (var i = 0; i < sentences.length; i++) {\r\n\t\t\tvar sentence = sentences[i];\r\n\r\n\t\t\tsentencesDictionary.handleCacheUpdate({ sentence: sentence });\r\n\t\t}\r\n\t}\r\n\r\n\t// fire event\r\n\tthis.fire = function (eventType, data, instance, DOMElement) {\r\n\t\tvar eventsBlockedState = this.getOption('eventsBlockedState'),\r\n\t\t\toptions = argumentsToObject(['eventType', 'data', 'instance', 'DOMElement'], arguments);\r\n\r\n\t\toptions.moduleID = moduleID;\r\n\r\n\t\tcore.logger.log({\r\n\t\t\t'name': moduleID,\r\n\t\t\t'msg': \"Fired event: \" + options.eventType + ' with such data -> ',\r\n\t\t\t'data': options.data,\r\n\t\t\t'type': 'signals'\r\n\t\t});\r\n\r\n\t\tif (core.options[\"paused\"] === true || eventsBlockedState[options.eventType]) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\r\n\t\treturn this.getCommunication().fire(options);\r\n\t};\r\n\r\n\t// subscribe to event\r\n\tthis.subscribe = function (eventType, handler, context, priority, instance, element) {\r\n\t\tvar options = argumentsToObject(['eventType', 'handler', 'context', 'priority', 'instance', 'element'], arguments);\r\n\t\toptions.context = options.context || core.getService(moduleID);\r\n\t\toptions.moduleID = moduleID;\r\n\r\n\t\tvar overrideHandler = function() {\r\n\r\n\t\t\tcore.logger.log({\r\n\t\t\t\t'name': moduleID,\r\n\t\t\t\t'msg': 'Responded to the event: ' + options.eventType + ' with data -> ',\r\n\t\t\t\t'data': arguments[0],\r\n\t\t\t\t'type': 'signals'\r\n\t\t\t});\r\n\r\n\t\t\treturn options.handler.apply(options.context, options);\r\n\t\t};\r\n\r\n\t\treturn this.getCommunication().subscribe(options);\r\n\t};\r\n\r\n\t// unsubscribe from event\r\n\tthis.unsubscribe = function (eventType, context, instance, DOMElement) {\r\n\t\tvar options = argumentsToObject(['eventType', 'context', 'context', 'instance', 'DOMElement'], arguments);\r\n\t\toptions.context = options.context || core.getService(moduleID);\r\n\t\toptions.moduleID = moduleID;\r\n\r\n\t\tcore.logger.log({\r\n\t\t\t'name': moduleID,\r\n\t\t\t'msg': 'Unsubscribe to the event: ' + options.eventType,\r\n\t\t\t'type': 'signals'\r\n\t\t});\r\n\r\n\t\treturn this.getCommunication().unsubscribe(options);\r\n\t};\r\n\r\n\tthis.addEventProxy = function(options) {\r\n\r\n\t\tcore.logger.log({\r\n\t\t\t'name': moduleID,\r\n\t\t\t'msg': 'Set event proxy between elements',\r\n\t\t\t'data': options,\r\n\t\t\t'type': 'signals'\r\n\t\t});\r\n\r\n\t\treturn core.getService(\"DOMCommunication\").EventProxy.addEventProxy(options);\r\n\t};\r\n\r\n\tthis.removeEventProxy = function(options) {\r\n\r\n\t\tcore.logger.log({\r\n\t\t\t'name': moduleID,\r\n\t\t\t'msg': 'Remove event proxy between elements',\r\n\t\t\t'data': options,\r\n\t\t\t'type': 'signals'\r\n\t\t});\r\n\r\n\t\treturn core.getService(\"DOMCommunication\").EventProxy.removeEventProxy(options);\r\n\t};\r\n\r\n \tthis.fireInAllApps = function (eventType, data) {\r\n\t\tcore.instanceManager.notifyAll(eventType, data);\r\n\t};\r\n\r\n\tthis._getCoreOptionObject = function() {\r\n\t\treturn core.options;\r\n\t};\r\n\r\n\tthis.getOption = function(optionName /*String or Array*/) {\r\n\t\tvar _options = Object.prototype.toString.call(optionName) == '[object String]' ? [optionName] : optionName;\r\n\t\tvar _retOptionsObject = {};\r\n\t\tfor (var i = 0; i < _options.length; i++) {\r\n\t\t\t_retOptionsObject[_options[i]] = core.options[_options[i]];\r\n\t\t}\r\n\r\n\t\tvar options = _options.length == 1 ? _retOptionsObject[_options[0]] : _retOptionsObject;\r\n\r\n\t\tcore.logger.log({\r\n\t\t\t'name': moduleID,\r\n\t\t\t'msg': 'Get the \"' + _options + '\" option with value -> ',\r\n\t\t\t'data': options,\r\n\t\t\t'type': 'options'\r\n\t\t});\r\n\r\n\t\treturn options;\r\n\t};\r\n\r\n\tthis.getActions = function(actionsList, container) {\r\n\t\treturn core.getService(\"ActionsManager\").getActions(actionsList, container);\r\n\t}\r\n\tthis.getProblemActions = function(problem) {\r\n\t\treturn core.getService(\"ActionsManager\").getProblemActions(problem);\r\n\t}\r\n\tthis.getStaticActions = function(problem) {\r\n\t\treturn core.getService(\"ActionsManager\").getStaticActions(problem);\r\n\t}\r\n\tthis.getProblemInfo = function(problemNode) {\r\n\t\treturn core.getService(\"ProblemManager\").getProblemInfo(problemNode);\r\n\t}\r\n\tthis.getNodeInfo = function(node) {\r\n\t\treturn core.getService(\"ProblemManager\").getNodeInfo(node);\r\n\t}\r\n\tthis.getFullNodeInfo = function(node) {\r\n\t\treturn core.getService(\"ProblemManager\").getFullNodeInfo(node);\r\n\t}\r\n\tthis.getChildProblemNodes = function (node) {\r\n\t\treturn core.getService(\"ProblemManager\").getChildProblemNodes(node);\r\n\t}\r\n\tthis.getParentProblemNodes = function (node) {\r\n\t\treturn core.getService(\"ProblemManager\").getParentProblemNodes(node);\r\n\t}\r\n\tthis.getProblemNodeFromMouseEvent = function (event) {\r\n\t\treturn core.getService(\"ProblemManager\").getProblemNodeFromMouseEvent(event);\r\n\t}\r\n\tthis.getProblemNodesFromPoint = function (x, y) {\r\n\t\treturn core.getService(\"ProblemManager\").getProblemNodesFromPoint(x, y);\r\n\t}\r\n\tthis.getProblemTypes = function() {\r\n\t\treturn core.getService(\"ProblemManager\").getProblemTypes();\r\n\t}\r\n\r\n\tthis.isOriginalContainerTextBased = function() {\r\n\t\treturn this.getOption(\"isTextBasedContainer\");\r\n\t};\r\n\r\n\tthis.getDefaultOption = function(optionName) {\r\n\t\tvar _options = Object.prototype.toString.call(optionName) == '[object String]' ? [optionName] : optionName;\r\n\t\tvar _retOptionsObject = {};\r\n\t\tfor (var i = 0; i < _options.length; i++) {\r\n\t\t\t_retOptionsObject[_options[i]] = core.options[_options[i]].defaultValue;\r\n\t\t}\r\n\t\treturn _options.length == 1 ? _retOptionsObject[_options[0]] : _retOptionsObject;\r\n\t};\r\n\r\n\tthis.getLocal = function(abbreviation) {\r\n\t\treturn this.Localization.getLocal(abbreviation, this.getOption('localization'));\r\n\t};\r\n\r\n\tthis.setOption = function(optionName, value) {\r\n\t\tif(optionName in core.options) {\r\n\t\t\tcore.options[optionName] = value;\r\n\t\t\tif( this.getOption('options-to-restore').includes(optionName) !== false ) {\r\n\r\n\t\t\t\tcore.logger.log({\r\n\t\t\t\t\t'name': moduleID,\r\n\t\t\t\t\t'msg': 'Set the \"' + optionName + '\" option with value -> ',\r\n\t\t\t\t\t'data': value,\r\n\t\t\t\t\t'type': 'options'\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.DataStorage.setData(this.getOption('uid') + '_' + optionName, value);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tthis.addDeferredFunction = function(name, params) {\r\n\t\t// core.deferred.register(name, params);\r\n\t\tcore.getService(\"Deferred\").register(name, params);\r\n\t};\r\n\r\n\tthis.removeAllDeferredFunctions = function() {\r\n\t\t// core.deferred.unregisterAll();\r\n\t\tcore.getService(\"Deferred\").unregisterAll();\r\n\t};\r\n\r\n\tthis.getRegExp = function(name) {\r\n\t\treturn core.getService(\"RegExpressions\").getRegExp(name);\r\n\t};\r\n\r\n\tthis.setFocused = function(focused) {\r\n\t\treturn core.options[\"focused\"] = focused;\r\n\t};\r\n\r\n\tthis.getFocused = function(focused) {\r\n\t\treturn core.options[\"focused\"];\r\n\t};\r\n\r\n\tthis.isFocused = function() {\r\n\t\tvar focused = this.getFocused(),\r\n\t\t\tdocumentContainer = this.getOption('documentContainer'),\r\n\t\t\tisActiveContainer = (documentContainer === document.activeElement),\r\n\t\t\tisActiveContainerInMain = documentContainer.contains(document.activeElement);\r\n\r\n\t\treturn focused || isActiveContainer || isActiveContainerInMain;\r\n\t};\r\n\r\n\tthis.setContainer = function(container) {\r\n\t\treturn core.options[\"container\"] = container;\r\n\t};\r\n\r\n\tthis.removeMarkupFromString = function(str) {\r\n\t\tvar self = this,\r\n\t\t\ttempNode = document.createElement(\"div\"),\r\n\t\t\tmisspelled_word_node = self.getOption(\"misspelled_word_node\"),\r\n\t\t\tdata_attribute_name = self.getOption(\"data_attribute_name\"),\r\n\t\t\tproblem_word_node = self.getOption('problem_grammar_node'),\r\n\t\t\tproblem_attribute_name = self.getOption('problem_grammar_data_attribute');\r\n\r\n\t\ttempNode.innerHTML = str;\r\n\r\n\t\tvar spellingChildNodes = self.UILib.findNodeChildren(tempNode, misspelled_word_node, data_attribute_name);\r\n\t\tvar grammarChildNodes = self.UILib.findNodeChildren(tempNode, problem_word_node, problem_attribute_name);\r\n\r\n\t\twhile (spellingChildNodes.length > 0) {\r\n\t\t\tvar spellingNode = spellingChildNodes.shift(),\r\n\t\t\t\tfragment = document.createDocumentFragment();\r\n\r\n\t\t\twhile (spellingNode.childNodes.length > 0) {\r\n\t\t\t\tfragment.appendChild(spellingNode.childNodes.item(0));\r\n\t\t\t}\r\n\r\n\t\t\tspellingNode.parentNode.insertBefore(fragment, spellingNode);\r\n\t\t\tspellingNode.parentNode.removeChild(spellingNode);\r\n\t\t}\r\n\r\n\t\twhile (grammarChildNodes.length > 0) {\r\n\t\t\tvar grammarNode = grammarChildNodes.shift(),\r\n\t\t\t\tfragment = document.createDocumentFragment();\r\n\r\n\t\t\twhile (grammarNode.childNodes.length > 0) {\r\n\t\t\t\tfragment.appendChild(grammarNode.childNodes.item(0));\r\n\t\t\t}\r\n\r\n\t\t\tgrammarNode.parentNode.insertBefore(fragment, grammarNode);\r\n\t\t\tgrammarNode.parentNode.removeChild(grammarNode);\r\n\t\t}\r\n\r\n\t\treturn tempNode.innerHTML;\r\n\t};\r\n\r\n\tthis.getProblemNodeFromSelection = function(type) {\r\n\t\tvar selection = this.getSelection(),\r\n\t\t\tisBackwards = selection.isBackwards(),\r\n\t\t\trange = selection.rangeCount() ? selection.getRangeAt(0) : null,\r\n\t\t\tcollapsed = range ? range.collapsed() : true,\r\n\t\t\tselectionNode = selection.anchorNode(),\r\n\t\t\trangeText,\r\n\t\t\trangeNodes,\r\n\t\t\telement,\r\n\t\t\tproblemWord,\r\n\t\t\tproblemStartsFromRange,\r\n\t\t\trangeStartsFromProblem,\r\n\t\t\tproblemNode,\r\n\t\t\tproblemNodeName,\r\n\t\t\tproblemAttrName,\r\n\t\t\tproblemClassName;\r\n\r\n\t\tswitch (type) {\r\n\t\t\tcase 'spelling':\r\n\t\t\t\tproblemNodeName = this.getOption('misspelled_word_node');\r\n\t\t\t\tproblemAttrName = this.getOption('data_attribute_name');\r\n\t\t\t\tproblemClassName = this.getOption(\"misspelled_word_class\");\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'grammar':\r\n\t\t\t\tproblemNodeName = this.getOption('problem_grammar_node');\r\n\t\t\t\tproblemAttrName = this.getOption('problem_grammar_data_attribute');\r\n\t\t\t\tproblemClassName = this.getOption(\"problem_grammar_class\");\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t// If selection node is node with some CORE UI problem or one of the parents of this node is node with problem\r\n\t\tif ( this.Utils.isEqualNode(selectionNode, problemAttrName) ) {\r\n\t\t\tproblemNode = selectionNode;\r\n\t\t} else {\r\n\t\t\tproblemNode = this.UILib.findNodeParents(selectionNode, problemNodeName, problemAttrName)[0];\r\n\t\t}\r\n\r\n\t\t// Sometimes browser create start of the selection in wrong place.\r\n\t\t// For example:\r\n \t\t// Actual: ^<span class=\"spelling-problem\" data-spellingParentsNode=\"mispelled\" data-spelling-lang=\"en_US\">mispelled</span>^\r\n\t\t// Expected: <span class=\"spelling-problem\" data-spellingParentsNode=\"mispelled\" data-spelling-lang=\"en_US\">^mispelled^</span>\r\n\t\tif (!problemNode && !collapsed) {\r\n\t\t\trangeText = this.removeSpecialCharacters( range.toString() );\r\n\t\t\trangeText = isBackwards ? rangeText.split('').reverse().join('') : rangeText;\r\n\r\n\t\t\trangeNodes = range.getNodes();\r\n\t\t\trangeNodes = isBackwards ? rangeNodes.reverse() : rangeNodes;\r\n\r\n \t\t\tfor (var i = 0, len = rangeNodes.length; i < len; i++) {\r\n \t\t\t\telement = rangeNodes[i];\r\n\r\n \t\t\t\t// We need first node with CORE UI problem in nodes from the range\r\n\t\t\t\tif ( element.nodeType === 1 && this.UILib.hasClass(element, problemClassName) ) {\r\n\t\t\t\t\tproblemWord = this.UILib.attr(element, problemAttrName);\r\n\t\t\t\t\tproblemWord = isBackwards ? problemWord.split('').reverse().join('') : problemWord;\r\n\r\n\t\t\t\t\tproblemStartsFromRange = (problemWord.length >= rangeText.length && problemWord.indexOf(rangeText) === 0);\r\n\t\t\t\t\trangeStartsFromProblem = (problemWord.length < rangeText.length && rangeText.indexOf(problemWord) === 0);\r\n\r\n\t\t\t\t\t// If misspelled word contains range word in the start:\r\n\t\t\t\t\t// ^<span class=\"spelling-problem\" data-spellingParentsNode=\"mispelled\" data-spelling-lang=\"en_US\">mispell^ed</span>\r\n\t\t\t\t\t// or range string contains misspelled word in the start:\r\n\t\t\t\t\t// ^<span class=\"spelling-problem\" data-spellingParentsNode=\"mispelled\" data-spelling-lang=\"en_US\">mispelled</span> test^\r\n\t\t\t\t\t// then we can return this node like misspelled node\r\n\t\t\t\t\tif (problemStartsFromRange || rangeStartsFromProblem) {\r\n \t\t\t\t\t\tproblemNode = element;\r\n\t\t\t\t\t}\r\n\r\n \t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn problemNode;\r\n\t};\r\n\r\n\tthis.getSpellingNodeFromSelection = function() {\r\n\t\treturn this.getProblemNodeFromSelection('spelling');\r\n\t};\r\n\r\n\tthis.getGrammarNodeFromSelection = function() {\r\n\t\treturn this.getProblemNodeFromSelection('grammar');\r\n\t};\r\n\r\n\tthis.getSpellingNodesInElement = function(node) {\r\n\t\tvar container = node ? node : this.getOption('container'),\r\n\t\t\tspellingAttrName = this.getOption('data_attribute_name');\r\n\r\n\t\treturn this.UILib.find('[' + spellingAttrName + ']', container);\r\n\t};\r\n\r\n\tthis.getGrammarNodesInElement = function(node) {\r\n\t\tvar container = node ? node : this.getOption('container'),\r\n\t\t\tgrammarAttrName = this.getOption('problem_grammar_data_attribute');\r\n\r\n\t\treturn this.UILib.find('[' + grammarAttrName + ']', container);\r\n\t};\r\n\r\n\tthis.getParentBlockElement = function(node) {\r\n\t\tvar blockElementsRegex = this.getRegExp('blockElementsRegex'),\r\n\t\t\tcontainer = this.getOption('container');\r\n\r\n\t\twhile (node !== container) {\r\n\t\t\tif ( blockElementsRegex.search(node.nodeName) !== -1 ) {\r\n\t\t\t\treturn node;\r\n\t\t\t} else {\r\n\t\t\t\tnode = node.parentNode;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn node;\r\n\t};\r\n\r\n\tthis.getOffsetParent = function(node) {\r\n\t\tvar doc = this.Utils.getCurrentDocument(this.getOption('documentContainer')),\r\n\t\t\toffsetParent = node.offsetParent || doc.documentElement;\r\n\r\n\t\tif ( offsetParent === doc.body && this.Utils.getComputedStyle(offsetParent)['position'] === 'static' ) {\r\n\t\t\toffsetParent = offsetParent.parentNode;\r\n\t\t}\r\n\r\n\t\treturn offsetParent;\r\n\t};\r\n\r\n\tthis.getPrevSymbol = function(parent, node) {\r\n\t\tvar range = this.createRange(),\r\n\t\t\tel = document.createElement('div'),\r\n\t\t\tfrag, text;\r\n\r\n\t\trange.setStart(parent, 0);\r\n\t\trange.setEndBefore(node);\r\n\r\n\t\tfrag = range.cloneContents();\r\n\t\tel.appendChild(frag);\r\n\t\ttext = el.textContent || el.innerText;\r\n\t\ttext = this.removeSpecialCharacters(text);\r\n\r\n\t\treturn text[text.length - 1];\r\n\t};\r\n\r\n\tthis.getNextSymbol = function(parent, node) {\r\n\t\tvar range = this.createRange(),\r\n\t\t\tel = document.createElement('div'),\r\n\t\t\tfrag, text;\r\n\r\n\t\trange.setStartAfter(node);\r\n\t\trange.setEnd(parent, parent.childNodes.length);\r\n\r\n\t\tfrag = range.cloneContents();\r\n\t\tel.appendChild(frag);\r\n\t\ttext = el.textContent || el.innerText;\r\n\t\ttext = this.removeSpecialCharacters(text);\r\n\r\n\t\treturn text[0];\r\n\t};\r\n\r\n\tthis.getTextBeforeCursor = function() {\r\n\t\tvar range = this.createRange(),\r\n\t\t\tel = document.createElement('div'),\r\n\t\t\tselection = this.getSelection(),\r\n\t\t\tfrag, text;\r\n\r\n\t\tif (selection.rangeCount() === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\trange.setStart( this.getOption('container'), 0 );\r\n\t\trange.setEnd( selection.anchorNode(), selection.anchorOffset() );\r\n\r\n\t\tfrag = range.cloneContents();\r\n\t\tel.appendChild(frag);\r\n\t\ttext = el.textContent || el.innerText;\r\n\t\ttext = this.removeSpecialCharacters(text);\r\n\r\n\t\treturn text;\r\n\t};\r\n\r\n\tthis.isNodeContentBroken = function(node, problemAttrName) {\r\n\t\tvar attrWord = node.getAttribute(problemAttrName),\r\n\t\t\trealWord = node.textContent || node.innerText;\r\n\r\n\t\trealWord = this.removeSpecialCharacters(realWord);\r\n\r\n\t\treturn (attrWord !== realWord);\r\n\t};\r\n\r\n\tthis.getBrokenProblemNodes = function(type, node) {\r\n\t\tvar focused = this.getOption('focused'),\r\n\t\t\tselection = this.getSelection(),\r\n\t\t\twordBoundaryRegex = this.getRegExp('wordBoundaryRegex'),\r\n\t\t\tself = this,\r\n\t\t\t_node, getProblemNodesInElement, problemNodesToRemove, problemAttrName;\r\n\r\n\t\tswitch (type) {\r\n\t\t\tcase 'spelling':\r\n\t\t\t\tproblemAttrName = this.getOption('data_attribute_name');\r\n\t\t\t\tgetProblemNodesInElement = 'getSpellingNodesInElement';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'grammar':\r\n\t\t\t\tproblemAttrName = this.getOption('problem_grammar_data_attribute');\r\n\t\t\t\tgetProblemNodesInElement = 'getGrammarNodesInElement';\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tif (node) {\r\n\t\t\t_node = node;\r\n\t\t} else if (focused) {\r\n\t\t\t_node = selection.anchorNode();\r\n\t\t}\r\n\r\n\t\tif (_node) {\r\n\t\t\t_node = this.getParentBlockElement(_node);\r\n\t\t\tproblemNodesToRemove = this[getProblemNodesInElement](_node);\r\n\r\n\t\t\tproblemNodesToRemove = problemNodesToRemove.filter(function(node) {\r\n\t\t\t\tif ( self.isNodeContentBroken(node, problemAttrName) ) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar prevSymbol = self.getPrevSymbol(_node, node);\r\n\r\n\t\t\t\tif ( prevSymbol && !wordBoundaryRegex.test(prevSymbol) ) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar nextSymbol = self.getNextSymbol(_node, node);\r\n\r\n\t\t\t\tif ( nextSymbol && !wordBoundaryRegex.test(nextSymbol) ) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn problemNodesToRemove;\r\n\t\t}\r\n\t};\r\n\r\n\tthis.getBrokenSpellingNodes = function(node) {\r\n\t\treturn this.getBrokenProblemNodes('spelling', node);\r\n\t};\r\n\r\n\tthis.getBrokenGrammarNodes = function(node) {\r\n\t\treturn this.getBrokenProblemNodes('spelling', node);\r\n\t};\r\n\r\n\tthis.getProblemsCount = function() {\r\n\t\tvar spellingNodes = this.getSpellingNodesInElement(),\r\n\t\t\tgrammarNodes = this.getGrammarNodesInElement(),\r\n\t\t\tnodes = spellingNodes.concat(grammarNodes),\r\n\t\t\tnumber = 0;\r\n\r\n\t\tfor (var i = 0, len = nodes.length; i < len; i++) {\r\n\t\t\tif (nodes[i].innerHTML || nodes[i].clientWidth) {\r\n\t\t\t\tnumber++;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn number;\r\n\t};\r\n\r\n\tthis.isCaretInStartOfMisspelledWord = function() {\r\n\t\tvar selection = this.getSelection(),\r\n\t\t\trange = selection.rangeCount() ? selection.getRangeAt(0) : null,\r\n\t\t\tmisspelledAttrName = this.getOption('data_attribute_name'),\r\n\t\t\tcontainer = this.getOption('container'),\r\n\t\t\tblockElementsRegex = this.getRegExp('blockElementsRegex'),\r\n\t\t\twordBoundaryRegex = this.getRegExp('wordBoundaryRegex'),\r\n\t\t\tspellingNode, walker, text;\r\n\r\n\t\tif( !range || !range.collapsed() ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tspellingNode = this.getSpellingNodeFromSelection();\r\n\r\n\t\tif (spellingNode) {\r\n\t\t\tif ( range.startOffset() === 0 ) {\r\n\t\t\t\treturn spellingNode;\r\n\t\t\t} else {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\twalker = new this.Utils.Walker(range.startContainer(), range.startOffset(), true, container);\r\n\r\n\t\t\tdo {\r\n\t\t\t\tif ( walker.siblingNode && blockElementsRegex.test(walker.siblingNode.nodeName.toLowerCase()) ) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( this.Utils.isEqualNode(walker.currentNode, misspelledAttrName) ) {\r\n\t\t\t\t\tspellingNode = walker.currentNode;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttext = this.replaceSepatators(walker.textWalkedThrough);\r\n\r\n\t\t\t\tif ( wordBoundaryRegex.test(text) ) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} while ( walker.getNext() );\r\n\t\t}\r\n\r\n\t\treturn spellingNode;\r\n\t};\r\n\r\n\tthis.isCaretInEndOfMisspelledWord = function() {\r\n\t\tvar spellingNode,\r\n\t\t\tselection = this.getSelection(),\r\n\t\t\trange = selection.rangeCount() ? selection.getRangeAt(0) : null,\r\n\t\t\tstartContainer,\r\n\t\t\tendNode,\r\n\t\t\twalker,\r\n\t\t\tmisspelledAttrName = this.getOption('data_attribute_name'),\r\n\t\t\tcontainer = this.getOption('container'),\r\n\t\t\tthrowRange;\r\n\r\n\t\tif( !range || !range.collapsed() ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tspellingNode = this.getSpellingNodeFromSelection();\r\n\t\tif(spellingNode) {\r\n\t\t\tstartContainer = range.startContainer();\r\n\t\t\tif( range.startOffset() === startContainer.length && spellingNode.childNodes[spellingNode.childNodes.length - 1] === startContainer) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t// in FF sometimes caret seted behind node if we set cursor in end of misspelled word\r\n\t\t} else {\r\n\t\t\tendNode = range.startContainer();\r\n\t\t\tif(endNode.childNodes && endNode.childNodes.length > 0) {\r\n\t\t\t\tendNode = endNode.childNodes[range.startOffset()];\r\n\t\t\t\t//we in end of control\r\n\t\t\t\tif(!endNode) return true;\r\n\t\t\t} else if( range.startOffset() !== 0 ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\twalker = new this.Utils.Walker(endNode, 0, false, container);\r\n\r\n\t\t\tdo {\r\n\r\n\t\t\t\tif(this.Utils.isEqualNode(walker.currentNode, misspelledAttrName) && walker.textWalkedThrough.length > 0) {\r\n\r\n\t\t\t\t\tspellingNode = walker.currentNode;\r\n\t\t\t\t\tspellingNode = this.getLatestTextNodeFromSpellingNode(spellingNode);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} while (walker.getNext());\r\n\r\n\t\t\t// TODO. improve spellingNode search algorithm\r\n\t\t\tif(!spellingNode) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tthrowRange = this.createRange();\r\n\t\t\tthrowRange.setStart(spellingNode, spellingNode.nodeValue.length);\r\n\t\t\tthrowRange.setEnd(endNode, 0);\r\n\r\n\t\t\t// FF return false on collapsed method, but range length equeal 0. Sad but true;\r\n\t\t\tif(throwRange.toString().length === 0 ) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t};\r\n\r\n\tthis.getLatestTextNodeFromSpellingNode = function(node) {\r\n\t\twhile (node.childNodes.length) {\r\n\t\t\tnode = node.childNodes[node.childNodes.length - 1];\r\n\t\t}\r\n\r\n\t\treturn node;\r\n\t}\r\n\r\n\tthis.saveRange = function(range, backward) {\r\n\t\tvar savedRange;\r\n\r\n\t\tsavedRange = core.getService(\"RangeCreator\").getRangeManager().saveRange(range, backward);\r\n\r\n\t\tcore.logger.log({\r\n\t\t\t'name': moduleID,\r\n\t\t\t'msg': 'Save the range',\r\n\t\t\t'data': savedRange,\r\n\t\t\t'type': 'range'\r\n\t\t});\r\n\r\n\t\treturn savedRange;\r\n\t};\r\n\r\n\tthis.restoreRange = function(rangeInfo, normalize) {\r\n\t\tvar restoredRange;\r\n\r\n\t\tif(rangeInfo) {\r\n\t\t\trestoredRange = core.getService(\"RangeCreator\").getRangeManager().restoreRange(rangeInfo, normalize);\r\n\r\n\t\t\tcore.logger.log({\r\n\t\t\t\t'name': moduleID,\r\n\t\t\t\t'msg': 'Restore the range',\r\n\t\t\t\t'data': restoredRange,\r\n\t\t\t\t'type': 'range'\r\n\t\t\t});\r\n\r\n\t\t\treturn restoredRange;\r\n\t\t}\r\n\t};\r\n\r\n\tthis.getMainContainer = function() {\r\n\t\treturn this.getOption('isIframe') ? this.getOption('documentContainer') : this.getOption('container');\r\n\t};\r\n\r\n\tthis.getContainerInstance = function() {\r\n\t\tvar wrapper = core.getService('Wrapper'),\r\n\t\t\tmirror = core.getService('Mirror'),\r\n\t\t\tckeditor5 = this.getOption('originalContainer').editor;\r\n\r\n\t\tif (ckeditor5 && ckeditor5.getData && ckeditor5.setData) {\r\n\t\t\treturn ckeditor5;\r\n\t\t}\r\n\r\n\t\tif (wrapper) {\r\n\t\t\treturn wrapper;\r\n\t\t}\r\n\r\n\t\tif (mirror) {\r\n\t\t\treturn mirror;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t};\r\n\r\n\tthis.getDataFromContainer = function() {\r\n\t\tvar containerInstance = this.getContainerInstance();\r\n\r\n\t\tif (containerInstance) {\r\n\t\t\treturn containerInstance.getData();\r\n\t\t}\r\n\r\n\t\treturn this.getHtmlWithoutProblemNodes( this.getOption('originalContainer').innerHTML );\r\n\t};\r\n\r\n\tthis.setDataToContainer = function(data) {\r\n\t\tvar containerInstance = this.getContainerInstance();\r\n\r\n\t\tif (typeof data !== 'string') {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (containerInstance) {\r\n\t\t\tcontainerInstance.setData(data);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tdata = this.getHtmlWithoutProblemNodes(data);\r\n\r\n\t\tthis.getOption('originalContainer').innerHTML = data;\r\n\t};\r\n\r\n\tthis.isCacheAvailable = function() {\r\n\t\treturn !this.getOption('disableCache') && !this.getOption('customDictionaryIds') && !this.getOption('cdModificationTime') && this.Utils.isLocalStorageSupported();\r\n\t};\r\n\r\n\tfunction accessLimitation(object, privats) {\r\n\t\tvar returnedObject = {};\r\n\r\n\t\tfor (var k in object) {\r\n\t\t\tif(!object.hasOwnProperty(k)) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(privats.indexOf(k) === -1) {\r\n\t\t\t\treturnedObject[k] = object[k].bind(object);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn returnedObject;\r\n\t}\r\n\t// Function what make overall view for arguments.\r\n\t// If arguments was provided separated by commas like \"func(arg1 ,arg2)\" we create\r\n\t// ArgumentsObject and write keys from argsNames and value from args.\r\n\t// in case wheare we provide args in object luke \"func({arg1: value})\"\r\n\t// we just return that object\r\n\tfunction  argumentsToObject(keys, args) {\r\n\t\tvar ArgumentsObject = {};\r\n\t\targs = core.Utils.ArrayUtils.argumentsToArray(args);\r\n\t\tif ( core.Utils.is(args[0], 'Object') ) {\r\n\t\t\tArgumentsObject = args[0];\r\n\t\t} else {\r\n\t\t\tArgumentsObject = core.Utils.ArrayUtils.zipArraysToObject(keys, args);\r\n\t\t}\r\n\r\n\t\treturn ArgumentsObject;\r\n\t}\r\n\r\n\t// check whether bookmark functionality can be used or not\r\n\tfunction bookmarksIsEnabled() {\r\n\t\tvar result,\r\n\t\t\tisLeftMouseButtonPressed = this.getOption('leftMouseButtonPressed'),\r\n\t\t\tisIE = this.Utils.Browser.ie;\r\n\r\n\t\tif(isIE && isLeftMouseButtonPressed) {\r\n\t\t\tresult = false;\r\n\t\t} else {\r\n\t\t\tresult = true;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n};\n// uilib.js\n/**\n * @fileoverview Static Module. CORE UI library module.\n * @Adapter Pattern\n */\n\n(function( exports ) {\n\t'use strict';\n\tvar libAdapter, jQuipAdapter, IEHandlers = [],\n\t\tjQuip;\n\n\t/*\n\t * adapter for jQuip UI library\n\t * @constructor\n\t */\n\tjQuipAdapter = function() {\n\t\t// Convert jquip set of elements to array of native DOM objects\n\t\tfunction getNative(jObject) {\n\t\t\tvar result = jObject,\n\t\t\t\ttype = Object.prototype.toString.call(jObject).slice(8, -1).toLowerCase();\n\n\t\t\t// We need to skip all incoming data from transforming into array but jquip objects only\n\t\t\tif(jObject && type === 'object' && typeof jObject.toArray !== 'undefined') {\n\t\t\t\tresult = jObject.toArray();\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\n\t\t// Converts array of native DOM objects, DOM object, selector or HTMLCollection to jquip set of elements\n\t\tfunction getjObject(selector) {\n\t\t\tvar array = [],\n\t\t\t\ttype = Object.prototype.toString.call(selector).slice(8, -1).toLowerCase();\n\n\t\t\t// lets convert HTMLCollection to array. Because jquip doesn't work with those kind of objects\n\t\t\tif(selector && (type === 'htmlcollection' || type === 'nodelist' || (type === 'object' && typeof selector.length !== 'undefined' && typeof selector[0] !== 'undefined' && typeof selector.nodeType === 'undefined'))) {\n\t\t\t\tfor(var i = 0; i < selector.length; array.push(selector[i]), i++) {}\n\t\t\t\tselector = array;\n\t\t\t}\n\n\t\t\treturn jQuip(selector);\n\t\t}\n\t\t// search methods\n\t\tthis.find = function(selector, context) {\n\t\t\tvar result;\n\n\t\t\tif(typeof context == 'undefined') {\n\t\t\t\tresult = getjObject(selector);\n\t\t\t} else {\n\t\t\t\tresult = getjObject(context).find(selector);\n\t\t\t}\n\n\t\t\treturn getNative(result);\n\t\t};\n\n\t\tthis.parent = function(selector, context) {\n\t\t\tvar result = getjObject(selector).parent(context);\n\n\t\t\treturn getNative(result);\n\t\t};\n\n\t\tthis.parents = function(selector, context) {\n\t\t\tvar result = getjObject(selector).parents(context);\n\n\t\t\treturn getNative(result);\n\t\t};\n\n\t\tthis.is = function(selector, state) {\n\t\t\tvar result = getjObject(selector).is(state);\n\n\t\t\treturn getNative(result);\n\t\t};\n\n\t\tthis.each = function(selector, callback) {\n\t\t\tgetjObject(selector).each(callback);\n\t\t};\n\n\t\tthis.filter = function(selector, context) {\n\t\t\tvar result = getjObject(selector).filter(context);\n\n\t\t\treturn getNative(result);\n\t\t};\n\n\t\t// DOM manipulations\n\t\tthis.create = function(selector) {\n\t\t\treturn getNative(jQuip(selector));\n\t\t};\n\n\t\tthis.remove = function(selector) {\n\t\t\treturn getNative(jQuip(selector).remove());\n\t\t};\n\n\t\tthis.appendTo = function(selector, context) {\n\t\t\treturn getNative(jQuip(selector).appendTo(jQuip(context)));\n\t\t};\n\n\t\tthis.prependTo = function(selector, context) {\n\t\t\treturn getNative(jQuip(selector).prependTo(jQuip(context)));\n\t\t};\n\n\t\tthis.append = function(selector, context) {\n\t\t\treturn getNative(jQuip(selector).append(jQuip(context)));\n\t\t};\n\n\t\tthis.prepend = function(selector, context) {\n\t\t\treturn getNative(jQuip(selector).prepend(jQuip(context)));\n\t\t};\n\n\t\tthis.insertAfter = function(selector, context) {\n\t\t\treturn getNative(jQuip(selector).insertAfter(jQuip(context)));\n\t\t};\n\n\t\tthis.insertBefore = function(selector, context) {\n\t\t\treturn getNative(jQuip(selector).insertBefore(jQuip(context)));\n\t\t};\n\n\t\tthis.attr = function(selector, attrName, attrValue) {\n\t\t\treturn getNative(jQuip(selector).attr(attrName, attrValue));\n\t\t};\n\n\t\tthis.removeAttr = function(selector, attrName) {\n\t\t\treturn getNative(jQuip(selector).removeAttr(attrName));\n\t\t};\n\n\t\tthis.addClass = function(selector, className) {\n\t\t\treturn getNative(jQuip(selector).addClass(className));\n\t\t};\n\n\t\tthis.removeClass = function(selector, className) {\n\t\t\treturn getNative(jQuip(selector).removeClass(className));\n\t\t};\n\n\t\tthis.hasClass = function(selector, className) {\n\t\t\treturn getNative(jQuip(selector).hasClass(className));\n\t\t};\n\n\t\tthis.css = function(selector, cssProperty) {\n\t\t\treturn getNative(jQuip(selector).css(cssProperty));\n\t\t};\n\n\t\tthis.show = function(selector) {\n\t\t\treturn getNative(jQuip(selector).show());\n\t\t};\n\n\t\tthis.hide = function(selector) {\n\t\t\treturn getNative(jQuip(selector).hide());\n\t\t};\n\n\t\tthis.html = function(selector, newHtml) {\n\t\t\treturn getNative(jQuip(selector).html(newHtml));\n\t\t};\n\n\t\tthis.val = function(selector, newVal) {\n\t\t\treturn getNative(jQuip(selector).val(newVal));\n\t\t};\n\n\t\tthis.text = function(selector, newText) {\n\t\t\treturn getNative(jQuip(selector).text(newText));\n\t\t};\n\n\t\tthis.empty = function(selector) {\n\t\t\treturn getNative(jQuip(selector).empty());\n\t\t};\n\n\t\t// events\n\t\tthis.domReady = function(callback) {\n\t\t\tjQuip(callback);\n\t\t};\n\n\t\tthis.on = function(eventName, selector, delegate, eventHandler) {\n\t\t\tjQuip(selector).on(eventName, delegate, eventHandler);\n\t\t};\n\n\t\tthis.off = function(eventName, selector, delegate, eventHandler) {\n\t\t\tjQuip(selector).off(eventName, delegate, eventHandler);\n\t\t};\n\n\t\tthis.trigger = function(eventName, selector) {\n\t\t\treturn jQuip(selector).trigger(eventName);\n\t\t};\n\n\t\tthis.getEventTarget = function(jEvent) {\n\t\t\tvar target = jEvent.target;\n\t\t\t// Fix target property, if necessary (IE 6/7/8 & Safari2)\n\t\t\tif(!target) {\n\t\t\t\ttarget = jEvent.srcElement || document;\n\t\t\t}\n\n\t\t\t// Target should not be a text node (Safari)\n\t\t\tif(target.nodeType === 3) {\n\t\t\t\ttarget = target.parentNode;\n\t\t\t}\n\n\t\t\treturn target;\n\t\t};\n\n\t\tthis.cancelEvent = function(jEvent) {\n\t\t\treturn jQuip.cancelEvent(jEvent);\n\t\t};\n\n\t\t// Move our preventDefault(#34611) from jquip into adapter\n\t\tthis.preventDefault = function(jEvent) {\n\t\t\tif (jEvent) {\n\t\t\t\t// if preventDefault exists run it on the original event\n\t\t\t\tif (jEvent.preventDefault) {\n\t\t\t\t\tjEvent.preventDefault();\n\n\t\t\t\t// otherwise set the returnValue property of the original event to false (IE)\n\t\t\t\t} else {\n\t\t\t\t\tjEvent.returnValue = false;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.defaultPrevented = function(jEvent) {\n\t\t\tif (jEvent) {\n\t\t\t\tif (jEvent.defaultPrevented !== undefined) {\n\t\t\t\t\treturn jEvent.defaultPrevented;\n\n\t\t\t\t// otherwise set the returnValue property of the original event to false (IE)\n\t\t\t\t} else {\n\t\t\t\t\treturn (jEvent.returnValue === false) ? true : false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn jEvent.defaultPrevented;\n\t\t};\n\n\t\tthis.stopPropagation = function(jEvent){\n\t\t\tif (jEvent) {\n\t\t\t\tjEvent.cancelBubble = true;\n\t\t\t\t// if stopPropagation exists run it on the original event\n\t\t\t\tif (jEvent.stopPropagation) {\n\t\t\t\t\tjEvent.stopPropagation();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.stopImmediatePropagation = function(jEvent){\n\t\t\tif (jEvent) {\n\t\t\t\t// if stopImmediatePropagation exists run it on the original event\n\t\t\t\tjEvent.isImmediatePropagationStopped = function() {\n\t\t\t\t\treturn true;\n\t\t\t\t};\n\t\t\t\tthis.stopPropagation(jEvent);\n\t\t\t\tif (jEvent.stopImmediatePropagation) {\n\t\t\t\t\tjEvent.stopImmediatePropagation();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.focus = function(selector, fn) {\n\t\t\tvar args = [], target;\n\n\t\t\tArray.prototype.push.apply(args, arguments);\n\t\t\ttarget = jQuip(args.shift());\n\t\t\treturn getNative(target.focus.apply(target, args));\n\t\t};\n\n\t\tthis.blur = function(selector, fn) {\n\t\t\tvar args = [], target;\n\n\t\t\tArray.prototype.push.apply(args, arguments);\n\t\t\ttarget = jQuip(args.shift());\n\t\t\treturn getNative(target.blur.apply(target, args));\n\t\t};\n\n\t\tthis.contextmenu = function(selector, fn) {\n\t\t\tvar args = [], target;\n\n\t\t\tArray.prototype.push.apply(args, arguments);\n\t\t\ttarget = jQuip(args.shift());\n\t\t\treturn getNative(target.contextmenu.apply(target, args));\n\t\t};\n\n\t\tthis.proxy = function(fn, context) {\n\t\t\treturn jQuip.proxy(fn, context);\n\t\t};\n\n\t\t// css\n\t\tthis.width = function(selector, margin) {\n\t\t\treturn jQuip(selector).width(margin);\n\t\t};\n\n\t\tthis.height = function(selector, margin) {\n\t\t\treturn jQuip(selector).height(margin);\n\t\t};\n\n\t\tthis.outerWidth = function(selector, margin) {\n\t\t\treturn jQuip(selector).outerWidth(margin);\n\t\t};\n\n\t\tthis.outerHeight = function(selector, margin) {\n\t\t\treturn jQuip(selector).outerHeight(margin);\n\t\t};\n\n\t\tthis.scrollLeft = function(selector, value) {\n\t\t\treturn jQuip(selector).scrollLeft(value);\n\t\t};\n\n\t\tthis.scrollTop = function(selector, value) {\n\t\t\treturn jQuip(selector).scrollTop(value);\n\t\t};\n\n\t\tthis.offset = function(selector) {\n\t\t\treturn jQuip(selector).offset();\n\t\t};\n\n\t\t// misc\n\t\tthis.extend = function(/* [ deep,] target, object1 [, objectN ] */) {\n\t\t\treturn jQuip.extend.apply(jQuip, arguments);\n\t\t};\n\t};\n\n\t// define current adapter\n\tlibAdapter = new jQuipAdapter();\n\n\t/**\n\t * @exports CORE.prototype.UILib\n\t */\n\tvar UILib = {\n\n\t\t/**\n\t\t * Return a collection of matched elements found in the DOM based on passed argument(s). If only \"selector\" specified - returns all elements that match. If \"context\" was specified as well,\n\t\t * returns the descendants of \"context\", filtered by a selector.\n\t\t *\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList} selector - What to find\n\t\t * @param {string|DOMNode} [context] - where to find\n\t\t * @returns {Array.<DOMNode>} - Array of matched elements\n\t\t */\n\t\tfind: function(selector, context) {\n\t\t\treturn libAdapter.find.apply(libAdapter, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Get the parent of each element in the current set of matched elements, optionally filtered by a \"context\". Note, that this method travels only single level up the DOM tree.\n\t\t *\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList} selector - Parent of node to find\n\t\t * @param {string|DOMNode} [context] - Specify filter for found parents\n\t\t * @returns {Array.<DOMNode>} - Array of matched elements\n\t\t */\n\t\tparent: function(selector, context) {\n\t\t\treturn libAdapter.parent.apply(libAdapter, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Get the parents of each element in the current set of matched elements, optionally filtered by a \"context\".\n\t\t *\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList} selector - Parents of node to find\n\t\t * @param {string|DOMNode} [context] - Specify filter for found parents\n\t\t * @returns {Array.<DOMNode>} - Array of matched elements\n\t\t */\n\t\tparents: function(selector, context) {\n\t\t\treturn libAdapter.parents.apply(libAdapter, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Check state of element\n\t\t *\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList} selector - Which node state we will check\n\t\t * @param {string} state - State that we will check. Right now implemented only two states checking: \":visible\" and \":hidden\"\n\t\t * @returns {boolean} - State result\n\t\t */\n\t\tis: function(selector, state) {\n\t\t\treturn libAdapter.is.apply(libAdapter, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Iterate over an array or HTMLCollection, executing a function for each matched element.\n\t\t *\n\t\t * @param {Array|HTMLCollection|NodeList} selector - Set of elements or an array that we need to travel through\n\t\t * @param {function} callback - Callback\n\t\t */\n\t\teach: function(selector, callback) {\n\t\t\tlibAdapter.each.apply(libAdapter, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Reduce the set of matched elements to those that match the selector or pass the function's test.\n\t\t *\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList} selector - Set of elements to filter or selector of this elements\n\t\t * @param {string|DOMNode|function} context - Context that could be: 1) a string containing a selector expression to match the current set of elements against;\n\t\t * 2) one or more DOM elements to match the current set of elements against; 3) a function used as a test for each element in the set. this is the current DOM element.\n\t\t * return true if you want to add current DOM element to set of matched elements\n\t\t * @returns {Array.<DOMNode>} - Array of matched elements\n\t\t */\n\t\tfilter: function(selector, context) {\n\t\t\treturn libAdapter.filter.apply(libAdapter, arguments);\n\t\t},\n\n\t\t// =======DOM manipulations=======\n\t\t/**\n\t\t * Return an array of matched elements created by passing an HTML string.\n\t\t *\n\t\t * @param {string} selector - What to create\n\t\t * @returns {Array.<DOMNode>} - Array of created elements\n\t\t */\n\t\tcreate: function(selector) {\n\t\t\treturn libAdapter.create.apply(libAdapter, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Return an array of removed elements that match the \"selector\".\n\t\t *\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList|Array.<DOMNode>} selector - What to remove\n\t\t * @returns {Array.<DOMNode>} - Array of removed elements\n\t\t */\n\t\tremove: function(selector) {\n\t\t\treturn libAdapter.remove.apply(libAdapter, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Insert every element in the set of matched elements to the end of the \"context\".\n\t\t *\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList|Array.<DOMNode>} selector - What to append\n\t\t * @param {string|DOMNode} context - Where to append\n\t\t * @returns {Array.<DOMNode>} - Array of appended elements\n\t\t */\n\t\tappendTo: function(selector, context) {\n\t\t\treturn libAdapter.appendTo.apply(libAdapter, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Insert every element in the set of matched elements to the top of the \"context\".\n\t\t *\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList|Array.<DOMNode>} selector - What to prepend\n\t\t * @param {string|DOMNode} context - Where to prepend\n\t\t * @returns {Array.<DOMNode>} - Array of prepended elements\n\t\t */\n\t\tprependTo: function(selector, context) {\n\t\t\treturn libAdapter.prependTo.apply(libAdapter, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Insert every element in the set of matched elements to the end of the \"selector\".\n\t\t *\n\t\t * @param {string|DOMNode} selector - Where to append\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList|Array.<DOMNode>} context - What to append\n\t\t * @returns {Array.<DOMNode>} - Array of appended elements\n\t\t */\n\t\tappend: function(selector, context) {\n\t\t\treturn libAdapter.append.apply(libAdapter, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Insert every element in the set of matched elements to the top of the \"selector\".\n\t\t *\n\t\t * @param {string|DOMNode} selector - Where to prepend\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList|Array.<DOMNode>} context - What to prepend\n\t\t * @returns {Array.<DOMNode>} - Array of prepended elements\n\t\t */\n\t\tprepend: function(selector, context) {\n\t\t\treturn libAdapter.prepend.apply(libAdapter, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Insert every element in the set of matched elements after \"context\".\n\t\t *\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList|Array.<DOMNode>} selector - What to insert\n\t\t * @param {string|DOMNode} context - After what element we want to insert\n\t\t * @returns {Array.<DOMNode>} - Array of inserted elements\n\t\t */\n\t\tinsertAfter: function(selector, context) {\n\t\t\treturn libAdapter.insertAfter.apply(libAdapter, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Insert every element in the set of matched elements before \"context\".\n\t\t *\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList|Array.<DOMNode>} selector - What to insert\n\t\t * @param {string|DOMNode} context - Before what element we want to insert\n\t\t * @returns {Array.<DOMNode>} - Array of inserted elements\n\t\t */\n\t\tinsertBefore: function(selector, context) {\n\t\t\treturn libAdapter.insertBefore.apply(libAdapter, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Replace element instead \"context\".\n\t\t *\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList|Array.<DOMNode>} selector - What to insert\n\t\t * @param {string|DOMNode} context - Element what will be replaced.\n\t\t * @returns {Array.<DOMNode>} - Array of inserted elements\n\t\t */\n\t\treplace: function(selector, context) {\n\t\t\tlibAdapter.insertBefore.apply(libAdapter, arguments);\n\t\t\treturn libAdapter.remove.apply(libAdapter, context);\n\t\t},\n\n\t\t/**\n\t\t * Get the value of an attribute for the first element in the set of matched elements or set one or more attributes for every matched element.\n\t\t *\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList|Array.<DOMNode>} selector - For which element(s) we want to read(set) the attr\n\t\t * @param {string} attrName - Attribute name\n\t\t * @param {string} [attrValue] - Value of attribute to set. If specified, attr will be set for every matched element\n\t\t * @returns {string|Array.<DOMNode>} - Value of specified attribute or array of elements with new \"attrName\" value\n\t\t */\n\t\tattr: function(selector, attrName, attrValue) {\n\t\t\treturn libAdapter.attr.apply(libAdapter, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Remove an attribute for the set of matched elements.\n\t\t *\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList|Array.<DOMNode>} selector - For which elements we want to remove the attr\n\t\t * @param {string} attrName - Attribute name to remove\n\t\t * @returns {Array.<DOMNode>} - Array of elements with removed attribute\n\t\t */\n\t\tremoveAttr: function(selector, attrName) {\n\t\t\treturn libAdapter.removeAttr.apply(libAdapter, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Add class for the set of matched elements.\n\t\t *\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList|Array.<DOMNode>} selector - For which elements we want to add the class\n\t\t * @param {string} className - Class name to add\n\t\t * @returns {Array.<DOMNode>} - Array of elements with added class\n\t\t */\n\t\taddClass: function(selector, className) {\n\t\t\tif( !this.hasClass(selector, className) ) {\n\t\t\t\treturn libAdapter.addClass.apply(libAdapter, arguments);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Remove class for the set of matched elements.\n\t\t *\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList|Array.<DOMNode>} selector - For which elements we want to remove the class\n\t\t * @param {string} className - Class name to remove\n\t\t * @returns {Array.<DOMNode>} - Array of elements with removed class\n\t\t */\n\t\tremoveClass: function(selector, className) {\n\t\t\tif( this.hasClass(selector, className) ) {\n\t\t\t\treturn libAdapter.removeClass.apply(libAdapter, arguments);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Check whether matched element contains specific class or not\n\t\t *\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList|Array.<DOMNode>} selector - For which elements we want to check the class\n\t\t * @param {string} className - Class name to check\n\t\t * @returns {boolean} - Result of class existance\n\t\t */\n\t\thasClass: function(selector, className) {\n\t\t\treturn libAdapter.hasClass.apply(libAdapter, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Get the value of a style property for the first element in the set of matched elements or set one or more CSS properties for every matched element.\n\t\t *\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList|Array.<DOMNode>} selector - For which element(s) we want to read(set) the style property\n\t\t * @param {string|Object.<string, string>} cssProperty - Style property name to read or object that contains css properties to be set\n\t\t * @returns {string|Array.<DOMNode>} - Value of specified style property or array of elements with new styles\n\t\t */\n\t\tcss: function(selector, cssProperty) {\n\t\t\treturn libAdapter.css.apply(libAdapter, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Display the matched elements.\n\t\t *\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList|Array.<DOMNode>} selector - Which elements we want to show\n\t\t * @returns {Array.<DOMNode>} - Array of displayed elements\n\t\t */\n\t\tshow: function(selector) {\n\t\t\treturn libAdapter.show.apply(libAdapter, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Hide the matched elements.\n\t\t *\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList|Array.<DOMNode>} selector - Which elements we want to hide\n\t\t * @returns {Array.<DOMNode>} - Array of hidden elements\n\t\t */\n\t\thide: function(selector) {\n\t\t\treturn libAdapter.hide.apply(libAdapter, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Get the HTML contents of the first element in the set of matched elements or set the HTML contents of every matched element.\n\t\t *\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList|Array.<DOMNode>} selector - For which element(s) we want to read(set) the HTML\n\t\t * @param {string} [newHtml] - New html to set. If specified, new html will be set for every matched element\n\t\t * @returns {string|Array.<DOMNode>} - Current HTML of the first matched element or array of elements with new HTML\n\t\t */\n\t\thtml: function(selector, newHtml) {\n\t\t\treturn libAdapter.html.apply(libAdapter, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Get the current value of the first element in the set of matched elements or set the value of every matched element.\n\t\t *\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList|Array.<DOMNode>} selector - For which element(s) we want to read(set) the value\n\t\t * @param {string} [newVal] - New value to set. If specified, new value will be set for every matched element\n\t\t * @returns {string|Array.<DOMNode>} - Current value of the first matched element or array of elements with new value\n\t\t */\n\t\tval: function(selector, newVal) {\n\t\t\treturn libAdapter.val.apply(libAdapter, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Get the current text of the first element in the set of matched elements or set the text of every matched element.\n\t\t *\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList|Array.<DOMNode>} selector - For which element(s) we want to read(set) the text\n\t\t * @param {string} [newText] - New text to set. If specified, new text will be set for every matched element\n\t\t * @returns {string|Array.<DOMNode>} - Current text of the first matched element or array of elements with new text\n\t\t */\n\t\ttext: function(selector, newText) {\n\t\t\treturn libAdapter.text.apply(libAdapter, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Remove all children from specified selector\n\t\t *\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList|Array.<DOMNode>} selector - Which element(s) we want to empty\n\t\t * @returns {string|Array.<DOMNode>} - Array of emptied elements\n\t\t */\n\t\tempty: function(selector) {\n\t\t\treturn libAdapter.empty.apply(libAdapter, arguments);\n\t\t},\n\n\t\t// =======Events=======\n\t\t/**\n\t\t * Binds a function to be executed when the DOM has finished loading.\n\t\t *\n\t\t * @param {function} callback - The function to execute when the DOM is ready\n\t\t */\n\t\tdomReady: function(callback) {\n\t\t\tlibAdapter.domReady(callback);\n\t\t},\n\n\t\t/**\n\t\t * Attach an event handler function for one or more events to the selected elements.\n\t\t *\n\t\t * @param {string} eventName - One or more space-separated event types, such as \"click\"\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList|Array.<DOMNode>} selector - For which element(s) we want to set an event handler\n\t\t * @param {string} [delegate] - A selector string to filter the descendants of the selected elements that trigger the event. If the selector is null or omitted, the event is always triggered when it reaches the selected element.\n\t\t * @param {function} eventHandler - A function to execute when the event is triggered\n\t\t */\n\t\ton: function(eventName, selector, delegate, eventHandler) {\n\t\t\tif(eventHandler === undefined) {\n\t\t\t\teventHandler = delegate;\n\t\t\t\tdelegate = undefined;\n\t\t\t}\n\n\t\t\tlibAdapter.on.apply(libAdapter, [eventName, selector, delegate || eventHandler, eventHandler]);\n\t\t},\n\n\t\t/**\n\t\t * Remove an event handler.\n\t\t *\n\t\t * @param {string} eventName - One or more space-separated event types, such as \"click\".\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList|Array.<DOMNode>} selector - For which element(s) we want to remove an event handler\n\t\t * @param {string} [delegate] - A selector which should match the one originally passed to .on() when attaching event handlers\n\t\t * @param {function} eventHandler - A handler function previously attached for the event(s)\n\t\t */\n\t\toff: function(eventName, selector, delegate, eventHandler) {\n\t\t\tvar Utils = exports.Utils;\n\t\t\tif (eventHandler === undefined && typeof delegate === 'function') {\n\t\t\t\teventHandler = delegate;\n\t\t\t\tdelegate = undefined;\n\t\t\t}\n\n\t\t\tlibAdapter.off.apply(libAdapter, [eventName, selector, delegate, eventHandler]);\n\t\t},\n\n\t\t/**\n\t\t * Execute all handlers and behaviors attached to the matched elements for the given event type.\n\t\t *\n\t\t * @param {string} eventName - One or more space-separated event types, such as \"click\"\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList|Array.<DOMNode>} selector - For which element(s) we want to trigger an event\n\t\t */\n\t\ttrigger: function(eventName, selector, event) {\n\t\t\tif(event) {\n\t\t\t\tselector = this.find(selector)[0];\n\t\t\t\tif(selector.dispatchEvent) {\n\t\t\t\t\treturn selector.dispatchEvent(event);\n\t\t\t\t} else if (selector.fireEvent) {\n\t\t\t\t\treturn selector.fireEvent(\"on\" + eventName, event);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn libAdapter.trigger.apply(libAdapter, arguments);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Get event target\n\t\t *\n\t\t * @param {Object} e - Event\n\t\t * @returns {DOMNode} - Event target\n\t\t */\n\t\tgetEventTarget: function(e) {\n\t\t\treturn libAdapter.getEventTarget.apply(libAdapter, arguments);\n\t\t},\n\t\t/**\n\t\t * Cancel event execution\n\t\t *\n\t\t * @param {Object} e - Event\n\t\t * @returns {boolean} - returns false\n\t\t */\n\t\tcancelEvent: function(e) {\n\t\t\treturn libAdapter.cancelEvent.apply(libAdapter, arguments);\n\t\t},\n\t\t/**\n\t\t * Create event\n\t\t *\n\t\t * @param {Object} eventType - Event type\n\t\t * @returns {HTML event} - returns event\n\t\t */\n\t\tcreateEvent: function() {\n\t\t\tvar event;\n\n\t\t\tif (document.createEvent) {\n\t\t\t\tevent = document.createEvent('Event');\n\t\t\t} else if (document.createEventObject) {\n\t\t\t\tevent = document.createEventObject();\n\t\t\t}\n\n\t\t\treturn event;\n\t\t},\n\n\t\t/**\n\t\t * Prevent default browser behavior on this event rising\n\t\t *\n\t\t * @param {Object} e - Event\n\t\t */\n\t\tpreventDefault: function(e) {\n\t\t\tlibAdapter.preventDefault(e);\n\t\t},\n\n\t\t/**\n\t\t * stop propagation default browser behavior on this event rising\n\t\t *\n\t\t * @param {Object} e - Event\n\t\t */\n\t\tstopPropagation: function(e) {\n\t\t\tlibAdapter.stopPropagation(e);\n\t\t},\n\n\t\t/**\n\t\t * stop immediate propagation default browser behavior on this event rising\n\t\t *\n\t\t * @param {Object} e - Event\n\t\t */\n\t\tstopImmediatePropagation: function(e) {\n\t\t\tlibAdapter.stopImmediatePropagation(e);\n\t\t},\n\n\t\t/**\n\t\t * Returns a boolean indicating whether or not event.preventDefault() was called on the event.\n\t\t *\n\t\t * @param {Object} e - Event\n\t\t * @returns {Boolean}\n\t\t */\n\t\tisDefaultPrevented: function(e) {\n\t\t\treturn libAdapter.defaultPrevented(e);\n\t\t},\n\n\t\t/**\n\t\t * Bind an event handler to the \"focus\" JavaScript event, or trigger that event on an element.\n\t\t *\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList|Array.<DOMNode>} selector - For which element(s) we want to trigger focus event. Please note that element should be focusable\n\t\t * @param {function} [fn] - A function to execute each time the event is triggered\n\t\t * @returns {Array.<DOMNode>} - Array of focused elements or array of elements with setted up\n\t\t */\n\t\tfocus: function(selector, fn) {\n\t\t\treturn libAdapter.focus.apply(libAdapter, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Bind an event handler to the \"blur\" JavaScript event, or trigger that event on an element.\n\t\t *\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList|Array.<DOMNode>} selector - For which element(s) we want to trigger blur event. Please note that element should be focusable\n\t\t * @param {function} [fn] - A function to execute each time the event is triggered\n\t\t */\n\t\tblur: function(selector, fn) {\n\t\t\treturn libAdapter.blur.apply(libAdapter, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Bind an event handler to the \"contextmenu\" JavaScript event, or trigger that event on an element.\n\t\t *\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList|Array.<DOMNode>} selector - For which element(s) we want to trigger contextmenu event\n\t\t * @param {function} [fn] - A function to execute each time the event is triggered\n\t\t */\n\t\tcontextmenu: function(selector, fn) {\n\t\t\treturn libAdapter.contextmenu.apply(libAdapter, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Takes a function and returns a new one that will always have a particular context.\n\t\t *\n\t\t * @param {function} fn - The function whose context will be changed\n\t\t * @param {Object} context - The object to which the context (this) of the function should be set\n\t\t * @returns {function} - Function with changed context\n\t\t */\n\t\tproxy: function(fn, context) {\n\t\t\treturn libAdapter.proxy.apply(libAdapter, arguments);\n\t\t},\n\n\t\t// ===========css================\n\t\t// @TODO: add docs and test\n\t\twidth: function(selector, margin) {\n\t\t\treturn libAdapter.width.apply(libAdapter, arguments);\n\t\t},\n\n\t\t// @TODO: add docs and test\n\t\theight: function(selector, margin) {\n\t\t\treturn libAdapter.height.apply(libAdapter, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Gets the current computed width for the first element in the set of matched elements, including padding and border.\n\t\t *\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList} selector - Target element\n\t\t * @param {boolean} margin - A Boolean indicating whether to include the element's margin in the calculation.\n\t\t * @returns {number} - Returns the width of the element, along with left and right padding, border, and optionally margin, in pixels.\n\t\t */\n\t\touterWidth: function(selector, margin) {\n\t\t\treturn libAdapter.outerWidth.apply(libAdapter, arguments);\n\t\t},\n\n\t\t/**\n\t\t * Gets the current computed height for the first element in the set of matched elements, including padding and border.\n\t\t *\n\t\t * @param {string|DOMNode|HTMLCollection|NodeList} selector - Target element\n\t\t * @param {boolean} margin - A Boolean indicating whether to include the element's margin in the calculation.\n\t\t * @returns {number} - Returns the height of the element, along with top and bottom padding, border, and optionally margin, in pixels.\n\t\t */\n\t\touterHeight: function(selector, margin) {\n\t\t\treturn libAdapter.outerHeight.apply(libAdapter, arguments);\n\t\t},\n\n\t\t// @TODO: add docs and test\n\t\tscrollLeft: function(selector, value) {\n\t\t\treturn libAdapter.scrollLeft.apply(libAdapter, arguments);\n\t\t},\n\n\t\t// @TODO: add docs and test\n\t\tscrollTop: function(selector, value) {\n\t\t\treturn libAdapter.scrollTop.apply(libAdapter, arguments);\n\t\t},\n\n\t\t// @TODO: add docs and test\n\t\toffset: function(selector) {\n\t\t\treturn libAdapter.offset.apply(libAdapter, arguments);\n\t\t},\n\n\t\t// ===========misc===============\n\t\t/**\n\t\t * Merge the contents of two or more objects together into the first object.\n\t\t *\n\t\t * @param {boolean} [deep] - If true, the merge becomes recursive (aka. deep copy)\n\t\t * @param {Object} target - The object to extend. It will receive the new properties\n\t\t * @param {Object} object1 - An object containing additional properties to merge in\n\t\t * @param {...Object} [objectN] - Additional objects containing properties to merge in\n\t\t * @returns {Object} - Result of merge\n\t\t */\n\t\textend: function(/* [ deep,] target, object1 [, objectN ] */) {\n\t\t\treturn libAdapter.extend.apply(libAdapter, arguments);\n\t\t},\n\t\t/**\n\t\t * Sets position of  window.\n\t\t *\n\t\t * @param {number} x - left position\n\t\t * @param {number} y - top position\n\t\t */\n\t\tsetPosition: function(selector, x, y) {\n\t\t\tif(typeof x === 'number' && typeof y === 'number') {\n\t\t\t\tthis.css(selector, {left: x, top: y});\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * find selector in the parent element\n\t\t *\n\t\t * @param  {Node | String} parent   Where to find\n\t\t * @param  {String | DOMNode | HTMLCollection | NodeList} selector What to find\n\t\t * @return {Array.<DOMNode>}          Array of matched elements\n\t\t */\n\t\tquery: function( parent, selector ) {\n\t\t\treturn this.find( selector, parent );\n\t\t},\n\n\t\t/**\n\t\t * Find child nodes for specified node\n\t\t *\n\t\t * @param  {Node | String} selector\tWhere to find\n\t\t * @param  {Node | String} nodeName\tname of child node that we are looking for\n\t\t * @param  {String} attributeName  Attribute's name\n\t\t * @return {Array.<DOMNode>}\tArray of matched elements\n\t\t */\n\t\tfindNodeChildren: function( selector, nodeName, attributeName ) {\n\t\t\treturn this.find(nodeName + '[' + attributeName + ']', selector);\n\t\t},\n\n\t\t/**\n\t\t * Find parents for specified node\n\t\t *\n\t\t * @param  {Node | String} selector\tWhere to find\n\t\t * @param  {Node | String} nodeName\tname of parent node that we are looking for\n\t\t * @param  {String} attributeName  Attribute's name\n\t\t * @return {Array.<DOMNode>}\tArray of matched elements\n\t\t */\n\t\tfindNodeParents: function( selector, nodeName, attributeName ) {\n\t\t\treturn this.parents(selector, nodeName + '[' + attributeName + ']');\n\t\t}\n\t};\n\n\tfunction jQuipDefiner() {\n\t\tfunction wrap(method) {\n\t\t\treturn function() {\n\t\t\t\tif(!jQuip) {\n\t\t\t\t\tjQuip = WEBSPELLCHECKER.CORE.jquip;\n\t\t\t\t}\n\t\t\t\treturn method.apply(UILib, arguments);\n\t\t\t};\n\t\t}\n\n\t\tfor(var k in UILib) {\n\t\t\tif(UILib.hasOwnProperty(k) && typeof UILib[k] === 'function') {\n\t\t\t\tUILib[k] = wrap(UILib[k]);\n\t\t\t}\n\t\t}\n\t}\n\tjQuipDefiner();\n \t/**\n\t * CORE UI library static module.\n\t *\n\t * @alias CORE.prototype.UILib\n\t */\n\texports.UILib = UILib;\n\n}( WEBSPELLCHECKER.CORE.prototype ));\n// instancemanager.js\n/**\n * @fileoverview Static Module of Manage instance of CORE\n */\n\n\n(function( exports ) {\n\t'use strict';\n\n\t// make sure that we declaring instanceManager only once\n\tif(exports.instanceManager) {\n\t\treturn;\n\t}\n\n\tvar instances = [];\n\n\t/**\n\t * @exports CORE.prototype.instanceManager\n\t */\n\tvar instanceManager = {\n\n\t\t/**\n\t\t * Add to storage instances\n\t\t *\n\t\t * @param {Object} sandbox\n\t\t */\n\t\tadd: function( sandbox ) {\n\t\t\tinstances.push(sandbox);\n\t\t},\n\n\t\t/**\n\t\t * Remove within storage instances\n\t\t *\n\t\t * @param  {String} uid Unique identifier\n\t\t */\n\t\tremove: function( uid ) {\n\n\t\t\tfor( var i=0; i < instances.length; i++ ) {\n\n\t\t\t\tif( instances[i].getOption( 'uid' ) === uid ) {\n\t\t\t\t\tinstances.splice( i, 1 );\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Get instance\n\t\t *\n\t\t * @param  {String} uid Unique identifier\n\t\t */\n\t\tgetInstance: function (uid) {\n\t\t\tvar instance = null;\n\n\t\t\tfor (var i = 0; i < instances.length; i++) {\n\n\t\t\t\tif (instances[i].getOption('uid') === uid) {\n\t\t\t\t\tinstance =  instances[i];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn instance;\n\t\t},\n\n\t\t/**\n\t\t * Notify all instances in the storage of instances\n\t\t *\n\t\t * @param  {String} eventType Event name\n\t\t * @param  {Object} data      Data\n\t\t */\n\t\tnotifyAll: function( eventType, data ) {\n\n\t\t\tfor( var i=0; i<instances.length; i++ ) {\n\t\t\t\tinstances[i].fire( eventType, data );\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Get Unique identifier\n\t\t *\n\t\t * @param  {Node} container Contaianer\n\t\t * @return {String}\t\t\tUnique identifier\n\t\t */\n\t\tgetUniqueId: function( container ) {\n\t\t\tvar hash = exports.Utils.hashCode(location.href);\n\n\t\t\treturn container.id ? container.id + '_' + hash : 'wsc_' + instances.length + '_' + hash;\n\t\t},\n\n\t\t/**\n\t\t * Get instance by ID\n\t\t *\n\t\t * @param {String} id Control ID\n\t\t * @return {Object} instance\n\t\t */\n\t\tgetControlById: function( id ) {\n\t\t\tvar instance = null;\n\n\t\t\tfor (var i = 0, len = instances.length; i < len; i++) {\n\t\t\t\tif (instances[i].originalElementId && instances[i].originalElementId === id) {\n\t\t\t\t\tinstance = instances[i].instance;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn instance;\n\t\t},\n\n\t\t/**\n\t\t * Get WSC instance for DOM element\n\t\t *\n\t\t * @param  {Node} element DOM element\n\t\t * @return {Null|Object} Null or instance\n\t\t */\n\t\tgetInstanceByElement: function( element ) {\n\t\t\tvar instance = null;\n\n\t\t\tfor (var i = 0, len = instances.length; i < len; i++) {\n\t\t\t\tvar _instance = instances[i];\n\n\t\t\t\tif (_instance.getOption('container') === element || _instance.getOption('originalContainer') === element) {\n\t\t\t\t\tinstance = _instance.instance;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn instance;\n\t\t}\n\t};\n\n\t/**\n\t * Static Module of Manage instance of CORE\n\t *\n\t * @alias CORE.prototype.instanceManager\n\t */\n\texports.instanceManager = instanceManager;\n\n}( WEBSPELLCHECKER.CORE.prototype ));\n// utils.js\r\n/**\r\n * @fileoverview Static Module. CORE utils module.\r\n */\r\n\r\n(function( exports ) {\r\n\t'use strict';\r\n\r\n\t/**\r\n\t * @exports CORE.prototype.Utils\r\n\t */\r\n\tvar Utils = Object.assign({\r\n        /**\r\n\t\t * Checking the subject of emptiness\r\n\t\t * @param  {Object} object Object for checking\r\n\t\t * @return {Boolean}\r\n\t\t */\r\n\t\tobjectIsEmpty: function( object ) {\r\n\r\n\t\t\tfor( var prop in object ) {\r\n\t\t\t\tif( object.hasOwnProperty( prop ) ) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\tinvertObject: function(data) {\r\n\t\t\treturn Object.keys(data).reduce(function(obj,key){\r\n\t\t\t\tobj[ data[key] ] = key;\r\n\t\t\t\treturn obj;\r\n\t\t\t},{});\r\n\t\t},\r\n    \t/**\r\n\t\t * Walker Construcor. Node iterrator.\r\n\t\t *\r\n\t\t * @param  {Node}                         startNode\r\n\t\t * @param  {Number}                       startOffset\r\n\t\t * @param  {Bool}                         direction. true - ltr | false - rtl\r\n\t\t * @param  {Node}                         stopNode\r\n\t\t */\r\n\t\tWalker: function(startNode, startOffset, direction, stopNode) {\r\n\t\t\tvar getNextNodeMethod = direction ? 'nextSibling' : 'previousSibling';\r\n\t\t\tvar startTextChunk = startNode.nodeType === 3 ? (direction ? startNode.nodeValue.substr(startOffset, startNode.nodeValue.length) : startNode.nodeValue.substr(0, startOffset)) : '';\r\n\r\n\t\t\tthis.textWalkedThrough = startTextChunk;\r\n\t\t\tthis.currentNode = startNode;\r\n\t\t\tthis.previousNode = null;\r\n\t\t\tthis.siblingNode = null;\r\n\r\n\t\t\t// Traverse DOM step by step with keeping traverse current state\r\n\t\t\tthis.getNext = function() {\r\n\t\t\t\t// Try to go 'inside' of the current node directly taking its first or last child in case\r\n\t\t\t\t// when this is not the very first iteration (this.previousNode is not null).\r\n\t\t\t\t// We need to protect walker from go 'inside' of the node twice by the following condition:\r\n\t\t\t\t// this.currentNode.childNodes[direction * (this.currentNode.childNodes.length - 1)] !== this.previousNode\r\n\t\t\t\t// When:\r\n\t\t\t\t// [direction * (this.currentNode.childNodes.length - 1)] equals to '0' for rtl and equals 'length - 1' fot ltr\r\n\t\t\t\tif(this.currentNode.childNodes.length > 0 && this.previousNode && this.currentNode.childNodes[direction * (this.currentNode.childNodes.length - 1)] !== this.previousNode) {\r\n\t\t\t\t\tthis.previousNode = this.currentNode;\r\n\t\t\t\t\tthis.currentNode = this.currentNode.childNodes[!direction * (this.currentNode.childNodes.length - 1)];\r\n\t\t\t\t\tthis.siblingNode = null;\r\n\t\t\t\t} else\r\n\t\t\t\t// Initially process case with startOffset specifyed.\r\n\t\t\t\t// So we need to take children according to this offset.\r\n\t\t\t\t// For ltr (direction = true) we need node from startOffset (next after selection).\r\n\t\t\t\t// For rtr (direction = false) we need node from startOffset - 1 (previous before selection).\r\n\t\t\t\tif(this.currentNode.childNodes.length > 0 && !this.previousNode && this.currentNode.childNodes[startOffset - !direction]) {\r\n\t\t\t\t\tthis.previousNode = this.currentNode;\r\n\t\t\t\t\tthis.currentNode = this.currentNode.childNodes[startOffset - !direction];\r\n\t\t\t\t\tthis.siblingNode = null;\r\n\t\t\t\t} else\r\n\t\t\t\t// Try to get next sibling node\r\n\t\t\t\tif(this.currentNode[getNextNodeMethod]) {\r\n\t\t\t\t\tthis.previousNode = this.currentNode;\r\n\t\t\t\t\tthis.currentNode = this.currentNode[getNextNodeMethod];\r\n\t\t\t\t\tthis.siblingNode = this.currentNode\r\n\t\t\t\t} else\r\n\t\t\t\t// Go to 'upper' level\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.previousNode = this.currentNode;\r\n\t\t\t\t\tthis.currentNode = this.currentNode.parentNode;\r\n\t\t\t\t\tthis.siblingNode = null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(this.currentNode) {\r\n\t\t\t\t\tswitch(this.currentNode.nodeType) {\r\n\t\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\t\tif(this.currentNode === stopNode) {\r\n\t\t\t\t\t\t\t\tthis.currentNode = null;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\t\t// Do not need to add to textWalkedThrough white spaces text nodes with: '\\n\\t' or '\\n    '\r\n\t\t\t\t\t\t\tif ( /\\n+\\s*/.test(this.currentNode.nodeValue) ) {\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif(direction) {\r\n\t\t\t\t\t\t\t\tthis.textWalkedThrough += this.currentNode.nodeValue;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.textWalkedThrough = this.currentNode.nodeValue + this.textWalkedThrough;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn this.currentNode;\r\n\t\t\t};\r\n\r\n\t\t\tthis.reset = function() {\r\n\t\t\t\tthis.textWalkedThrough = startTextChunk;\r\n\t\t\t\tthis.currentNode = startNode;\r\n\t\t\t\tthis.previousNode = null;\r\n\t\t\t\tthis.siblingNode = null;\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * remove punctuation in the text\r\n\t\t * @TODO: optimize\r\n\t\t *\r\n\t\t * @param  {object HTMLElement | Node}    Container container where we locking for node\r\n\t\t * @param  {String}                       The string to look for\r\n\t\t * @return {Node}                         Node with string\r\n\t\t */\r\n\t\tfindFirstNodeWithString: function(container, string){\r\n\t\t\tvar queue = [container],\r\n\t\t\t\tnode = queue.shift();\r\n\r\n\t\t\twhile (node) {\r\n\t\t\t\tswitch (node.nodeType) {\r\n\t\t\t\t\tcase 3 :\r\n\t\t\t\t\t\tif(node.nodeValue.indexOf(string) !== -1){\r\n\r\n\t\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 1 : // Node.ELEMENT_NODE || 1\r\n\r\n\t\t\t\t\t\tfor (var i=0;i<node.childNodes.length; i++) {\r\n\t\t\t\t\t\t\tqueue.splice(i, 0,node.childNodes[i]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (queue.length > node.childNodes.length) {\r\n\t\t\t\t\t\t\tqueue.splice(i, 0, document.createTextNode(' '));\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tnode = queue.shift();\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t},\r\n\r\n\r\n\t\tisEqualNode: function( node, attr ) {\r\n\t\t\tvar result = false;\r\n\r\n\t\t\tif(node) {\r\n\t\t\t\tresult = node.getAttribute && node.getAttribute(attr) ? true : false;\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t},\r\n\r\n\t\tisLocalStorageSupported: function() {\r\n\t\t\ttry {\r\n\t\t\t\twindow.localStorage.setItem('_localStorageSupported', 1);\r\n\t\t\t\twindow.localStorage.removeItem('_localStorageSupported');\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t} catch (e) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * remove special Filling in text\r\n\t\t * @param  {String} text Text for processing\r\n\t\t * @return {String}      Text without punctuation\r\n\t\t */\r\n\t\tremoveFillingCharacter: function( text ) {\r\n\t\t\t// String.fromCharCode(8204) ZERO WIDTH NON-JOINER\r\n\t\t\ttext = text.replace( /*REG_REPLACE*/new RegExp( String.fromCharCode(8204), 'g' ), '' );\r\n\r\n\t\t\treturn text;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Removing any valiable from window scope\r\n\t\t * @param  {String} object variable for delete\r\n\t\t */\r\n\t\tremoveGlobal: function( variable, scope ) {\r\n\t\t\tscope = scope || window;\r\n\t\t\ttry {\r\n\t\t\t\tdelete scope.variable;\r\n\t\t\t} catch(e) {\r\n\t\t\t\tscope.variable = undefined;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// TODO: move to another place\r\n\t\tsortRangesForMurkup: function(a /* range */, b /* range */) {Ð°\r\n\t\t\tvar _order = b.compareBoundaryPoints(0, a);\r\n\t\t\treturn _order;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get current document\r\n\t\t * @TODO: move to another place\r\n\t\t *\r\n\t\t * @param  {Node} documentContainer\r\n\t\t * @return {Node}\r\n\t\t */\r\n\t\tgetCurrentDocument: function( documentContainer ) {\r\n\t\t\tvar _document;\r\n\r\n\t\t\tif( documentContainer.nodeName.toLowerCase() == \"iframe\" ) {\r\n\t\t\t\t_document = documentContainer.contentWindow && documentContainer.contentWindow.document ? documentContainer.contentWindow.document : document;\r\n\t\t\t} else {\r\n\t\t\t\t_document = document;\r\n\t\t\t}\r\n\r\n\t\t\treturn _document;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get computed styles of the element\r\n\t\t *\r\n\t\t * @param  {Node} node\r\n\t\t * @return {Object}\r\n\t\t */\r\n\t\tgetComputedStyle: function(node) {\r\n\t\t\treturn window.getComputedStyle ? window.getComputedStyle(node) : node.currentStyle;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get scroll width\r\n\t\t *\r\n\t\t * @return {Number}\r\n\t\t */\r\n\t\tgetScrollWidth: function() {\r\n\t\t\tvar div = document.createElement('div'),\r\n\t\t\t\tscrollWidth;\r\n\r\n\t\t\tdiv.style.overflowY = 'scroll';\r\n\t\t\tdiv.style.width = '50px';\r\n\t\t\tdiv.style.height = '50px';\r\n\t\t\tdiv.style.visibility = 'hidden';\r\n\r\n\t\t\tdocument.body.appendChild(div);\r\n\t\t\tscrollWidth = div.offsetWidth - div.clientWidth;\r\n\t\t\tdocument.body.removeChild(div);\r\n\r\n\t\t\treturn scrollWidth;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get scroll bars state\r\n\t\t *\r\n\t\t * @param  {Node} node\r\n\t\t * @return {Object}\r\n\t\t */\r\n\t\tgetScrollBarsState: function(node) {\r\n\t\t\treturn {\r\n\t\t\t\tvertical: node.scrollHeight > node.clientHeight,\r\n\t\t\t\thorizontal: node.scrollWidth > node.clientWidth\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get scroll left for input element\r\n\t\t *\r\n\t\t * @param  {Node} input\r\n\t\t * @return {Number}\r\n\t\t */\r\n\t\tgetScrollLeftForInput: function(input) {\r\n\t\t\tvar scrollLeft,\r\n\t\t\t\tcomputed,\r\n\t\t\t\tpaddingLeft,\r\n\t\t\t\tborderLeft,\r\n\t\t\t\trange,\r\n\t\t\t\trangeRect,\r\n\t\t\t\tinputRect;\r\n\r\n\t\t\tif (input.createTextRange) {\r\n\t\t\t\trange = input.createTextRange();\r\n\t\t\t\trangeRect = range.getBoundingClientRect();\r\n\t\t\t\tinputRect = input.getBoundingClientRect();\r\n\t\t\t\tcomputed = this.getComputedStyle(input);\r\n\t\t\t\tpaddingLeft = parseFloat(computed.paddingLeft);\r\n\t\t\t\tborderLeft = input.clientLeft;\r\n\r\n\t\t\t\tscrollLeft = inputRect.left + borderLeft + paddingLeft - rangeRect.left;\r\n\t\t\t} else {\r\n\t\t\t\tscrollLeft = input.scrollLeft;\r\n\t\t\t}\r\n\r\n\t\t\treturn scrollLeft;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get scroll width for input element\r\n\t\t *\r\n\t\t * @param  {Node} input\r\n\t\t * @return {Number}\r\n\t\t */\r\n\t\tgetScrollWidthForInput: function (input) {\r\n\t\t\tvar scrollWidth,\r\n\t\t\t\trange,\r\n\t\t\t\trangeRect;\r\n\r\n\t\t\tif (input.createTextRange) {\r\n\t\t\t\trange = input.createTextRange();\r\n\t\t\t\trangeRect = range.getBoundingClientRect();\r\n\r\n\t\t\t\tscrollWidth = rangeRect.width + 30;\r\n\t\t\t} else {\r\n\t\t\t\tscrollWidth = input.scrollWidth;\r\n\t\t\t}\r\n\r\n\t\t\treturn scrollWidth;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Reduce Coordinates array\r\n\t\t *\r\n\t\t * @param  {Array} input\r\n\t\t * @return {Object}\r\n\t\t */\r\n\t\treduceCoordinates(inputArr) {\r\n\t\t\tvar reducer = inputArr[0],\r\n\t\t\t\tcoordObj, top, left;\r\n\r\n\t\t\tfor(var i = 0; i < inputArr.length; i += 1) {\r\n\t\t\t\tcoordObj = inputArr[i] || {top: 0, left: 0};\r\n\t\t\t\ttop = parseInt(coordObj.top);\r\n\t\t\t\tleft = parseInt(coordObj.left);\r\n\t\t\t\ttop = isNaN(top) ? 0 : top;\r\n\t\t\t\tleft = isNaN(left) ? 0 : left;\r\n\t\t\t\tif(i === 0) {\r\n\t\t\t\t\treducer.top = top;\r\n\t\t\t\t\treducer.left = left;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treducer.top += top;\r\n\t\t\t\t\treducer.left += left;\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn reducer;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Scroll to node in container\r\n\t\t *\r\n\t\t * @param  {Node} container\r\n\t\t * @param  {Node} node\r\n\t\t */\r\n\t\tscrollToNodeInContainer: function (container, node) {\r\n\t\t\tvar containerRect = container.getBoundingClientRect(),\r\n\t\t\t\tnodeRect = node.getBoundingClientRect(),\r\n\t\t\t\tdistance;\r\n\r\n\t\t\t// If node already in container view we will skip this case\r\n\t\t\tif (nodeRect.top > containerRect.top && nodeRect.bottom < containerRect.bottom) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// For correct scroll calculating we set scrollTop to zero and additionaly get elements client rect\r\n\t\t\tcontainer.scrollTop = 0;\r\n\t\t\tcontainerRect = container.getBoundingClientRect();\r\n\t\t\tnodeRect = node.getBoundingClientRect();\r\n\t\t\tdistance = nodeRect.top - containerRect.top;\r\n\t\t\tcontainer.scrollTop = distance;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns a list of all elements under the cursor\r\n\t\t *\r\n\t\t * @param  {Number} x\r\n\t\t * @param  {Number} y\r\n\t\t * @param  {HTMLDocument} doc\r\n\t\t * @return {Array.<Node>}\r\n\t\t */\r\n\t\telementsFromPoint: function(x, y, doc) {\r\n\t\t\tvar elements = [],\r\n\t\t\t\tpreviousPointerEvents = [],\r\n\t\t\t\tcurrent;\r\n\r\n\t\t\tif (doc.elementsFromPoint || doc.msElementsFromPoint) {\r\n\t\t\t\treturn doc.elementsFromPoint ? doc.elementsFromPoint(x, y) : doc.msElementsFromPoint(x, y);\r\n\t\t\t}\r\n\r\n\t\t\twhile ((current = doc.elementFromPoint(x,y)) && elements.indexOf(current) === -1 && current.tagName !== 'HTML') {\r\n\t\t\t\telements.push(current);\r\n\t\t\t\tpreviousPointerEvents.push(current.style.pointerEvents);\r\n\t\t\t\tcurrent.style.pointerEvents = 'none';\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i = 0; i < elements.length; i++) {\r\n\t\t\t\telements[i].style.pointerEvents = previousPointerEvents[i] ? previousPointerEvents[i] : '';\r\n\t\t\t}\r\n\r\n\t\t\treturn elements;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Escape HTML\r\n\t\t *\r\n\t\t * @param  {String} str\r\n\t\t * @return {String}\r\n\t\t */\r\n\t\tescapeHTML: function(str) {\r\n\t\t\tstr = str.replace(/&/g, '&amp;');\r\n\t\t\tstr = str.replace(/</g, '&lt;');\r\n\t\t\tstr = str.replace(/>/g, '&gt;');\r\n\t\t\tstr = str.replace(/\"/g, '&quot;');\r\n\r\n\t\t\treturn str;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Unescape tags for problem nodes\r\n\t\t *\r\n\t\t * @param  {String} str\r\n\t\t * @return {String}\r\n\t\t */\r\n\t\tunescapeProblemTags: function(str) {\r\n\t\t\tstr = str.replace(/@lt;/g, '<');\r\n\t\t\tstr = str.replace(/@gt;/g, '>');\r\n\t\t\tstr = str.replace(/@quot;/g, '\"');\r\n\r\n\t\t\treturn str;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get data about Visibility API\r\n\t\t *\r\n\t\t * @return {Object}\r\n\t\t */\r\n\t\tgetVisibilityApiData: function() {\r\n\t\t\tvar data = {};\r\n\r\n\t\t\tif (typeof document.hidden !== 'undefined') {\r\n\t\t\t\tdata.hidden = 'hidden';\r\n\t\t\t\tdata.visibilityChangeEvent = 'visibilitychange';\r\n\t\t\t} else if (typeof document.webkitHidden !== 'undefined') {\r\n\t\t\t\tdata.hidden = 'webkitHidden';\r\n\t\t\t\tdata.visibilityChangeEvent = 'webkitvisibilitychange';\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get current window object\r\n\t\t *\r\n\t\t * @param  {object HTMLDocument} document\r\n\t\t * @return {object Window} window\r\n\t\t */\r\n\t\tgetWindowByDocument: function(doc) {\r\n\t\t\t// check IE < 9 have not 'defaultView' fill need use 'parentWindow'\r\n\t\t\treturn ('defaultView' in doc) ? doc.defaultView : doc.parentWindow;\r\n\t\t},\r\n\t\t// @TODO: move to another place\r\n\t\tfixRangeBoundaryPoints: function( range ) {\r\n\t\t\t// if word range like: \t\t\t\t\t\t\"test <i>^miss</i><sptrong>ppeling^</strong> test\"\r\n\t\t\t// we need move range boundary points to: \t\"test ^<i>miss</i><sptrong>ppeling</strong>^ test\"\r\n\t\t\tvar rangePoint = {\r\n\t\t\t\tstartNode: range.startContainer(),\r\n\t\t\t\tendNode: range.endContainer(),\r\n\t\t\t\tstartOffset: range.startOffset(),\r\n\t\t\t\tendOffset: range.endOffset()\r\n\t\t\t};\r\n\r\n\t\t\tif(rangePoint.startNode.parentNode != rangePoint.endNode.parentNode){\r\n\t\t\t\tvar ancestorContainer = range.commonAncestorContainer();\r\n\r\n\t\t\t\tvar node = rangePoint.startNode;\r\n\t\t\t\tif(rangePoint.startOffset === 0){\r\n\t\t\t\t\twhile (node.parentNode != ancestorContainer && node.parentNode.firstChild == node) {\r\n\t\t\t\t\t\tnode = node.parentNode;\r\n\t\t\t\t\t}\r\n\t\t\t\t\trangePoint.startBeforeNode = node;\r\n\t\t\t\t}\r\n\r\n\t\t\t\trangePoint.startNode = node;\r\n\r\n\t\t\t\tnode = rangePoint.endNode;\r\n\t\t\t\tif(node.length == rangePoint.endOffset) {\r\n\t\t\t\t\twhile (node.parentNode != ancestorContainer && node.parentNode.lastChild == node) {\r\n\t\t\t\t\t\tnode = node.parentNode;\r\n\t\t\t\t\t}\r\n\t\t\t\t\trangePoint.endAfterNode = node;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\trange.setStart(rangePoint.startNode, rangePoint.startOffset);\r\n\t\t\trange.setEnd(rangePoint.endNode, rangePoint.endOffset);\r\n\r\n\t\t\tif(rangePoint.startBeforeNode) { range.setStartBefore(rangePoint.startBeforeNode); }\r\n\t\t\tif(rangePoint.endAfterNode) { range.setEndAfter(rangePoint.endAfterNode); }\r\n\r\n\t\t\treturn range;\r\n\t\t},\r\n\r\n\t\textendOptions: function( options, extender ) {\r\n\r\n\t\t\tfor(var item in extender){\r\n\t\t\t\toptions[item] = extender[item];\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetUrl: function( path, basePath ) {\r\n\r\n\t\t\tif(path.indexOf(':/')==-1 && path.indexOf('/')!==0) {\r\n\t\t\t\tpath = basePath+path;\r\n\t\t\t}\r\n\r\n\t\t\treturn path;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Check and compare type of object\r\n\t\t *\r\n\t\t * @example\r\n\t\t * \t\tCORE.prototype.Utils.is( [1, 2, 3, 4], 'Array' );\r\n\t\t *\r\n\t\t * @param  {Object}  obj  Object for compare\r\n\t\t * @param  {String}  type Actual value for compare with object\r\n\t\t * @return {Boolean}      The result of comparing the expected data type with the actual value\r\n\t\t */\r\n\t\tis: function( obj, type ) {\r\n\t\t\tvar cls = Object.prototype.toString.call( obj ).slice(8, -1);\r\n\t\t\treturn obj !== undefined && obj !== null && cls === type;\r\n\t\t},\r\n\r\n\t\tgetLocationInfo: function(path) {\r\n\r\n\t\t\t// path: 'file:///D:/Dev/WSC/SCAYTv3/apps/ckwsc/' or 'https://www.google.com.ua'\r\n\t\t\tvar a = document.createElement('a');\r\n\t\t\ta.href = path;\r\n\r\n\t\t\treturn {\r\n\t\t\t\tprotocol: a.protocol.replace(/:/, ''),\r\n\t\t\t\thost: a.host.split(':')[0],\r\n\t\t\t\tport: (a.port == \"0\" || a.port == \"\") ? \"80\" : a.port, // Safari 5 always return '0' when port implicitly equals '80'\r\n\t\t\t\tpathname: a.pathname.replace(/*REG_REPLACE*//^\\//, '')\r\n\t\t\t};\r\n\t\t},\r\n\t\t/**\r\n\t\t * Prototypical inheritance\r\n\t\t * @param  {Object} Parent Parent object for inheritance\r\n\t\t * @param  {Function|Object} Child Child constructor or object for inheritance\r\n\t\t * @return {Function}\r\n\t\t */\r\n\t\textend: function(Parent, Child) {\r\n\t\t\tvar F, props;\r\n\r\n\t\t\tParent = Parent || Object;\r\n\r\n\t\t\tF = function() {};\r\n\t\t\tF.prototype = Parent.prototype;\r\n\r\n\t\t\tif ( !(typeof Child === 'function') ) {\r\n\t\t\t\tprops = Child;\r\n\t\t\t\tChild = function() {};\r\n\t\t\t}\r\n\r\n\t\t\tChild.prototype = Object.assign( new F(), Child.prototype || {} );\r\n\t\t\tChild.prototype.parent = Parent;\r\n\t\t\tChild.prototype.constructor = Child;\r\n\r\n\t\t\tif (props && props !== null && typeof props === 'object') {\r\n\t\t\t\tfor (var i in props) {\r\n\t\t\t\t\tif ( props.hasOwnProperty(i) ) {\r\n\t\t\t\t\t\tChild.prototype[i] = props[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn Child;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Prototypical inheritance\r\n\t\t * @param  {Object} Parent Parent object for inheritance\r\n\t\t * @param  {Function|Object} Child Child constructor or object for inheritance\r\n\t\t * @return {Function}\r\n\t\t */\r\n\t\textends: function(Parent, Child) {\r\n\t\t\tvar F, props;\r\n\r\n\t\t\tParent = Parent || Object;\r\n\r\n\t\t\tF = function() {};\r\n\t\t\tF.prototype = Parent.prototype;\r\n\r\n\t\t\tif ( !(typeof Child === 'function') ) {\r\n\t\t\t\tprops = Child;\r\n\t\t\t\tChild = function() {};\r\n\t\t\t}\r\n\r\n\t\t\tChild.prototype = Object.assign( new F(), Child.prototype || {} );\r\n\t\t\tChild.parent = Parent;\r\n\t\t\tChild.prototype.constructor = Child;\r\n\r\n\t\t\tif (props && props !== null && typeof props === 'object') {\r\n\t\t\t\tfor (var i in props) {\r\n\t\t\t\t\tif ( props.hasOwnProperty(i) ) {\r\n\t\t\t\t\t\tChild.prototype[i] = props[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn Child;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Prototypical inheritance\r\n\t\t * @param  {Object} Parent Parent object for inheritance\r\n\t\t * @param  {Function|Object} Child Child constructor or object for inheritance\r\n\t\t * @return {Function}\r\n\t\t */\r\n\t\textends: function(Parent, Child) {\r\n\t\t\tvar F, props;\r\n\r\n\t\t\tParent = Parent || Object;\r\n\r\n\t\t\tF = function() {};\r\n\t\t\tF.prototype = Parent.prototype;\r\n\r\n\t\t\tif ( !(typeof Child === 'function') ) {\r\n\t\t\t\tprops = Child;\r\n\t\t\t\tChild = function() {};\r\n\t\t\t}\r\n\r\n\t\t\tChild.prototype = Object.assign( new F(), Child.prototype || {} );\r\n\t\t\tChild.parent = Parent;\r\n\t\t\tChild.prototype.constructor = Child;\r\n\r\n\t\t\tif (props && props !== null && typeof props === 'object') {\r\n\t\t\t\tfor (var i in props) {\r\n\t\t\t\t\tif ( props.hasOwnProperty(i) ) {\r\n\t\t\t\t\t\tChild.prototype[i] = props[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn Child;\r\n\t\t},\r\n\r\n\t\tdecoratMethods: function(Main, Decorator) {\r\n\t\t\tvar mainProto = Main.prototype,\r\n\t\t\t\tDecoratorProto = Decorator.prototype;\r\n\r\n\t\t\tfor(var k in mainProto) {\r\n\t\t\t\tif( mainProto.hasOwnProperty(k) && (typeof mainProto[k] === 'function' && typeof DecoratorProto[k] === 'function') ) {\r\n\t\t\t\t\tDecoratorProto[k] = function() {\r\n\t\t\t\t\t\tDecorator[k]( mainProto[k] );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Hash code from string\r\n\t\t * @param  {String} string String for generating hash\r\n\t\t * @return {Number}\r\n\t\t */\r\n\t\thashCode: function(string) {\r\n\t\t\tvar hash = 0,\r\n\t\t\t\tchar;\r\n\r\n\t\t\tif (string.length === 0) {\r\n\t\t\t\treturn hash;\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i = 0, len = string.length; i < len; i++) {\r\n\t\t\t\tchar = string.charCodeAt(i);\r\n\t\t\t\thash = ( (hash << 5) - hash ) + char;\r\n\t\t\t\thash = hash & hash; // Convert to 32bit integer\r\n\t\t\t}\r\n\r\n\t\t\treturn hash;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Unique ID\r\n\t\t * @return {String}\r\n\t\t */\r\n\t\tgetUniqueId: function() {\r\n\t\t\t// Convert all numbers to base 36 (numbers + letters)\r\n\t\t\treturn ( Date.now().toString(36) + Math.random().toString(36).substr(2, 9) );\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Truncate string\r\n\t\t * @param  {String} string String for truncating\r\n\t\t * @param  {Number} length Length of the new string\r\n\t\t * @return {String}\r\n\t\t */\r\n\t\ttrunc: function(string, length) {\r\n\t\t\treturn string.length > length ? string.substr(0, length) + '&hellip;' : string;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Copy all CSS styles from one node to another\r\n\t\t * @param {Node} from Copy styles from this node\r\n\t\t * @param {Node} to Copy styles to this node\r\n\t\t */\r\n\t\tcopyStyles: function(from, to) {\r\n\t\t\tvar stylesObject = null,\r\n\t\t\t\tUILib = exports.UILib,\r\n\t\t\t\tprocessedStyles = {};\r\n\r\n\t\t\tif (document.defaultView && document.defaultView.getComputedStyle) {\r\n\t\t\t\tstylesObject = document.defaultView.getComputedStyle(from, null);\r\n\t\t\t} else {\r\n\t\t\t\tstylesObject = from.currentStyle;\r\n\t\t\t}\r\n\r\n\t\t\tif (!stylesObject) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tfor (var property in stylesObject) {\r\n\t\t\t\tprocessedStyles[stylesObject[property]] = stylesObject[stylesObject[property]];\r\n\t\t\t}\r\n\r\n\t\t\tUILib.css(to, processedStyles);\r\n\t\t},\r\n\t\t/**\r\n\t\t * Get base data from script name\r\n\t\t *\r\n\t\t * @param  {String} fileName\r\n\t\t * @return {Object}\r\n\t\t */\r\n\t\tgetBaseData: function(fileName) {\r\n\t\t\tvar regPath,\r\n\t\t\t\tstartStr = '/',\r\n\t\t\t\tendStr = '.js',\r\n\t\t\t\tscript,\r\n\t\t\t\tpath;\r\n\r\n\t\t\tif(document.currentScript && !fileName) {\r\n\t\t\t\tscript = document.currentScript;\r\n\t\t\t\tpath = script.src;\r\n\t\t\t\tfileName = path.substring( path.lastIndexOf(startStr) + startStr.length, path.lastIndexOf(endStr) + endStr.length );\r\n\t\t\t}\r\n\r\n\t\t\tregPath = new RegExp('(^|.*[\\\\\\\\\\/])' + fileName + '(?:\\\\?.*)?$', 'i');\r\n\r\n\t\t\tif(!path) {\r\n\t\t\t\tvar scripts = document.getElementsByTagName('script');\r\n\t\t\t\tfor(var i = 0; i<scripts.length; i++) {\r\n\t\t\t\t\tvar g = scripts[i].src.match(regPath);\r\n\t\t\t\t\tif(g) {\r\n\t\t\t\t\t\tscript = scripts[i];\r\n\t\t\t\t\t\tpath = g[1];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tpath = path.match(regPath)[1];\r\n\t\t\t}\r\n\r\n\t\t\tif(path && path.indexOf(':/')==-1) {\r\n\t\t\t\tif(path.indexOf('/')===0) {\r\n\t\t\t\t\tpath = window.location.href.match(/*REG_REPLACE*//^.*?:\\/\\/[^\\/]*/)[0]+path;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpath = window.location.href.match(/*REG_REPLACE*//^[^\\?]*\\/(?:)/)[0]+path;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tpath: path,\r\n\t\t\t\tscript: script\r\n\t\t\t};\r\n\t\t},\r\n\t\t/**\r\n\t\t * Get options from data attributes\r\n\t\t *\r\n\t\t * @param  {Node} node\r\n\t\t * @param  {String} prefix\r\n\t\t * @return {Object}\r\n\t\t */\r\n\t\tgetOptionsFromDataAttrs: function(node, prefix) {\r\n\t\t\tvar attributes = node.attributes,\r\n\t\t\t\tignoredAttrs = ['autocreate'],\r\n\t\t\t\toptions = {},\r\n\t\t\t\tattributeName = '',\r\n\t\t\t\tvalue = '',\r\n\t\t\t\tparamName = '';\r\n\r\n\t\t\tfor (var i = 0; i < attributes.length; i++) {\r\n\t\t\t\tattributeName = attributes[i].name;\r\n\r\n\t\t\t\tif (attributeName.indexOf(prefix) === 0) {\r\n\t\t\t\t\tparamName = attributeName.substring(prefix.length, attributeName.length);\r\n\r\n\t\t\t\t\tif (ignoredAttrs.includes(paramName)) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvalue = node.getAttribute(prefix + paramName);\r\n\t\t\t\t\t// TODO check another types.\r\n\t\t\t\t\tvalue = value === 'true' ? true : value;\r\n\t\t\t\t\tvalue = value === 'false' ? false : value;\r\n\t\t\t\t\toptions[paramName] = value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn options;\r\n\t\t},\r\n\t\t/**\r\n\t\t * Check if node is text based\r\n\t\t *\r\n\t\t * @param  {Node} node\r\n\t\t * @return {Boolean}\r\n\t\t */\r\n\t\tisTextBased: function (node) {\r\n\t\t\tvar availableTypes = ['textarea', 'text', 'search', 'url'];\r\n\r\n\t\t\treturn node ? availableTypes.indexOf(node.type) >= 0 : false;\r\n\t\t},\r\n\t\t/**\r\n\t\t * Check if node is input based\r\n\t\t *\r\n\t\t * @param  {Node} node\r\n\t\t * @return {Boolean}\r\n\t\t */\r\n\t\tisInputBased: function (node) {\r\n\t\t\tvar inputFieldTypes = ['text', 'search', 'url'];\r\n\r\n\t\t\treturn node ? inputFieldTypes.indexOf(node.type) >= 0 : false;\r\n\t\t},\r\n\t\t/**\r\n\t\t * Check if node is CKEditor5\r\n\t\t *\r\n\t\t * @param  {Node} node\r\n\t\t * @return {Boolean}\r\n\t\t */\r\n\t\tisCKEditor5: function(node) {\r\n\t\t\tvar ckeditor5Class = 'ck-editor__editable';\r\n\r\n\t\t\treturn exports.UILib.hasClass(node, ckeditor5Class) ? true : false;\r\n\t\t},\r\n\t\t/**\r\n\t\t * Check if node is one of the model editors\r\n\t\t *\r\n\t\t * @param  {Node} node\r\n\t\t * @return {Boolean}\r\n\t\t */\r\n\t\tisModelEditor: function(node) {\r\n\t\t\tvar editorByClass = ['ProseMirror', 'ql-editor', 'scribe'],\r\n\t\t\t\teditorByAttribute = ['trix-id'];\r\n\r\n\t\t\tfor (var i = 0; i < editorByClass.length; i++) {\r\n\t\t\t\tif ( exports.UILib.hasClass(node, editorByClass[i]) ) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i = 0; i < editorByAttribute.length; i++) {\r\n\t\t\t\tif ( exports.UILib.attr(node, editorByAttribute[i]) ) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\t/**\r\n\t\t * Check if node is hidden\r\n\t\t *\r\n\t\t * @param  {Node} node\r\n\t\t * @return {Boolean}\r\n\t\t */\r\n\t\tisHidden: function (node) {\r\n\t\t\treturn !node.offsetWidth && !node.offsetHeight;\r\n\t\t},\r\n\t\t/**\r\n\t\t * Check if node is in page\r\n\t\t *\r\n\t\t * @param  {Node} node\r\n\t\t * @return {Boolean}\r\n\t\t */\r\n\t\tisInPage: function(node) {\r\n\t\t\treturn document.getElementsByTagName('body')[0].contains(node);\r\n\t\t},\r\n\t\t/**\r\n\t\t * Check if node is available\r\n\t\t *\r\n\t\t * @param  {Node} node\r\n\t\t * @return {Boolean}\r\n\t\t */\r\n\t\tisNodeAvailable: function(node) {\r\n\t\t\treturn this.isInPage(node) && !this.isHidden(node);\r\n\t\t},\r\n\t\t/**\r\n\t\t * Check if application started on touch device\r\n\t\t *\r\n\t\t * @return {Boolean}\r\n\t\t */\r\n\t\tisTouchDevice: function() {\r\n\t\t\treturn ( ('ontouchstart' in window) || window.DocumentTouch && document instanceof DocumentTouch );\r\n\t\t},\r\n\t\t/**\r\n\t\t * Check if MutationObserver is available\r\n\t\t *\r\n\t\t * @return {Boolean}\r\n\t\t */\r\n\t\tisMutationObserver: function() {\r\n\t\t\treturn 'MutationObserver' in window ? true : false\r\n\t\t},\r\n\t\tpushOrConcat: function(arr, errOrItem) {\r\n\t\t\tif( Array.isArray(errOrItem) ) {\r\n\t\t\t\tarr = arr.concat(errOrItem);\r\n\t\t\t} else {\r\n\t\t\t\tarr.push(errOrItem);\r\n\t\t\t}\r\n\r\n\t\t\treturn arr;\r\n\t\t},\r\n\t\t/**\r\n\t\t * Convert DOM HTMLCollection to JavaScript Array.\r\n\t\t *\r\n\t\t * @return {Boolean}\r\n\t\t */\r\n\t\tHTMLCollectionToArray: function (collection) {\r\n\t\t\tvar length = collection.length,\r\n\t\t\t\tarr = new Array(length),\r\n\t\t\t\ti;\r\n\r\n\t\t\tfor (i = length - 1; i >= 0; i -= 1) {\r\n\t\t\t\tarr[i] = collection[i];\r\n\t\t\t}\r\n\t\t\treturn arr\r\n\t\t},\r\n\t\t/**\r\n\t\t * Check if letter is uppercase\r\n\t\t *\r\n\t\t * @param  {String} letter\r\n\t\t * @return {Boolean}\r\n\t\t */\r\n\t\tisUppercaseLetter: function (letter) {\r\n\t\t\tvar first = letter.charAt(0);\r\n\r\n\t\t\tif ( first === first.toUpperCase() && first !== first.toLowerCase() ) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\t/**\r\n\t\t * Check if letter is lowercase\r\n\t\t *\r\n\t\t * @param  {String} letter\r\n\t\t * @return {Boolean}\r\n\t\t */\r\n\t\tisLowercaseLetter: function (letter) {\r\n\t\t\tvar first = letter.charAt(0);\r\n\r\n\t\t\tif (first !== first.toUpperCase() && first === first.toLowerCase()) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\t/**\r\n\t\t * Check if string starts with space and then after space need to be uppercase letter\r\n\t\t *\r\n\t\t * @param  {String} string\r\n\t\t * @return {Boolean}\r\n\t\t */\r\n\t\tstartsWithSpaceAndUppercaseLetter: function (string) {\r\n\t\t\t/*\r\n\t\t\t\t\\xA0 - 160 char code which represents non breaking space in IE\r\n\r\n\t\t\t\t/^[\\s\\xA0]+(?=\\S{1})/g\r\n\t\t\t\t- first space\r\n\t\t\t\t- then after space need to be other than white space symbol\r\n\t\t\t*/\r\n\t\t\tvar matches = /^[\\s\\xA0]+(?=\\S{1})/g.exec(string),\r\n\t\t\t\tletter;\r\n\r\n\t\t\tif (matches) {\r\n\t\t\t\tletter = string.charAt(matches[0].length);\r\n\r\n\t\t\t\treturn this.isUppercaseLetter(letter);\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\t/**\r\n\t\t * Check if string has uppercase letter\r\n\t\t *\r\n\t\t * @param  {String} string\r\n\t\t * @return {Boolean}\r\n\t\t */\r\n\t\thasUppercaseLetter: function (string) {\r\n\t\t\tfor (var i = 0; i < string.length; i++) {\r\n\t\t\t\tif ( this.isUppercaseLetter(string[i]) ) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\t/**\r\n\t\t * Capitalize first letter of the string\r\n\t\t *\r\n\t\t * @param  {String} string\r\n\t\t * @return {String}\r\n\t\t */\r\n\t\tcapitalizeFirstLetter: function(string) {\r\n\t\t\treturn string.charAt(0).toUpperCase() + string.slice(1);\r\n\t\t},\r\n\t\t/**\r\n\t\t * Returns max z-index\r\n\t\t *\r\n\t\t * @param  {Node} element\r\n\t\t * @return {Number}\r\n\t\t */\r\n\t\tgetMaxZIndex: function(element) {\r\n\t\t\tvar zIndex = 0,\r\n\t\t\t\tcurrentZIndex;\r\n\r\n\t\t\twhile (element !== document.body) {\r\n\t\t\t\tcurrentZIndex = this.getZIndex(element);\r\n\r\n\t\t\t\tif (currentZIndex !== null) {\r\n\t\t\t\t\tzIndex = currentZIndex;\r\n\t\t\t\t}\r\n\r\n\t\t\t\telement = element.parentNode;\r\n\t\t\t}\r\n\r\n\t\t\treturn zIndex;\r\n\t\t},\r\n\t\t/**\r\n\t\t * Returns element z-index related to stacking context\r\n\t\t * {@link https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Positioning/Understanding_z_index/The_stacking_context}\r\n\t\t *\r\n\t\t * @param  {Node} element\r\n\t\t * @return {Number|Null}\r\n\t\t */\r\n\t\tgetZIndex: function(element) {\r\n\t\t\tvar computed = this.getComputedStyle(element),\r\n\t\t\t\tcurrentZIndex = parseInt(computed['zIndex']),\r\n\t\t\t\tcurrentPosition = computed['position'];\r\n\r\n\t\t\tif ( isNaN(currentZIndex) ) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tif (currentPosition !== 'static') {\r\n\t\t\t\treturn currentZIndex;\r\n\t\t\t}\r\n\r\n\t\t\tif (element.parentNode) {\r\n\t\t\t\tif ( this.getComputedStyle(element.parentNode)['display'] === 'flex' ) {\r\n\t\t\t\t\treturn currentZIndex;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}, exports.Utils);\r\n\r\n\t/**\r\n\t * Static Module. CORE utils module\r\n\t *\r\n\t * @alias CORE.prototype.Utils\r\n\t */\r\n\texports.Utils = Utils;\r\n\r\n}( WEBSPELLCHECKER.CORE.prototype ));\n// uimetrics.js\n/**\n * @fileoverview Static Module. CORE module that provide crossbrowser metrics information.\n * Does not contain any manipulation methods.\n */\n(function( exports, modules ) {\n\t'use strict';\n\n\tif( !exports.UIMetrics ) { // @WAT ?? @TODO check this ocndition\n\t\tvar UILib = modules.UILib,\n\t\t\twin = window,\n\t\t\tdoc = document,\n\t\t\thtml = document.documentElement,\n\t\t\tbody = document.body,\n\t\t\tUIMetrics = {};\n\n\t\tUIMetrics.getScrollLeft = function() {\n\t\t\treturn UILib.scrollLeft(win);\n\t\t};\n\n\t\tUIMetrics.getScrollTop = function() {\n\t\t\treturn UILib.scrollTop(win);\n\t\t};\n\n\t\tUIMetrics.getScrollInfo = function() {\n\t\t\treturn {\n\t\t\t\tleft: this.getScrollLeft(),\n\t\t\t\ttop: this.getScrollTop()\n\t\t\t}\n\t\t}\n\n\t\tUIMetrics.getWindowWidth = function() {\n\t\t\treturn UILib.width(win);\n\t\t};\n\n\t\tUIMetrics.getWindowHeight = function() {\n\t\t\treturn UILib.height(win);\n\t\t};\n\n\t\tUIMetrics.getWindowSize = function() {\n\t\t\treturn {\n\t\t\t\twidth: this.getWindowWidth(),\n\t\t\t\theight: this.getWindowHeight()\n\t\t\t}\n\t\t};\n\n\t\tUIMetrics.getWindowInnerWidth = function() {\n\t\t\treturn typeof window.innerWidth === 'number' ? window.innerWidth : document.documentElement.clientWidth;\n\t\t};\n\n\t\tUIMetrics.getWindowInnerHeight = function() {\n\t\t\treturn typeof window.innerHeight === 'number' ? window.innerHeight : document.documentElement.clientHeight;\n\t\t};\n\n\t\tUIMetrics.getBodyMinWidth = function() {\n\t\t\tvar bodyMinWidth = 0;\n\n\t\t\tif(document.defaultView && document.defaultView.getComputedStyle) {\n\t\t\t\tbodyMinWidth = document.defaultView.getComputedStyle(document.body, null)['minWidth'];\n\t\t\t} else if (document.body.currentStyle) {\n\t\t\t\tbodyMinWidth = document.body.currentStyle['minWidth'];\n\t\t\t} else {\n\t\t\t\tbodyMinWidth = document.body.style['minWidth'];\n\t\t\t}\n\n\t\t\treturn parseInt(bodyMinWidth, 10) || 0;\n\t\t};\n\n\t\tUIMetrics.getPageWidth = function() {\n\t\t\treturn Math.max(\n\t\t\t\tMath.max(document.documentElement.offsetWidth, document.documentElement.scrollWidth),\n\t\t\t\tMath.max(document.body.offsetWidth, document.body.scrollWidth)\n\t\t\t);\n\t\t};\n\n\t\tUIMetrics.getPageHeight = function() {\n\t\t\treturn Math.max(\n\t\t\t\tMath.max(document.documentElement.offsetHeight, document.documentElement.scrollHeight),\n\t\t\t\tMath.max(document.body.offsetHeight, document.body.scrollHeight)\n\t\t\t);\n\t\t};\n\n\t\tUIMetrics.getDocumentWidth = function() {\n\t\t\treturn Math.max(UIMetrics.getPageWidth(), UIMetrics.getBodyMinWidth(), UIMetrics.getWindowWidth());\n\t\t};\n\n\t\tUIMetrics.getDocumentHeight = function() {\n\t\t\treturn Math.max(UIMetrics.getPageHeight(), UIMetrics.getWindowHeight());\n\t\t};\n\n\t\texports.UIMetrics = UIMetrics;\n\t}\n\n}( WEBSPELLCHECKER.CORE, WEBSPELLCHECKER.CORE.prototype ));\n// template.js\r\n/**\r\n * @fileoverview Static Module. Template manager for Application\r\n */\r\n\r\n(function( exports ) {\r\n\t'use strict';\r\n\r\n\t/**\r\n\t * Save used templates\r\n\t * @privat\r\n\t */\r\n\tvar cache = {},\r\n\r\n\t\t// Simple JavaScript Templating\r\n\t\t// John Resig - http://ejohn.org/ - MIT Licensed\r\n\t\ttmpl = function tmpl( str, data ){\r\n\t\t\t// Figure out if we're getting a template, or if we need to\r\n\t\t\t// load the template - and be sure to cache the result.\r\n\t\t\tvar fn = !(/*REG_REPLACE*//\\W/.test(str)) ?\r\n\t\t\t\tcache[str] = cache[str] ||\r\n\t\t\t\t\ttmpl(document.getElementById(str).innerHTML.replace(/*REG_REPLACE*//\\r\\n/, '')) :\r\n\r\n\t\t\t\t// Generate a reusable function that will serve as a template\r\n\t\t\t\t// generator (and which will be cached).\r\n\t\t\t\tnew Function(\"obj\",\r\n\t\t\t\t\t\"var p=[],print=function(){p.push.apply(p,arguments);};\" +\r\n\t\t\t\t\t// Introduce the data as local variables using with(){}\r\n\t\t\t\t\t\"with(obj){p.push('\" +\r\n\t\t\t\t\t// Convert the template into pure JavaScript\r\n\t\t\t\t\tstr.replace(/*REG_REPLACE*//[\\r\\t\\n]/g, \" \")\r\n\t\t\t\t\t\t.split(\"<%\").join(\"\\t\")\r\n\t\t\t\t\t\t.replace(/*REG_REPLACE*//((^|%>)[^\\t]*)'/g, \"$1\\r\")\r\n\t\t\t\t\t\t.replace(/*REG_REPLACE*//\\t=(.*?)%>/g, \"',$1,'\")\r\n\t\t\t\t\t\t.split(\"\\t\").join(\"');\")\r\n\t\t\t\t\t\t.split(\"%>\").join(\"p.push('\")\r\n\t\t\t\t\t\t.split(\"\\r\").join(\"\\\\'\")\r\n\t\t\t\t\t+ \"');}return p.join('');\");\r\n\r\n\t\t\t// Provide some basic currying to the user\r\n\t\t\treturn data ? fn( data ) : fn;\r\n\t\t},\r\n\t\tUILib = exports.UILib;\r\n\r\n\t\t/**\r\n\t\t * @exports CORE.prototype.Template\r\n\t\t * @requires UILib\r\n\t\t */\r\n\t\tvar template = {\r\n\r\n\t\t\t/**\r\n\t\t\t * Create and append script tag with template's text to body;\r\n\t\t\t * @param  {String} tplName Unique identifier\r\n\t\t\t * @param  {String} tpl     Text template\r\n\t\t\t */\r\n\t\t\tcreate: function( tplName, tpl ) {\r\n\t\t\t\tvar script;\r\n\r\n\t\t\t\t// Make sure that we did not create that template earlier\r\n\t\t\t\tif( !document.getElementById( tplName ) ) {\r\n\t\t\t\t\tscript = document.createElement('script');\r\n\r\n\t\t\t\t\tscript.type = 'text/html';\r\n\t\t\t\t\tscript.id = tplName;\r\n\t\t\t\t\tscript.text = tpl;\r\n\r\n\t\t\t\t\tUILib.appendTo( script, 'body' );\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Delete tamplate's script with body\r\n\t\t\t * @param  {String} tplName Unique identifier\r\n\t\t\t */\r\n\t\t\tremove: function( tplName ) {\r\n\t\t\t\tUILib.remove( 'body #' + tplName );\r\n\t\t\t\tdelete cache[tplName];\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Render template with data\r\n\t\t\t * @param  {String} tplName Unique identifier\r\n\t\t\t * @param  {Object} data    Data\r\n\t\t\t */\r\n\t\t\trender: function( tplName, data ) {\r\n\t\t\t\treturn tmpl( tplName, data );\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t/**\r\n\t * Static Module. Template manager for Application\r\n\t *\r\n\t * @alias CORE.prototype.Template\r\n\t */\r\n\texports.Template = template;\r\n\r\n}( WEBSPELLCHECKER.CORE.prototype ));\r\n\r\n\n// datastorage.js\r\n/**\r\n * @fileoverview Static Module of Storage Data in the localStorage.\r\n */\r\n\r\n\r\n(function( exports ) {\r\n\t'use strict';\r\n\r\n\tvar DataTypeManager = {\r\n\t\tseparator: '<$>',\r\n\t\tgetDataType: function(value) {\r\n\t\t\tvar type;\r\n\r\n\t\t\tif(typeof value === 'undefined') {\r\n\t\t\t\ttype = 'undefined';\r\n\t\t\t} else if(value === null) {\r\n\t\t\t\ttype = 'null';\r\n\t\t\t} else {\r\n\t\t\t\ttype = Object.prototype.toString.call(value).slice(8, -1);\r\n\t\t\t}\r\n\t\t\treturn type;\r\n\t\t},\r\n\t\tconvertDataToString: function(value) {\r\n\t\t\tvar str,\r\n\t\t\t\ttype = this.getDataType(value).toLowerCase();\r\n\r\n\t\t\tstr = type + this.separator + value;\r\n\t\t\treturn str;\r\n\t\t},\r\n\t\t// get value type and convert value due to type, since all stored values are String\r\n\t\trestoreDataFromString: function(str) {\r\n\t\t\tvar value = str,\r\n\t\t\t\ttype,\r\n\t\t\t\tseparatorStartIndex;\r\n\r\n\t\t\t// @TODO: remove this line much later. Support of old format for options\r\n\t\t\tstr = this.backCompatibility(str);\r\n\r\n\t\t\tif(typeof str === 'string') {\r\n\t\t\t\tseparatorStartIndex = str.indexOf(this.separator);\r\n\t\t\t\ttype = str.substring(0, separatorStartIndex);\r\n\t\t\t\tvalue = str.substring(separatorStartIndex + this.separator.length);\r\n\r\n\t\t\t\tswitch(type) {\r\n\t\t\t\t\tcase 'boolean':\r\n\t\t\t\t\t\tvalue = value === 'true';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'number':\r\n\t\t\t\t\t\tvalue = parseFloat(value);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\t// we assume that we will store string values only, due to performance\r\n\t\t\t\t\tcase 'array':\r\n\t\t\t\t\t\tvalue = value === '' ? [] : value.split(',');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'null':\r\n\t\t\t\t\t\tvalue = null;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'undefined':\r\n\t\t\t\t\t\tvalue = undefined;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn value;\r\n\t\t},\r\n\t\t// old data type support\r\n\t\t// here we trying to convert data from old format into new\r\n\t\t// @TODO: remove this function much later\r\n\t\tbackCompatibility: function(str) {\r\n\t\t\tvar convertedStr = str,\r\n\t\t\t\tvalue,\r\n\t\t\t\tseparatorStartIndex;\r\n\r\n\t\t\tif(typeof str === 'string') {\r\n\t\t\t\tseparatorStartIndex = str.indexOf(this.separator);\r\n\t\t\t\t// is it old format?\r\n\t\t\t\tif(separatorStartIndex < 0) {\r\n\t\t\t\t\t// try to get number from string\r\n\t\t\t\t\tvalue = parseFloat(str);\r\n\t\t\t\t\t// is it not a number?\r\n\t\t\t\t\tif(isNaN(value)) {\r\n\t\t\t\t\t\t// yes, this is not a number. Lets check is this is an array \"[comma,separated,values]\"\r\n\t\t\t\t\t\tif((str[0] === '[') && (str[str.length - 1] === ']')) {\r\n\t\t\t\t\t\t\t// this is an array. Lets remove brackets symbols and extract the words\r\n\t\t\t\t\t\t\tstr = str.replace('[', '');\r\n\t\t\t\t\t\t\tstr = str.replace(']', '');\r\n\t\t\t\t\t\t\tif(str === '') {\r\n\t\t\t\t\t\t\t\tvalue = [];\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tvalue = str.split(',');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t// value = str === '[]' ? [] : str.split(',');\r\n\t\t\t\t\t\t} else if(str === 'true' || str === 'false') {\r\n\t\t\t\t\t\t\t// this is boolean value\r\n\t\t\t\t\t\t\tvalue = str === 'true';\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// this is string\r\n\t\t\t\t\t\t\tvalue = str;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconvertedStr = this.convertDataToString(value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn convertedStr;\r\n\t\t}\r\n\t};\r\n\r\n\tvar LocalStorage = {\r\n\r\n\t\tget: function( key ) {\r\n\t\t\tvar value = DataTypeManager.restoreDataFromString( window.localStorage.getItem(key) );\r\n\t\t\treturn value;\r\n\t\t},\r\n\r\n\t\tset: function( key, value ) {\r\n\t\t\t// For case when exceed the quota limit in a browserâs LocalStorage system.\r\n\t\t\t// QuotaExceededError: Setting the value of 'value' exceeded the quota.\r\n\t\t\ttry {\r\n\t\t\t\tvar _value = DataTypeManager.convertDataToString(value);\r\n\t\t\t\twindow.localStorage.setItem(key, _value);\r\n\t\t\t} catch (e) {}\r\n\t\t},\r\n\r\n\t\tdel: function( key ) {\r\n\t\t\twindow.localStorage.removeItem( key );\r\n\t\t},\r\n\r\n\t\tclear: function() {\r\n\t\t\twindow.localStorage.clear();\r\n\t\t}\r\n\t};\r\n\r\n\tvar CookiesStorage = {\r\n\r\n\t\texpiration: (function() {\r\n\t\t\treturn 60 * 60 * 24 * 366;\r\n\t\t}()),\r\n\r\n\t\tget: function(key) {\r\n\t\t\tvar value = DataTypeManager.restoreDataFromString(this.getCookie(key));\r\n\t\t\treturn value;\r\n\t\t},\r\n\r\n\t\tset: function(key, value) {\r\n\t\t\tvar _value = DataTypeManager.convertDataToString(value);\r\n\t\t\tthis.setCookie(key, _value, {expires: this.expiration});\r\n\t\t},\r\n\r\n\t\tdel: function(key) {\r\n\t\t\tthis.deleteCookie(key);\r\n\t\t},\r\n\r\n\t\tgetCookie: function(name) {\r\n\t\t\tif (typeof name !== 'string') {\r\n\t\t\t\tname = '';\r\n\t\t\t}\r\n\r\n\t\t\tvar matches = /*REG_REPLACE*/document.cookie.match(new RegExp(\"(?:^|; )\" + name.replace(/([\\.$?*|{}\\(\\)\\[\\]\\\\\\/\\+^])/g, '\\\\$1') + \"=([^;]*)\"));\r\n\t\t\treturn matches ? decodeURIComponent(matches[1]) : undefined;\r\n\t\t},\r\n\r\n\t\tsetCookie: function(name, value, props) {\r\n\t\t\tprops = props || {};\r\n\t\t\tvar exp = props.expires;\r\n\r\n\t\t\tif (typeof exp === \"number\" && exp) {\r\n\t\t\t\tvar d = new Date();\r\n\r\n\t\t\t\td.setTime(d.getTime() + exp * 1000);\r\n\t\t\t\texp = props.expires = d;\r\n\t\t\t}\r\n\r\n\t\t\tif(exp && exp.toUTCString) {\r\n\t\t\t\tprops.expires = exp.toUTCString();\r\n\t\t\t}\r\n\r\n\t\t\tvalue = encodeURIComponent(value);\r\n\t\t\tvar updatedCookie = name + \"=\" + value;\r\n\r\n\t\t\tfor(var propName in props) {\r\n\t\t\t\tvar propValue = props[propName];\r\n\r\n\t\t\t\tupdatedCookie += \"; \" + propName;\r\n\r\n\t\t\t\tif(propValue !== true) {\r\n\t\t\t\t\tupdatedCookie += \"=\" + propValue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tdocument.cookie = updatedCookie;\r\n\t\t},\r\n\r\n\t\tdeleteCookie: function(name) {\r\n\t\t\tthis.setCookie(name, null, {expires: -1});\r\n\t\t},\r\n\r\n\t\t// delete all cookies\r\n\t\tclear: function() {\r\n\t\t\tvar cookies = document.cookie.split(\";\");\r\n\r\n\t\t\tfor (var i = 0; i < cookies.length; i++) {\r\n\t\t\t\tvar cookie = cookies[i];\r\n\t\t\t\tvar eqPos = cookie.indexOf(\"=\");\r\n\t\t\t\tvar name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;\r\n\r\n\t\t\t\tthis.deleteCookie(name);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tvar isLocalStorageSupported = function() {\r\n\t\ttry {\r\n\t\t\tvar supported = ('localStorage' in window && window['localStorage'] !== null);\r\n\r\n\t\t\t// Safari (OS X or iOS) in 'Private Browsing Mode' throws an exception when we trying to call localStorage.setItem.\r\n\t\t\t// QuotaExceededError (DOM Exception 22): The quota has been exceeded.\r\n\t\t\tif (supported) {\r\n\t\t\t\twindow.localStorage.setItem('_localStorageSupported', 1);\r\n\t\t\t\twindow.localStorage.removeItem('_localStorageSupported');\r\n\t\t\t} else {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t} catch (e) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t};\r\n\r\n\tvar strategy = isLocalStorageSupported() ? LocalStorage : CookiesStorage;\r\n\r\n\t/**\r\n\t * @exports CORE.prototype.DataStorage\r\n\t */\r\n\tvar DataStorage = {\r\n\r\n\t\t/**\r\n\t\t * Get data within storage for key\r\n\t\t *\r\n\t\t * @param {string} key \t- Key\r\n\t\t */\r\n\t\tgetData: function( key ) {\r\n\t\t\treturn strategy.get( key );\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Set data within storage\r\n\t\t *\r\n\t\t * @param {string} key \t\t- Key\r\n\t\t * @param {object} value \t- Value\r\n\t\t */\r\n\t\tsetData: function( key, value ) {\r\n\t\t\tstrategy.set( key, value );\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Delete data within storage for key\r\n\t\t *\r\n\t\t * @param {String} key \t- Key\r\n\t\t */\r\n\t\tdeleteData: function( key ) {\r\n\t\t\tstrategy.del( key );\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Clear storage\r\n\t\t */\r\n\t\tclear: function() {\r\n\t\t\tstrategy.clear();\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * Static Module of Storage Data in the localStorage.\r\n\t *\r\n\t * @alias CORE.prototype.DataStorage\r\n\t */\r\n\texports.DataStorage = DataStorage;\r\n\r\n}( WEBSPELLCHECKER.CORE.prototype ));\n// range.js\n/**\n * @fileoverview of CORE RangeCreator module.\n */\n\n(function( exports ) {\n\t'use strict';\n\tvar Utils, UILib;\n\t/**\n\t * RangeCreator module constructor.\n\t * @constructor\n\t * @alias CORE.RangeCreator\n\t * @param {string} moduleID\n\t * @param {CORE.Sandbox} sandbox\n\t */\n\tvar RangeCreator = function(moduleID, sandbox) {\n\t\tthis.name = moduleID;\n\t\tthis.sandbox = sandbox;\n\t\tUtils = sandbox.Utils;\n\t\tUILib = sandbox.UILib;\n\t};\n\n\tRangeCreator.prototype = {\n\t\tinit: function() {\n\t\t\tvar self = this;\n\t\t\t// we should waite all module because some modules (like wrapper)\n\t\t\t// can substitute container and documentContainer options\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'allModulesReady',\n\t\t\t\thandler: function() {\n\t\t\t\t\tself.documentContainer =  self.sandbox.getOption('documentContainer');\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.documentContainer = this.sandbox.getOption('documentContainer');\n\t\t\tthis.blockElementsRegex = this.sandbox.getRegExp('blockElementsRegex');\n\t\t\tthis.ignoreElementsRegex = this.sandbox.getRegExp('ignoreElementsRegex');\n\t\t\t// /* initialization of Range adapter */\n\t\t\tthis.libAdapter = RangeCreator.RangyAdapter;\n\t\t\tthis.rangyOptions = {\n\t\t\t\tnonWhiteSpaceExtendedGlobal: this.sandbox.getRegExp('nonWhiteSpaceExtended').g(),\n\t\t\t\t// Original tokenizer of rangy odified with support of symbols in any language(rangy supports latin characters only).\n\t\t\t\t// Also added definitions for punctuation and some characters we need to ignore (see removePunctuation method).\n\t\t\t\ttokenizer: \tfunction (chars, options) {\n\t\t\t\t\tvar word = chars.join(''),\n\t\t\t\t\t\tlastWordEnd = 0,\n\t\t\t\t\t\ttokens = [],\n\t\t\t\t\t\twordStart, wordEnd, result;\n\n\t\t\t\t\tfunction createTokenFromRange(start, end, isWord) {\n\t\t\t\t\t\tvar tokenChars = chars.slice(start, end),\n\t\t\t\t\t\t\ttoken = {\n\t\t\t\t\t\t\t\tisWord: isWord,\n\t\t\t\t\t\t\t\tchars: tokenChars,\n\t\t\t\t\t\t\t\ttoString: function() { return tokenChars.join(''); }\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\tfor (var i = 0, len = tokenChars.length; i < len; ++i) {\n\t\t\t\t\t\t\ttokenChars[i].token = token;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttokens.push(token);\n\t\t\t\t\t}\n\t\t\t\t\tword = self.sandbox.replaceSepatators(word);\n\n\t\t\t\t\t// Match words and mark characters\n\t\t\t\t\twhile ( (result = options.nonWhiteSpaceExtendedGlobal.exec(word)) ) {\n\t\t\t\t\t\twordStart = result.index;\n\t\t\t\t\t\twordEnd = wordStart + result[0].length;\n\n\t\t\t\t\t\t// Create token for non-word characters preceding this word\n\t\t\t\t\t\tif (wordStart > lastWordEnd) {\n\t\t\t\t\t\t\tcreateTokenFromRange(lastWordEnd, wordStart, false);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcreateTokenFromRange(wordStart, wordEnd, true);\n\t\t\t\t\t\tlastWordEnd = wordEnd;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Create token for trailing non-word characters, if any exist\n\t\t\t\t\tif (lastWordEnd < chars.length) {\n\t\t\t\t\t\tcreateTokenFromRange(lastWordEnd, chars.length, false);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn tokens;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\t// If documentContainer is iframe and it was removed from the page rangy will throw an error.\n\t\t// We need to prevent creating rangy with removed element.\n\t\tgetDocumentContainer: function() {\n\t\t\treturn Utils.isInPage(this.documentContainer) ? this.documentContainer : null;\n\t\t},\n\t\t/* Range Module methods */\n\t\tcreateRange: function () { return new RangeCreator.Range( new this.libAdapter( this.getDocumentContainer(), this.blockElementsRegex, this.ignoreElementsRegex, this.rangyOptions ) ); },\n\t\tgetSelection: function (/*Boolean*/ inMainWindow) { return new RangeCreator.Selection( new this.libAdapter( this.getDocumentContainer(), this.blockElementsRegex, this.ignoreElementsRegex, this.rangyOptions ), inMainWindow ); },\n\t\tgetSelectionManager: function () { return new RangeCreator.SelectionManager( new this.libAdapter( this.getDocumentContainer(), this.blockElementsRegex, this.ignoreElementsRegex, this.rangyOptions ) ); },\n\t\tgetRangeManager: function () { return new RangeCreator.RangeManager( new this.libAdapter( this.getDocumentContainer(), this.blockElementsRegex, this.ignoreElementsRegex, this.rangyOptions ) ); },\n\t\tcomparisonType: {\n\t\t\tSTART_TO_START: 0,\n\t\t\tSTART_TO_END: 1,\n\t\t\tEND_TO_START: 3,\n\t\t\tEND_TO_END: 2\n\t\t}\n\t};\n\n\t/**\n\t * RangeCreator.Range\n\t *\n\t * @constructor\n\t */\n\tRangeCreator.Range = function(adapter) {\n\t\tvar range = adapter.range;\n\t\trange.createRange();\n\t\t//this.adapter = adapter;\n\t\t//this.adapter.range.createRange();\n\n\t\t// Properties\n\t\tthis.collapsed = function() { return range.collapsed(); };\n\n\t\tthis.commonAncestorContainer = function() { return range.commonAncestorContainer(); };\n\n\t\tthis.endContainer =\tfunction() { return range.endContainer(); };\n\n\t\tthis.endOffset = function() { return range.endOffset(); };\n\n\t\tthis.startContainer = function() { return range.startContainer(); };\n\n\t\tthis.startOffset = function() { return range.startOffset(); };\n\t\t// Methods\n\t\tthis.setStart =\tfunction(/*Node*/ node, /*Number*/ offset) { return range.setStart(node, offset); };\n\n\t\tthis.setEnd = function(/*Node*/ node, /*Number*/ offset) { return range.setEnd(node, offset); };\n\n\t\tthis.setStartBefore = function(/*Node*/ node) { return range.setStartBefore(node); };\n\n\t\tthis.setStartAfter = function(/*Node*/ node) { return range.setStartAfter(node); };\n\n\t\tthis.setEndBefore =\tfunction(/*Node*/ node) { return range.setEndBefore(node); };\n\n\t\tthis.setEndAfter = function(/*Node*/ node) { return range.setEndAfter(node); };\n\n\t\tthis.selectNode = function(/*Node*/ node) { return range.selectNode(node); };\n\n\t\tthis.selectNodeContents = function(/*Node*/ node) { return range.selectNodeContents(node); };\n\n\t\tthis.collapse =\tfunction(/*Boolean*/ toStart) { return range.collapse(toStart); };\n\n\t\tthis.cloneContents = function() { return range.cloneContents(); };\n\n\t\tthis.deleteContents = function() { return range.deleteContents(); };\n\n\t\tthis.extractContents = function() { return range.extractContents(); };\n\n\t\tthis.insertNode = function(/*Node*/ node) { return range.insertNode(node); };\n\n\t\tthis.surroundContents = function(/*Node*/ node) { return range.surroundContents(node); };\n\n\t\tthis.compareBoundaryPoints = function(/*Number*/ comparisonType, /*Range*/ range) { return range.compareBoundaryPoints(comparisonType, range); };\n\n\t\tthis.cloneRange = function() { return range.cloneRange(); }; // TODO: make it right\n\t\tthis.detach = function() { return range.detach(); };\n\t\tthis.toString = function() { return range.toString(); };\n\t\tthis.createContextualFragment = function(/*String*/ html) { return range.createContextualFragment(html); };\n\t\tthis.move = function(/*String*/ unit, /*Number*/ count, /*Object*/ option) { return range.move(unit, count, option); };\n\t\tthis.expand = function(/*String*/ unit, /*Object*/ option) { return range.expand(unit, option); };\n\t\tthis.getNodes = function() { return range.getNodes(); };\n\t\tthis.moveEnd = function(/*String*/ unit, /*Number*/ count, /*Object*/ option) { return range.moveEnd(unit, count, option); };\n\t\tthis.moveStart = function(/*String*/ unit, /*Number*/ count, /*Object*/ option) { return range.moveStart(unit, count, option); };\n\t\tthis.getBookmark = function(/*Node*/ container) { return range.getBookmark(container); };\n\t\tthis.moveToBookmark = function(/*Object*/ bookmark) { return range.moveToBookmark(bookmark); };\n\t\tthis.containsRange = function(/*Range*/ curRange) {\n\t\t\t//for method containsRange we should provide rangy range obgect\n\t\t\treturn range.containsRange(curRange._getRangyRange());\n\t\t};\n\t\t// PRIVATE\n\t\t// return range object created by RangyLib;\n\t\tthis._getRangyRange = function() { return range._getRangyRange(); };\n\t};\n\n\tRangeCreator.RangeManager = function(adapter) {\n\t\tvar rangeManager = adapter.rangeManager;\n\n\t\treturn {\n\t\t\tsaveRange: function(range, backward) {\n\t\t\t\treturn rangeManager.saveRange(range, backward);\n\t\t\t},\n\t\t\trestoreRange: function(rangeInfo, normalize) {\n\t\t\t\treturn rangeManager.restoreRange(rangeInfo, normalize);\n\t\t\t}\n\t\t};\n\t};\n\n\tRangeCreator.RangeManager.prototype = {};\n\n\t/**\n\t * RangeCreator.Selection\n\t *\n\t * @constructor\n\t */\n\tRangeCreator.Selection = function(adapter, inMainWindow) {\n\t\tvar selection = adapter.selection;\n\t\tselection.getSelection(inMainWindow);\n\n\t\tthis.rangeCount = function() { return selection.rangeCount(); };\n\t\tthis.getRangeAt = function(/*Number*/ index) { return selection.getRangeAt(index); };\n\t\tthis.removeAllRanges = function() { return selection.removeAllRanges(); };\n\t\tthis.addRange = function(/*Range*/ range) { return selection.addRange(range); };\n\t\tthis.anchorNode = function() { return selection.anchorNode(); };\n\t\tthis.anchorOffset = function() { return selection.anchorOffset(); };\n\t\tthis.focusNode = function() { return selection.focusNode(); };\n\t\tthis.focusOffset = function() { return selection.focusOffset(); };\n\t\tthis.move = function(/*String*/ unit, /*Number*/ count, /*Object*/ options) { return selection.move(unit, count, options); };\n\t\tthis.expand = function(/*String*/ unit, /*Object*/ options) { return selection.expand(unit, options); };\n\t\tthis.isBackwards = function() { return selection.isBackwards(); };\n\t};\n\n\tRangeCreator.SelectionManager = function(adapter) {\n\t\tvar selectionManager = adapter.selectionManager;\n\n\t\treturn {\n\t\t\tsaveSelection: \t\tfunction() { return selectionManager.saveSelection(); },\n\t\t\trestoreSelection: \tfunction(/*Object*/ savedSelection) { return selectionManager.restoreSelection(savedSelection); },\n\t\t\tremoveMarkers: \t\tfunction(/*Object*/ savedSelection) { return selectionManager.removeMarkers(savedSelection); }\n\t\t};\n\t};\n\n\tRangeCreator.SelectionManager.prototype = {};\n\n\n\t/* Range adapter for Rangy */\n\tRangeCreator.RangyAdapter = function(documentContainer, blockElementsRegex, ignoreElementsRegex, rangyOptions) {\n\t\t// constructor\n\t\tRangeCreator.Lib = RangeCreator.Lib || exports.rangy || window['rangy'];\n\t\t// if document.readyState === interactive then initialize rangy manually\n\t\tif (RangeCreator.Lib.initialized === false) {\n\t\t\tRangeCreator.Lib.init();\n\t\t}\n\t\tvar _range, _selection = null,\n\t\t\t_adapter = {\n\t\t\t\trange: {\n\t\t\t\t\tcreateRange: \t\tfunction() { return _range = RangeCreator.Lib.createRange(documentContainer); },\n\t\t\t\t\t// Properties\n\t\t\t\t\tcollapsed: \t\t\tfunction() { return _range.collapsed; },\n\t\t\t\t\tcommonAncestorContainer: function() { return _range.commonAncestorContainer; },\n\t\t\t\t\tendContainer: \t\tfunction() { return _range.endContainer; },\n\t\t\t\t\tendOffset: \t\t\tfunction() { return _range.endOffset; },\n\t\t\t\t\tstartContainer: \tfunction() { return _range.startContainer; },\n\t\t\t\t\tstartOffset: \t\tfunction() { return _range.startOffset; },\n\t\t\t\t\t// Methods\n\t\t\t\t\tsetStart: \t\t\tfunction(/*Node*/ node, /*Number*/ offset) { return _range.setStart(node, offset); },\n\t\t\t\t\tsetEnd: \t\t\tfunction(/*Node*/ node, /*Number*/ offset) { return _range.setEnd(node, offset); },\n\t\t\t\t\tsetStartBefore: \tfunction(/*Node*/ node) { return _range.setStartBefore(node); },\n\t\t\t\t\tsetStartAfter: \t\tfunction(/*Node*/ node) { return _range.setStartAfter(node); },\n\t\t\t\t\tsetEndBefore: \t\tfunction(/*Node*/ node) { return _range.setEndBefore(node); },\n\t\t\t\t\tsetEndAfter: \t\tfunction(/*Node*/ node) { return _range.setEndAfter(node); },\n\t\t\t\t\tselectNode: \t\tfunction(/*Node*/ node) { return _range.selectNode(node); },\n\t\t\t\t\tselectNodeContents: function(/*Node*/ node) { return _range.selectNodeContents(node); },\n\t\t\t\t\tcollapse: \t\t\tfunction(/*Boolean*/ toStart) { return _range.collapse(toStart); },\n\t\t\t\t\tcloneContents: \t\tfunction() { return _range.cloneContents(); },\n\t\t\t\t\tdeleteContents: \tfunction() { return _range.deleteContents(); },\n\t\t\t\t\textractContents: \tfunction() { return _range.extractContents(); },\n\t\t\t\t\tinsertNode: \t\tfunction(/*Node*/ node) { return _range.insertNode(node); },\n\t\t\t\t\tsurroundContents: \tfunction(/*Node*/ node) { return _range.surroundContents(node); },\n\t\t\t\t\tcompareBoundaryPoints: function(/*Number*/ comparisonType, /*Range*/ range) {\n\t\t\t\t\t\tvar _convertedRange = RangeCreator.Lib.createRange(documentContainer);\n\t\t\t\t\t\t_convertedRange.setStart(range.startContainer(), range.startOffset());\n\t\t\t\t\t\t_convertedRange.setEnd(range.endContainer(), range.endOffset());\n\t\t\t\t\t\treturn _range.compareBoundaryPoints(comparisonType, _convertedRange);\n\t\t\t\t\t},\n\t\t\t\t\tcloneRange: \t\tfunction() {\n\t\t\t\t\t\tvar _rangeClone = new RangeCreator.Range( new RangeCreator.RangyAdapter( documentContainer, blockElementsRegex, ignoreElementsRegex, rangyOptions ) );\n\n\t\t\t\t\t\t_rangeClone.setStart(this.startContainer(), this.startOffset());\n\t\t\t\t\t\t_rangeClone.setEnd(this.endContainer(), this.endOffset());\n\t\t\t\t\t\treturn _rangeClone;\n\t\t\t\t\t},\n\t\t\t\t\tdetach: \t\t\tfunction() { return _range.detach(); },\n\t\t\t\t\ttoString: \t\t\tfunction() {\n\t\t\t\t\t\tvar _text = \"\";\n\t\t\t\t\t\tvar documentFragment = _range.cloneContents();\n\t\t\t\t\t\tvar queue = [documentFragment],\n\t\t\t\t\t\t\tnode = queue.shift();\n\n\t\t\t\t\t\twhile (node) {\n\t\t\t\t\t\t\tswitch (node.nodeType) {\n\t\t\t\t\t\t\t\tcase 3 :\n\t\t\t\t\t\t\t\t\t_text += node.nodeValue;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 1 :\n\t\t\t\t\t\t\t\tcase 11 :\n\t\t\t\t\t\t\t\t\tif ( !ignoreElementsRegex.match(node.nodeName) ) {\n\t\t\t\t\t\t\t\t\t\tfor ( var i=0; i < node.childNodes.length; i++ ) {\n\t\t\t\t\t\t\t\t\t\t\tqueue.splice(i, 0, node.childNodes[i]);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif ( blockElementsRegex.match(node.nodeName) ) {\n\t\t\t\t\t\t\t\t\t\t\tif (queue.length > node.childNodes.length) {\n\t\t\t\t\t\t\t\t\t\t\t\tqueue.splice(i, 0, document.createTextNode(' '));\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\tif (_text.length > 0 && _text[_text.length - 1] != ' ') {\n\t\t\t\t\t\t\t\t\t\t\t\tqueue.splice(0, 0, document.createTextNode(' '));\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t_text += ' ';\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tnode = queue.shift();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn _text;\n\t\t\t\t\t},\n\t\t\t\t\tcreateContextualFragment: function(/*String*/ html) { return _range.createContextualFragment(html); },\n\t\t\t\t\tmove: function(/*String*/ unit, /*Number*/ count, /*Object*/ options) {\n\t\t\t\t\t\treturn _range.move(unit, count, unit === 'word' && !options ? rangyOptions : options);\n\t\t\t\t\t},\n\t\t\t\t\texpand: function(/*String*/ unit, /*Object*/ options) {\n\t\t\t\t\t\treturn _range.expand(unit, unit === 'word' && !options ? rangyOptions : options);\n\t\t\t\t\t},\n\t\t\t\t\tgetNodes: function() { return _range.getNodes(); },\n\t\t\t\t\tmoveEnd: function(/*String*/ unit, /*Number*/ count, /*Object*/ options) {\n\t\t\t\t\t\treturn _range.moveEnd(unit, count, unit === 'word' && !options ? rangyOptions : options);\n\t\t\t\t\t},\n\t\t\t\t\tmoveStart: function(/*String*/ unit, /*Number*/ count, /*Object*/ options) {\n\t\t\t\t\t\treturn _range.moveStart(unit, count, unit === 'word' && !options ? rangyOptions : options);\n\t\t\t\t\t},\n\t\t\t\t\tgetBookmark: function(/*Node*/ container) { return _range.getBookmark(container); },\n\t\t\t\t\tmoveToBookmark: function(/*Object*/ bookmark) {\n\t\t\t\t\t\tvar _wscRange = false;\n\n\t\t\t\t\t\tif (bookmark) {\n\t\t\t\t\t\t\t_range.moveToBookmark(bookmark);\n\n\t\t\t\t\t\t\t_wscRange = new RangeCreator.Range( new RangeCreator.RangyAdapter( documentContainer, blockElementsRegex, ignoreElementsRegex, rangyOptions ) );\n\t\t\t\t\t\t\t_wscRange.setStart(_range.startContainer, _range.startOffset);\n\t\t\t\t\t\t\t_wscRange.setEnd(_range.endContainer, _range.endOffset);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn _wscRange;\n\t\t\t\t\t},\n\t\t\t\t\tcontainsRange: function(/*Range*/ range) { return _range.containsRange(range); },\n\t\t\t\t\t_getRangyRange: function() { return _range; }\n\t\t\t\t},\n\t\t\t\tselection: {\n\t\t\t\t\tgetSelection: \t\tfunction(inMainWindow) {\n\t\t\t\t\t\tvar _getSelection = function() {\n\t\t\t\t\t\t\t// For some event we need to get selection in main window even if we have iframe based container\n\t\t\t\t\t\t\tif ( (typeof inMainWindow === 'boolean' && inMainWindow) || documentContainer.nodeName.toLowerCase() !== \"iframe\" ) {\n\t\t\t\t\t\t\t\t_selection = RangeCreator.Lib.getSelection();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t_selection = RangeCreator.Lib.getSelection(documentContainer);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (_selection !== null) {\n\t\t\t\t\t\t\tthis.detach();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// IE has strange behaviour with iframes.\n\t\t\t\t\t\t// In some cases we get next error:\n\t\t\t\t\t\t// SCRIPT70: Permission denied\n\t\t\t\t\t\t// For this case we should catch this error and detach selection in Rangy library.\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t_getSelection();\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tthis.detach();\n\t\t\t\t\t\t\t_getSelection();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn _selection;\n\t\t\t\t\t},\n\t\t\t\t\trangeCount: \t\tfunction() { return _selection.rangeCount; },\n\t\t\t\t\tgetRangeAt: \t\tfunction(/*Number*/ index) {\n\t\t\t\t\t\tvar _selRange = _selection.getRangeAt(index);\n\t\t\t\t\t\tvar _range = new RangeCreator.Range( new RangeCreator.RangyAdapter( documentContainer, blockElementsRegex, ignoreElementsRegex, rangyOptions ) );\n\t\t\t\t\t\t_range.setStart(_selRange.startContainer, _selRange.startOffset);\n\t\t\t\t\t\t_range.setEnd(_selRange.endContainer, _selRange.endOffset);\n\t\t\t\t\t\treturn _range;\n\t\t\t\t\t},\n\t\t\t\t\tremoveAllRanges: \tfunction() { return _selection.removeAllRanges(); },\n\t\t\t\t\taddRange: \t\t\tfunction(/*Range*/ range) {\n\t\t\t\t\t\tvar _range = RangeCreator.Lib.createRange(documentContainer);\n\t\t\t\t\t\t_range.setStart(range.startContainer(), range.startOffset());\n\t\t\t\t\t\t_range.setEnd(range.endContainer(), range.endOffset());\n\t\t\t\t\t\treturn _selection.addRange(_range);\n\t\t\t\t\t},\n\t\t\t\t\tanchorNode: \t\tfunction() { return _selection.anchorNode; },\n\t\t\t\t\tanchorOffset: \t\tfunction() { return _selection.anchorOffset; },\n\t\t\t\t\tfocusNode: \t\t\tfunction() { return _selection.focusNode; },\n\t\t\t\t\tfocusOffset: \t\t\tfunction() { return _selection.focusOffset; },\n\t\t\t\t\tmove: \t\t\t\tfunction(/*String*/ unit, /*Number*/ count, /*Object*/ options) { return _selection.move(unit, count, options); },\n\t\t\t\t\texpand: \t\t\tfunction(/*String*/ unit, /*Object*/ options) { return _selection.expand(unit, options); },\n\t\t\t\t\tdetach: \t\t\tfunction(){ RangeCreator.Lib.Selection.detachAll(); },\n\t\t\t\t\tisBackwards: \t\tfunction() { return _selection.isBackwards(); }\n\t\t\t\t},\n\t\t\t\tselectionManager: {\n\t\t\t\t\tsaveSelection: \t\tfunction() {\n\t\t\t\t\t\tvar _savedSelection;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif(UILib.is(documentContainer, ':visible')) {\n\t\t\t\t\t\t\t\tif (documentContainer.nodeName.toLowerCase() == \"iframe\") {\n\t\t\t\t\t\t\t\t\t_savedSelection = RangeCreator.Lib.saveSelection(documentContainer);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t_savedSelection = RangeCreator.Lib.saveSelection();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t_savedSelection.doc = Utils.getCurrentDocument(documentContainer);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch(e) {}\n\n\t\t\t\t\t\treturn _savedSelection;\n\t\t\t\t\t},\n\t\t\t\t\trestoreSelection: \tfunction(/*Object*/ savedSelection) {\n\t\t\t\t\t\t\t//function copied from the rangy-core.js\n\t\t\t\t\t\tfunction restoreRanges(rangeInfos) {\n\t\t\t\t\t\t\tvar ranges = [];\n\n\t\t\t\t\t\t\t// Ranges are in reverse order of appearance in the DOM. We want to restore earliest first to avoid\n\t\t\t\t\t\t\t// normalization affecting previously restored ranges.\n\t\t\t\t\t\t\tvar rangeCount = rangeInfos.length;\n\n\t\t\t\t\t\t\tfor (var i = rangeCount - 1; i >= 0; i--) {\n\t\t\t\t\t\t\t\tranges[i] = RangeCreator.Lib.restoreRange(rangeInfos[i], false);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn ranges;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!savedSelection.restored) {\n\t\t\t\t\t\t\tvar rangeInfos = savedSelection.rangeInfos;\n\t\t\t\t\t\t\tvar sel = _adapter.selection.getSelection(savedSelection.win);\n\t\t\t\t\t\t\tvar ranges = restoreRanges(rangeInfos), rangeCount = rangeInfos.length;\n\n\t\t\t\t\t\t\tif (rangeCount == 1 && RangeCreator.Lib.features.selectionHasExtend && rangeInfos[0].backward) {\n\t\t\t\t\t\t\t\tsel.removeAllRanges();\n\t\t\t\t\t\t\t\tsel.addRange(ranges[0], true);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tsel.setRanges(ranges);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tsavedSelection.restored = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn savedSelection.restored;\n\t\t\t\t\t},\n\t\t\t\t\tremoveMarkers: function(/*Object*/ savedSelection) {\n\t\t\t\t\t\tRangeCreator.Lib.removeMarkers(savedSelection);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\trangeManager: {\n\t\t\t\t\tsaveRange: function(range, backward) {\n\t\t\t\t\t\tvar _savedRange, _rangyRange;\n\n\t\t\t\t\t\t_rangyRange = RangeCreator.Lib.createRange(documentContainer);\n\n\t\t\t\t\t\t_rangyRange.setStart(range.startContainer(), range.startOffset());\n\n\t\t\t\t\t\tif(!range.collapsed()) {\n\t\t\t\t\t\t\t_rangyRange.setEnd(range.endContainer(), range.endOffset());\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t_savedRange = RangeCreator.Lib.saveRange(_rangyRange, backward);\n\n\t\t\t\t\t\treturn _savedRange;\n\t\t\t\t\t},\n\t\t\t\t\trestoreRange: function(rangeInfo, normalize) {\n\t\t\t\t\t\tvar _restoredRange, _wscRange = false;\n\n\t\t\t\t\t\tif(rangeInfo) {\n\t\t\t\t\t\t\t_restoredRange = RangeCreator.Lib.restoreRange(rangeInfo, normalize);\n\n\t\t\t\t\t\t\t_wscRange = new RangeCreator.Range( new RangeCreator.RangyAdapter( documentContainer, blockElementsRegex, ignoreElementsRegex, rangyOptions ) );\n\t\t\t\t\t\t\t_wscRange.setStart(_restoredRange.startContainer, _restoredRange.startOffset);\n\t\t\t\t\t\t\t_wscRange.setEnd(_restoredRange.endContainer, _restoredRange.endOffset);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn _wscRange;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\treturn _adapter;\n\t};\n\n\t/* Range adapter for TestLib */\n\tRangeCreator.TestAdapter = function() {\n\t\t// constructor\n\t\tRangeCreator.Lib = RangeCreator.Lib || window[\"TestLib\"];\n\t\tUtils.removeGlobal(window[\"TestLib\"]);\n\n\t\tvar _range = null;\n\n\t\treturn {\n\t\t\tcreateRange: function() { return RangeCreator.Lib.createRange(); },\n\t\t\tselectNodeContents: function(document) { return RangeCreator.Lib.selectNodeContents(document); },\n\t\t\tcollapse: function(bool) { return RangeCreator.Lib.collapse(bool); },\n\t\t\tcreateContextualFragment: function(text) { return RangeCreator.Lib.createContextualFragment(text); },\n\t\t\tinsertNode: function(node) { return RangeCreator.Lib.insertNode(node); }\n\t\t};\n\t};\n\n\texports.RangeCreator = RangeCreator;\n\n})(WEBSPELLCHECKER.CORE);\n// statecontroller.js\n/**\n * @fileoverview of CORE IME module.\n */\n\n(function( exports ) {\n\t'use strict';\n\n\t/**\n\t * Represents StateController Module.\n\t *\n\t * @constructor\n\t * @alias CORE.StateController\n\t * @param {String} moduleID\n\t * @param {CORE.Sandbox} sandbox\n\t */\n\tvar StateController = function(moduleID, sandbox) {\n\t\t/**\n\t\t * Module name.\n\t\t *\n\t\t * @type {String}\n\t\t*/\n\t\tthis.name = moduleID;\n\t\t/**\n\t\t * Reference to StateController module sandbox.\n\t\t *\n\t\t * @type {CORE.Sandbox}\n\t\t */\n\t\tthis.sandbox = sandbox;\n\t\t/**\n\t\t * Link on the container.\n\t\t *\n\t\t * @type {Node}\n\t\t */\n\t\tthis.container = this.sandbox.getOption('container');\n\n\t\tthis.documentContainer = this.sandbox.getOption('focusContainer');\n\t};\n\n\tStateController.prototype = {\n\t\t/**\n\t\t * Called after each registration in core.\n\t\t *\n\t\t * @memberof CORE.StateController#\n\t\t */\n\t\tinit: function() {\n\t\t\tvar self = this;\n\t\t\t// we should waite all module because some modules (like wrapper)\n\t\t\t// can substitute container and documentContainer options\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'allModulesReady',\n\t\t\t\thandler: function() {\n\t\t\t\t\tself.removeBindings();\n\t\t\t\t\tself.documentContainer =  self.sandbox.getOption('focusContainer');\n\t\t\t\t\tself.container = this.sandbox.getOption('container');\n\t\t\t\t\tself.addBindings();\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.addBindings();\n\t\t},\n\t\t/**\n\t\t * Destructor of module. Called from core\n\t\t * Remove all ui subscribers\n\t\t *\n\t\t * @memberof CORE.StateController#\n\t\t */\n\t\tdestroy: function() {\n\t\t\tthis.removeBindings();\n\t\t},\n\t\t/**\n\t\t * add core bindings\n\t\t *\n\t\t * @memberof CORE.StateContr\toller#\n\t\t */\n\t\taddBindings: function() {\n\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'focus',\n\t\t\t\telement: this.documentContainer,\n\t\t\t\thandler: this.focusHandler\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'blur',\n\t\t\t\telement: this.documentContainer,\n\t\t\t\thandler: this.blurHandler\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'mousedown',\n\t\t\t\telement: this.container,\n\t\t\t\thandler: this.mouseDownHandler\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'mouseup',\n\t\t\t\telement: this.container,\n\t\t\t\thandler: this.mouseUpHandler\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'keydown',\n\t\t\t\telement: this.container,\n\t\t\t\thandler: this.keydownHandler,\n\t\t\t\tpriority: 2000,\n\t\t\t\tcontext: this\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'keyup',\n\t\t\t\telement: this.container,\n\t\t\t\thandler: this.keyupHandler,\n\t\t\t\tpriority: 2000,\n\t\t\t\tcontext: this\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Remove core bindings\n\t\t *\n\t\t * @memberof CORE.StateController#\n\t\t */\n\t\tremoveBindings: function() {\n\n\t\t\tthis.sandbox.unsubscribe({\n\t\t\t\teventType: 'focus',\n\t\t\t\telement: this.documentContainer,\n\t\t\t\thandler: this.focusHandler\n\t\t\t});\n\n\t\t\tthis.sandbox.unsubscribe({\n\t\t\t\teventType: 'blur',\n\t\t\t\telement: this.documentContainer,\n\t\t\t\thandler: this.blurHandler\n\t\t\t});\n\n\t\t\tthis.sandbox.unsubscribe({\n\t\t\t\teventType: 'mousedown',\n\t\t\t\telement: this.container,\n\t\t\t\thandler: this.mouseDownHandler\n\t\t\t});\n\n\t\t\tthis.sandbox.unsubscribe({\n\t\t\t\teventType: 'mouseup',\n\t\t\t\telement: this.container,\n\t\t\t\thandler: this.mouseUpHandler\n\t\t\t});\n\n\t\t\tthis.sandbox.unsubscribe({\n\t\t\t\teventType: 'keydown',\n\t\t\t\telement: this.container,\n\t\t\t\thandler: this.keydownHandler,\n\t\t\t\tcontext: this\n\t\t\t});\n\n\t\t\tthis.sandbox.unsubscribe({\n\t\t\t\teventType: 'keyup',\n\t\t\t\telement: this.container,\n\t\t\t\thandler: this.keyupHandler,\n\t\t\t\tcontext: this\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t* Native focus event handler.\n\t\t*\n\t\t* @memberof CORE.StateController#\n\t\t* @param {Object} event - Communication event\n\t\t*/\n\t\tfocusHandler: function(event) {\n\t\t\t/* Handling focus on control */\n\t\t\tthis.sandbox.setFocused(true);\n\t\t},\n\t\t/**\n\t\t* Native blur event handler.\n\t\t*\n\t\t* @memberof CORE.StateController#\n\t\t* @param {Object} event - Communication event\n\t\t*/\n\t\tblurHandler: function(event) {\n\t\t\t/* Handling focus on control */\n\t\t\tthis.sandbox.setFocused(false);\n\t\t},\n\t\t/**\n\t\t* Native mouseDown event handler.\n\t\t*\n\t\t* @memberof CORE.StateController#\n\t\t* @param {Object} event - Communication event\n\t\t*/\n\t\tmouseDownHandler: function(event) {\n\t\t\t/* Handling left mouse button holding on control */\n\t\t\tthis.sandbox.setOption('leftMouseButtonPressed', true);\n\t\t},\n\t\t/**\n\t\t* Native mouseUp event handler.\n\t\t*\n\t\t* @memberof CORE.StateController#\n\t\t* @param {Object} event - Communication event\n\t\t*/\n\t\tmouseUpHandler: function(event) {\n\t\t\t/* Handling left mouse button holding on control */\n\t\t\tthis.sandbox.setOption('leftMouseButtonPressed', false);\n\t\t},\n\t\t/**\n\t\t* Native keyDown event handler.\n\t\t*\n\t\t* @memberof CORE.StateController#\n\t\t* @param {Object} event - Communication event\n\t\t*/\n\t\tkeydownHandler: function(event) {\n\t\t\tswitch (event.keyCode) {\n\t\t\t\tcase 46:\n\t\t\t\t\tthis.sandbox.setOption('deleteKeyButtonPressed', true);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 8:\n\t\t\t\t\tthis.sandbox.setOption('backspaceKeyButtonPressed', true);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 32:\n\t\t\t\t\tthis.sandbox.setOption('spaceKeyButtonPressed', true);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 13:\n\t\t\t\t\tthis.sandbox.setOption('enterKeyButtonPressed', true);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t* Native keyUp event handler.\n\t\t*\n\t\t* @memberof CORE.StateController#\n\t\t* @param {Object} event - Communication event\n\t\t*/\n\t\tkeyupHandler: function(event) {\n\t\t\tswitch (event.keyCode) {\n\t\t\t\tcase 46:\n\t\t\t\t\tthis.sandbox.setOption('deleteKeyButtonPressed', false);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 8:\n\t\t\t\t\tthis.sandbox.setOption('backspaceKeyButtonPressed', false);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 32:\n\t\t\t\t\tthis.sandbox.setOption('spaceKeyButtonPressed', false);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 13:\n\t\t\t\t\tthis.sandbox.setOption('enterKeyButtonPressed', false);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t};\n\n\texports.StateController = StateController;\n})(WEBSPELLCHECKER.CORE);\n// communication.js\r\n/**\r\n * @fileoverview of CORE Communication module.\r\n */\r\n\r\n(function( exports ) {\r\n\t'use strict';\r\n\tvar Utils,\r\n\t\t_events;\r\n\t/**\r\n\t * Communication module constructor.\r\n\t * @constructor\r\n\t * @alias CORE.Communication\r\n\t * @param {string} moduleID\r\n\t * @param {CORE.Sandbox} sandbox\r\n\t */\r\n\tvar Communication = function(moduleID, sandbox) {\r\n\t\t/**\r\n\t\t * Module name.\r\n\t\t *\r\n\t\t * @type {String}\r\n\t\t*/\r\n\t\tthis.name = moduleID;\r\n\r\n\t\t/**\r\n\t\t * Reference to Communication module sandbox.\r\n\t\t *\r\n\t\t * @type {CORE.Sandbox}\r\n\t\t */\r\n\t\tthis.sandbox = sandbox;\r\n\r\n\t\tUtils = sandbox.Utils;\r\n\t\t/**\r\n\t\t * Events collection.\r\n\t\t * @type {Object.<string, CORE.Communication.Signal>}\r\n\t\t */\r\n\t\tthis.events = {};\r\n\r\n\t\tCommunication.Signal = Communication.Signal || exports['signals'];\r\n\t};\r\n\r\n\tCommunication.prototype = {\r\n\t\t/**\r\n\t\t * Called after each registration in core.\r\n\t\t *\r\n\t\t * @memberof CORE.Communication#\r\n\t\t */\r\n\t\tinit: function() {\r\n\t\t\t_events = [\r\n\t\t\t\t'toggleApp',\r\n\t\t\t\t\"startSpellCheck\",\r\n\t\t\t\t\"moduleStarted\",\r\n\t\t\t\t\"selectionIsChanged\",\r\n\t\t\t\t\"saveSelection\",\r\n\t\t\t\t\"restoreSelection\",\r\n\t\t\t\t\"periodicalChecking\",\r\n\t\t\t\t'loadTheme',\r\n\t\t\t\t'localizationLoaded',\r\n\t\t\t\t/**\r\n\t\t\t\t * @name collectWords\r\n\t\t\t\t * @event\r\n\t\t\t\t * @memberof CORE.Communication\r\n\t\t\t\t * @type {CORE.Communication.Signal}\r\n\t\t\t\t * @param {object} data\r\n\t\t\t\t * @param {CORE.RangeCreator.Range|string} data.source\r\n\t\t\t\t */\r\n\t\t\t\t\"collectWords\",\r\n\r\n\t\t\t\t/**\r\n\t\t\t\t * @name wordsCollected\r\n\t\t\t\t * @event\r\n\t\t\t\t * @memberof CORE.Communication\r\n\t\t\t\t * @type {CORE.Communication.Signal}\r\n\t\t\t\t * @param {object} data\r\n\t\t\t\t * @param {object} data.wordsCollection \t- sample: { 'word1': { word: 'word1' }, 'word2': { word: 'word2' } }\r\n\t\t\t\t */\r\n\t\t\t\t\"wordsCollected\", // required for data.words array\r\n\t\t\t\t\"misspelledWordsFound\", // required for data.words array and word language\r\n\t\t\t\t\"replaceWord\", // TODO: rename?\r\n\t\t\t\t\"sentWordsCount\",\r\n\t\t\t\t\"getWordsLimit\",\r\n\t\t\t\t\"createActionList\",\r\n\t\t\t\t\"freeze\",\r\n\r\n\t\t\t\t// Grammar Check\r\n\t\t\t\t\"startGrammarCheck\",\r\n\t\t\t\t\"collectSentences\",\r\n\t\t\t\t\"sentencesCollected\",\r\n\t\t\t\t\"getGrammarSuggestionsList\",\r\n\t\t\t\t\"problemSentencesFound\",\r\n\t\t\t\t\"markupPhrase\",\r\n\t\t\t\t\"ignorePhrase\",\r\n\t\t\t\t\"ignoreAllPhrases\",\r\n\t\t\t\t\"replacePhrase\",\r\n\t\t\t\t\"removeMarkupFromPhrases\",\r\n\t\t\t\t\"removeGrammarMarkupInSelectionNode\",\r\n\t\t\t\t\"updateSentencesCache\",\r\n\t\t\t\t\"enableGrammarChanged\",\r\n\t\t\t\t/**\r\n\t\t\t\t * @name markupWords\r\n\t\t\t\t * @event\r\n\t\t\t\t * @memberof CORE.Communication\r\n\t\t\t\t * @type {CORE.Communication.Signal}\r\n\t\t\t\t * @param {object} data\r\n\t\t\t\t * @param {Array<CORE.RangeCreator.Range>} data.ranges \t- Collection of Ranges\r\n\t\t\t\t */\r\n\t\t\t\t\"markupWords\", // TODO: rename?\r\n\r\n\t\t\t\t/**\r\n\t\t\t\t * @name getSuggestionsList\r\n\t\t\t\t * @event\r\n\t\t\t\t * @memberof CORE.Communication\r\n\t\t\t\t * @type {CORE.Communication.Signal}\r\n\t\t\t\t * @param {object} data\r\n\t\t\t\t * @param {string} data.lang\r\n\t\t\t\t * @param {string} data.word\r\n\t\t\t\t */\r\n\t\t\t\t\"getSuggestionsList\",\r\n\t\t\t\t\"suggestionListSend\",\r\n\t\t\t\t\"ignoreWord\",\r\n\t\t\t\t\"ignoreAllWords\",\r\n\t\t\t\t\"removeMarkupInDocument\",\r\n\t\t\t\t\"removeMarkupFromWords\",\r\n\t\t\t\t\"removeMarkupInSelectionNode\",\r\n\t\t\t\t\"textReplaced\",\r\n\t\t\t\t// TaksManager\r\n\t\t\t\t\"taskEnded\",\r\n\t\t\t\t\"spellCheckStarted\",\r\n\t\t\t\t\"spellCheckEnded\",\r\n\t\t\t\t// blur\r\n\t\t\t\t\"beforemanualcontrolblur\",\r\n\t\t\t\t// Banner\r\n\t\t\t\t\"showBanner\",\r\n\t\t\t\t\"hideBanner\",\r\n\r\n\t\t\t\t/* WSC temporary events */\r\n\t\t\t\t\"openWSCwindow\",\r\n\t\t\t\t\"documentReadyForSpelling\",\r\n\t\t\t\t\"suggestionListRendered\",\r\n\t\t\t\t\"commitOptions\",\r\n\t\t\t\t\"optionsCommited\",\r\n\t\t\t\t\"getUserDictionaryName\",\r\n\t\t\t\t\"getUserDictionary\",\r\n\t\t\t\t\"createUserDictionary\",\r\n\t\t\t\t\"renameUserDictionary\",\r\n\t\t\t\t\"restoreUserDictionary\",\r\n\t\t\t\t\"removeUserDictionary\",\r\n\t\t\t\t\"disconnectFromUserDictionary\",\r\n\t\t\t\t\"setUserDictionaryName\",\r\n\t\t\t\t\"addWordToUserDictionary\",\r\n\t\t\t\t\"deleteWordFromUserDictionary\",\r\n\t\t\t\t\"userDictionaryChanged\",\r\n\t\t\t\t\"userDictionaryStateChanged\",\r\n\t\t\t\t\"userDictionaryStateRestored\",\r\n\r\n\t\t\t\t//wrapper\r\n\t\t\t\t\"keydownCharLengthOnFakeElement\",\r\n\r\n\t\t\t\t// copy/paste module\r\n\t\t\t\t\"cutProcessed\",\r\n\t\t\t\t\"copyProcessed\",\r\n\t\t\t\t\"pasteProcessed\",\r\n\t\t\t\t\"afterPaste\",\r\n\r\n\t\t\t\t// context menuÑ\r\n\t\t\t\t\"contextMenuHide\",\r\n\r\n\t\t\t\t// dialog events\r\n\t\t\t\t\"dialogDefinition\",\r\n\t\t\t\t'openDialog',\r\n\t\t\t\t\"onLoad\",\r\n\t\t\t\t\"onShow\",\r\n\t\t\t\t\"onHide\",\r\n\t\t\t\t\"onClose\",\r\n\t\t\t\t\"onSubmit\",\r\n\t\t\t\t\"onCancel\",\r\n\t\t\t\t\"afterTabShow\",\r\n\r\n\t\t\t\t//experimental\r\n\t\t\t\t\"appReady\",\r\n\t\t\t\t\"calculateWords\",\r\n\t\t\t\t\"dictionaryChanged\",\r\n\r\n\t\t\t\t//test\r\n\t\t\t\t\"defaultTextchanged\",\r\n\t\t\t\t\"backgroundColorChanged\",\r\n\r\n\t\t\t\t//Modules state events\r\n\t\t\t\t'asyncModulesReady',\r\n\t\t\t\t'allModulesReady',\r\n\t\t\t\t'moduleReady',\r\n\r\n\t\t\t\t// Events for handle restore html elements\r\n\t\t\t\t'markupedNode',\r\n\t\t\t\t\"removedMarkupInContainer\",\r\n\t\t\t\t'removeMarkup',\r\n\r\n\t\t\t\t// Shortcuts events\r\n\t\t\t\t\"setShortcuts\",\r\n\t\t\t\t\"removeShortcuts\",\r\n\r\n\t\t\t\t// Undo/Redo events\r\n\t\t\t\t\"undo\",\r\n\t\t\t\t\"redo\",\r\n\t\t\t\t\"executeUndo\",\r\n\t\t\t\t\"executeRedo\",\r\n\t\t\t\t\"checkUndoRedoPosibility\",\r\n\t\t\t\t\"undoRedoPosibility\",\r\n\r\n\t\t\t\t// Drag and Drop events\r\n\t\t\t\t\"dropProcessed\",\r\n\t\t\t\t\"crossContainerDrop\",\r\n\t\t\t\t\"afterDrop\",\r\n\r\n\t\t\t\t\"remoteAction\",\r\n\r\n\t\t\t\t// Garbage collector\r\n\t\t\t\t\"fixBrokenNodes\",\r\n\t\t\t\t\"lockMutationsListener\",\r\n\t\t\t\t\"garbageCollected\",\r\n\r\n\t\t\t\t// ProofRID events\r\n\t\t\t\t\"userDictionaryAction\",\r\n\t\t\t\t\"showMessage\",\r\n\t\t\t\t\"hideMessage\",\r\n\t\t\t\t\"showUiElement\",\r\n\t\t\t\t\"hideUiElement\",\r\n\t\t\t\t\"setProofreadInDialogContainer\",\r\n\t\t\t\t\"startProofreadInDialog\",\r\n\t\t\t\t\"finishProofreadInDialog\",\r\n\t\t\t\t\"finishCheckingInDialog\",\r\n\r\n\t\t\t\t// Events for alternative markup\r\n\t\t\t\t\"startProblemsCheck\",\r\n\t\t\t\t\"replaceProblem\",\r\n\t\t\t\t\"ignoreAllProblems\",\r\n\t\t\t\t\"problemsFound\",\r\n\t\t\t\t\"problemsCollected\",\r\n\t\t\t\t\"markupProblems\",\r\n\t\t\t\t\"removeMarkupInContainer\",\r\n\t\t\t\t\"removeMarkupFromProblems\"\r\n\t\t\t];\r\n\r\n\t\t\tthis.addEvents(_events);\r\n\t\t},\r\n\t\t/**\r\n\t\t * Destructor of module. Called from core\r\n\t\t * Remove all ui subscribers\r\n\t\t *\r\n\t\t * @memberof CORE.Communication#\r\n\t\t */\r\n\t\tdestroy: function() {\r\n\t\t\tthis.unsubscribe({\r\n\t\t\t\teventType: _events.join(', ')\r\n\t\t\t});\r\n\t\t},\r\n\t\t/**\r\n\t\t * Creates Signal for each event and add it to communication events list\r\n\t\t *\r\n\t\t * @param {array} events \t- list of events name\r\n\t\t */\r\n\t\taddEvents: function(events) {\r\n\t\t\tfor (var i = 0; i < events.length; i += 1) {\r\n\t\t\t\tvar eventName = events[i];\r\n\t\t\t\tthis.events[eventName] = this.createSignal();\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t * Creates Signal for event\r\n\t\t *\r\n\t\t * @returns {CORE.Communication.Signal}\r\n\t\t */\r\n\t\tcreateSignal: function() {\r\n\t\t\treturn new Communication.Signal();\r\n\t\t},\r\n\t\t/**\r\n\t\t * Triggers all callback functions for specific event\r\n\t\t *\r\n\t\t * @param {string} moduleID \t- Module name which fires event\r\n\t\t * @param {string} eventType \t- Event name\r\n\t\t * @param {object} data \t\t- Event data\r\n\t\t *\r\n\t\t * @returns {array || object}   - event object or Array of event objects depending on the one or more ivents has been fired in one fire method\r\n\t\t */\r\n\t\tfire: function(options) {\r\n\t\t\toptions = options || {};\r\n\r\n\t\t\tvar moduleID = options.moduleID,\r\n\t\t\t\tdata = options.data || {},\r\n\r\n\t\t\t\teventTypes = options.eventType.split(','),\r\n\t\t\t\teventName = '',\r\n\t\t\t\tsignal,\r\n\t\t\t\tresultData = [],\r\n\t\t\t\teventObject;\r\n\r\n\t\t\tfor( var i = 0; i < eventTypes.length; i++ ) {\r\n\t\t\t\teventName = eventTypes[i].trim();\r\n\t\t\t\tsignal = this.events[eventName];\r\n\t\t\t\teventObject = new Communication.Event(eventName, data, signal);\r\n\t\t\t\tsignal.dispatch(eventObject);\r\n\t\t\t\tresultData.push( eventObject.aggregateEventData() );\r\n\t\t\t}\r\n\r\n\t\t\treturn (resultData.length > 1) ? resultData : resultData[0];\r\n\t\t},\r\n\t\t/**\r\n\t\t * Adds handler to specific event.\r\n\t\t *\r\n\t\t * @param {string} moduleID \t- Module name which adds handler\r\n\t\t * @param {string} eventType \t- Event name\r\n\t\t * @param {function} handler \t- Callback function\r\n\t\t * @param {object} context \t\t- Callback function context object\r\n\t\t * @param {number} priority \t- Priority of callback execution\r\n\t\t */\r\n\t\tsubscribe: function(options) {\r\n\t\t\toptions = options || {};\r\n\r\n\t\t\tvar moduleID = options.moduleID,\r\n\t\t\t\teventType = options.eventType,\r\n\t\t\t\thandler = options.handler,\r\n\t\t\t\tcontext = options.context,\r\n\t\t\t\tpriority = options.priority || 0,\r\n\t\t\t\teventTypes = options.eventType.split(','),\r\n\t\t\t\teventName = '';\r\n\r\n\t\t\tfor( var i = 0; i < eventTypes.length; i++) {\r\n\t\t\t\teventName = eventTypes[i].trim();\r\n\t\t\t\tthis.events[eventName].add(handler, context, priority);\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t* Removes handler to specific event.\r\n\t\t*\r\n\t\t* @param {string} moduleID  - Module name which removes handler\r\n\t\t* @param {string} eventType - Event name\r\n\t\t* @param {object} context   - Callback function context object that will filter all events of eventType to unsubscribe\r\n\t\t*/\r\n\t\tunsubscribe: function(options) {\r\n\t\t\toptions = options || {};\r\n\r\n\t\t\tvar moduleID = options.moduleID,\r\n\t\t\t\teventType = options.eventType,\r\n\t\t\t\tcontext = options.context,\r\n\t\t\t\tfoundEvents, eventName,\r\n\t\t\t\teventTypes = options.eventType.split(','),\r\n\t\t\t\ti = 0;\r\n\r\n\t\t\tfor( var j = 0; j < eventTypes.length; j++) {\r\n\t\t\t\teventName = eventTypes[j].trim();\r\n\t\t\t\tfoundEvents = this.events[eventName];\r\n\t\t\t\tif (context) {\r\n\t\t\t\t\twhile(foundEvents._bindings[i]) {\r\n\t\t\t\t\t\tif(foundEvents._bindings[i].context === context) {\r\n\t\t\t\t\t\t\tfoundEvents.remove(foundEvents._bindings[i]._listener, context);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ti++;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfoundEvents.removeAll();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Represents Communication.Event Object.\r\n\t * Create event object based on fired data\r\n\t * @constructor\r\n\t * @alias CORE.Communication\r\n\t * @param {string} eventType - Event name\r\n\t * @param {object} data \t - Event data\r\n\t * @param {object} signal \t - Signal object for current signal type\r\n\t */\r\n\tCommunication.Event = function(eventType, data, signal){\r\n\t\tObject.assign(this, data);\r\n\t\tthis._type = eventType;\r\n\t\tthis._eventData = [];\r\n\t\tthis._signal = signal;\r\n\t\tthis._propagationStopped = false;\r\n\t\tthis._defaultPrevented = false;\r\n\t\tthis._immediatePropagationStopped = false;\r\n\t};\r\n\r\n\tCommunication.Event.prototype = {\r\n\t\tconstructor: Communication.Event,\r\n\t\t/**\r\n\t\t * Push data Object to event data Array\r\n\t\t *\r\n\t\t * @param {object} data - object with data what will added to event data\r\n\t\t */\r\n\t\tsetReturnedData: function(data) {\r\n\t\t\tif( !Utils.is(data, 'Object') ){\r\n\t\t\t\tthrow new TypeError('data is not a object');\r\n\t\t\t}else{\r\n\t\t\t\tthis._eventData.push(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t * If this method is called, the default action of the event will not be triggered.\r\n\t\t *\r\n\t\t */\r\n\t\tpreventDefault: function() {\r\n\t\t\tthis._defaultPrevented = true;\r\n\t\t},\r\n\t\t/**\r\n\t\t * Get private event property isDefaultPrevented\r\n\t\t *\r\n\t\t * @returns {boolean} - curent event preventDefault flag\r\n\t\t */\r\n\t\tisDefaultPrevented: function() {\r\n\t\t\treturn this._defaultPrevented;\r\n\t\t},\r\n\t\t/**\r\n\t\t * Change private event flag propagation Stopped. This flag used for blocking event propagation\r\n\t\t */\r\n\t\tstopPropagation: function() {\r\n\t\t\tthis._propagationStopped = true;\r\n\t\t},\r\n\t\t/**\r\n\t\t * Change private event flag immediate propagation Stopped. This flag used for blocking event Immediate propagation\r\n\t\t */\r\n\t\tstopImmediatePropagation: function() {\r\n\t\t\tthis._immediatePropagationStopped = true;\r\n\t\t\tthis._signal.halt();\r\n\t\t},\r\n\t\t/**\r\n\t\t * Method for checking whether added EventData\r\n\t\t *\r\n\t\t * @returns {boolean} - Return true if private eventData array is empty\r\n\t\t */\r\n\t\tisEventDataEmpty: function() {\r\n\t\t\treturn (this._eventData.length > 0) ? false : true;\r\n\t\t},\r\n\t\t/**\r\n\t\t * Get private event property propagationStopped\r\n\t\t *\r\n\t\t * @returns {boolean} - curent event propagationStopped flag\r\n\t\t */\r\n\t\tisPropagationStopped: function() {\r\n\t\t\treturn this._propagationStopped;\r\n\t\t},\r\n\t\t/**\r\n\t\t * Aggregate result object from event data. Takes as an argument a function with aggregation rules.\r\n\t\t * Aggregation rules function takes 2 params:\r\n\t\t * 1: accumulated object.\r\n\t\t * 2: current Object.\r\n\t\t * Default object aggregation work like Object.assign method(overwrite the same fields).\r\n\t\t *\r\n\t\t * @returns {object} - Aggregate object of event data\r\n\t\t */\r\n\t\taggregateEventData: function(aggregationRules){\r\n\t\t\tvar eventData = this._eventData,\r\n\t\t\t\tresult = {};\r\n\t\t\taggregationRules = aggregationRules || Object.assign;\r\n\t\t\tfor(var i = 0; i < eventData.length; i+=1){\r\n\t\t\t\taggregationRules(result, eventData[i]);\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}\r\n\t};\r\n\r\n\texports.Communication = Communication;\r\n\r\n})(WEBSPELLCHECKER.CORE);\n// DOMCommunication.js\n/**\n * @fileoverview of CORE DOMCommunication module.\n */\n\n(function( exports ) {\n\t'use strict';\n\n\tvar UILib, Utils, logger;\n\t/**\n\t * DOMCommunication module constructor.\n\t * @constructor\n\t * @alias CORE.DOMCommunication\n\t * @param {string} moduleID\n\t * @param {CORE.Sandbox} sandbox\n\t */\n\tvar DOMCommunication = function(moduleID, sandbox) {\n\t\t/**\n\t\t * Module name.\n\t\t *\n\t\t * @type {String}\n\t\t*/\n\t\tthis.name = moduleID;\n\t\t/**\n\t\t * Reference to DOMCommunication module sandbox.\n\t\t *\n\t\t * @type {CORE.Sandbox}\n\t\t */\n\t\tthis.sandbox = sandbox;\n\t\t/**\n\t\t * Decorator flag\n\t\t * If true should implement decorator interface:\n\t\t * 1. have decoratorFor field with moduleID (what the module wiil send to decorate method)\n\t\t * 2. have decorate method (what will call for decoratorFor module)\n\t\t *\n\t\t * @type {Bool}\n\t\t */\n\t\tthis.decorator = true;\n\t\t/**\n\t\t *  moduleID of decorated module\n\t\t *\n\t\t * @type {String}\n\t\t */\n\t\tthis.decoratorFor = 'Communication';\n\n\t\tUILib = this.UILib = this.sandbox.FullUILib;\n\t\tUtils = this.Utils = this.sandbox.Utils;\n\t\tlogger = this.logger = this.sandbox.console;\n\t\t/**\n\t\t * Events collection.\n\t\t * @type {Object.<object, CORE.DOMCommunication.domEvents>}\n\t\t */\n\t\tthis.events = {};\n\t};\n\n\tDOMCommunication.prototype = {\n\t\tconstructor: DOMCommunication,\n\t\t/**\n\t\t * Called after each registration in core.\n\t\t *\n\t\t * @memberof CORE.DOMCommunication#\n\t\t */\n\t\tinit: function() {\n\t\t\tthis.eventsNames = [\n\t\t\t\t// mouse buttons events\n\t\t\t\t'click',\n\t\t\t\t'dblclick',\n\t\t\t\t'contextmenu',\n\t\t\t\t'mousedown',\n\t\t\t\t'mouseup',\n\t\t\t\t'mouseout',\n\t\t\t\t'mousemove',\n\t\t\t\t'mouseover',\n\t\t\t\t'mouseenter',\n\t\t\t\t'mouseleave',\n\t\t\t\t// focus events\n\t\t\t\t'focus',\n\t\t\t\t'blur',\n\t\t\t\t'focusin',\n\t\t\t\t'focusout',\n\t\t\t\t// key events\n\t\t\t\t'keydown',\n\t\t\t\t'keypress',\n\t\t\t\t'keyup',\n\t\t\t\t// clipboard events\n\t\t\t\t'cut',\n\t\t\t\t'copy',\n\t\t\t\t'beforepaste',\n\t\t\t\t'paste',\n\t\t\t\t// drag end drop events\n\t\t\t\t'drop',\n\t\t\t\t'drag',\n\t\t\t\t'dragover',\n\t\t\t\t'dragstart',\n\t\t\t\t'dragend',\n\t\t\t\t'dragenter',\n\t\t\t\t'dragleave',\n\t\t\t\t// DOM interective events\n\t\t\t\t'change',\n\t\t\t\t'resize',\n\t\t\t\t'orientationchange',\n\t\t\t\t'select',\n\t\t\t\t'compositionstart',\n\t\t\t\t'compositionend',\n\t\t\t\t'selectionchange',\n\t\t\t\t'scroll',\n\t\t\t\t'mousewheel',\n\t\t\t\t'input',\n\t\t\t\t'visibilitychange',\n\t\t\t\t'webkitvisibilitychange',\n\t\t\t\t'unload',\n\t\t\t\t'submit',\n\t\t\t\t// Touch events\n\t\t\t\t'touchstart',\n\t\t\t\t'touchmove',\n\t\t\t\t'touchend'\n\t\t\t];\n\n\t\t\t// create EventProxy instance\n\t\t\tthis.EventProxy = new DOMCommunication.EventProxy(this);\n\t\t},\n\t\t/**\n\t\t * Destructor of module. Called from core\n\t\t * Remove all ui subscribers\n\t\t *\n\t\t * @memberof CORE.DOMCommunication#\n\t\t */\n\t\tdestroy: function() {\n\t\t\t// for clear all subribers we call unsubscribe\n\t\t\t// for all eventTypes what registred in this module.\n\t\t\tthis.wrapMethod('unsubscribe')({\n\t\t\t\teventType: this.eventsNames.join(', ')\n\t\t\t});\n\t\t\tthis.EventProxy.removeAllEventProxy();\n\t\t},\n\t\t/**\n\t\t * Decorate method. Part of decorator interfase.\n\t\t * This method calling from core and take how parametr module\n\t\t * what will be decorated\n\t\t *\n\t\t * @param {object} communication - instance of Communication module\n\t\t *\n\t\t * @returns {object} DOMCommunication - Mixin original communication and DOMCommunication methods.\n\t\t */\n\t\tdecorate: function(communication) {\n\t\t\tthis.communication = communication;\n\t\t\tthis.addEvents(this.eventsNames);\n\t\t\t// add dom events to communication events\n\t\t\tthis.communication.addEvents(this.eventsNames);\n\t\t\tvar self = this,\n\t\t\t\tDOMCommunication = {\n\t\t\t\t\tfire: this.wrapMethod('fire'),\n\t\t\t\t\tsubscribe: this.wrapMethod('subscribe'),\n\t\t\t\t\tunsubscribe: this.wrapMethod('unsubscribe')\n\t\t\t\t};\n\n\t\t\t// mix decorated methods with original communication methods\n\t\t\tfor (var fill in this.communication) {\n\t\t\t\tDOMCommunication[fill] = (DOMCommunication[fill]) ?\n\t\t\t\t\tDOMCommunication[fill] : this.communication[fill];\n\t\t\t}\n\t\t\t// return decorated communication\n\t\t\treturn DOMCommunication;\n\t\t},\n\t\t/**\n\t\t * Creates UISignal for each event and add it to communication events list\n\t\t *\n\t\t * @param {array} events \t- list of events name\n\t\t */\n\t\taddEvents: function(eventsNames) {\n\t\t\tfor (var i = 0; i < eventsNames.length; i += 1) {\n\t\t\t\tvar eventName = eventsNames[i];\n\t\t\t\t// for each event type we create UISignal object\n\t\t\t\tthis.events[eventName] = new DOMCommunication.UISignal(eventName, this.communication, this.name);\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Check can we attach event listener to current element;\n\t\t *\n\t\t * @param {object HTMLElement | document | window} element\n\t\t *\n\t\t * @returns { bool } - flag support or not event attaching\n\t\t */\n \t\tcheckOnEventSupport: function(element) {\n\t\t\treturn !!(element && (element.addEventListener || element.attachEvent));\n\t\t},\n\t\t/**\n\t\t * Validation of listener. It should be fucntion\n\t\t *\n\t\t * @param { function } listener - parametr what we validate.\n\t\t * @param { string } fnName - name of validation function (for error log).\n\t\t *\n\t\t * @returns { bool } - flag support or not event attaching\n\t\t */\n\t\tvalidateListener: function(listener, fnName) {\n\t\t\tif (typeof listener !== 'function') {\n\t\t\t\tthrow new Error( 'listener is a required param of {fn}() and should be a Function.'.replace('{fn}', fnName) );\n\t\t\t}\n\t\t\treturn listener;\n\t\t},\n\t\t/**\n\t\t * Validation of listener. It should be fucntion\n\t\t *\n\t\t * @param { HMTL Event } event - custom event what we want fill\n\t\t * @param { object } data - data for adding to event\n\t\t *\n\t\t * @returns { HMTL Event } event - event with added data\n\t\t */\n\t\tsetEventData: function(event, data) {\n\t\t\tvar ignoredProps = ['target', 'srcElement', 'currentTarget'];\n\n\t\t\tevent.initEvent && event.initEvent(data.type, true, true);\n\t\t\tfor (var property in data) {\n\t\t\t\t// We can't rewrite srcElementin IE8\n\t\t\t\t// If we try to do it after fire on element that field equal null\n\t\t\t\t// and we should skip private system event fields\n\t\t\t\tif( ignoredProps.indexOf(property) !== -1 || property[0] === '_' ) {\n\t\t\t\t \tcontinue;\n\t\t\t\t}\n\t\t\t\tif(typeof data[property] !== 'function') {\n\t\t\t\t\t// in IE8 we have error when try rewrite some fields\n\t\t\t\t\ttry {\n\t\t\t\t\t\tevent[property] = data[property];\n\t\t\t\t\t} catch(e){}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn event;\n\t\t},\n\t\t/**\n\t\t * Checking eventTypes on suporting in this module\n\t\t *\n\t\t * @param { array } eventTypes - collection of events names\n\t\t *\n\t\t * @returns { bool } - flag. support / unsupport current types\n\t\t */\n\t\tcheckEventTypes: function(eventTypes) {\n\t\t\tvar eventType;\n\t\t\tfor (var i = 0; i < eventTypes.length; i += 1) {\n\t\t\t\teventType = eventTypes[i].trim();\n\t\t\t\tif(this.eventsNames.indexOf(eventType) === -1) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\t/**\n\t\t * Dispatching event with current event data.\n\t\t *\n\t\t * @param {object HTMLElement | document | window} - element\n\t\t * @param {string} eventType\t\t\t   \t\t   - Event name\n\t\t * @param {object} eventData\t\t\t\t\t   - Data what will be dispath\n\t\t *\n\t\t * @returns {bool}   - result of fire ( defaultPrevented flag )\n\t\t */\n\t\tdispatchEvent: function(element, eventType, eventData) {\n\t\t\t// For triggering DOM event we should create custom event with our data.\n\t\t\tvar customEvent = this.setEventData( UILib.createEvent(eventType), eventData );\n\t\t\t// strore returned result for defaultPrevented parametr\n\t\t\treturn !( this.UILib.trigger(eventType, element, customEvent) );\n\t\t},\n\t\t/**\n\t\t * Before some events we should notify system.\n\t\t * it happen because some browser events called in another flow\n\t\t * Focus/blur methods call browser events after methods perform actions\n\t\t *\n\t\t * @param {string} eventType\t\t\t   \t\t   - Event name\n\t\t * @param {object} options\t\t\t\t\t   \t   - fire options\n\t\t */\n\t\tfireBeforeEventsForContainer: function(eventType, options) {\n\t\t\tvar container = this.sandbox.getOption('container'),\n\t\t\t\tdocumentContainer = this.sandbox.getOption('documentContainer'),\n\t\t\t\ttargetDocument = this.Utils.getCurrentDocument(documentContainer),\n\t\t\t\tprefix = 'beforemanualcontrol';\n\n\t\t\t// we should fir before blur event for saving bookmark in control\n\t\t\t// because after calling blur method we lose selection in element\n\t\t\t// and can't take the bookmark\n\t\t\tif( (eventType === 'focus' &&\n\t\t\t\toptions.element !== container &&\n\t\t\t\tdocument.activeElement === documentContainer) ||\n\t\t\t\teventType === 'blur' &&\n\t\t\t\toptions.element === container )\n\t\t\t{\n\n\t\t\t\tthis.communication.fire({\n\t\t\t\t\teventType: prefix + 'blur'\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Triggers all callback functions for specific event\n\t\t * Method create custom native evnent with data and fire event to DOM\n\t\t * The custom event does not invoke the native browser behavior but call a DOM subscribers\n\n\t\t * @param {string} eventType\t\t \t\t\t\t- Event name*\n\t\t * @param {string} options.moduleID \t\t\t\t- Module name which fires event\n\t\t * @param {object} options.data \t\t\t\t\t- Event data\n\t\t * @param {object HTMLElement | document | winfow} options.element - Html event target\n\t\t *\n\t\t * @returns {object}   - result of fire ( defaultPrevented flag )\n\t\t */\n\t\tfire: function(eventType, options) {\n\t\t\tvar element = options.element,\n\t\t\t\tUISignal = this.events[eventType],\n\t\t\t\t// browser have some method what in self life sicle fire browser event\n\t\t\t\tinterectiveEvents = ['click', 'focus', 'blur'],\n\t\t\t\tdefaultPrevented,\n\t\t\t\tcallback,\n\t\t\t\t// variable with last fired event\n\t\t\t\tfireResult = {};\n\n\t\t\t// for dispatching interective events we can just call metho d on element\n\t\t\tif ( interectiveEvents.indexOf(eventType) !== -1) {\n\t\t\t\t// subscribe on UI event for providing preventDefault info\n\t\t\t\t// because call interective method dont return preventDefault value\n\t\t\t\tcallback = function(event) {\n\t\t\t\t\tdefaultPrevented = UILib.isDefaultPrevented(event);\n\t\t\t\t};\n\t\t\t\tUILib.on(eventType, element, callback);\n\t\t\t\tthis.fireBeforeEventsForContainer(eventType, options);\n\t\t\t\telement[eventType]();\n\t\t\t\tUILib.off(eventType, element, callback);\n\t\t\t} else {\n\t\t\t\toptions.data = options.data || {};\n\t\t\t\tif(!options.data.type) {\n\t\t\t\t\toptions.data.type = eventType;\n\t\t\t\t}\n\n\t\t\t\tdefaultPrevented = this.dispatchEvent(element, eventType, options.data);\n\t\t\t}\n\n\t\t\t// If after firing event lastSystemFireResult in UISignal\n\t\t\t// is empty than we haven't active subscribers for this event\n\t\t\tif(UISignal.lastSystemFireResult === null) {\n\t\t\t\tfireResult.defaultPrevented = defaultPrevented;\n\t\t\t} else {\n\t\t\t\tfireResult = UISignal.lastSystemFireResult;\n\t\t\t\tUISignal.lastSystemFireResult = null;\n\t\t\t}\n\t\t\t// return result of fire ( defaultPrevented flag )\n\t\t\treturn fireResult;\n\t\t},\n\t\t/**\n\t\t * Adds handler to specific UI event.\n\t\t *\n\t\t * @param {string} eventType \t\t\t\t\t\t- Event name\n\t\t * @param {string} options.moduleID \t\t\t\t- Module name which adds handler\n\t\t * @param {function} options.handler \t\t\t\t- Callback function\n\t\t * @param {object} options.context \t\t\t\t\t- Callback function context object\n\t\t * @param {number} options.priority \t\t\t\t- Priority of callback execution\n\t\t * @param {object HTMLElement} options.element \t\t- Html event target\n\t\t */\n\t\tsubscribe: function(eventType, options) {\n\t\t\tvar\tself = this,\n\t\t\t\tUISignal = self.events[eventType],\n\t\t\t\t// object with data for subscribe on UI browser event\n\t\t\t\tsubscription = {\n\t\t\t\t\telement: options.element,\n\t\t\t\t\tuserContext: options.context,\n\t\t\t\t\tuserHandler: self.validateListener(options.handler, 'subscribe')\n\t\t\t\t};\n\n\t\t\tUISignal.addSubscription(subscription);\n\n\t\t\t// we store context in userContext field\n\t\t\t// because context field used for js-signals lib\n\t\t\t// and unsubscribe remove all subscription for current context\n\t\t\t// we should add unique context\n\t\t\t// if we want unsubscribe from events one by one\n\t\t\toptions.userContext = options.context;\n\t\t\toptions.context = subscription;\n\n\t\t\t// wrap options handler before calling original subscribe\n\t\t\t// this calbback will called for each subscriber with same event type\n\t\t\toptions.handler = function(event) {\n\n\t\t\t\t// check if event alredy decorated from UIEventDecorator\n\t\t\t\t// we shoden't do it again.\n\t\t\t\tif(event.constructor !== DOMCommunication.UIEventDecorator) {\n\t\t\t\t\tif(event.nativeEvent === undefined) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// the original event was modified (for optimization we dont't want copi all fields for each event object)\n\t\t\t\t\tevent = new DOMCommunication.UIEventDecorator(event);\n\t\t\t\t}\n\t\t\t\t// Delegation. We should call callback only for subscriber with same target element\n\t\t\t\tif (event.currentTarget === this.element) {\n\t\t\t\t\tthis.userHandler.call(this.userContext, event);\n\t\t\t\t}\n\t\t\t};\n\t\t\tself.communication.subscribe(options);\n\t\t},\n\t\t/**\n\t\t* Removes handler to specific event.\n\t\t* Releted to params we can unsubscribe:\n\t\t*  1. one handler for element      - if we provide handler and element.\n\t\t*  2. all handlers for element     - if we provide only element.\n\t\t*  3. all handler for all elements - if we provide only eventType\n\t\t*\n\t\t* @param {string} options.moduleID  \t\t\t\t- Module name which removes handler\n\t\t* @param {string} options.eventType \t\t\t\t- Event name\n\t\t* @param {function} options.handler \t\t\t\t- Callback function\n\t\t* @param {object} options.context   \t\t\t\t- Callback function context object that will filter all events of eventType to unsubscribe\n\t\t* @param {object HTMLElement} options.element \t\t- Html event target\n\t\t*/\n\t\tunsubscribe: function(eventType, options) {\n\t\t\tvar self = this,\n\t\t\t\tUISignal = self.events[eventType],\n\t\t\t\thandler = options.handler,\n\t\t\t\telement = options.element,\n\t\t\t\tsubscription,\n\t\t\t\tuserContext;\n\n\t\t\tfunction removeSubscription(subscription, index) {\n\t\t\t\tUISignal.removeSubscription(subscription, index);\n\t\t\t\tself.communication.unsubscribe(options);\n\t\t\t}\n\n\t\t\tfor (var i = UISignal.subscribers.length - 1; i >= 0; i -= 1) {\n\t\t\t\tsubscription =  UISignal.subscribers[i];\n\t\t\t\t// we store context in userContext field\n\t\t\t\t// because context field used for js-signals lib\n\t\t\t\toptions.userContext = options.userContext || options.context;\n\t\t\t\toptions.context = subscription;\n\n\t\t\t\t// if we have provided context we sould skip binds with another context\n\t\t\t\tif(options.userContext && (options.userContext !== subscription.userContext)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// If we not provide element we remove all events for this context\n\t\t\t\tif(!element) {\n\t\t\t\t\tremoveSubscription(subscription, i);\n\t\t\t\t} else if(subscription.element === element) {\n\t\t\t\t\t// if we have handler we should unsubscribe only subscribtionas with this handler\n\t\t\t\t\tif(handler) {\n\t\t\t\t\t\thandler = self.validateListener(options.handler, 'unsubscribe');\n\n\t\t\t\t\t\tif(handler === subscription.userHandler){\n\t\t\t\t\t\t\tremoveSubscription(subscription, i);\n\t\t\t\t\t\t}\n\t\t\t\t\t// without handler we unsubscribe all handlers\n\t\t\t\t\t// with same eveentType for current element\n\t\t\t\t\t} else {\n\t\t\t\t\t\tremoveSubscription(subscription, i);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\toptions.context = options.userContext;\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t* Some general actions with options before providing it to method\n\t\t*\n\t\t* @param {string} eventType \t- Event name\n\t\t* @param {object} option \t\t- Calling event option\n\t\t*\n\t\t* @returns {object} option      - calling event option\n\t\t*/\n\t\tprepareOption: function(eventType, option) {\n\t\t\t// *NOTE* hard fix for iframe in FF\n\t\t\t// we cant catch focus event on iframe body. Only on contentWindow\n\t\t\t// we owerload element link for all focus events.\n\t\t\tif( option.element === this.sandbox.getOption('container') &&\n\t\t\t\teventType === 'focus' &&\n\t\t\t\tthis.Utils.Browser.gecko &&\n\t\t\t\tthis.sandbox.getOption('isIframe') === true )\n\t\t\t{\n\t\t\t\toption.element = this.sandbox.getOption('focusContainer');\n\t\t\t\tif( option.eventType.split(',').length > 1 ) {\n\t\t\t\t\tlogger.warn(\"You can't call focus event with another events in one \" +\n\t\t\t\t\t\t\t\t\"fire/subscribe method with another events. For this case \" +\n\t\t\t\t\t\t\t\t\"focus event should be one in 'eventType'\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn option;\n\t\t},\n\t\t/**\n\t\t* We should do some actions(options preparation, checkings etc.)\n\t\t* For each method what we decorated.\n\t\t*\n\t\t* @param {string} methodName  - name of method what we wrapped\n\t\t*\n\t\t* @returns {array || object}  - result/s of fire system event\n\t\t*/\n\t\twrapMethod: function(methodName) {\n\t\t\tvar self = this;\n\t\t\treturn function(options) {\n\t\t\t\tvar eventTypes = options.eventType.split(','),\n\t\t\t\t\teventType, result, results = [], _options;\n\t\t\t\t// if events not define in this module\n\t\t\t\t// we just proxy event to decorated module\n\t\t\t\tif( self.checkEventTypes(eventTypes) ) {\n\t\t\t\t\t// if event types defined in this module we check element on supporting event listeners\n\t\t\t\t\t// exept 'unsubscribe' because we can unsubscribe several elenents from one event\n\t\t\t\t\tif ( self.checkOnEventSupport(options.element) === false && methodName !== 'unsubscribe') {\n\t\t\t\t\t\tlogger.warn( options.eventType + ' event/s defined in ' + self.name +\n\t\t\t\t\t\t\t' module. For ' + methodName + ' DOM events you should set (HTMLElement | document) in method params');\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t\tfor( var i = 0; i < eventTypes.length; i += 1 ) {\n\t\t\t\t\t\teventType = eventTypes[i].trim();\n\t\t\t\t\t\toptions = self.prepareOption(eventType, options);\n\t\t\t\t\t\t_options = options;\n\t\t\t\t\t\t// we should provide immutable options object\n\t\t\t\t\t\t// because we change it in some methods.\n\t\t\t\t\t\tif(eventTypes.length > 1) {\n\t\t\t\t\t\t\t_options = Object.assign({}, options);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Call wrapped method.\n\t\t\t\t\t\tresult = self[methodName].call(self, eventType, _options);\n\t\t\t\t\t\tif(result) {\n\t\t\t\t\t\t\tresults.push(result);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn (results.length > 1) ? results : results[0];\n\t\t\t\t} else {\n\t\t\t\t\treturn self.communication[methodName](options);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t};\n\t/**\n\t * DOMCommunication.EventProxy constructor.\n\t * Functionality for proxy events from element to element\n\t * Define in this module because it responsible for subscribing and fire browser events\n\t * Proxy mechanism unlike fire method does not call interective methods like click|focus|blur\n\t *\n\t * @constructor\n\t *\n\t * @param {object} DOMCommunicationInstance - instance of DOMCommunication module.\n\t */\n\tDOMCommunication.EventProxy = function(DOMCommunicationInstance) {\n\t\tthis.DOMCommunication = DOMCommunicationInstance;\n\t\tthis.proxyElements = [];\n\t};\n\n\tDOMCommunication.EventProxy.prototype = {\n\t\tconstructor: DOMCommunication.EventProxy,\n\t\t/**\n\t\t * register eventProxy data\n\t\t *\n\t\t * @param {string} options.From\t\t\t- Html element where we Listen events\n\t\t * @param {string} options.To \t\t\t- Html element where we Fire events\n\t\t * @param {string} options.eventsNames\t- Events names collection.\n\t\t */\n\t\taddEventProxy: function(options) {\n\t\t\tvar DOMCommunication = this.DOMCommunication;\n\t\t\tif(!DOMCommunication.checkOnEventSupport(options.from) || !DOMCommunication.checkOnEventSupport(options.to)) {\n\t\t\t\tlogger.warn(\"for eventProxy you should provide 2 elements: 'from' and 'to'\");\n\t\t\t}\n\t\t\t// we should copy object if does not want affect original\n\t\t\tvar proxyObject = Object.assign({}, options),\n\t\t\t\tself = this;\n\n\t\t\t// if we did not provide events names then we proxy all known  events\n\t\t\tproxyObject.eventsNames = options.eventsNames || DOMCommunication.eventsNames;\n\t\t\t// dispathing handler\n\t\t\tproxyObject.handler = function(event) {\n\t\t\t\tDOMCommunication.dispatchEvent(this.to, event.type, event);\n\t\t\t};\n\t\t\tproxyObject.handler = proxyObject.handler.bind(proxyObject);\n\t\t\tthis.proxyElements.push(proxyObject);\n\t\t\tfor (var i = 0; i < proxyObject.eventsNames.length; i += 1) {\n\t\t\t\tUILib.on(\n\t\t\t\t\tproxyObject.eventsNames[i],\n\t\t\t\t\tproxyObject.from,\n\t\t\t\t\tproxyObject.handler\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Helper for removing all registred proxy\n\t\t */\n\t\tremoveAllEventProxy: function() {\n\t\t\tfor (var i = 0; i < this.proxyElements.length; i += 1) {\n\t\t\t\tthis.removeEventProxy(this.proxyElements[i]);\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * unregister eventProxy data\n\t\t *\n\t\t * @param {string} options.From\t\t\t- Html element where we listen events\n\t\t * @param {string} options.To \t\t\t- Html element where we fire events\n\t\t * @param {string} options.eventsNames\t- Events names collection.\n\t\t *\n\t\t */\n\t\tremoveEventProxy: function(options) {\n\t\t\tvar proxyObject;\n\t\t\tfor (var i = 0; i < this.proxyElements.length; i += 1) {\n\t\t\t\tif( options.from === this.proxyElements[i].from &&\n\t\t\t\t\toptions.to === this.proxyElements[i].to ) {\n\t\t\t\t\tproxyObject = this.proxyElements[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (i = 0; i < options.eventsNames.length; i += 1) {\n\t\t\t\tUILib.off(\n\t\t\t\t\tproxyObject.eventsNames[i],\n\t\t\t\t\tproxyObject.from,\n\t\t\t\t\tproxyObject.handler\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t};\n\t/**\n\t * DOMCommunication.UIEventDecorator constructor.\n\t * We return original system object\n\t * for decrease number of copies fields from object to object\n\t *\n\t * @constructor\n\t * this class prepared event data and encapsulate working with native browser event\n\t *\n\t * @param {object} event - System event object.\n\t */\n\tDOMCommunication.UIEventDecorator = function(event) {\n\t\t// store information about native event to decorator\n\t\tthis.eventPrototype = event.constructor.prototype;\n\t\tthis.event = event;\n\t\tthis.nativeEvent = event.nativeEvent;\n\t\tvar defaultPreventedBefore = UILib.isDefaultPrevented(this.nativeEvent);\n\n\t\tif(defaultPreventedBefore) {\n\t\t\tthis.event.preventDefault();\n\t\t}\n\t\t// set data what will return after event fired\n\t\tevent.setReturnedData({\n\t\t\tdefaultPrevented: defaultPreventedBefore\n\t\t});\n\n\t\t// mix event and native event data\n\t\tfor (var k in this.nativeEvent) {\n\t\t\tif(this.nativeEvent[k] !== (null || undefined) &&\n\t\t\t\ttypeof this.nativeEvent[k] !== 'function' )  {\n\t\t\t\tevent[k] = this.nativeEvent[k];\n\t\t\t}\n\t\t}\n\t\t// mixin system event and UIEventDecorator methods\n\t\t// Now links to decorated method store in object\n\t\t// and links to original methods in prototype\n\t\t// maybe need find another way\n\t\tfor (k in this.constructor.prototype) {\n\t\t\tevent[k] = this.constructor.prototype[k].bind(this);\n\t\t}\n\t\tevent.constructor = this.constructor;\n\t\tevent.target = UILib.getEventTarget(this.nativeEvent);\n\t\tdelete event.nativeEvent;\n\n\t\treturn event;\n\t};\n\n\tDOMCommunication.UIEventDecorator.prototype = {\n\t\tconstructor: DOMCommunication.UIEventDecorator,\n\t\t/**\n\t\t * If this method is called, the default action of the event will not be triggered.\n\t\t */\n\t\tpreventDefault: function() {\n\t\t\tif( this.eventPrototype.isDefaultPrevented.call(this.event) === false ) {\n\t\t\t\tUILib.preventDefault(this.nativeEvent);\n\t\t\t\tthis.eventPrototype.setReturnedData.call(this.event, {\n\t\t\t\t\tdefaultPrevented: true\n\t\t\t\t});\n\t\t\t\tthis.eventPrototype.preventDefault.call(this.event);\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Prevents further propagation of the current event in the capturing and bubbling phases.\n\t\t */\n\t\tstopPropagation: function() {\n\t\t\tUILib.stopPropagation(this.nativeEvent);\n\t\t\tthis.eventPrototype.stopPropagation.call(this.event);\n\t\t},\n\t\t/**\n\t\t * Prevents other listeners of the same event from being called.\n\t\t */\n\t\tstopImmediatePropagation: function() {\n\t\t\tUILib.stopImmediatePropagation(this.nativeEvent);\n\t\t\tthis.eventPrototype.stopImmediatePropagation.call(this.event);\n\t\t}\n\t};\n\n\t/**\n\t * DOMCommunication.UISignal constructor.\n\t * @constructor\n\t * this class encapsulate manage listening of browser events\n\t * store subscribers collection\n\t * connection between browser and system Observers\n\t *\n\t * @param {string} eventType - signal name.\n\t * @param {object} emmiter   - object what can fire system event.\n\t * @param {string} moduleID  - name of current module.\n\t */\n\tDOMCommunication.UISignal = function(eventType, emmiter, moduleID) {\n\t\tvar self = this;\n\n\t\tthis.subscribers = [];\n\t\tthis.registredElements = [];\n\t\tthis.eventType = eventType;\n\t\tthis.emmiter = emmiter;\n\t\tthis.moduleID = moduleID;\n\t\tthis.lastSystemFireResult = null;\n\t\t/**\n\t\t * callback for native listener. From this method we fire system event with native event\n\t\t * should have link to \"this\" in closure\n\t\t *\n\t\t * @param {HMTL Event} nativeEvent - cammon browser event.\n\t\t */\n\t\tthis.handler = function(nativeEvent) {\n\t\t\t// we should store result of fire mehod for returning data from\n\t\t\t// decorated fire method\n\t\t\tself.lastSystemFireResult = self.emmiter.fire({\n\t\t\t\tmoduleID: self.moduleID,\n\t\t\t\teventType: self.eventType,\n\t\t\t\tdata: {\n\t\t\t\t\tnativeEvent: nativeEvent\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t};\n\n\tDOMCommunication.UISignal.prototype = {\n\t\tconstructor: DOMCommunication.UISignal,\n\t\t/**\n\t\t * add subscription to collection.\n\t\t *\n\t\t * @param {object} subscription  - subscription what be added to collection.\n\t\t */\n\t\taddSubscription: function(subscription) {\n\t\t\tthis.subscribers.push(subscription);\n\t\t\t// if for current element we haven't registred DOM listener\n\t\t \t// we should register it\n\t\t\tif( this.findElementIndex(subscription.element, this.registredElements) === -1 ) {\n\t\t\t\tthis.registerElement(subscription.element);\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * remove subscription from collection.\n\t\t *\n\t\t * @param {object} subscription  - subscription what be removed from collection.\n\t\t * @param {number} index  - index of subscription (optional for optimization).\n\t\t */\n\t\tremoveSubscription: function(subscription, index) {\n\t\t\tvar subscribers = this.subscribers;\n\t\t\tif (typeof index === 'undefined') {\n\t\t\t\tfor (var i = 0; i < subscribers.length; i += 1) {\n\t\t\t\t\tif(subscribers[i] === subscription) {\n\t\t\t\t\t\tindex = i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsubscribers.splice(index, 1);\n\t\t\t// if for current element we haven't registred DOM listener\n\t\t \t// we should unregister it\n\t\t\tif ( this.findElementIndex(subscription.element, subscribers) === -1) {\n\t\t\t\tthis.unregisterElement(subscription.element);\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * register element on browser event\n\t\t *\n\t\t * @param {object HTMLElement} element - registered element\n\t\t */\n\t\tregisterElement: function(element) {\n\t\t\tvar self = this, handler;\n\t\t\tif (Utils.Browser.ie && Utils.Browser.version < 9) {\n\t\t\t\thandler = function(nativeEvent) {\n\t\t\t\t\tif(nativeEvent === null) {\n\t\t\t\t\t\tnativeEvent = Utils.getWindowByDocument(element.document).event;\n\t\t\t\t\t}\n\t\t\t\t\tnativeEvent.currentTarget = element;\n\t\t\t\t\tself.handler(nativeEvent);\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\thandler = this.handler;\n\t\t\t}\n\n\t\t\tthis.registredElements.push({\n\t\t\t\telement: element,\n\t\t\t\thandler: handler\n\t\t\t});\n\t\t\tUILib.on(this.eventType, element,  handler);\n\t\t},\n\t\t/**\n\t\t * unregister element on browser event\n\t\t *\n\t\t * @param {object HTMLElement} element - registered element\n\t\t */\n\t\tunregisterElement: function(element) {\n\t\t\tvar index = this.findElementIndex(element, this.registredElements),\n\t\t\t\tregistredElement = this.registredElements[index];\n\n\t\t\tthis.registredElements.splice(index, 1);\n\t\t\tUILib.off(this.eventType, element,  registredElement.handler);\n\t\t},\n\t\t/**\n\t\t * helper for searching index element in collection\n\t\t *\n\t\t * @param {object HTMLElement} element -  current element\n\t\t * @param {object} collection \t\t   -  collection with elements\n\t\t */\n\t\tfindElementIndex: function(element, collection) {\n\t\t\tfor (var i = 0; i < collection.length; i += 1) {\n\t\t\t\tif(collection[i].element === element) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn -1;\n\t\t}\n\t};\n\n\texports.DOMCommunication = DOMCommunication;\n})(WEBSPELLCHECKER.CORE);\n// WebApiAdapter.js\n/**\n * @fileoverview of CORE WebApiAdapter module.\n */\n(function(exports) {\n\t'use strict';\n\n\tvar UILib, Utils, logger;\n\t/**\n\t * WebApiAdapter module constructor.\n\t * @constructor\n\t * @alias CORE.WebApiAdapter\n\t * @param {string} moduleID\n\t * @param {CORE.Sandbox} sandbox\n\t */\n\tvar WebApiAdapter = function(moduleID, sandbox) {\n\t\t/**\n\t\t * Module name.\n\t\t *\n\t\t * @type {String}\n\t\t */\n\t\tthis.name = moduleID;\n\t\t/**\n\t\t * Reference to WebApiAdapter module sandbox.\n\t\t *\n\t\t * @type {CORE.Sandbox}\n\t\t */\n\t\tthis.sandbox = sandbox;\n    };\n\n    WebApiAdapter.prototype = {\n        constructor: WebApiAdapter,\n\t\t/**\n\t\t * Called after each registration in core.\n\t\t *\n\t\t * @memberof CORE.WebApiAdapter#\n\t\t */\n        init: function() {\n            var self = this,\n                options = this.sandbox._getCoreOptionObject();\n\n            this.parametersMap = {\n                onSuccess: 'success',\n                onError: 'error'\n            };\n\n            this.webApi = new this.sandbox.initWebApi(options);\n\n            this.sandbox.subscribe('remoteAction', function(event) {\n                var method = self.adapter[event.actionMethod],\n                    parametrs;\n\n                if (!method) {\n                    throw new Error('Web api action method ' + method + ' not supported.');\n                }\n\n                parametrs = this.mapWebApiParameters(event);\n                method.call(self, parametrs);\n            });\n        },\n        /**\n         * Map remote action parametrs to webApi parameters.\n         *\n         *  @param {Object} parametrs - Action parametrs.\n         *\n         *  @returns {Object} - Mapped parameters object.\n         */\n        mapWebApiParameters: function(parametrs) {\n            var result = {},\n                mappedParameter;\n\n            for (var parametr in parametrs) {\n                if (parametrs.hasOwnProperty(parametr) ) {\n                    mappedParameter = this.parametersMap[parametr];\n\n                    if (mappedParameter !== undefined) {\n                        result[mappedParameter] = parametrs[parametr];\n                    } else {\n                        result[parametr] = parametrs[parametr];\n                    }\n                }\n            }\n\n            return result;\n        },\n        /**\n         * API method what collect words from string.\n         *\n         * @param {String} string - Original text.\n         *\n         * @returns {Object} - Object with array of words and collection of words offsets.\n         */\n        getWordsFromString: function(string) {\n            return this.webApi._getService('TextProcessor').getWordsFromString(string);\n        },\n        /**\n         * Method for placing separators(punctuation, symbols, quotes) on spaces.\n         *\n         * @param {String} string - String for replacing separators.\n         *\n         * @returns {String} - text without separators.\n         */\n        replaceSepatators: function(string) {\n            return this.webApi._getService('TextProcessor').replaceSepatators(string);\n        },\n        /**\n         * Method what replacing special characters(define in webapi regularssources module) on empty strings.\n         *\n         * @param {String} string - String for removing special characters.\n         *\n         * @returns {String} - text without separators.\n         */\n        removeSpecialCharacters: function(string) {\n            return this.webApi._getService('TextProcessor').removeSpecialCharacters(string);\n        },\n        adapter: {\n            /**\n             * spellCheck API method.\n             *\n             * @param {Object} parametrs\n             * @param {String} parametrs.text - Text to check spelling.\n             * @param {String} parametrs.lang - Spellcheck language. If not provided then take from constructor.\n             * @param {SpellCheckCallback} parametrs.success - Handler successful response from the server.\n             * @param {RequestCallback} parametrs.error - Handler unsuccessful response from the server.\n             */\n            spellCheck: function(parametrs) {\n                return this.webApi.spellCheck(parametrs);\n            },\n            /**\n             * grammarCheck API method.\n             *\n             * @param {Object} parametrs\n             * @param {String} parametrs.text - Text to grammar checking.\n             * @param {String} parametrs.lang - Grammarcheck language. If not provided then take from constructor.\n             * @param {GrammarCheckCallback} parametrs.success - Handler successful response from the server.\n             * @param {RequestCallback} parametrs.error - Handler unsuccessful response from the server.\n             * @returns {Object} - Transpor\n             */\n            grammarCheck: function(parametrs) {\n                return this.webApi.grammarCheck(parametrs);\n            },\n            /**\n             * getLangList API method.\n             *\n             * @param {Object} parametrs\n             * @param {GetLangListCallback} parametrs.success - Handler successful response from the server.\n             * @param {RequestCallback} parametrs.error - Handler unsuccessful response from the server.\n             * @returns {Object} - Transport object.\n             */\n            getLangList: function(parametrs) {\n                return this.webApi.getLangList(parametrs);\n            },\n            /**\n             * getInfo API method.\n             *\n             * @param {Object} parametrs\n             * @param {GetLangInfoCallback} parametrs.success - Handler successful response from the server.\n             * @param {RequestCallback} parametrs.error - Handler unsuccessful response from the server.\n             * @returns {Object} - Transport object.\n             */\n            getInfo: function(parametrs) {\n                return this.webApi.getInfo(parametrs);\n            },\n            /**\n             * getUserDictionary API method.\n             *\n             * @param {Object} parametrs\n             * @param {String} parametrs.name - User dictionary name.\n             * @param {UserDictionaryCallback} parametrs.success - Handler successful response from the server.\n             * @param {RequestCallback} parametrs.error - Handler unsuccessful response from the server.\n             * @returns {Object} - Transport object.\n             */\n            getUserDictionary: function(parametrs) {\n                return this.webApi.getUserDictionary(parametrs);\n            },\n             /**\n             * createUserDictionary API method.\n             *\n             * @param {Object} parametrs\n             * @param {String} parametrs.name - User dictionary name.\n             * @param {UserDictionaryCallback} parametrs.success - Handler successful response from the server.\n             * @param {RequestCallback} parametrs.error - Handler unsuccessful response from the server.\n             */\n            createUserDictionary: function(parametrs) {\n                return this.webApi.createUserDictionary(parametrs);\n            },\n            /**\n             * @param {Object} parametrs\n             * @param {String} parametrs.name - User dictionary name.\n             * @param {UserDictionaryCallback} parametrs.success - Handler successful response from the server.\n             * @param {RequestCallback} parametrs.error - Handler unsuccessful response from the server.\n             * @example\n             **/\n            deleteUserDictionary: function(parametrs) {\n                return this.webApi.deleteUserDictionary(parametrs);\n            },\n             /**\n             * addWordToUserDictionary API method.\\\n             *\n             * @param {Object} parametrs\n             * @param {String} parametrs.name - User dictionary name.\n             * @param {String} parametrs.word - Word what will be added to UD.\n             * @param {UserDictionaryCallback} parametrs.success - Handler successful response from the server.\n             * @param {RequestCallback} parametrs.error - Handler unsuccessful response from the server.\n             */\n            addWordToUserDictionary: function(parametrs) {\n                return this.webApi.addWordToUserDictionary(parametrs);\n            },\n            /**\n             * deleteWordFromUserDictionary API method.\n             *\n             * @param {Object} parametrs\n             * @param {String} parametrs.name - User dictionary name.\n             * @param {String} parametrs.word - Word what will be deleted from UD.\n             * @param {UserDictionaryCallback} parametrs.success - Handler successful response from the server.\n             * @param {RequestCallback} parametrs.error - Handler unsuccessful response from the server.\n             * @returns {Object} - Transport object.\n             */\n            deleteWordFromUserDictionary: function(parametrs) {\n                return this.webApi.deleteWordFromUserDictionary(parametrs);\n            },\n            /**\n             * renameUserDictionary API method.\n             *\n             * @param {Object} parametrs\n             * @param {String} parametrs.name - User dictionary name.\n             * @param {String} parametrs.newName - New user dictionary name.\n             * @param {UserDictionaryCallback} parametrs.success - Handler successful response from the server.\n             * @param {RequestCallback} parametrs.error - Handler unsuccessful response from the server.\n             * @returns {Object} - Transport object.\n             */\n            renameUserDictionary: function(parametrs) {\n                return this.webApi.renameUserDictionary(parametrs);\n            },\n            /**\n             * getDictionariesModifyTime API method.\n             *\n             * @param {Object} parametrs\n             * @param {String} parametrs.userDictionary - User dictionary name.\n             * @param {String} parametrs.customDictionary - Custom dictionary name.\n             * @param {GetDictionariesModifyTime} parametrs.success - Handler successful response from the server.\n             * @param {RequestCallback} parametrs.error - Handler unsuccessful response from the server.\n             * @returns {Object} - Transport object.\n             */\n            getDictionariesModifyTime: function(parametrs) {\n                return this.webApi.getDictionariesModifyTime(parametrs);\n            },\n        }\n    };\n\n    exports.WebApiAdapter = WebApiAdapter;\n})(WEBSPELLCHECKER.CORE);\n// RegExpressions.js\n/**\n * @fileoverview of CORE RegExpressions module.\n */\n(function(exports) {\n\t'use strict';\n\n\tvar UILib, Utils, logger, RegularsManager;\n\n\t/**\n\t * RegExpressions module constructor.\n\t *\n\t * @constructor\n\t * @alias CORE.RegExpressions\n\t * @param {string} moduleID\n\t * @param {CORE.Sandbox} sandbox\n\t */\n\tvar RegExpressions = function(moduleID, sandbox) {\n\t\t/**\n\t\t * Module name.\n\t\t *\n\t\t * @type {String}\n\t\t */\n\t\tthis.name = moduleID;\n\t\t/**\n\t\t * Reference to RegExpressions module sandbox.\n\t\t *\n\t\t * @type {CORE.Sandbox}\n\t\t */\n\t\tthis.sandbox = sandbox;\n\n\t\tthis.regExps = {};\n\n        RegularsManager = sandbox.RegularsManager;\n    };\n\n    RegExpressions.prototype = {\n\t\tconstructor: RegExpressions,\n\t\t/**\n\t\t * Called after each registration in core.\n\t\t *\n\t\t * @memberof CORE.RegExpressions#\n\t\t */\n        init: function() {\n\t\t\tthis.regExps['ignoreElementsRegex'] = this.createIgnoreElementsRegex('ignoreElements');\n\t\t\tthis.regExps['ignoreGrammarElementsRegex'] = this.createIgnoreElementsRegex('ignoreGrammarElements');\n\n\t\t\t///^(aside|br|img|caption|button|address|blockquote|body|center|dir|div|dl|fieldset|form|h[1-6]|hr|isindex|menu|noframes|noscript|ol|p|pre|table|ul|dd|dt|frameset|li|tbody|td|tfoot|th|thead|tr|html|select|option|sup|sub|input)$/i\n\t\t\tthis.regExps['blockElementsRegex'] = RegularsManager.wrap(\"aside|br|img|caption|button|address|blockquote|body|center|dir|div|dl|fieldset|form|h[1-6]|hr|isindex|menu|noframes|noscript|ol|p|pre|table|ul|dd|dt|frameset|li|tbody|td|tfoot|th|thead|tr|html|select|option|sup|sub|input\")\n\t\t\t\t.group().start().end().i();;\n\n\t\t\t///.\\s\\xA0/.source + punctuationRegExp\n\t\t\tthis.regExps['wordBoundaryRegex'] = RegularsManager.anyChar.compositionGraph([\n\t\t\t\tRegularsManager.space,\n\t\t\t\tRegularsManager.punctuationRegExp,\n\t\t\t\tRegularsManager.wrap( this.sandbox.getOption('customPunctuation') )\n\t\t\t]).set();\n\n\t\t\t//'[' + /'\"/.source + /.\\s\\xA0/.source + /,\\^\\$\\*\\+\\?\\=\\!\\:\\|\\\\\\/\\(\\)\\[\\]\\{\\}\\>\\<\\@\\%\\&\\#\\;\\_\\~\\u061F\\u060C\\u061B\\u0001-\\u001F\\u0080-\\u00B6\\u00B8-\\u00BF\\u2000-\\u200A\\u200C-\\u266F\\u2E00-\\u2E7F /.source + ']'\n\t\t\tthis.regExps['wordBoundaryRegexAndQuotes'] = RegularsManager.anyChar.compositionGraph([\n\t\t\t\tRegularsManager.space,\n\t\t\t\tRegularsManager.punctuationRegExp,\n\t\t\t\tRegularsManager.wrap( this.sandbox.getOption('customPunctuation') ),\n\t\t\t\tRegularsManager.quotes\n\t\t\t]).set();\n\t\t\t// /\"\\\\f\\\\n\\\\r\\\\t\\\\v\\\\uFEFF\\\\u0085\\\\u00A0\\\\u1680\\\\u180E\\\\u2000-\\\\u200C\\\\u2028\\\\u2029\\\\u202F\\\\u205F\\\\u3000\"\n\t\t\tthis.regExps['nonWhiteSpaceExtended'] = RegularsManager.whiteSpace\n\t\t\t\t.start().set().onePlus();\n\n\t\t\t///[.!?\\2029][\\s\\xA0]*$/g\n\n\t\t\tthis.regExps['sentenceEndCharsGrammar'] = RegularsManager.sentenceEndChars\n\t\t\t\t.composition(\n\t\t\t\t\tRegularsManager.wrap('\\\\u2029')\n\t\t\t\t).set()\n\t\t\t\t.composition(\n\t\t\t\t\tRegularsManager.space\n\t\t\t\t).more().end().g();\n\n\t\t\t// IE specific separator for &nbsp;\n\t\t\tthis.regExps['ieSeparator'] = RegularsManager.wrap( String.fromCharCode(160) ).g();\n\t\t},\n\t\tgetRegExp: function(name) {\n\t\t\treturn this.regExps[name] || RegularsManager[name];\n\t\t},\n\t\t/**\n\t\t * Method what create ignore elements Regexes based on elementsName ().\n\t\t * @memberof WEBSPELLCHECKER.RegExpressions#\n\t\t *\n\t\t * @param {String} elementsName - Name of regular sources.\n\t\t *\n\t\t * @returns {Object} - regular exp wrapper.\n\t\t * @private\n\t\t */\n        createIgnoreElementsRegex: function(elementsName) {\n\t\t\tvar ignoreElements = this.sandbox.getOption(elementsName),\n\t\t\t\tignoreElementsArray,\n\t\t\t\tdefaultIgnoredTagNames = ['style', 'script'];\n\n            if (ignoreElements !== '') {\n\t\t\t\t// delete all spaces\n\t\t\t\tignoreElements = RegularsManager.space\n\t\t\t\t\t.g().replace(ignoreElements, '');\n\t\t\t\t// replace commas with '|'\n\t\t\t\tignoreElementsArray = RegularsManager.comma\n\t\t\t\t\t.g().replace(ignoreElements, '|');\n\n\t\t\t\t// does option already contain default tag name to ignore?\n\t\t\t\tfor (var i = 0; i < defaultIgnoredTagNames.length; i++) {\n\t\t\t\t\t//new RegExp('\\\\b' + defaultIgnoredTagNames[i] + '\\\\b', 'g')\n\t\t\t\t\tvar defaultIgnoredTagReg = RegularsManager.wrap(defaultIgnoredTagNames[i])\n\t\t\t\t\t\t.wrapWordBoundary().g();\n\n\t\t\t\t\tif ( !defaultIgnoredTagReg.match(ignoreElements) ) {\n\t\t\t\t\t\t// no, we need to include them\n\t\t\t\t\t\tignoreElements = ignoreElements + '|' + defaultIgnoredTagNames[i];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tignoreElements = defaultIgnoredTagNames.join('|');\n\t\t\t}\n\n\t\t\treturn RegularsManager.wrap(ignoreElements).group().start().end().i();\n        }\n\t};\n\n\texports.RegExpressions = RegExpressions;\n})(WEBSPELLCHECKER.CORE);\n// deferred.js\r\n/**\r\n * @fileoverview of CORE deferred module.\r\n */\r\n\r\n(function( exports ) {\r\n\t'use strict';\r\n\r\n\t/**\r\n\t * Deferred Module constructor.\r\n\t * @constructor\r\n\t * @alias CORE.Deffered\r\n\t * @param {string} moduleID\r\n\t * @param {CORE.Sandbox} sandbox\r\n\t */\r\n\tvar Deferred = function(moduleID, sandbox) {\r\n\t\t/**\r\n\t\t * Module name.\r\n\t\t *\r\n\t\t * @type {string}\r\n\t\t*/\r\n\t\tthis.name = moduleID;\r\n\r\n\t\t/**\r\n\t\t * Reference to Deferred module sandbox.\r\n\t\t *\r\n\t\t * @type {CORE.Sandbox}\r\n\t\t */\r\n\t\tthis.sandbox = sandbox;\r\n\r\n\t\t/**\r\n\t\t * Collection of registred tasks.\r\n\t\t *\r\n\t\t * @type {object<string, CORE.Deferred.Task>}\r\n\t\t */\r\n\t\tthis.tasks = { };\r\n\r\n\t\t/**\r\n\t\t * Tasks counter.\r\n\t\t *\r\n\t\t * @type {number}\r\n\t\t */\r\n\t\tthis.taskCount = 0;\r\n\t};\r\n\r\n\tDeferred.prototype = {\r\n\r\n\t\t/**\r\n\t\t * Called after each registration in core.\r\n\t\t *\r\n\t\t * @memberof CORE.Deferred#\r\n\t\t */\r\n\t\tinit: function() {\r\n\t\t\tthis.sandbox.subscribe('taskEnded', function(data) {\r\n\t\t\t\tthis.taskEndedHandler(data.taskName);\r\n\t\t\t}, this);\r\n\r\n\t\t},\r\n\t\t/**\r\n\t\t * Destructor of module. Called from core\r\n\t\t *\r\n\t\t * @memberof CORE.Deferred#\r\n\t\t */\r\n\t\tdestroy: function() {\r\n\t\t\tthis.unregisterAll();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Handles 'taskEnded' event and fires 'spellCheckEnded' when taskCount equals 0\r\n\t\t *\r\n\t\t * @param {string} taskName \t- Task name\r\n\t\t * @fires {CORE.Communication.spellCheckEnded}\r\n\t\t */\r\n\t\ttaskEndedHandler: function(taskName) {\r\n\t\t\tthis.unregister(taskName, true);\r\n\t\t\tif (this.taskCount === 0) {\r\n\t\t\t\tthis.sandbox.fire('spellCheckEnded', {});\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Registers task in [tasks collection]{@link CORE.Deferred#tasks}\r\n\t\t *\r\n\t\t * @memberof CORE.Deferred#\r\n\t\t * @param {string} name\t\t\t\t\t\t\t- Task name\r\n\t\t * @param {object} params \t\t\t\t\t\t- Task params\r\n\t\t * @param {boolean} [params.single=false] \t\t- Please use single=true if you need to create Task without chance to extend Task collection\r\n\t\t * @param {array} [params.collection=[]] \t\t- Array of any data\r\n\t\t * @param {number} [params.delay=0] \t\t\t- Delay before execution of deferredFunction\r\n\t\t * @param {number} [params.partialItemsCount=1] - Count of items processed during each iteration of collection processing\r\n\t\t * @param {function} params.deferredFunction \t- Function which be executed for each iteration of collection processing\r\n\t\t *\r\n\t\t * @returns {CORE.Deferred.Task}\r\n\t\t * @fires CORE.Communication.spellCheckStarted\r\n\t\t */\r\n\t\tregister: function(name, params) {\r\n\r\n\t\t\tif (this.taskCount === 0) {\r\n\t\t\t\tthis.sandbox.fire(\"spellCheckStarted\", {});\r\n\t\t\t}\r\n\r\n\t\t\tif (params.single) {\r\n\t\t\t\tthis.unregister(name, true);\r\n\t\t\t\tparams.collection = [\"single\"];\r\n\t\t\t}\r\n\r\n\t\t\tif (this.tasks[name]) {\r\n\t\t\t\tthis.tasks[name].extendCollection(params.collection);\r\n\t\t\t} else {\r\n\t\t\t\tthis.tasks[name] = new Deferred.Task(name, params, this.sandbox);\r\n\t\t\t\tthis.taskCount++;\r\n\t\t\t\tthis.tasks[name].startTask();\r\n\t\t\t}\r\n\r\n\t\t\treturn this.tasks[name];\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Unregisters task with specific name\r\n\t\t *\r\n\t\t * @param {string} name \t- Name of Task\r\n\t\t */\r\n\t\tunregister: function(name, withoutCallback) {\r\n\t\t\tif (this.tasks[name]) {\r\n\t\t\t\tif (this.tasks[name].timeout) {\r\n\t\t\t\t\tclearTimeout(this.tasks[name].timeout);\r\n\t\t\t\t\tthis.tasks[name].timeout = null;\r\n\t\t\t\t}\r\n\t\t\t\tthis.taskCount--;\r\n\t\t\t\tif(!withoutCallback && this.tasks[name].onUnregister) {\r\n\t\t\t\t\tthis.tasks[name].onUnregister.apply(this.tasks[name]);\r\n\t\t\t\t}\r\n\t\t\t\tdelete this.tasks[name];\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Unregisters all tasks from [tasks collection]{@link CORE.Deferred#tasks}\r\n\t\t */\r\n\t\tunregisterAll: function() {\r\n\r\n\t\t\tfor (var name in this.tasks) {\r\n\t\t\t\tif ( this.tasks.hasOwnProperty(name) ) {\r\n\t\t\t\t\tthis.unregister(name);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * Deferred.Task.\r\n\t *\r\n\t * @constructor\r\n\t * @param {string} name\t\t\t\t\t\t\t- Task name\r\n\t * @param {object} params \t\t\t\t\t\t- Task params\r\n\t * @param {boolean} [params.single=false] \t\t- Please use single=true if you need to create Task without chance to extend Task collection\r\n\t * @param {array} [params.collection=[]] \t\t- Array of any data\r\n\t * @param {number} [params.delay=0] \t\t\t- Delay before execution of deferredFunction\r\n\t * @param {number} [params.partialItemsCount=1] - Count of items processed during each iteration of collection processing\r\n\t * @param {function} params.deferredFunction \t- Function which be executed for each iteration of collection processing\r\n\t * @param {CORE.Sandbox} sandbox\r\n\t */\r\n\tDeferred.Task = function(name, params, sandbox) {\r\n\t\tvar self = this;\r\n\r\n\t\tparams = params || {};\r\n\r\n\t\t//this.sandbox = sandbox;\r\n\r\n\t\tthis.name = name;\r\n\t\tthis.single = params.single || false;\r\n\t\tthis.collection = [].concat(params.collection || []);\r\n\t\tthis.delay = params.delay || 0;\r\n\t\tthis.partialItemsCount = params.partialItemsCount || 1;\r\n\t\tthis.deferredFunction = getTaskFunction(params.deferredFunction);\r\n\t\tthis.defferedFunctionArgs = params.defferedFunctionArgs || [];\r\n\t\tthis.timeout = undefined;\r\n\t\t// @TODO: add docummentation and Unit tests for this callback\r\n\t\tthis.onUnregister = params.onUnregister;\r\n\r\n\t\tfunction getTaskFunction( func ) {\r\n\t\t\treturn function() {\r\n\t\t\t\tfunc && func.apply( this, arguments );\r\n\t\t\t\tthis.endTask();\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tthis.getPartialItems = function() {\r\n\t\t\treturn this.collection.splice(0, this.partialItemsCount || 1);\r\n\t\t};\r\n\r\n\t\tthis.runDeferredFunction = function(partialItems) {\r\n\t\t\tvar status = this.deferredFunction.apply(this, [].concat([partialItems], this.defferedFunctionArgs));\r\n\r\n\t\t\treturn status;\r\n\t\t};\r\n\r\n\t\tthis.extendCollection = function( collection ) {\r\n\t\t\t//this.collection.push.apply(this.collection, collection);\r\n\t\t\tvar _spliceHelper = [0,0];\r\n\t\t\t_spliceHelper.push.apply(_spliceHelper, collection);\r\n\t\t\tthis.collection.splice.apply(this.collection, _spliceHelper);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Starts task execution\r\n\t\t */\r\n\t\tthis.startTask = function() {\r\n\t\t\tthis.timeout = setTimeout(function() {\r\n\t\t\t\tvar data = self.getPartialItems();\r\n\t\t\t\t// TODO: 'callStatus' look for another realization callStatus\r\n\t\t\t\t// \t\t to fix problem with multiple requests to SERVICE\r\n\t\t\t\tself.runDeferredFunction(data);\r\n\t\t\t\t//if (callStatus == false) {\r\n\t\t\t\t///\tself.extendCollection(data);\r\n\t\t\t\t//}\r\n\t\t\t}, this.delay);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * @fires CORE.Communication.taskEnded\r\n\t\t */\r\n\t\tthis.endTask = function() {\r\n\t\t\tthis.timeout = null;\r\n\t\t\tif (this.collection.length > 0) {\r\n\t\t\t\tthis.startTask();\r\n\t\t\t} else {\r\n\t\t\t\tsandbox.fire('taskEnded', { taskName: this.name });\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\r\n\texports.Deferred = Deferred;\r\n\r\n})(WEBSPELLCHECKER.CORE);\n/**\n * @namespace WEBSPELLCHECKER\n */\n(function() {\n\tvar OptionsManager = WEBSPELLCHECKER.OptionsManager,\n\t\tUtils = WEBSPELLCHECKER.CORE.prototype.Utils,\n\t\tcoreTemplate = OptionsManager.importOptionsTemplate('CoreTemplate'),\n\t\toptionTypes = OptionsManager.optionTypes,\n\t\tmarkupHandlerCallback,\n\t\tAppTemplate,\n\t\tbasePath, scriptLocation;\n\n\tAppTemplate = {\n\t\tenableGrammar: { defaultValue: false, type: optionTypes.boolean },\n\t\tautoStartup: { defaultValue: false, type: optionTypes.boolean, },\n\t\t// TODO remove in version with refactored CKplugin\n\t\tcharsToObserve : { defaultValue: '', type: optionTypes.string },\n\t\tbasePath: { defaultValue: undefined, type: optionTypes.string },\n\t\tunits: { defaultValue: ['editableControls', 'spelling', 'ui'], type: optionTypes.array },\n\t\tonLoad: { defaultValue: function() {}, type: optionTypes.function }\n\t};\n\tAppTemplate = OptionsManager.mergeOptionsTemplates(AppTemplate, coreTemplate);\n\tAppTemplate.setDefaults({\n\t\tappType: 'application'\n\t});\n\tOptionsManager.exportOptionsTemplate('AppTemplate', AppTemplate);\n\n\n\tbasePath = Utils.getBaseData('wscbundle.js').path;\n\tif(basePath) {\n\t\tAppTemplate.setDefaults({basePath: basePath});\n\t\tscriptLocation = Utils.getLocationInfo(basePath);\n\t\tif (scriptLocation.protocol !== 'file' ) {\n\t\t\tAppTemplate.setDefaults({\n\t\t\t\tserviceProtocol: scriptLocation.protocol,\n\t\t\t\tserviceHost: scriptLocation.host,\n\t\t\t\tservicePort: scriptLocation.port,\n\t\t\t\tservicePath: scriptLocation.pathname + './../script/ssrv.cgi',\n\t\t\t\tserviceId: ''\n\t\t\t});\n\t\t}\n\t}\n\tif(WEBSPELLCHECKER._createApp) {return}\n\n\t/**\n\t * _createApp success Callback.\n\t *\n\t * @callback AppCallbackSuccess\n\t * @param {AppInstance} - link to an instance of WSC application.\n\t */\n\n\t/**\n\t * Create Webspellchecker application for integrations.\n\t *\n\t * @param {Options} options\n\t * @param {AppCallbackSuccess} callbackSuccess\n\t * @param {CallbackError} callbackError\n\t *\n\t * @return {AppInstance} - link to an instance of WSC application.\n\t * @example\n\t * var AppInstance;\n\t * WEBSPELLCHECKER._createApp({\n\t *         container: 'originalElementId'\n\t *         autoStartup: true,\n\t *         lang: 'de_DE',\n\t *         localization: 'de',\n\t *         serviceProtocol: 'http',\n\t *         servicePort: '80',\n\t *         serviceHost: document.location.host,\n\t *         servicePath: 'spellcheck/script/ssrv.cgi'\n\t *     },\n\t *     function(instance) {\n\t *        AppInstance = instance;\n\t *     },\n\t *     function(error) {\n\t *         console.log(error);\n\t *     }\n\t * );\n\t */\n\tWEBSPELLCHECKER._createApp = function(options, callbackSuccess, callbackError) {\n\t\tvar appInstance = this,\n\t\t\tCORE = WEBSPELLCHECKER.CORE,\n\t\t\tlogger = WEBSPELLCHECKER.logger,\n\t\t\tOptionsManager = WEBSPELLCHECKER.OptionsManager,\n\t\t\tUtils = WEBSPELLCHECKER.CORE.prototype.Utils,\n\t\t\tappInstanceOptions,\n\t\t\tclientUnits,\n\t\t\tenableGrammar,\n\t\t\tcore,\n\t\t\terror,\n\t\t\tsandbox;\n\n\n\t\tappInstanceOptions = parseOptions(options, this);\n\t\tif (appInstanceOptions instanceof Error) {\n\t\t\terror = appInstanceOptions;\n\t\t\tif ( Utils.TypeChecker.isFunction(callbackError) ) {\n\t\t\t\tcallbackError(error);\n\t\t\t} else {\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t}\n\t\tclientUnits = appInstanceOptions.units;\n\t\tenableGrammar = clientUnits.includes('grammar') && appInstanceOptions.enableGrammar;\n\n\t\tif ( !clientUnits.includes('common') ) {\n\t\t\tclientUnits.unshift('common');\n\t\t}\n\n\t\tcore = new CORE(appInstanceOptions);\n\t\tsandbox = new WEBSPELLCHECKER.CORE.Sandbox('APP', core);\n\n\t\tsandbox.setOption('appStarted', appInstanceOptions.autoStartup);\n\t\toptions.appType && sandbox.setOption('appType', options.appType); // Hard fix for: https://webspellchecker.atlassian.net/browse/WP-1893\n\n\t\tif ( Utils.isTouchDevice() ) {\n\t\t\tsandbox.setOption('isTouchDevice', true);\n\t\t}\n\n\t\tvar modulesList = {\n\t\t\t\t'Wrapper': CORE.Wrapper,\n\t\t\t\t'Mirror': CORE.Mirror,\n\t\t\t\t'ContenteditableMirror': CORE.ContenteditableMirror,\n\t\t\t\t'IME': CORE.IME,\n\t\t\t\t'StyleManager': CORE.StyleManager,\n\t\t\t\t'LocalizationManager': CORE.LocalizationManager,\n\t\t\t\t'Banner': CORE.Banner,\n\t\t\t\t'FocusManager': CORE.FocusManager,\n\t\t\t\t'AccessLimiter': CORE.AccessLimiter,\n\n\t\t\t\t'WordsCollector': CORE.WordsCollector,\n\t\t\t\t'WordsFinder': CORE.WordsFinder,\n\t\t\t\t'Dictionary': CORE.DictionaryManager,\n\t\t\t\t'Markup': CORE.Markup,\n\t\t\t\t'WordsProcessor': CORE.WordsProcessor,\n\n\t\t\t\t'DragAndDropManager': CORE.DragAndDropManager,\n\t\t\t\t'UndoManager': CORE.UndoManager,\n\t\t\t\t'DOMChangesListener': CORE.DOMChangesListener,\n\n\t\t\t\t'SentencesCollector': CORE.SentencesCollector,\n\t\t\t\t'SentencesDictionary': CORE.GrammarDictionaryManager,\n\t\t\t\t'GrammarPhrasesFinder': CORE.GrammarPhrasesFinder,\n\t\t\t\t'SentencesProcessor': CORE.SentencesProcessor,\n\t\t\t\t'GrammarMarkup': CORE.GrammarMarkup,\n\t\t\t\t'MaxLength': CORE.MaxLength,\n\t\t\t\t'KeyboardManager': CORE.KeyboardManager,\n\t\t\t\t'ProblemManager':  CORE.ProblemManager,\n\t\t\t\t'ActionsManager': CORE.ActionsManager,\n\t\t\t\t'InfoGetter': CORE.InfoGetter,\n\t\t\t\t'GarbageCollector': CORE.GarbageCollector,\n\t\t\t\t'ProofreadDialogManager': CORE.ProofreadDialogManager,\n\t\t\t\t'ProblemsTokenizer': CORE.ProblemsTokenizer\n\t\t\t},\n\t\t\tmodules = [];\n\n\t\tif (CORE.UI) {\n\t\t\tObject.assign(modulesList, {\n\t\t\t\t'UIBuilder': CORE.UIBuilder\n\t\t\t});\n\t\t}\n\n\t\tvar units = {\n\t\t\tspelling: [\n\t\t\t\t'WordsCollector',\n\t\t\t\t'WordsFinder',\n\t\t\t\t'Dictionary',\n\t\t\t\t'Markup',\n\t\t\t\t'WordsProcessor'\n\t\t\t],\n\t\t\tgrammar: [\n\t\t\t\t'SentencesCollector',\n\t\t\t\t'SentencesDictionary',\n\t\t\t\t'GrammarPhrasesFinder',\n\t\t\t\t'SentencesProcessor',\n\t\t\t\t'GrammarMarkup'\n\t\t\t],\n\t\t\tui: [\n\t\t\t\t'FocusManager',\n\t\t\t\t'UIBuilder',\n\t\t\t\t'DOMChangesListener'\n\t\t\t],\n\t\t\tcommon: [\n\t\t\t\t'IME',\n\t\t\t\t'Banner',\n\t\t\t\t'InfoGetter',\n\t\t\t\t'AccessLimiter',\n\t\t\t\t'ProblemManager',\n\t\t\t\t'ActionsManager',\n\t\t\t\t'StyleManager',\n\t\t\t\t'LocalizationManager',\n\t\t\t\t'KeyboardManager',\n\t\t\t\t'ProofreadDialogManager'\n\t\t\t],\n\t\t\teditableControls: [\n\t\t\t\t'Wrapper',\n\t\t\t\t'UndoManager',\n\t\t\t\t'DragAndDropManager',\n\t\t\t\t'MaxLength'\n\t\t\t],\n\t\t\tautoSearchCreation: [\n\t\t\t\t'Mirror',\n\t\t\t\t'ContenteditableMirror',\n\t\t\t\t'ProblemsTokenizer',\n\t\t\t\t'GarbageCollector'\n\t\t\t]\n\t\t};\n\n\t\tvar priorityModules = [\n\t\t\t'Wrapper',\n\t\t\t'Mirror',\n\t\t\t'ContenteditableMirror'\n\t\t];\n\t\t// Add extra plugin\n\t\t/* When all modules(sync and async) ready, start spellcheck and grammarcheck */\n\t\tfunction getModulesList(arr) {\n\t\t\treturn arr.map(function(moduleName) {\n\t\t\t\treturn {\n\t\t\t\t\tname: moduleName,\n\t\t\t\t\tmodule: modulesList[moduleName]\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\tfunction getModuleIndexByName(modules, moduleName) {\n\t\t\tfor(var i = 0; i < modules.length; i += 1) {\n\t\t\t\tif(modules[i].name === moduleName) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn -1;\n\t\t}\n\t\t// Some modules should start before another.\n\t\tfunction setModulesOrder(modules, priorityModules) {\n\t\t\tvar priorityModuleName,\n\t\t\t\tpriorityModule,\n\t\t\t\tpriorityModuleIndex;\n\n \t\t\tfor (var i = priorityModules.length -1; i >= 0; i -= 1) {\n\t\t\t\tpriorityModuleName = priorityModules[i];\n\t\t\t\tpriorityModuleIndex = getModuleIndexByName(modules, priorityModuleName);\n\t\t\t\tif( priorityModuleIndex !== -1 ) {\n\t\t\t\t\tpriorityModule = modules[priorityModuleIndex];\n\t\t\t\t\tmodules.splice(priorityModuleIndex, 1);\n\t\t\t\t\tmodules.unshift(priorityModule);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn modules;\n\t\t}\n\n\t\tsandbox.subscribe('afterDrop', startAppWhenModulesReady);\n\t\tsandbox.subscribe('allModulesReady', startAppWhenModulesReady);\n\t\tsandbox.subscribe('allModulesReady', function() {\n\t\t\t// Wraper module init after async modules. We should wait\n\t\t\tif ( clientUnits.includes('editableControls') ) {\n\t\t\t\t// add Application(core) instance to ClipboardManager, by its own Sandbox\n\t\t\t\tcore.clipboardManager.add(sandbox, sandbox.getOption('container'), sandbox.isOriginalContainerTextBased());\n\t\t\t}\n\n\t\t\tif ( clientUnits.includes('ui') ) {\n\t\t\t\tsetAdditionalClasses(sandbox);\n\t\t\t\tbindEvents(options, sandbox, this, core.clipboardManager);\n\t\t\t}\n\n\t\t\tif (instance) {\n\t\t\t\trunSuccessCallback(instance);\n\n\t\t\t\t// MS EDGE works with some css rules in quirks mode in iframe without DOCTYPE\n\t\t\t\tif (sandbox.Utils.Browser.edge && sandbox.getOption('isIframe') && !sandbox.getOption('documentContainer').contentDocument.doctype) {\n\t\t\t\t\tsandbox.UILib.addClass(sandbox.getOption('container'), sandbox.getOption('iframe_quirks_class'));\n\t\t\t\t}\n\n\t\t\t\tsandbox.UILib.addClass(sandbox.getOption('container'), sandbox.getOption('instance_class'));\n\t\t\t\tsandbox.isOriginalContainerTextBased() && sandbox.UILib.addClass(sandbox.getOption('originalContainer'), sandbox.getOption('instance_class'));\n\t\t\t}\n\n\t\t\tsandbox.subscribe({\n\t\t\t\teventType: 'dblclick',\n\t\t\t\telement: sandbox.getOption('container'),\n\t\t\t\thandler: doubleClickHandler\n\t\t\t});\n\t\t}, this);\n\n\n\t\t/* When App rewrite nodes we should substitute nodes with special characters to CK  */\n\t\t/* Find node with Special characters and call a callback function with node in parameters */\n\t\tfunction checkNodeWithSpecialChars(data){\n\t\t\tvar chars = sandbox.getOption('charsToObserve'),\n\t\t\t\tnodeWithChar,\n\t\t\t\tnode = data.node;\n\n\t\t\tfor (var i = 0; i < chars.length; i++) {\n\t\t\t\tnodeWithChar = sandbox.Utils.findFirstNodeWithString(node, chars[i].charCode);\n\n\t\t\t\tif (nodeWithChar) {\n\t\t\t\t\tmarkupHandlerCallback({ charName: chars[i].charName, node : nodeWithChar });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tsandbox.subscribe('removedMarkupInContainer', checkNodeWithSpecialChars);\n\t\tsandbox.subscribe('markupedNode', checkNodeWithSpecialChars);\n\n\t\tclientUnits.forEach(function(unitName) {\n\t\t\tmodules = modules.concat( getModulesList(units[unitName]) );\n\t\t});\n\n\t\tif ( Array.isArray(options.extraModules) ) {\n\t\t\tmodules = modules.concat( getModulesList(options.extraModules) );\n\t\t}\n\n\t\tmodules = setModulesOrder(modules, priorityModules);\n\t\tcore.initModules(modules);\n\n\t\t// add Application(core) instance to InstanceManager, by its own Sandbox\n\t\tcore.instanceManager.add(sandbox);\n\n\t\t/* when instance ready, call success callback */\n\t\tfunction runSuccessCallback(instance) {\n\t\t\tif (callbackSuccess) {\n\t\t\t\tcallbackSuccess(instance);\n\t\t\t}\n\t\t}\n\n\t\t// TODO lead to the same species based on async modules way\n\t\tfunction startAppWhenModulesReady() {\n\t\t\tsetGrammarState(enableGrammar);\n\n\t\t\tif ( sandbox.getOption('appStarted') && sandbox.getOption('proofreadAsYouType') ) {\n\t\t\t\tsandbox.startMarkup();\n\t\t\t} else {\n\t\t\t\tsandbox.stopMarkup();\n\t\t\t}\n\n\t\t\tif (typeof options.onLoad === 'function') {\n\t\t\t\toptions.onLoad.apply(instance, arguments);\n\t\t\t}\n\t\t}\n\n\t\tvar container = sandbox.getOption('container');\n\n\t\tsetAdditionalAttributes(sandbox, container);\n\n\t\tsandbox.subscribe('commitOptions', function(event) {\n\t\t\tfunction filterOptions(options) {\n\t\t\t\tvar res = {};\n\n\t\t\t\tfor(var k in options) {\n\t\t\t\t\tif( options[k] !== sandbox.getOption(k) ) {\n\t\t\t\t\t\tres[k] = options[k];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn res;\n\t\t\t}\n\n\t\t\tvar data = filterOptions(event.changedOptions);\n\n\t\t\tif( !Utils.objectIsEmpty(data)) {\n\t\t\t\tif (data.lang) {\n\t\t\t\t\tsandbox.fire('removeMarkupInDocument', {});\n\t\t\t\t\tsandbox.fire('removeMarkupInContainer', {});\n\t\t\t\t\tsandbox.removeAllDeferredFunctions();\n\t\t\t\t}\n\n\t\t\t\tsandbox.setPaused(true);\n\n\t\t\t\tvar dictionary = CORE.DictionaryManager.Dictionary,\n\t\t\t\t\tlang = sandbox.getOption('lang');\n\n\t\t\t\tdictionary.each(lang, function(wordObject) {\n\t\t\t\t\tif (wordObject.getStatus(sandbox.getOption('uid')) == CORE.DictionaryManager.wordStatus.inprocess) {\n\t\t\t\t\t\twordObject.setStatus(CORE.DictionaryManager.wordStatus.unknown, sandbox.getOption('uid'));\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tfor (var optionName in data) {\n\t\t\t\t\tif (data.hasOwnProperty(optionName)) {\n\t\t\t\t\t\tsandbox.setOption(optionName, data[optionName]);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tsandbox.setPaused(false);\n\n\t\t\t\tsetGrammarState(enableGrammar);\n\t\t\t\tsandbox.startProblemsCheck();\n\t\t\t\tsandbox.fire('optionsCommited', data);\n\t\t\t}\n\t\t}, appInstance);\n\n\t\t// preprocess incoming options and returns set of options for instance\n\t\tfunction parseOptions(_options, appInstance) {\n\t\t\tvar criticalMessage = '',\n\t\t\t\tappInstanceOptions = {},\n\t\t\t\tAppTemplate = OptionsManager.importOptionsTemplate('AppTemplate'),\n\t\t\t\terror;\n\t\t\t\t// default set of options and description of valid value for each of them\n\n\t\t\tif ( _options.disableOptionsStorage && Array.isArray(_options.disableOptionsStorage) ) {\n\t\t\t\tvar userOptions = _options.disableOptionsStorage,\n\t\t\t\t\tavailableValue = ['all', 'options', 'lang', 'ignoreWordsWithMixedCases', 'ignoreDomainNames', 'ignoreAllCapsWords', 'ignoreWordsWithNumbers'],\n\t\t\t\t\tvaluesOption = ['lang', 'ignoreWordsWithMixedCases', 'ignoreDomainNames', 'ignoreAllCapsWords', 'ignoreWordsWithNumbers'];\n\n\t\t\t\tvar isValidOption = function(option) {\n\t\t\t\t\treturn !!availableValue.includes(option);\n\t\t\t\t};\n\n\t\t\t\tvar makeOptionsToStorage = function(options) {\n\t\t\t\t\tvar retval = [];\n\n\t\t\t\t\tfor (var i = 0; i < options.length; i++) {\n\t\t\t\t\t\tvar value = options[i],\n\t\t\t\t\t\t\tisGroupOptionInUserOptions = !!options.includes('options');\n\n\t\t\t\t\t\tif ( !isValidOption(value) || isGroupOptionInUserOptions && valuesOption.indexOf('lang') === -1 ) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( !!valuesOption.includes(value) ) {\n\t\t\t\t\t\t\tvaluesOption.splice( valuesOption.indexOf(value), 1 );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( value === 'all' || isGroupOptionInUserOptions && !!options.includes('lang') ) {\n\t\t\t\t\t\t\treturn [];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (value === 'options') {\n\t\t\t\t\t\t\tvaluesOption = ['lang'];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tretval = retval.concat(valuesOption);\n\n\t\t\t\t\treturn retval;\n\t\t\t\t};\n\n\t\t\t\toptions['options-to-restore'] = makeOptionsToStorage(userOptions);\n\t\t\t\tdelete _options.disableOptionsStorage;\n\t\t\t}\n\t\t\t_options.container =  Object.prototype.toString.call(_options.container) == '[object String]' ? document.getElementById(_options.container) : _options.container;\n\n\t\t\tappInstanceOptions = OptionsManager.createOptions(_options, 'AppTemplate', function errorHandler(errors) {\n\t\t\t\terrors.reports.forEach(function(report) {\n\t\t\t\t\tif (report.critical) {\n\t\t\t\t\t\tcriticalMessage += report.message;\n\t\t\t\t\t}\n\t\t\t\t}, this);\n\t\t\t});\n\t\t\tif(!appInstanceOptions.basePath) {\n\t\t\t\tcriticalMessage += 'basePath in undefined. wscbundle script should be included to the page.';\n\t\t\t}\n\n\t\t\tif ( criticalMessage !== '') {\n\t\t\t\terror = new Error(criticalMessage);\n\t\t\t\treturn error;\n\t\t\t}\n\t\t\t// delete all spaces if so\n\t\t\tif (appInstanceOptions.customDictionaryIds) {\n\t\t\t\tappInstanceOptions.customDictionaryIds = appInstanceOptions.customDictionaryIds.replace(/*REG_REPLACE*//\\s/g, '');\n\t\t\t}\n\n\t\t\treturn appInstanceOptions;\n\t\t}\n\n\t\tfunction bindEvents(_options, sandbox, appInstance, clipboardManager) {\n\t\t\tvar UILib = sandbox.UILib,\n\t\t\t\tUtils = sandbox.Utils,\n\t\t\t\tisIframe = sandbox.getOption('isIframe'),\n\t\t\t\tmirrorBasedInstance = sandbox.getOption('mirrorBasedInstance'),\n\t\t\t\tisModelEditor = sandbox.getOption('isModelEditor'),\n\t\t\t\tdocumentContainer = sandbox.getOption('documentContainer'),\n\t\t\t\tcontainer = sandbox.getOption('container'),\n\t\t\t\toriginalContainer = sandbox.getOption('originalContainer'),\n\t\t\t\tcontainerToCheck;\n\n\t\t\tif (isIframe) {\n\t\t\t\tcontainerToCheck = documentContainer;\n\t\t\t} else if (mirrorBasedInstance || isModelEditor) {\n\t\t\t\tcontainerToCheck = originalContainer;\n\t\t\t} else {\n\t\t\t\tcontainerToCheck = container;\n\t\t\t}\n\n\t\t\t// clipboard events\n\t\t\t// refresh spelling markup\n\t\t\tsandbox.subscribe({\n\t\t\t\teventType: 'cutProcessed',\n\t\t\t\thandler:  function(e) {\n\t\t\t\t\tsandbox.fire('removeMarkupInSelectionNode', {});\n\t\t\t\t\t// We should start spell and grammar check after browser cut action\n\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\tsandbox.startProblemsCheck();\n\t\t\t\t\t}, 0);\n\t\t\t\t},\n\t\t\t\tcontext: appInstance\n\t\t\t});\n\n\t\t\tsandbox.subscribe('removedMarkupInContainer', function(data) {\n\t\t\t\tdata.textChanged && sandbox.startProblemsCheck();\n\t\t\t});\n\n\t\t\t// refresh spelling markup\n\t\t\tsandbox.subscribe('pasteProcessed', function(data) {\n\t\t\t\tsandbox.fire('removeMarkupInSelectionNode', {});\n\t\t\t}, appInstance);\n\n\t\t\tsandbox.subscribe('afterPaste, garbageCollected', function(data) {\n\t\t\t\tsandbox.startProblemsCheck();\n\t\t\t}, appInstance);\n\n\t\t\t// We need auto removing instances and removing markup only for auto search functionality\n\t\t\tif ( clientUnits.includes('autoSearchCreation') ) {\n\t\t\t\tsandbox.subscribe('periodicalChecking', function (data) {\n\t\t\t\t\tvar remove = false;\n\n\t\t\t\t\tif (!Utils.isNodeAvailable(containerToCheck)) {\n\t\t\t\t\t\tremove = true;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Some times body of the iframe removed and created new.\n\t\t\t\t\t// So we need to compare saved and current body.\n\t\t\t\t\tif (isIframe && !remove) {\n\t\t\t\t\t\tif (container !== containerToCheck.contentWindow.document.getElementsByTagName('body')[0]) {\n\t\t\t\t\t\t\tremove = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (remove) {\n\t\t\t\t\t\tinstance && instance.destroy && instance.destroy();\n\t\t\t\t\t}\n\t\t\t\t}, appInstance);\n\n\t\t\t\tsandbox.subscribe({\n\t\t\t\t\teventType: 'submit',\n\t\t\t\t\telement: document,\n\t\t\t\t\thandler: function (e) {\n\t\t\t\t\t\tif (!e.defaultPrevented) {\n\t\t\t\t\t\t\tvar form = e.target,\n\t\t\t\t\t\t\t\twscMarkupRemoved = form ? form.wscMarkupRemoved : true;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tsandbox.fire('removeMarkupInDocument');\n\t\t\t\t\t\t\tsandbox.fire('removeMarkupInContainer');\n\n\t\t\t\t\t\t\tif (!wscMarkupRemoved) {\n\t\t\t\t\t\t\t\tform.wscMarkupRemoved = true;\n\n\t\t\t\t\t\t\t\tfor (var i = 0; i < form.elements.length; i++) {\n\t\t\t\t\t\t\t\t\tvar element = form.elements[i],\n\t\t\t\t\t\t\t\t\t\tvalue = element.value;\n\n\t\t\t\t\t\t\t\t\tif ( Utils.isTextBased(element) && value ) {\n\t\t\t\t\t\t\t\t\t\tvalue = sandbox.removeMarkupFromString(value);\n\t\t\t\t\t\t\t\t\t\telement.value = value;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tfunction setAdditionalClasses(sandbox) {\n\t\t\tvar Utils = sandbox.Utils,\n\t\t\t\tUILib = sandbox.UILib;\n\n\t\t\tif (Utils.Browser.ie) {\n\t\t\t\tUILib.addClass('html', 'wsc-ie' + Utils.Browser.version);\n\n\t\t\t\tif (Utils.Browser.version < 9) {\n\t\t\t\t\tUILib.addClass('html', 'wsc-lt-ie9');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( Utils.isTouchDevice() ) {\n\t\t\t\tUILib.addClass('html', 'wsc-touch');\n\t\t\t}\n\t\t}\n\n\t\tfunction setAdditionalAttributes(sandbox, container) {\n\t\t\tvar UILib = sandbox.UILib;\n\n\t\t\tUILib.attr(container, 'aria-readonly', false);\n\t\t\tUILib.attr(container, 'spellcheck', false);\n\t\t}\n\n\t\t// #21993 : Text can't be selected with double click during markuping the text\n\t\tfunction doubleClickHandler() {\n\t\t\tvar selection = sandbox.getSelection(),\n\t\t\t\trange, selectedText;\n\n\t\t\tif (selection.rangeCount() > 0) {\n\t\t\t\trange = selection.getRangeAt(0);\n\t\t\t\tselectedText = range.toString();\n\n\t\t\t\tif (!selectedText && range.getNodes().length === 0) {\n\t\t\t\t\t// @TODO provide support of expanding to words not only for English language. See rangy-textrange module for more details.\n\t\t\t\t\t// Sometimes user do double click in empty editable and also\n\t\t\t\t\t// Chrome and Safari on Mac OS have strange behaviour when we\n\t\t\t\t\t// double click in the end of the text (they both don't select last word).\n\t\t\t\t\t// So we have to do selection.expand in try/catch block.\n\t\t\t\t\t// Also review expand method functionality.\n\t\t\t\t\ttry {\n\t\t\t\t\t\tselection.expand('word');\n\t\t\t\t\t\tsandbox.fire('selectionIsChanged', {});\n\t\t\t\t\t} catch (e) {}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// TODO review possible ways async modules initialization. Fix for the right way.\n\t\tsandbox.subscribe({\n\t\t\teventType: 'toggleApp',\n\t\t\thandler: function(event) {\n\t\t\t\tvar flag = event.flag;\n\n\t\t\t\t(flag) ? sandbox.startApp() : sandbox.stopApp();\n\t\t\t}\n\t\t});\n\n\t\tfunction setGrammarState(state) {\n\t\t\tvar grammarLangList = sandbox.getOption('grammarLangList'),\n\t\t\t\tcurrLang = sandbox.getOption('lang');\n\n\t\t\t// turn off Grammar for unsupported languages\n\t\t\tif (state && !(currLang in grammarLangList.ltr) && !(currLang in grammarLangList.rtl)) {\n\t\t\t\tstate = false;\n\t\t\t}\n\n\t\t\tif ( sandbox.getOption('enableGrammar') !== state ) {\n\t\t\t\tsandbox.setOption('enableGrammar', state);\n\t\t\t\tsandbox.fire('enableGrammarChanged', { state: state });\n\t\t\t\tsandbox.setGrammarMarkupPaused(!state);\n\t\t\t}\n\t\t}\n\n\t\t// extend sandbox with handy wrappers for standart methods\n\t\tsandbox.getLocal = function(abbreviation) {\n\t\t\treturn sandbox.Localization.getLocal(abbreviation, sandbox.getOption('localization'));\n\t\t};\n\n\t\tvar containerWithId;\n\t\t/**\n\t\t * Represent a WEBSPELLCHECKER Application instance.\n\t\t * Result of WEBSPELLCHECKER._createApp method\n\t\t * @typedef {object} AppInstance\n\t\t * @interface AppInstance\n\t\t * @see {@link WEBSPELLCHECKER._createApp}\n\t\t * @namespace AppInstance\n\t\t */\n\t\tvar instance = {\n\t\t\t/**\n\t\t\t * If all modules(sync and async) initialized - return true.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t *\n\t\t\t * @returns {Boolean} - all modules ready flag.\n\t\t\t * @example\n\t\t\t * if ( appInstance.isAllModulesReady() ) { };\n\t\t\t */\n\t\t\tisAllModulesReady: function(){\n\t\t\t\treturn core.allModulesReady;\n\t\t\t},\n\t\t\t/**\n\t\t\t * Reload the Spelling and Grammar markup in the instance.\n\t\t\t * If some text was added without browser events (like innerHTML).\n\t\t\t * This method manually trigger markup reloading.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @example\n\t\t\t * appInstance.reloadMarkup();\n\t\t\t */\n\t\t\treloadMarkup: function(){\n\t\t\t\tsandbox.startProblemsCheck();\n\t\t\t},\n\t\t\t/**\n\t\t\t * Replace a word in the Spelling or Grammar node with a word from the 'data.word' or 'data.phrase' field.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @param {Object} data - Configuration object.\n\t\t\t * @param {Node} data.word - Word for replacing.\n\t\t\t * @param {Node} data.phrase - Phrase for replacing.\n\t\t\t * @example\n\t\t\t * appInstance.replaceSelectionNode({word: 'someWord'});\n\t\t\t * appInstance.replaceSelectionNode({phrase: 'some phrase'});\n\t\t\t */\n\t\t\treplaceSelectionNode: function(data) {\n\t\t\t\tvar eventName = data && data.word ? 'replaceWord' : 'replacePhrase';\n\n\t\t\t\tsandbox.fire(eventName, data);\n\t\t\t},\n\t\t\t/**\n\t\t\t * Get suggestions for a specified word or phrase.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @param {Object} data - Configuration object.\n\t\t\t * @param {Node} data.word - Word for replacing.\n\t\t\t * @param {Node} data.phrase - Phrase for replacing.\n\t\t\t * @param {Node} data.lang - Language.\n\t\t\t * @returns {Array|Null} - Array of the suggestions or null.\n\t\t\t * @example\n\t\t\t * appInstance.getSuggestions({word: 'exampl', lang: 'en_US'});\n\t\t\t * appInstance.getSuggestions({phrase: 'type text', lang: 'en_US'});\n\t\t\t */\n\t\t\tgetSuggestions: function(data) {\n\t\t\t\tvar dictionaryModule = core.getService('Dictionary');\n\t\t\t\tvar grammarDictionaryModule = core.getService('SentencesDictionary');\n\t\t\t\tvar problemFromDictionary = data && data.word ? dictionaryModule.getWordFromDictionary(data.word, data.lang) : grammarDictionaryModule.getPhraseFromDictionary(data.phrase, data.lang),\n\t\t\t\t\tsuggestions = problemFromDictionary && problemFromDictionary.suggestions ? problemFromDictionary.suggestions : null;\n\n\t\t\t\treturn suggestions;\n\t\t\t},\n\t\t\t/**\n\t\t\t * Ignore a Spelling node in selection.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @example\n\t\t\t * appInstance.ignoreWord();\n\t\t\t */\n\t\t\tignoreWord: function() {\n\t\t\t\tsandbox.fire('ignoreWord');\n\t\t\t},\n\t\t\t/**\n\t\t\t * Ignore a Grammar node in selection.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @example\n\t\t\t * appInstance.ignorePhrase();\n\t\t\t */\n\t\t\tignorePhrase: function() {\n\t\t\t\tsandbox.fire('ignorePhrase');\n\t\t\t},\n\t\t\t/**\n\t\t\t * Ignore a selected Grammar nodes within the document.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @example\n\t\t\t * appInstance.ignoreAllPhrases();\n\t\t\t */\n\t\t\tignoreAllPhrases: function(data) {\n\t\t\t\tsandbox.fire('ignoreAllPhrases', data);\n\t\t\t},\n\t\t\t/**\n\t\t\t * Add a word to a User Dictionary.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @param {String} word - Word that will be added to a User Dictionary.\n\t\t\t * @param {Function} onSuccess - On success callback.\n\t\t\t * @param {Function} onError - On error callback.\n\t\t\t * @example\n\t\t\t * appInstance.addWordToUserDictionary('exampl'); // The word 'exampl' will be added to the User Dictionary\n\t\t\t * appInstance.addWordToUserDictionary(''); //  If the cursor is set in the Spelling node, the word from this node will be added to the User Dictionary\n\t\t\t */\n\t\t\taddWordToUserDictionary: function(word, onSuccess, onError) {\n\t\t\t\tsandbox.fire('addWordToUserDictionary', {word: word, onSuccess: onSuccess, onError: onError});\n\t\t\t},\n\t\t\t/**\n\t\t\t * Delete a word from the User Dictionary.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @param {String} word - Word.\n\t\t\t * @param {Function} onSuccess - On success callback.\n\t\t\t * @param {Function} onError - On error callback.\n\t\t\t * @example\n\t\t\t * appInstance.deleteWordFromUserDictionary('exampl'); // The word 'exampl' will be deleted from the User Dictionary\n\t\t\t */\n\t\t\tdeleteWordFromUserDictionary: function(word, onSuccess, onError) {\n\t\t\t\tsandbox.fire('deleteWordFromUserDictionary', {word: word, onSuccess: onSuccess, onError: onError});\n\t\t\t},\n\t\t\t/**\n\t\t\t * Ignore a selected word within the document.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @example\n\t\t\t * appInstance.ignoreAllWords();\n\t\t\t */\n\t\t\tignoreAllWords: function() {\n\t\t\t\tsandbox.fire('ignoreAllWords');\n\t\t\t},\n\t\t\t/**\n\t\t\t * Remove markup from all Spelling and Grammar nodes in the selection.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @param {Object} data - Configuration object.\n\t\t\t * @param {Boolean} data.grammarOnly - If âtrue', remove markup from Grammar nodes only.\n\t\t\t * @param {Node} data.selectionNode - Link to the node when the Spelling and Grammar markup should be removed.\n\t\t\t * @param {Boolean} data.removeInside - Remove the Spelling and Grammar markup if âtrue' and the selection is not collapsed.\n\t\t\t * @param {Boolean} data.forceBookmark - If âtrue', return the focus to the container.\n\t\t\t * @example\n\t\t\t * appInstance.removeMarkupInSelectionNode();\n\t\t\t * appInstance.removeMarkupInSelectionNode({grammarOnly: true}); // Remove markup only for Grammar nodes\n\t\t\t * appInstance.removeMarkupInSelectionNode({selectionNode: document.getElementById('someId')}); // Remove markup in specified node\n\t\t\t */\n\t\t\tremoveMarkupInSelectionNode: function(data) {\n\t\t\t\tvar eventName = data && data.grammarOnly ? 'removeGrammarMarkupInSelectionNode' : 'removeMarkupInSelectionNode';\n\n\t\t\t\tsandbox.fire(eventName, data);\n\t\t\t},\n\t\t\t/**\n\t\t\t * Destroy a instance.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @example\n\t\t\t * appInstance.destroy();\n\t\t\t */\n\t\t\tdestroy: function() {\n\t\t\t\tvar UILib = sandbox.UILib,\n\t\t\t\t\tUtils = sandbox.Utils,\n\t\t\t\t\tcontainerToCheck = sandbox.getOption('isIframe') ? sandbox.getOption('documentContainer') : sandbox.getOption('container');\n\n\t\t\t\tif ( sandbox.getOption('paused') ) {\n\t\t\t\t\t// we need to unpause to fire 'removeMarkupInDocument' event if APP is paused with application API\n\t\t\t\t\tsandbox.setPaused(false);\n\t\t\t\t}\n\n\t\t\t\t// We need to remove murkup only for available container\n\t\t\t\tif ( Utils.isInPage( sandbox.getMainContainer() ) ) {\n\t\t\t\t\tsandbox.fire('removeMarkupInDocument', {});\n\t\t\t\t\tsandbox.fire('removeMarkupInContainer', {});\n\t\t\t\t}\n\n\t\t\t\tif ( clientUnits.includes('editableControls') ) {\n\t\t\t\t\tcore.clipboardManager.remove(sandbox.getOption('uid'));\n\t\t\t\t}\n\n\t\t\t\tcore.instanceManager.remove(sandbox.getOption('uid'));\n\n\t\t\t\tsandbox.unsubscribe({\n\t\t\t\t\teventType: 'dblclick',\n\t\t\t\t\telement: sandbox.getOption('container'),\n\t\t\t\t\thandler: doubleClickHandler\n\t\t\t\t});\n\n\t\t\t\tcore.destroyModules();\n\t\t\t\tsandbox.setPaused(true);\n\t\t\t\tUILib.removeAttr(sandbox.getOption('originalContainer'), 'data-spelling');\n\n\t\t\t\tif (sandbox.Utils.Browser.edge && sandbox.getOption('isIframe') && !sandbox.getOption('documentContainer').contentDocument.doctype) {\n\t\t\t\t\tsandbox.UILib.removeClass(sandbox.getOption('container'), sandbox.getOption('iframe_quirks_class'));\n\t\t\t\t}\n\n\t\t\t\tUILib.removeClass(sandbox.getOption('container'), sandbox.getOption('instance_class'));\n\t\t\t\tsandbox.isOriginalContainerTextBased() && UILib.removeClass(sandbox.getOption('originalContainer'), sandbox.getOption('instance_class'));\n\n\t\t\t\tfor (var item in this) {\n\t\t\t\t\tif (this.hasOwnProperty(item)) {\n\t\t\t\t\t\tdelete this[item];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t/**\n\t\t\t * Get a list of all the available languages.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @returns {Object} - List of all the available languages.\n\t\t\t * @example\n\t\t\t * appInstance.getSpellingLangList();\n\t\t\t */\n\t\t\tgetSpellingLangList: function() {\n\t\t\t\treturn sandbox.getOption('spellingLangList');\n\t\t\t},\n\t\t\t/**\n\t\t\t * Get a list of all the available languages.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @returns {Object} - List of all the available languages.\n\t\t\t * @example\n\t\t\t * appInstance.getGrammarLangList();\n\t\t\t */\n\t\t\tgetGrammarLangList: function() {\n\t\t\t\treturn sandbox.getOption('grammarLangList');\n\t\t\t},\n\t\t\t/**\n\t\t\t * Get the application config data.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @returns {Object} - List of application config data.\n\t\t\t * @example\n\t\t\t * appInstance.getApplicationConfig(); // {ignoreAllCapsWords: false, ignoreDomainNames: true, ignoreAllCapsWords: false, ignoreWordsWithNumbers: false}\n\t\t\t */\n\t\t\tgetApplicationConfig: function() {\n\t\t\t\treturn sandbox.getOption(['ignoreWordsWithMixedCases', 'ignoreDomainNames', 'ignoreAllCapsWords', 'ignoreWordsWithNumbers']);\n\t\t\t},\n\t\t\t/**\n\t\t\t * Get a spell checking language.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @returns {String} - Spell checking language.\n\t\t\t * @example\n\t\t\t * appInstance.getLang(); // 'en_US'\n\t\t\t */\n\t\t\tgetLang: function() {\n\t\t\t\treturn sandbox.getOption('lang');\n\t\t\t},\n\t\t\t/**\n\t\t\t * Set a spell checking language. Possible values are:<br>\n\t\t\t * <pre>\n\t\t\t * 'en_US', 'en_GB', 'pt_BR', 'da_DK',\n\t\t\t * 'nl_NL', 'en_CA', 'fi_FI', 'fr_FR',\n\t\t\t * 'fr_CA', 'de_DE', 'el_GR', 'it_IT',\n\t\t\t * 'nb_NO', 'pt_PT', 'es_ES', 'sv_SE'.\n\t\t\t * </pre>\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @param {String} lang - Language.\n\t\t\t * @example\n\t\t\t * appInstance.setLang('en_GB');\n\t\t\t */\n\t\t\tsetLang: function(lang) {\n\t\t\t\tsandbox.fire('commitOptions', {changedOptions: {lang: lang} });\n\t\t\t},\n\t\t\t/**\n\t\t\t * Change the main APP options.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @param {Object} options - Configuration object.\n\t\t\t * @param {Boolean} options.ignoreAllCapsWords - Ignore all caps words like 'EXAMPL'.\n\t\t\t * @param {Boolean} options.ignoreDomainNames - Ignore domain names like 'http://example.com'.\n\t\t\t * @param {Boolean} options.ignoreWordsWithMixedCases - Ignore words with mixed cases like 'eXaMpL'.\n\t\t\t * @param {Boolean} options.ignoreWordsWithNumbers - Ignore words with numbers like 'exampl7'.\n\t\t\t * @param {String} options.lang - Change language.\n\t\t\t * @example\n\t\t\t * appInstance.commitOption({\n\t\t\t *     'ignoreAllCapsWords': true,\n\t\t\t *     lang: 'de_DE'\n\t\t\t * });\n\t\t\t */\n\t\t\tcommitOption: function(options) {\n\t\t\t\tif (!options.changedOptions) {\n\t\t\t\t\toptions.changedOptions = options;\n\t\t\t\t}\n\n\t\t\t\tsandbox.fire('commitOptions', options );\n\t\t\t},\n\t\t\t/**\n\t\t\t * Get an APP option value.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @param {String|Array} optionName - Option name or array with options names.\n\t\t\t * @returns {Object} - List of application config data.\n\t\t\t * @example\n\t\t\t * appInstance.getOption(['userDictionaryName', 'ignoreAllCapsWords']); // {userDictionaryName: null, ignore-all-caps-words: false}\n\t\t\t */\n\t\t\tgetOption: function(optionName) {\n\t\t\t\treturn sandbox.getOption(optionName);\n\t\t\t},\n\t\t\t/**\n\t\t\t * Get a User Dictionary name.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @returns {String|Null} - User Dictionary name ore null.\n\t\t\t * @example\n\t\t\t * appInstance.getUserDictionaryName();\n\t\t\t */\n\t\t\tgetUserDictionaryName: function() {\n\t\t\t\treturn sandbox.getOption('userDictionaryName');\n\t\t\t},\n\t\t\t/**\n\t\t\t * Create a new User Dictionary.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @param {String} name - User Dictionary name.\n\t\t\t * @param {Function} onSuccess - On success callback.\n\t\t\t * @param {Function} onError - On error callback.\n\t\t\t * @example\n\t\t\t * var onSuccess = function() {//Some code here};\n\t\t\t * var onError = function() {//Some code here};\n\t\t\t * appInstance.createUserDictionary('test', onSuccess, onError);\n\t\t\t */\n\t\t\tcreateUserDictionary: function(name, onSuccess, onError) {\n\t\t\t\tsandbox.fire('createUserDictionary', {name: name, onSuccess: onSuccess, onError: onError});\n\t\t\t},\n\t\t\t/**\n\t\t\t * Connect a User Dictionary.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @param {String} name - User Dictionary name.\n\t\t\t * @param {Function} onSuccess - On success callback.\n\t\t\t * @param {Function} onError - On error callback.\n\t\t\t * @example\n\t\t\t * var onSuccess = function() {//Some code here};\n\t\t\t * var onError = function() {//Some code here};\n\t\t\t * appInstance.restoreUserDictionary('test', onSuccess, onError);\n\t\t\t */\n\t\t\trestoreUserDictionary: function(name, onSuccess, onError) {\n\t\t\t\tsandbox.fire('restoreUserDictionary', {name: name, onSuccess: onSuccess, onError: onError});\n\t\t\t},\n\t\t\t/**\n\t\t\t * Disconnect the User Dictionary.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @param {String} name - User Dictionary name.\n\t\t\t * @param {Function} onSuccess - On success callback.\n\t\t\t * @param {Function} onError - On error callback.\n\t\t\t * @example\n\t\t\t * var onSuccess = function() {//Some code here};\n\t\t\t * var onError = function() {//Some code here};\n\t\t\t * appInstance.disconnectFromUserDictionary('test', onSuccess, onError);\n\t\t\t */\n\t\t\tdisconnectFromUserDictionary: function(name, onSuccess, onError) {\n\t\t\t\tsandbox.fire('disconnectFromUserDictionary', {name: name, onSuccess: onSuccess, onError: onError});\n\t\t\t},\n\t\t\t/**\n\t\t\t * Rename an existing User Dictionary.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @param {String} name - User Dictionary name.\n\t\t\t * @param {Function} onSuccess - On success callback.\n\t\t\t * @param {Function} onError - On error callback.\n\t\t\t * @example\n\t\t\t * var onSuccess = function() {//Some code here};\n\t\t\t * var onError = function() {//Some code here};\n\t\t\t * appInstance.renameUserDictionary('test1', onSuccess, onError);\n\t\t\t */\n\t\t\trenameUserDictionary: function(newName, onSuccess, onError) {\n\t\t\t\tsandbox.fire('renameUserDictionary', {newName: newName, onSuccess: onSuccess, onError: onError});\n\t\t\t},\n\t\t\t/**\n\t\t\t * Remove a User Dictionary.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @param {String} name - User Dictionary name.\n\t\t\t * @param {Function} onSuccess - On success callback.\n\t\t\t * @param {Function} onError - On error callback.\n\t\t\t * @example\n\t\t\t * var onSuccess = function() {//Some code here};\n\t\t\t * var onError = function() {//Some code here};\n\t\t\t * appInstance.removeUserDictionary('test1', onSuccess, onError);\n\t\t\t */\n\t\t\tremoveUserDictionary: function(name, onSuccess, onError) {\n\t\t\t\tsandbox.fire('removeUserDictionary', {name: name, onSuccess: onSuccess, onError: onError});\n\t\t\t},\n\t\t\t/**\n\t\t\t * Set a User Dictionary name.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @param {String} name - User Dictionary name.\n\t\t\t * @example\n\t\t\t * appInstance.setUserDictionaryName('test2', onSuccess, onError);\n\t\t\t */\n\t\t\tsetUserDictionaryName: function(name) {\n\t\t\t\tsandbox.fire('setUserDictionaryName', {name: name});\n\t\t\t},\n\t\t\t/**\n\t\t\t * Check if the User Dictionary name exists or not.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @returns {Boolean} - Exist or not User Dictionary.\n\t\t\t * @example\n\t\t\t * appInstance.isUserDictionaryExist();\n\t\t\t */\n\t\t\tisUserDictionaryExist: function() {\n\t\t\t\treturn (typeof sandbox.getOption('userDictionaryName') == 'string');\n\t\t\t},\n\t\t\t/**\n\t\t\t * Remove Spelling and Grammar nodes from the string.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @param {String} str - String with Spelling and Grammar nodes.\n\t\t\t * @returns {String} - String without Spelling and Grammar nodes.\n\t\t\t * @example\n\t\t\t * appInstance.removeMarkupFromString('<p>This is an <span class=\"spelling-problem\" data-spelling-word=\"exampl\" data-spelling-lang=\"en_US\">exampl</span> of a sentence with one misspelled word.</p>'); // \"<p>This is an exampl of a sentence with one misspelled word.</p>\"\n\t\t\t */\n\t\t\tremoveMarkupFromString: function(str) {\n\t\t\t\treturn sandbox.removeMarkupFromString(str);\n\t\t\t},\n\t\t\t/**\n\t\t\t * Get a path to the logo.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @returns {String} - Path to the logo.\n\t\t\t * @example\n\t\t\t * appInstance.getLogo();\n\t\t\t */\n\t\t\tgetLogo: function() {\n\t\t\t\treturn sandbox.getOption('basePath') + sandbox.getOption('wscLogo');\n\t\t\t},\n\t\t\t/**\n\t\t\t * Get a version.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @returns {String} - version.\n\t\t\t * @example\n\t\t\t * appInstance.getVersion();\n\t\t\t */\n\t\t\tgetVersion: function() {\n\t\t\t\treturn sandbox.getOption('wscVersion');\n\t\t\t},\n\t\t\t/**\n\t\t\t * Get baranding info.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @returns {Object} - Object with baranding fields.\n\t\t\t * @example\n\t\t\t * appInstance.getBrandingInfo();\n\t\t\t */\n\t\t\tgetBrandingInfo: function() {\n\t\t\t\treturn {\n\t\t\t\t\twscSupportUrl: sandbox.getOption('wscSupportUrl')\n\t\t\t\t};\n\t\t\t},\n\t\t\t/**\n\t\t\t * Check if a passed node is a Spelling node.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @param {Node} node - DOM node.\n\t\t\t * @returns {Boolean} - Is passed node Spelling node.\n\t\t\t * @example\n\t\t\t * var node = document.getElementById('someId');\n\t\t\t * appInstance.isSpellingNode(node);\n\t\t\t */\n\t\t\tisSpellingNode: function(node) {\n\t\t\t\tvar spellingAttrName = sandbox.getOption('data_attribute_name');\n\n\t\t\t\treturn Utils.isEqualNode(node, spellingAttrName);\n\t\t\t},\n\t\t\t/**\n\t\t\t * Check if a passed node is a Grammar node.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @param {Node} node - DOM node.\n\t\t\t * @returns {Boolean} - Is passed node Grammar node.\n\t\t\t * @example\n\t\t\t * var node = document.getElementById('someId');\n\t\t\t * appInstance.isGrammarNode(node);\n\t\t\t */\n\t\t\tisGrammarNode: function(node) {\n\t\t\t\tvar grammarAttrName = sandbox.getOption('problem_grammar_data_attribute');\n\n\t\t\t\treturn Utils.isEqualNode(node, grammarAttrName);\n\t\t\t},\n\t\t\t/**\n\t\t\t * Find a Spelling node in the array of nodes.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @param {Array} nodeArr - Array of the DOM nodes.\n\t\t\t * @returns {Node|Null} - Spelling node or null.\n\t\t\t * @example\n\t\t\t * var node1 = document.getElementById('someId1');\n\t\t\t * var node2 = document.getElementById('someId2');\n\t\t\t * appInstance.findSpellingNode([node1, node2]);\n\t\t\t */\n\t\t\tfindSpellingNode: function(nodeArr) {\n\t\t\t\tfor (var i = 0; i < nodeArr.length; i++) {\n\t\t\t\t\tif ( this.isSpellingNode(nodeArr[i]) ) {\n\t\t\t\t\t\treturn nodeArr[i];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t},\n\t\t\t/**\n\t\t\t * Add handler for markup callback (backward compatibility for CKEditor).\n\t\t\t *\n\t\t\t * @private\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @param {Function} callback - Callback function.\n\t\t\t * @example\n\t\t\t * appInstance.addMarkupHandler(function() { //Code });\n\t\t\t */\n\t\t\taddMarkupHandler: function(callback) {\n\t\t\t\tmarkupHandlerCallback = callback;\n\t\t\t},\n\t\t\t/**\n\t\t\t * Set the markup mechanism to pause/unpause.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @param {Boolean} flag - Flag: If the flag equals 'true' - set the markup mechanism on pause, 'false' - unpause.\n\t\t\t * @example\n\t\t\t * appInstance.setMarkupPaused(true);\n\t\t\t */\n\t\t\tsetMarkupPaused: function(flag) {\n\t\t\t\tsandbox.setMarkupPaused(flag);\n\t\t\t},\n\t\t\t/**\n\t\t\t * Subscribe to event.\n\t\t\t *\n\t\t\t * @private\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @param {String} event - Event name.\n\t\t\t * @param {Function} callback - Callback function.\n\t\t\t * @example\n\t\t\t * appInstance.subscribe('eventName', function() { //Code });\n\t\t\t */\n\t\t\tsubscribe: function(event, callback) {\n\t\t\t\tsandbox.subscribe(event, callback);\n\t\t\t},\n\t\t\t/**\n\t\t\t * Fire event.\n\t\t\t *\n\t\t\t * @private\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @param {String} event - Event name.\n\t\t\t * @param {Object} data - Event data.\n\t\t\t * @example\n\t\t\t * appInstance.fire('eventName', {});\n\t\t\t */\n\t\t\tfire: function(event, data) {\n\t\t\t\tsandbox.fire(event, data);\n\t\t\t},\n\t\t\t/**\n\t\t\t * Returns lang list attribute name.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @returns {String} - Lang list attribute name.\n\t\t\t * @example\n\t\t\t * appInstance.getLangAttribute(); // 'data-wsc-lang'\n\t\t\t */\n\t\t\tgetLangAttribute: function() {\n\t\t\t\treturn sandbox.getOption('data_lang_attribute');\n\t\t\t},\n\t\t\t/**\n\t\t\t * Get a User Dictionary.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @param {String} userDictionaryName - User dictionary name.\n\t\t\t * @param {Function} callback - Callback function.\n\t\t\t * Receive User Dictionary Object.\n\t\t\t * @example\n\t\t\t * appInstance.getUserDictionary('userDictionaryName', function(userDictionary) {\n\t\t\t *      console.log(userDictionary.wordlist)\n\t\t\t * });\n\t\t\t */\n\t\t\tgetUserDictionary: function(userDictionaryName, callback) {\n\t\t\t\tsandbox.fire('getUserDictionary', {name: userDictionaryName, callback: callback});\n\t\t\t},\n\t\t\t/**\n\t\t\t * Show banner.\n\t\t\t *\n\t\t\t * @private\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @param {String} contextMenuContainerSelector - Context menu container selector.\n\t\t\t * @example\n\t\t\t * appInstance.showBanner('contextMenuContainerSelector');\n\t\t\t */\n\t\t\tshowBanner: function(contextMenuContainerSelector) {\n\t\t\t\tsandbox.fire('showBanner', {contextMenuContainerSelector: contextMenuContainerSelector});\n\t\t\t},\n\t\t\t/**\n\t\t\t * Hide banner.\n\t\t\t *\n\t\t\t * @private\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @example\n\t\t\t * appInstance.hideBanner();\n\t\t\t */\n\t\t\thideBanner: function() {\n\t\t\t\tsandbox.fire('hideBanner', {});\n\t\t\t},\n\t\t\t/**\n\t\t\t * Get problem description.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @param {String} grammarPhrase - Phrase.\n\t\t\t * @param {String} rule - Rule.\n\t\t\t * @param {String} lang - Language.\n\t\t\t * @returns {String} - Problem description.\n\t\t\t * @example\n\t\t\t * appInstance.getProblemDescriptionText('an examples', 'A_PLURAL', 'en_US');\n\t\t\t */\n\t\t\tgetProblemDescriptionText: function(grammarPhrase, rule, lang) {\n\t\t\t\tvar grammarDictionary = CORE.GrammarDictionaryManager && CORE.GrammarDictionaryManager.Dictionary;\n\n\t\t\t\tif (!grammarDictionary) {\n\t\t\t\t\treturn ''\n\t\t\t\t};\n\n\t\t\t\treturn grammarDictionary.getProblemDescription(grammarPhrase, rule, lang);\n\t\t\t},\n\t\t\t/**\n\t\t\t * Returns first node with passed char.\n\t\t\t *\n\t\t\t * @private\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @param {Node} node - Node.\n\t\t\t * @param {String} contextMenuContainerSelector - Context menu container selector.\n\t\t\t * @returns {Node} - First node with passed char.\n\t\t\t * @example\n\t\t\t * appInstance.findNodeWithChar();\n\t\t\t */\n\t\t\tfindNodeWithChar: function(node, char) {\n\t\t\t\treturn sandbox.Utils.findFirstNodeWithString(node, char.charCode);\n\t\t\t},\n\t\t\t/**\n\t\t\t * Returns attributes and classes names.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @returns {Object} - Object with attributes and classes names.\n\t\t\t * @example\n\t\t\t * appInstance.getAttributeInfo();\n\t\t\t */\n\t\t\tgetAttributeInfo: function() {\n\t\t\t\treturn {\n\t\t\t\t\tdata_attribute_name: sandbox.getOption('data_attribute_name'),\n\t\t\t\t\tmisspelled_word_class: sandbox.getOption('misspelled_word_class'),\n\t\t\t\t\tproblem_grammar_data_attribute: sandbox.getOption('problem_grammar_data_attribute'),\n\t\t\t\t\tproblem_grammar_class: sandbox.getOption('problem_grammar_class')\n\t\t\t\t};\n\t\t\t},\n\t\t\t/**\n\t\t\t * Returns information about banner state (enable/disable).\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @returns {Boolean} - Banner state (enable/disable).\n\t\t\t * @example\n\t\t\t * appInstance.isBannerEnable();\n\t\t\t */\n\t\t\tisBannerEnable: function() {\n\t\t\t\treturn sandbox.getOption('banner');\n\t\t\t},\n\t\t\t/**\n\t\t\t * Find a Grammar node in the array of nodes.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @param {Array} nodeArr - Array of the DOM nodes.\n\t\t\t * @returns {Node|Null} - Grammar node or null.\n\t\t\t * @example\n\t\t\t * var node1 = document.getElementById('someId1');\n\t\t\t * var node2 = document.getElementById('someId2');\n\t\t\t * appInstance.findGrammarNode([node1, node2]);\n\t\t\t */\n\t\t\tfindGrammarNode: function(nodeArr) {\n\t\t\t\tfor (var i = 0; i < nodeArr.length; i++) {\n\t\t\t\t\tif ( this.isGrammarNode(nodeArr[i]) ) {\n\t\t\t\t\t\treturn nodeArr[i];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t},\n\t\t\t/**\n\t\t\t * Get a Spelling or Grammar node from the selection.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @returns {Node|Undefined} - Spelling or Grammar node or undefined.\n\t\t\t * @example\n\t\t\t * appInstance.getProblemNodeFromSelection(); // <span class=\"spelling-problem\" data-spelling-word=\"exampl\" data-spelling-lang=\"en_US\">exampl</span>\n\t\t\t */\n\t\t\tgetProblemNodeFromSelection: function() {\n\t\t\t\tvar problemNode;\n\n\t\t\t\tproblemNode = sandbox.getSpellingNodeFromSelection();\n\n\t\t\t\tif (!problemNode) {\n\t\t\t\t\tproblemNode = sandbox.getGrammarNodeFromSelection();\n\t\t\t\t}\n\n\t\t\t\treturn problemNode;\n\t\t\t},\n\t\t\t/**\n\t\t\t * Get a Custom Dictionary name.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @returns {String} - Custom Dictionary name.\n\t\t\t * @example\n\t\t\t * appInstance.getCustomDictionary(); // '1'\n\t\t\t */\n\t\t\tgetCustomDictionary: function() {\n\t\t\t\treturn sandbox.getOption('customDictionaryIds');\n\t\t\t},\n\t\t\t/**\n\t\t\t * Get a Spelling node attribute name.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @returns {String} - Spelling node attribute name.\n\t\t\t * @example\n\t\t\t * appInstance.getSpellingNodeAttributeName(); // 'data-spelling-word'\n\t\t\t */\n\t\t\tgetSpellingNodeAttributeName: function() {\n\t\t\t\treturn sandbox.getOption('data_attribute_name');\n\t\t\t},\n\t\t\t// backward compatibility for tiny plugin.\n\t\t\tgetNodeAttribute: function() {\n\t\t\t\treturn this.getSpellingNodeAttributeName();\n\t\t\t},\n\t\t\t/**\n\t\t\t * Get a Grammar node attribute name.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @returns {String} - Grammar node attribute name.\n\t\t\t * @example\n\t\t\t * appInstance.getGrammarNodeAttributeName(); // 'data-grammar-phrase'\n\t\t\t */\n\t\t\tgetGrammarNodeAttributeName: function() {\n\t\t\t\treturn sandbox.getOption('problem_grammar_data_attribute');\n\t\t\t},\n\t\t\t/**\n\t\t\t * Get a Grammar node Rule attribute name.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @returns {String} - Grammar node Rule attribute name.\n\t\t\t * @example\n\t\t\t * appInstance.getGrammarNodeRuleAttributeName(); // 'data-grammar-rule'\n\t\t\t */\n\t\t\tgetGrammarNodeRuleAttributeName: function() {\n\t\t\t\treturn sandbox.getOption('problem_grammar_data_attribute_rule');\n\t\t\t},\n\t\t\t/**\n\t\t\t * Get a container node.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @returns {Node} - container node.\n\t\t\t * @example\n\t\t\t * appInstance.getContainerNode();\n\t\t\t */\n\t\t\tgetContainerNode: function() {\n\t\t\t\treturn sandbox.getOption('container');\n\t\t\t},\n\t\t\t/**\n\t\t\t * Get localization of item.\n\t\t\t * The full list of localization items you can find by following the next steps:\n\t\t\t * - Open a browser network tab and find a local.js file;\n\t\t\t * - This file contains the full list of the localization items\n\t\t\t * @public\n\t\t\t *\n\t\t\t * @memberof AppInstance#\n\t\t\t * @param {String} itemName - name of localization item.\n\t\t\t * @example\n\t\t\t * appInstance.getLocal('btn_ignore'); // 'Ignore'\n\t\t\t */\n\t\t\tgetLocal: function(itemName) {\n\t\t\t\treturn sandbox.Localization.getLocal(itemName, sandbox.getOption('localization'));\n\t\t\t},\n\t\t\t/**\n\t\t\t * Return the information if the instance is disabled or enabled.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t* @memberof AppInstance#\n\t\t\t* @example\n\t\t\t* appInstance.isDisabled(); // if 'true' - disabled, if 'false' - enabled\n\t\t\t*/\n\t\t\tisDisabled: function() {\n\t\t\t\treturn !sandbox.getOption('appStarted');\n\t\t\t},\n\t\t\t/**\n\t\t\t * Set a instance to disabled/enabled.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t* @memberof AppInstance#\n\t\t\t* @param {Boolean} flag - Flag: If the flag equals 'true' - disable the instance, 'false' - enable the instance.\n\t\t\t* @example\n\t\t\t* appInstance.setDisabled(true);\n\t\t\t*/\n\t\t\tsetDisabled: function(flag) {\n\t\t\t\tif ( sandbox.getOption('appStarted') !== flag ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.fire('toggleApp', { flag: !flag });\n\t\t\t},\n\t\t\t/**\n\t\t\t * Get count of problems (Spelling and Grammar nodes) in the container.\n\t\t\t *\n\t\t\t * @public\n\t\t\t *\n\t\t\t* @memberof AppInstance#\n\t\t\t* @returns {Number} - Count of problems in the container.\n\t\t\t* @example\n\t\t\t* var count = appInstance.getProblemsCount();\n\t\t\t*/\n\t\t\tgetProblemsCount: function() {\n\t\t\t\treturn sandbox.getProblemsCount();\n\t\t\t},\n\t\t\t/**\n\t\t \t * Fix broken Spelling and Grammar nodes in container.\n\t\t \t *\n\t\t \t * @public\n \t\t \t *\n\t\t \t * @memberof AppInstance#\n\t\t \t * @param {Node} - Node with Spelling and Grammar nodes which should be fixed.\n\t\t \t * @example\n\t\t\t * <div contenteditable=\"true\" id=\"editor\">\n\t\t\t *     <p id=\"firsP\"><span class=\"spelling-problem\" data-spelling-word=\"Gramar\" data-wsc-lang=\"en_US\">Gramarrr</span> error.</p>\n\t\t\t *     <p id=\"secondP\">Other text.</p>\n\t\t\t * </div>\n\t\t\t *\n\t\t\t * <script>\n\t\t\t *     var container = document.getElementById('firsP');\n\t\t\t *     appInstance.fixBrokenNodes(container); // all broken Spelling and Grammar nodes will be fixed in passed container\n\t\t\t *     appInstance.fixBrokenNodes(); // all broken Spelling and Grammar nodes will be fixed in appInstance contenteditable container\n\t\t\t * </script>\n\t\t\t */\n\t\t\tfixBrokenNodes: function (container) {\n\t\t\t\tsandbox.fire('fixBrokenNodes', { container: container });\n\t\t\t},\n\t\t\t/**\n\t\t\t * Fix broken Spelling and Grammar nodes.\n\t\t\t *\n\t\t\t * @public\n\t\t\t * @deprecated Performance issues. Use {@link CORE.APP#fixBrokenNodes} API method.\n\t\t\t *\n\t\t\t* @memberof AppInstance#\n\t\t\t* @param {Node} - Node with Spelling and Grammar nodes which should be fixed.\n\t\t\t* @example\n\t\t\t* var node = document.getElementById('someId');\n\t\t\t* appInstance.fixProblemNodesInElement(node); // all broken Spelling and Grammar nodes will be fixed in passed node\n\t\t\t* appInstance.fixProblemNodesInElement(); // all broken Spelling and Grammar nodes will be fixed in parent block element with cursor\n\t\t\t*/\n\t\t\tfixProblemNodesInElement: function(node) {\n\t\t\t\tvar spellingNodesToRemove = sandbox.getBrokenSpellingNodes(node),\n\t\t\t\t\tgrammarNodesToRemove = sandbox.getBrokenGrammarNodes(node);\n\n\t\t\t\tif (spellingNodesToRemove) {\n\t\t\t\t\tsandbox.fire('removeMarkup', {nodes: spellingNodesToRemove, spelling: true});\n\t\t\t\t\tthis.reloadMarkup();\n\t\t\t\t}\n\n\t\t\t\tif (grammarNodesToRemove) {\n\t\t\t\t\tsandbox.fire('removeMarkup', {nodes: grammarNodesToRemove, grammar: true});\n\t\t\t\t\tthis.reloadMarkup();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// Add link on application instance and original element ID to sandbox\n\t\tsandbox.instance = instance;\n\t\tcontainerWithId = sandbox.getOption('isIframe') ? sandbox.getOption('documentContainer') : sandbox.getOption('originalContainer') ;\n\t\tsandbox.originalElementId = sandbox.UILib.attr( containerWithId, 'id' );\n\t\tinstance._sandbox = sandbox;\n\t\tinstance._getService = function(serviceName) {\n\t\t\treturn core.getService(serviceName);\n\t\t};\n\n\t\tif (core.allModulesReady) {\n\t\t\trunSuccessCallback(instance);\n\t\t}\n\n\t\treturn instance;\n\t};\n\n})();\n\n/**\n * Setting that switches possibility to remove required UI from the view via initialization options.\n * E.g.: dialog tab 'About us'.\n * @type {boolean}\n * @static\n */\nif (typeof WEBSPELLCHECKER.CORE.includeRequiredUI === 'undefined') {\n\tWEBSPELLCHECKER.CORE.includeRequiredUI = true;\n}\n\n// dictionarymanager.js\r\n/**\r\n * @fileoverview of CORE dictionary manager.\r\n */\r\n\r\n(function( exports ) {\r\n\t'use strict';\r\n\r\n\tvar Utils, UILib;\r\n\r\n\t// make sure that we declaring DictionaryManager only once\r\n\tif(exports.DictionaryManager) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t/**\r\n\t * Represents DictionaryManager Module.\r\n\t *\r\n\t * @constructor\r\n\t * @alias CORE.DictionaryManager\r\n\t * @param {String} moduleID\r\n\t * @param {CORE.Sandbox} sandbox\r\n\t */\r\n\tvar DictionaryManager = function(moduleID, sandbox) {\r\n\t\t/**\r\n\t\t * Module name.\r\n\t\t *\r\n\t\t * @type {String}\r\n\t\t*/\r\n\t\tthis.name = moduleID;\r\n\r\n\t\t/**\r\n\t\t * Reference to EventProxy module sandbox.\r\n\t\t *\r\n\t\t * @type {CORE.Sandbox}\r\n\t\t */\r\n\t\tthis.sandbox = sandbox;\r\n\r\n\t\t/**\r\n\t\t * Indicate if cache available.\r\n\t\t *\r\n\t\t * @type {CORE.Sandbox}\r\n\t\t */\r\n\t\tthis.isCacheAvailable = sandbox.isCacheAvailable();\r\n\r\n\t\tUtils = this.sandbox.Utils;\r\n\t\tUILib = this.sandbox.UILib;\r\n\r\n\t\tthis.userDictionaryManager = new DictionaryManager.UserDictionaryManager(this.sandbox);\r\n\t};\r\n\r\n\tDictionaryManager.wordStatus = {\r\n\t\tunknown \t\t: 0,\r\n\t\tmisspelled \t\t: 1,\r\n\t\tignored \t\t: 2,\r\n\t\tinprocess \t\t: 3,\r\n\t\tcorrect \t\t: 4,\r\n\t\tuserDictionary \t: 5,\r\n\t\tuserIgnore \t\t: 6\r\n\t};\r\n\r\n\tDictionaryManager.userDictionaryActionsMap = {\r\n\t\tcreateUserDictionary: 'create',\r\n\t\trestoreUserDictionary: 'restore',\r\n\t\trenameUserDictionary: 'rename',\r\n\t\tremoveUserDictionary: 'remove',\r\n\t\tdisconnectFromUserDictionary: 'disconnect',\r\n\t\taddWordToUserDictionary: 'addWord',\r\n\t\tdeleteWordFromUserDictionary: 'deleteWord'\r\n\t};\r\n\r\n\tDictionaryManager.prototype = {\r\n\t\t/**\r\n\t\t * Called after each registration in core.\r\n\t\t *\r\n\t\t * @memberof CORE.DictionaryManager#\r\n\t\t */\r\n\t\tinit: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tthis.sandbox.subscribe('wordsCollected, problemsCollected', function(data) {\r\n\t\t\t\tif (data.wordsCollection) {\r\n\t\t\t\t\tthis.wordsCollectedHandler(data.wordsCollection);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\r\n\t\t\tthis.sandbox.subscribe('getUserDictionaryName', function(data) {\r\n\t\t\t\tthis.userDictionaryManager.getUserDictionaryName(data);\r\n\t\t\t});\r\n\r\n\t\t\tthis.sandbox.subscribe('getUserDictionary', function(data) {\r\n\t\t\t\tthis.userDictionaryManager.getUserDictionary(data);\r\n\t\t\t});\r\n\r\n\t\t\tthis.sandbox.subscribe('createUserDictionary', function(data) {\r\n\t\t\t\tdata.action = DictionaryManager.userDictionaryActionsMap['createUserDictionary'];\r\n\t\t\t\tthis.userDictionaryManager.createUserDictionary(data);\r\n\t\t\t});\r\n\r\n\t\t\tthis.sandbox.subscribe('restoreUserDictionary', function(data) {\r\n\t\t\t\tvar orignalSuccess = data.onSuccess || function() {},\r\n\t\t\t\t\tself = this;\r\n\r\n\t\t\t\tdata.onSuccess = function(response) {\r\n\t\t\t\t\torignalSuccess(response);\r\n\t\t\t\t\tself.userDictionaryStateRestoredHandler(response);\r\n\t\t\t\t}\r\n\t\t\t\tdata.action = DictionaryManager.userDictionaryActionsMap['restoreUserDictionary'];\r\n\t\t\t\tthis.userDictionaryManager.getUserDictionaryFromServer(data);\r\n\t\t\t});\r\n\r\n\t\t\tthis.sandbox.subscribe('renameUserDictionary', function(data) {\r\n\t\t\t\tdata.action = DictionaryManager.userDictionaryActionsMap['renameUserDictionary'];\r\n\t\t\t\tthis.userDictionaryManager.renameUserDictionary(data);\r\n\t\t\t});\r\n\r\n\t\t\tthis.sandbox.subscribe('removeUserDictionary', function(data) {\r\n\t\t\t\tdata.action = DictionaryManager.userDictionaryActionsMap['removeUserDictionary'];\r\n\t\t\t\tthis.userDictionaryManager.removeUserDictionary(data);\r\n\t\t\t});\r\n\r\n\t\t\tthis.sandbox.subscribe('disconnectFromUserDictionary', function(data) {\r\n\t\t\t\tdata.action = DictionaryManager.userDictionaryActionsMap['disconnectFromUserDictionary'];\r\n\t\t\t\tthis.userDictionaryManager.disconnectFromUserDictionary(data);\r\n\t\t\t});\r\n\r\n\t\t\tthis.sandbox.subscribe('setUserDictionaryName', function(data) {\r\n\t\t\t\tthis.userDictionaryManager.setUserDictionaryName(data.name);\r\n\t\t\t});\r\n\r\n\t\t\tthis.sandbox.subscribe('userDictionaryChanged', function(data) {\r\n\t\t\t\tthis.userDictionaryManager.syncUserDictionaryName(data);\r\n\t\t\t});\r\n\r\n\t\t\tthis.sandbox.subscribe('userDictionaryStateChanged', function(data) {\r\n\t\t\t\tthis.userDictionaryStateChangedHandler();\r\n\t\t\t});\r\n\r\n\t\t\tthis.sandbox.subscribe('userDictionaryStateRestored', function(data) {\r\n\t\t\t\tthis.userDictionaryStateRestoredHandler(data);\r\n\t\t\t});\r\n\r\n\t\t\tthis.sandbox.subscribe('addWordToUserDictionary', function(data) {\r\n\t\t\t\tdata.action = DictionaryManager.userDictionaryActionsMap['addWordToUserDictionary'];\r\n\t\t\t\tthis.addWordToUserDictionaryHandler(data);\r\n\t\t\t});\r\n\r\n\t\t\tthis.sandbox.subscribe('deleteWordFromUserDictionary', function(data) {\r\n\t\t\t\tdata.action = DictionaryManager.userDictionaryActionsMap['deleteWordFromUserDictionary'];\r\n\t\t\t\tthis.userDictionaryManager.deleteWordFromUserDictionary(data);\r\n\t\t\t});\r\n\r\n\t\t\tthis.sandbox.subscribe('getSuggestionsList', function(event) {\r\n\t\t\t\tvar spellingAttrName = self.sandbox.getOption('data_attribute_name'),\r\n\t\t\t\t\tproblemNode = event.problemNode,\r\n\t\t\t\t\tword = event.word,\r\n\t\t\t\t\tsuggestionList;\r\n\r\n\t\t\t\tif(problemNode) {\r\n\t\t\t\t\tword = word ||\tUILib.attr(problemNode, spellingAttrName);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsuggestionList = this.getSuggestionsListHandler( word, self.sandbox.getOption('lang') ).suggestionList;\r\n\t\t\t\tevent.setReturnedData({\r\n\t\t\t\t\tsuggestionList: suggestionList\r\n\t\t\t\t});\r\n\t\t\t}, this);\r\n\r\n\t\t\tthis.sandbox.subscribe('optionsCommited', function(data) {\r\n\t\t\t\tthis.optionsCommitedHandler(data);\r\n\t\t\t}, this);\r\n\r\n\t\t\tthis.sandbox.subscribe({\r\n\t\t\t\teventType: 'unload',\r\n\t\t\t\telement: window,\r\n\t\t\t\thandler: this.saveCache\r\n\t\t\t});\r\n\r\n\t\t\tthis.restoreCache();\r\n\t\t\tthis.setCacheState({\r\n\t\t\t\tcacheSize: this.sandbox.getOption('cacheSize'),\r\n\t\t\t\tprogramVersion: this.sandbox.getOption('programVersion')\r\n\t\t\t});\r\n\t\t},\r\n\t\t/**\r\n\t\t * Save cache\r\n\t\t * @memberof CORE.DictionaryManager#\r\n\t\t */\r\n\t\tsaveCache: function() {\r\n\t\t\tthis.isCacheAvailable && DictionaryManager.Cache.saveCache();\r\n\t\t},\r\n\t\t/**\r\n\t\t * Restore cache\r\n\t\t * @memberof CORE.DictionaryManager#\r\n\t\t */\r\n\t\trestoreCache: function() {\r\n\t\t\tthis.isCacheAvailable && DictionaryManager.Cache.restoreCache();\r\n\t\t},\r\n\t\t/**\r\n\t\t * Set cache state\r\n\t\t * @memberof CORE.DictionaryManager#\r\n\t\t */\r\n\t\tsetCacheState: function(data) {\r\n\t\t\tthis.isCacheAvailable && DictionaryManager.Cache.setState(data);\r\n\t\t},\r\n\t\t/**\r\n\t\t * Get word from cache\r\n\t\t *\r\n\t\t * @memberof CORE.DictionaryManager#\r\n\t\t * @param {String} word - Word\r\n\t\t * @param {String} lang - Language\r\n\t\t */\r\n\t\tgetCachedWord: function(word, lang) {\r\n\t\t\treturn this.isCacheAvailable && DictionaryManager.Cache.getWord(word, lang);\r\n\t\t},\r\n\t\t/**\r\n\t\t * Add word to cache\r\n\t\t *\r\n\t\t * @memberof CORE.DictionaryManager#\r\n\t\t * @param {Object} word - Word\r\n\t\t * @param {String} lang - Language\r\n\t\t */\r\n\t\taddWordToCache: function(word, lang) {\r\n\t\t\tthis.isCacheAvailable && DictionaryManager.Cache.addWord(word, lang);\r\n\t\t},\r\n\t\t/**\r\n\t\t * Subscribe function for 'wordsCollected' event\r\n\t\t *\r\n\t\t * @memberof CORE.DictionaryManager#\r\n\t\t * @param {Object} wordsCollection \t- Colection of words\r\n\t\t */\r\n\t\twordsCollectedHandler: function(wordsCollection) {\r\n\t\t\tvar addedWords, unknownWords;\r\n\r\n\t\t\tfor(var lang in wordsCollection.detectedLanguages) {\r\n\t\t\t\taddedWords = this.addWordsToDictionary(wordsCollection.words, lang);\r\n\t\t\t\tunknownWords = this.getUnknownWords(lang);\r\n\t\t\t\tthis.getWordsInfo(unknownWords, lang);\r\n\t\t\t\tthis.processWithTimeout(addedWords.misspelled, lang);\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t * Subscribe function for 'optionsCommited' event\r\n\t\t *\r\n\t\t * @memberof CORE.DictionaryManager#\r\n\t\t * @param {Object} data - Event data\r\n\t\t */\r\n\t\toptionsCommitedHandler: function(data) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tlang = this.sandbox.getOption('lang'),\r\n\t\t\t\tuid = this.sandbox.getOption('uid'),\r\n\t\t\t\tdictionary = DictionaryManager.Dictionary,\r\n\t\t\t\tignoredWords = [];\r\n\r\n\t\t\tdictionary.each(lang, function(wordObject) {\r\n\t\t\t\tif ( wordObject.existsInInstance(uid) ) {\r\n\t\t\t\t\tself.setIgnoredStateIfRequired(wordObject);\r\n\r\n\t\t\t\t\tif ( wordObject.getStatus(uid) == DictionaryManager.wordStatus.ignored ) {\r\n\t\t\t\t\t\tignoredWords.push(wordObject);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tthis.getWordsInfo( this.getUnknownWords(lang), lang );\r\n\t\t\tthis.processIgnoredWords(ignoredWords, lang);\r\n\t\t},\r\n\t\t/**\r\n\t\t * Subscribe function for 'userDictionaryStateChanged' event\r\n\t\t *\r\n\t\t * @memberof CORE.DictionaryManager#\r\n\t\t */\r\n\t\tuserDictionaryStateChangedHandler: function() {\r\n\t\t\tvar dictionary = this.Dictionary,\r\n\t\t\t\tudWordsFromDictionary = this.getUdWordsFromDictionary();\r\n\r\n\t\t\tfor(var i = 0; i < udWordsFromDictionary.length; i++) {\r\n\t\t\t\tudWordsFromDictionary[i].setStatusForAllInstances(DictionaryManager.wordStatus.unknown);\r\n\t\t\t}\r\n\r\n\t\t\tthis.sandbox.fireInAllApps('startSpellCheck');\r\n\t\t\tthis.sandbox.fireInAllApps('startProblemsCheck');\r\n\t\t},\r\n\t\t/**\r\n\t\t * Subscribe function for 'addWordToUserDictionary' event\r\n\t\t *\r\n\t\t * @memberof CORE.DictionaryManager#\r\n\t\t * @param {String} data - Event data\r\n\t\t */\r\n\t\taddWordToUserDictionaryHandler: function(data) {\r\n\t\t\tvar data_attribute_name = this.sandbox.getOption('data_attribute_name'),\r\n\t\t\t\tcontainer = this.sandbox.getOption('container'),\r\n\t\t\t\twords = [],\r\n\t\t\t\tspellingNode;\r\n\r\n\t\t\tspellingNode = data.spellingNode ? data.spellingNode : this.sandbox.getSpellingNodeFromSelection();\r\n\r\n\t\t\tif (data.word) {\r\n\t\t\t\tthis.userDictionaryManager.addWordToUserDictionary(data);\r\n\t\t\t} else if ( spellingNode && container.contains(spellingNode) ) {\r\n\t\t\t\tdata.word = spellingNode.getAttribute(data_attribute_name);\r\n\t\t\t\tthis.userDictionaryManager.addWordToUserDictionary(data);\r\n\t\t\t}\r\n\r\n\t\t\tif (data.word) {\r\n\t\t\t\t// We need to remove markup from capitalized word\r\n\t\t\t\tif ( Utils.isLowercaseLetter(data.word[0]) ) {\r\n\t\t\t\t\twords.push({\r\n\t\t\t\t\t\tword: Utils.capitalizeFirstLetter(data.word)\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\twords.push({\r\n\t\t\t\t\tword: data.word\r\n\t\t\t\t});\r\n\t\t\t\tthis.sandbox.fireInAllApps('removeMarkupFromWords', { words: words });\r\n\t\t\t\tthis.sandbox.fireInAllApps('removeMarkupFromProblems', { problems: words, problemType: 'spelling' });\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t * Subscribe function for 'getSuggestionsList' event\r\n\t\t *\r\n\t\t * @param {String} word \t- Word.\r\n\t\t * @param {String} lang \t- Dictionary language.\r\n\t\t * @memberof CORE.DictionaryManager#\r\n\t\t */\r\n\t\tgetSuggestionsListHandler: function (word, lang) {\r\n\t\t\tvar wordObject = this.getWordFromDictionary(word, lang),\r\n\t\t\t\tresult = {suggestionList: wordObject ? wordObject.suggestions : []};\r\n\r\n\t\t\tthis.sandbox.fire('suggestionListSend', result);\r\n\r\n\t\t\treturn result;\r\n\t\t},\r\n\t\t/**\r\n\t\t * Subscribe function for 'userDictionaryStateRestored' event\r\n\t\t *\r\n\t\t * @memberof CORE.DictionaryManager#\r\n\t\t */\r\n\t\tuserDictionaryStateRestoredHandler: function(userDictionaryObject) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tudWordsFromDictionary = this.getUdWordsFromDictionary(),\r\n\t\t\t\tuserDictionaryName = this.sandbox.getOption('userDictionaryName'),\r\n\t\t\t\tdictionary = DictionaryManager.Dictionary,\r\n\t\t\t\twords = userDictionaryObject.wordlist,\r\n\t\t\t\tudModificationTime = userDictionaryObject.udModificationTime || 0,\r\n\t\t\t\twordsFromDictionary, wordsLength;\r\n\r\n\t\t\t// we need to set 'unknown' status to all words from 'Dictionary' object with status 'userDictionary'\r\n\t\t\tfor(var i = 0; i < udWordsFromDictionary.length; i++) {\r\n\t\t\t\tudWordsFromDictionary[i].setStatusForAllInstances(DictionaryManager.wordStatus.unknown);\r\n\t\t\t}\r\n\r\n\t\t\t// we need to set 'unknown' status to all user dictionary words that came from server\r\n\t\t\tfor (i = 0, wordsLength = words.length; i < wordsLength; i++) {\r\n\t\t\t\twordsFromDictionary = dictionary.getAllWordsByName(words[i]);\r\n\r\n\t\t\t\tif(wordsFromDictionary.length > 0) {\r\n\t\t\t\t\tfor(var j = 0; j < wordsFromDictionary.length; j++) {\r\n\t\t\t\t\t\twordsFromDictionary[j].setStatusForAllInstances(DictionaryManager.wordStatus.unknown);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.userDictionaryManager.clearCache();\r\n\t\t\tthis.userDictionaryManager.setCacheState({ udModificationTime: udModificationTime });\r\n\r\n\t\t\t// we need to fire this events right after we got new information from the server\r\n\t\t\t// to take into account words with newly updated statuses\r\n\t\t\tself.sandbox.fireInAllApps('removeMarkupInDocument');\r\n\t\t\tself.sandbox.fireInAllApps('removeMarkupInContainer');\r\n\t\t\tself.sandbox.fireInAllApps('startSpellCheck');\r\n\t\t\tself.sandbox.fireInAllApps('startGrammarCheck');\r\n\t\t\tself.sandbox.fireInAllApps('startProblemsCheck');\r\n\t\t},\r\n\t\t/**\r\n\t\t * @memberof CORE.DictionaryManager#\r\n\t\t *\r\n\t\t * @param {String} word \t- Word.\r\n\t\t * @param {String} lang \t- Dictionary language.\r\n\t\t *\r\n\t\t * @returns {object}  - Word from CORE.DictionaryManager.Dictionary.\r\n\t\t */\r\n\t\tgetWordFromDictionary: function(word, lang) {\r\n\t\t\tvar dictionary = DictionaryManager.Dictionary;\r\n\r\n\t\t\treturn dictionary.getWord(word, lang);\r\n\t\t},\r\n\t\t/**\r\n\t\t * @memberof CORE.DictionaryManager#\r\n\t\t * @param {Object} wordsCollection \t- Colection of words\r\n\t\t * @param {String} lang \t\t\t- wordsCollection words language\r\n\t\t *\r\n\t\t * @returns { { unknown: array<CORE.DictionaryManager.Word>, misspelled: array<CORE.DictionaryManager.Word>, ignored: array<CORE.DictionaryManager.Word>} }\r\n\t\t */\r\n\t\taddWordsToDictionary: function(wordsCollection, lang) {\r\n\t\t\t// get or create dictionary with application language\r\n\t\t\tvar dictionary = DictionaryManager.Dictionary;\r\n\t\t\tvar uid = this.sandbox.getOption('uid');\r\n\t\t\tvar customDictionary = this.sandbox.getOption('customDictionaryIds') || '';\r\n\t\t\tvar _addedWords = {\r\n\t\t\t\tmisspelled: []\r\n\t\t\t};\r\n\r\n\t\t\tfor(var wordKey in wordsCollection) {\r\n\t\t\t\tvar word = wordsCollection[wordKey].word,\r\n\t\t\t\t\twordObject = dictionary.getWord(word, lang);\r\n\r\n\t\t\t\tif(!wordObject) {\r\n\t\t\t\t\twordObject = dictionary.addWord(word, lang);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(wordObject.existsInInstance(uid) == false) {\r\n\t\t\t\t\twordObject.addToInstance(uid);\r\n\t\t\t\t\twordObject.addCustomDictionariesInInstance(customDictionary, uid);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.setIgnoredStateIfRequired(wordObject);\r\n\r\n\t\t\t\t// If we have different combination of the custom dictionaries\r\n\t\t\t\t// for curent instance and other instances and word have status 'inprocess'\r\n\t\t\t\t// we should gets additional word info from server for this instance.\r\n\t\t\t\t// So we set word status to 'unknown'.\r\n\t\t\t\tif (wordObject.getStatus(uid) === DictionaryManager.wordStatus.inprocess && wordObject.isNeedGetWordInfo(uid)) {\r\n\t\t\t\t\twordObject.setStatus(DictionaryManager.wordStatus.unknown, uid);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(wordObject.getStatus(uid) == DictionaryManager.wordStatus.misspelled) {\r\n\t\t\t\t\t_addedWords.misspelled.push(wordObject);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn _addedWords;\r\n\t\t},\r\n\t\t/**\r\n\t\t * @memberof CORE.DictionaryManager#\r\n\t\t * @param {Object} wordObject - Word object.\r\n\t\t */\r\n\t\tsetIgnoredStateIfRequired: function(wordObject) {\r\n\t\t\tvar uid = this.sandbox.getOption('uid');\r\n\r\n\t\t\t// Reset ignored word to unknown state (needs when option is in disabled state after switching)\r\n\t\t\tif ( wordObject.getStatus(uid) === DictionaryManager.wordStatus.ignored ) {\r\n\t\t\t\twordObject.resetStatus(uid);\r\n\t\t\t}\r\n\r\n\t\t\tif ( this.sandbox.getOption('ignoreAllCapsWords') === true ) {\r\n\t\t\t\t// We should check word in upper case and lower case\r\n\t\t\t\t// because some languages does not have capital letter\r\n\t\t\t\tif ( ( wordObject.word.toUpperCase() !== wordObject.word.toLowerCase() ) && ( wordObject.word === wordObject.word.toUpperCase() ) ) {\r\n\t\t\t\t\twordObject.setStatus(DictionaryManager.wordStatus.ignored, uid);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ( this.sandbox.getOption('ignoreWordsWithMixedCases') === true ) {\r\n\t\t\t\tif ( ( wordObject.word == wordObject.word.toLowerCase() === false ) && ( wordObject.word === wordObject.word.toUpperCase() === false ) ) {\r\n\t\t\t\t\tif ( !( ( wordObject.word.split('')[0] === wordObject.word.split('')[0].toUpperCase() ) && ( wordObject.word.split('').slice(1).join('') === wordObject.word.split('').slice(1).join('').toLowerCase() ) ) ) {\r\n\t\t\t\t\t\twordObject.setStatus(DictionaryManager.wordStatus.ignored, uid);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ( this.sandbox.getOption('ignoreWordsWithNumbers') === true ) {\r\n\t\t\t\tif ( wordObject.word.replace(/*REG_REPLACE*//[0-9]/g, '') !== wordObject.word ) {\r\n\t\t\t\t\twordObject.setStatus(DictionaryManager.wordStatus.ignored, uid);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ( this.sandbox.getOption('ignoreDomainNames') === true ) {\r\n\t\t\t\tif ( wordObject.word.replace(/*REG_REPLACE*//\\./g, '') !== wordObject.word ) {\r\n\t\t\t\t\twordObject.setStatus(DictionaryManager.wordStatus.ignored, uid);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t * @memberof CORE.DictionaryManager#\r\n\t\t * @param {String} lang \t- Dictionary language.\r\n\t\t * @param {Number} status \t- CORE.DictionaryManager#wordStatus identifier\r\n\t\t *\r\n\t\t * @returns {array<CORE.DictionaryManager.Word>}  - Array of CORE.DictionaryManager.Word's.\r\n\t\t */\r\n\t\tgetWordsFromDictionaryByStatus: function(lang, status) {\r\n\t\t\tvar uid = this.sandbox.getOption('uid'),\r\n\t\t\t\tdictionary = DictionaryManager.Dictionary;\r\n\r\n\t\t\treturn dictionary.getWordsFromDictionaryByStatus(lang, uid, status);\r\n\t\t},\r\n\t\t/**\r\n\t\t * @memberof CORE.DictionaryManager#\r\n\t\t * @param {String} lang \t- Dictionary language.\r\n\t\t *\r\n\t\t * @returns {Array<CORE.DictionaryManager.Word>}  - Array of CORE.DictionaryManager.Word's with status = 'unknown'.\r\n\t\t */\r\n\t\tgetUnknownWords: function(lang) {\r\n\t\t\tvar _unknownWords = this.getWordsFromDictionaryByStatus(lang, DictionaryManager.wordStatus.unknown);\r\n\r\n\t\t\treturn _unknownWords;\r\n\t\t},\r\n\t\t/**\r\n\t\t * @memberof CORE.DictionaryManager#\r\n\t\t * @param {String} lang \t- Dictionary language.\r\n\t\t *\r\n\t\t * @returns {array<CORE.DictionaryManager.Word>}  - Array of CORE.DictionaryManager.Word's with status = 'misspelled'.\r\n\t\t */\r\n\t\tgetMisspelledWords: function(lang) {\r\n\t\t\tvar _misspelledWords = this.getWordsFromDictionaryByStatus(lang, DictionaryManager.wordStatus.misspelled);\r\n\r\n\t\t\treturn _misspelledWords;\r\n\t\t},\r\n\t\t/**\r\n\t\t * @memberof CORE.DictionaryManager#\r\n\t\t *\r\n\t\t * Get words from Dictionary with userDictionary status\r\n\t\t *\r\n\t\t * @returns {array<CORE.DictionaryManager.Word>}  - Array of CORE.DictionaryManager.Word's with status = 'userDictionary'.\r\n\t\t */\r\n\t\tgetUdWordsFromDictionary: function() {\r\n\t\t\tvar dictionary = DictionaryManager.Dictionary;\r\n\r\n\t\t\treturn dictionary.getAllWordsByStatus(DictionaryManager.wordStatus.userDictionary);\r\n\t\t},\r\n\t\t/**\r\n\t\t * @memberof CORE.DictionaryManager#\r\n\t\t * @param {Array<CORE.DictionaryManager.Word>} ignoredWords \t- Array of ignored words.\r\n\t\t * @param {String} lang \t\t\t\t\t\t\t\t\t\t- Words language.\r\n\t\t *\r\n\t\t * @fires CORE.Communication#removeMarkupFromWords\r\n\t\t */\r\n\t\tprocessIgnoredWords: function(ignoredWords, lang) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tthis.sandbox.addDeferredFunction('processIgnoredWordsForLang_' + lang, {\r\n\t\t\t\tdelay: 100,\r\n\t\t\t\tcollection: ignoredWords,\r\n\t\t\t\tpartialItemsCount: 100,\r\n\t\t\t\tdefferedFunctionArgs: [lang],\r\n\t\t\t\tdeferredFunction: function(words, lang) {\r\n\t\t\t\t\tself.sandbox.fire('removeMarkupFromWords', {words: words});\r\n\t\t\t\t\tself.sandbox.fire('removeMarkupFromProblems', {problems: words, problemType: 'spelling'});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t/**\r\n\t\t * @memberof CORE.DictionaryManager#\r\n\t\t * @param {Array<CORE.DictionaryManager.Word>} wordsToMarkup \t- Array of misspelled words.\r\n\t\t * @param {String} lang \t\t\t\t\t\t\t\t\t\t- Words language.\r\n\t\t *\r\n\t\t * @fires CORE.Communication#misspelledWordsFound\r\n\t\t */\r\n\t\tprocessWithTimeout: function(wordsToMarkup, lang) {\r\n\t\t\t// this functions will create (for each two words form 'wordsToMarkup' collection)\r\n\t\t\t// deferred function to fire 'misspelledWordsFound' event\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tthis.sandbox.addDeferredFunction('processWordsForLang_' + lang, {\r\n\t\t\t\tdelay: 100,\r\n\t\t\t\tcollection: wordsToMarkup,\r\n\t\t\t\tpartialItemsCount: 2,\r\n\t\t\t\tdefferedFunctionArgs: [lang],\r\n\t\t\t\tdeferredFunction: function(words, lang) {\r\n\t\t\t\t\t// Sometimes user can change words status (ignore), after\r\n\t\t\t\t\t// this we need to check words status before call of 'misspelledWordsFound' event\r\n\t\t\t\t\tvar i = 0;\r\n\r\n\t\t\t\t\twhile(i < words.length) {\r\n\t\t\t\t\t\tif (words[i].getStatus(self.sandbox.getOption('uid')) != DictionaryManager.wordStatus.misspelled) {\r\n\t\t\t\t\t\t\twords.splice(i, 1);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ti++;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(words.length !== 0) {\r\n\t\t\t\t\t\tself.sandbox.fire('misspelledWordsFound', {words: words, lang: lang});\r\n\t\t\t\t\t\tself.sandbox.fire('problemsFound', {problems: words, lang: lang, problemType: 'spelling'});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t/**\r\n\t\t * @memberof CORE.DictionaryManager#\r\n\t\t * @param {Array<CORE.DictionaryManager.Word>} unknownWords \t- Array of unknown words.\r\n\t\t * @param {String} lang \t\t\t\t\t\t\t\t\t\t- Words language.\r\n\t\t *\r\n\t\t * @fires CORE.Communication#misspelledWordsFound\r\n\t\t */\r\n\t\tgetWordsInfo: function(unknownWords, lang) {\r\n\t\t\tvar self = this,\r\n\t\t\t\twordsPrefix = 'word_',\r\n\t\t\t\tspellingLangList = this.sandbox.getOption('spellingLangList'),\r\n\t\t\t\twordsLimit = this.sandbox.fire('getWordsLimit').data,\r\n\t\t\t\tuid = this.sandbox.getOption('uid'),\r\n\t\t\t\twordsToGetInfo = [],\r\n\t\t\t\tcachedWords = [],\r\n\t\t\t\tcachedWordsObject = {},\r\n\t\t\t\tmisspelledWords = [],\r\n\t\t\t\tcachedWord;\r\n\r\n\t\t\tunknownWords = unknownWords || [];\r\n\r\n\t\t\t//prevent requests without unknown words\r\n            if(unknownWords.length === 0) {\r\n                return;\r\n\t\t\t}\r\n\r\n\t\t\t// if limitation module not included we shouldn't check wordsLimit\r\n            if(typeof wordsLimit === 'number') {\r\n                if(wordsLimit === 0) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n                unknownWords.length = (unknownWords.length > wordsLimit) ? wordsLimit : unknownWords.length;\r\n                this.sandbox.fire('sentWordsCount', {count: unknownWords.length});\r\n\t\t\t}\r\n\r\n\t\t\t// prevent sending requests to the server for unsupported languages\r\n\t\t\tif(!spellingLangList) {\r\n\t\t\t\tconsole.warn('Webspellchecker: Spellcheck lang list not defined.');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(!(lang in spellingLangList.ltr) && !(lang in spellingLangList.rtl)) {\r\n\t\t\t\tthis.sandbox.console.warn('Specified \"' + lang + '\" language is not supported for your Customer ID. More details at http://wiki.webspellchecker.net or contact support@webspellchecker.net');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tfor(var i = 0; i < unknownWords.length; i++) {\r\n\t\t\t\tcachedWord = this.getCachedWord(unknownWords[i].word, lang);\r\n\r\n\t\t\t\tif (cachedWord) {\r\n\t\t\t\t\t// TODO: add UD check and set in cachedWord field\r\n\t\t\t\t\tcachedWords.push(cachedWord);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tunknownWords[i].setGlobalStatus(DictionaryManager.wordStatus.inprocess);\r\n\t\t\t\t\tunknownWords[i].setInProcess(uid); // Add info about setting word in process by instance\r\n\t\t\t\t\twordsToGetInfo.push(unknownWords[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// For cached word we do not need to send request for server\r\n\t\t\tif (cachedWords.length !== 0) {\r\n\t\t\t\tvar customDictionary = self.sandbox.getOption('customDictionary') || '';\r\n\t\t\t\t// Create cached words object\r\n\t\t\t\tcachedWordsObject = createObjectFromArray(cachedWords, wordsPrefix);\r\n\r\n\t\t\t\tfor (var i = 0; i < unknownWords.length; i++) {\r\n\t\t\t\t\tvar _word = unknownWords[i].word,\r\n\t\t\t\t\t\tisInUserDictionary = cachedWordsObject[wordsPrefix + _word] && cachedWordsObject[wordsPrefix + _word].ud === true;\r\n\r\n\t\t\t\t\tif (!cachedWordsObject[wordsPrefix + _word]) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (cachedWordsObject[wordsPrefix + _word].suggestions && !isInUserDictionary) { // if misspelled and not in UD\r\n\t\t\t\t\t\thandleMisspelledWord(unknownWords[i], misspelledWords, cachedWordsObject, customDictionary);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\thandleUdCdCorrectWord(unknownWords[i], isInUserDictionary, customDictionary);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (misspelledWords.length !== 0) {\r\n\t\t\t\t\tthis.sandbox.fireInAllApps('misspelledWordsFound', { words: misspelledWords, lang: lang });\r\n\t\t\t\t\tthis.sandbox.fireInAllApps('problemsFound', { problems: misspelledWords, lang: lang, problemType: 'spelling' });\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (wordsToGetInfo.length === 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.sandbox.addDeferredFunction('getWordsInfoForLang_' + lang, {\r\n\t\t\t\tdelay: 500,\r\n\t\t\t\tcollection: wordsToGetInfo,\r\n\t\t\t\tpartialItemsCount: 10,\r\n\t\t\t\tdefferedFunctionArgs: [lang],\r\n\t\t\t\tonUnregister: function() {\r\n\t\t\t\t\tvar currentTask = this;\r\n\r\n\t\t\t\t\t// Go through all words in collection and set to them 'unknown' status\r\n\t\t\t\t\t// Fixed bug with words that wasn't underlined when editor was destroyed before\r\n\t\t\t\t\t// deffered task for sending words to server was executed. Thus words had status\r\n\t\t\t\t\t// 'inprocess' forever.\r\n\t\t\t\t\tsetGlobalStatusToWords(currentTask.collection, DictionaryManager.wordStatus.unknown);\r\n\r\n\t\t\t\t\t// Remove info about setting in process by current instance\r\n\t\t\t\t\tremoveWordsFromProcess(currentTask.collection);\r\n\t\t\t\t},\r\n\t\t\t\tdeferredFunction: function(words, lang) {\r\n\t\t\t\t\tvar currentTask = this;\r\n\r\n\t\t\t\t\t// TODO: create count handler for error callbacks\r\n\t\t\t\t\t// TODO: look for another realization callStatus\r\n\t\t\t\t\t// \t\t to fix problem with multiple requests to SERVICE\r\n\t\t\t\t\tvar wordsString = [];\r\n\r\n\t\t\t\t\tfor(var i = 0; i < words.length; i++) {\r\n\t\t\t\t\t\twordsString.push(words[i].word);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar userDictionaryName = self.sandbox.getOption('userDictionaryName');\r\n\t\t\t\t\tself.sandbox.fire('remoteAction', {\r\n\t\t\t\t\t\tactionMethod: 'spellCheck',\r\n\t\t\t\t\t\tuserWordlist: self.userDictionaryManager.getWordsFromUserDictionary(),\r\n\t\t\t\t\t\ttext: wordsString.join(','),\r\n\t\t\t\t\t\tlang: lang,\r\n\t\t\t\t\t\tonSuccess: function(data) {\r\n\t\t\t\t\t\t\tvar uid = self.sandbox.getOption('uid'),\r\n\t\t\t\t\t\t\t\tcustomDictionary = self.sandbox.getOption('customDictionaryIds') || '',\r\n\t\t\t\t\t\t\t\t_dataWords = {},\r\n\t\t\t\t\t\t\t\t_misspelledWords = [];\r\n\r\n\t\t\t\t\t\t\t// Create object with incomming misspelled words from server\r\n\t\t\t\t\t\t\t_dataWords = createObjectFromArray(data, wordsPrefix);\r\n\r\n\t\t\t\t\t\t\t// Sets statuses for previously unknown words\r\n\t\t\t\t\t\t\tfor(i = 0; i < words.length; i++) {\r\n\t\t\t\t\t\t\t\tvar _word = words[i].word;\r\n\t\t\t\t\t\t\t\tvar isInUserDictionary = _dataWords[wordsPrefix + _word] && _dataWords[wordsPrefix + _word].ud === true;\r\n\r\n\t\t\t\t\t\t\t\t// We need to work with cache firstly\r\n\t\t\t\t\t\t\t\tif (_dataWords[ wordsPrefix + _word ]) {\r\n\t\t\t\t\t\t\t\t\tself.addWordToCache({\r\n\t\t\t\t\t\t\t\t\t\tword: _word,\r\n\t\t\t\t\t\t\t\t\t\tsuggestions: _dataWords[wordsPrefix + _word].suggestions,\r\n\t\t\t\t\t\t\t\t\t\tud: _dataWords[wordsPrefix + _word].ud\r\n\t\t\t\t\t\t\t\t\t}, lang);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tself.addWordToCache({\r\n\t\t\t\t\t\t\t\t\t\tword: _word\r\n\t\t\t\t\t\t\t\t\t}, lang);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif (_dataWords[ wordsPrefix + _word ] && !isInUserDictionary) { // if misspelled and not in UD\r\n\t\t\t\t\t\t\t\t\thandleMisspelledWord(words[i], _misspelledWords, _dataWords, customDictionary);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\thandleUdCdCorrectWord(words[i], isInUserDictionary, customDictionary);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Remove info about setting in process by current instance\r\n\t\t\t\t\t\t\t\twords[i].removeFromProcess(uid);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif(_misspelledWords.length !== 0) {\r\n\t\t\t\t\t\t\t\tself.sandbox.fireInAllApps('misspelledWordsFound', { words: _misspelledWords, lang: lang });\r\n\t\t\t\t\t\t\t\tself.sandbox.fireInAllApps('problemsFound', { problems: _misspelledWords, lang: lang, problemType: 'spelling' });\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Reset (set to zero) 'numberOfFailedRequest' for successful request\r\n\t\t\t\t\t\t\tself.sandbox.setOption('numberOfFailedRequest', 0);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tonError: function(e) {\r\n\t\t\t\t\t\t\tvar numberOfFailedRequest = self.sandbox.getOption('numberOfFailedRequest');\r\n\r\n\t\t\t\t\t\t\tself.sandbox.setOption('numberOfFailedRequest', ++numberOfFailedRequest);\r\n\r\n\t\t\t\t\t\t\tif (numberOfFailedRequest > 4) {\r\n\t\t\t\t\t\t\t\tself.sandbox.setPaused(true);\r\n\t\t\t\t\t\t\t\tself.sandbox.removeAllDeferredFunctions();\r\n\r\n\t\t\t\t\t\t\t\t// Remove info about setting in process by current instance\r\n\t\t\t\t\t\t\t\tremoveWordsFromProcess(words);\r\n\r\n\t\t\t\t\t\t\t\t// Go through all words in failed request (and step of deferred task as result) and set to them 'unknown' status\r\n\t\t\t\t\t\t\t\t// Fixed bug with words that wasn't underlined when editor was destroyed before\r\n\t\t\t\t\t\t\t\t// deffered task for sending words to server was executed. Thus words had status\r\n\t\t\t\t\t\t\t\t// 'inprocess' forever.\r\n\t\t\t\t\t\t\t\tsetGlobalStatusToWords(words, DictionaryManager.wordStatus.unknown);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t// Re create request if 'numberOfFailedRequest' < 5\r\n\t\t\t\t\t\t\t\tself.getWordsInfo(words, lang);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tfunction setGlobalStatusToWords(words, status) {\r\n\t\t\t\tfor(var i = 0; i < words.length; i++) {\r\n\t\t\t\t\twords[i].setGlobalStatus(status);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction removeWordsFromProcess(words) {\r\n\t\t\t\tvar uid = self.sandbox.getOption('uid');\r\n\r\n\t\t\t\tfor (var i = 0; i < words.length; i++) {\r\n\t\t\t\t\twords[i].removeFromProcess(uid);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction createObjectFromArray(array, wordsPrefix) {\r\n\t\t\t\tvar obj = {};\r\n\r\n\t\t\t\tfor (var i = 0; i < array.length; i++) {\r\n\t\t\t\t\tobj[wordsPrefix + array[i].word] = array[i];\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn obj;\r\n\t\t\t}\r\n\r\n\t\t\tfunction handleMisspelledWord(word, misspelledWords, knownWords, customDictionary) {\r\n\t\t\t\tword.setStatusForAllInstancesWithSuchCustomDictionary(DictionaryManager.wordStatus.misspelled, customDictionary);\r\n\t\t\t\tword['suggestions'] = knownWords[ wordsPrefix + word.word ].suggestions;\r\n\t\t\t\tmisspelledWords.push(word);\r\n\t\t\t}\r\n\r\n\t\t\tfunction handleUdCdCorrectWord(word, isInUserDictionary, customDictionary) {\r\n\t\t\t\tif (isInUserDictionary) { // if in UD\r\n\t\t\t\t\tword.setStatusForAllInstances(DictionaryManager.wordStatus.userDictionary);\r\n\t\t\t\t} else { // if correct\r\n\t\t\t\t\tif (!customDictionary) {\r\n\t\t\t\t\t\t// if word correct without additional dictionaries that we can\r\n\t\t\t\t\t\t// set 'correct' status globally\r\n\t\t\t\t\t\tword.setGlobalStatus(DictionaryManager.wordStatus.correct);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tword.setStatusForAllInstancesWithSuchCustomDictionary(DictionaryManager.wordStatus.correct, customDictionary);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * Represents UserDictionaryManager Object.\r\n\t *\r\n\t * @constructor\r\n\t * @param {CORE.Sandbox} sandbox\r\n\t */\r\n\tDictionaryManager.UserDictionaryManager = function(sandbox) {\r\n\t\tthis.sandbox = sandbox;\r\n\t\tthis.init();\r\n\t};\r\n\tDictionaryManager.UserDictionaryManager.prototype = {\r\n\t\t// constructor\r\n\t\tinit: function() {\r\n\t\t\tvar userDictionaryName,\r\n\t\t\t\twordsFromUserDictionary = [],\r\n\t\t\t\tlang = this.sandbox.getOption('lang'),\r\n\t\t\t\tuid = this.sandbox.getOption('uid'),\r\n\t\t\t\tdictionary = DictionaryManager.Dictionary,\r\n\t\t\t\tudWordsFromDictionary = dictionary.getAllWordsByStatus(DictionaryManager.wordStatus.userDictionary),\r\n\t\t\t\tself = this,\r\n\t\t\t\ti;\r\n\r\n\t\t\tthis.userDictionaryName = this.sandbox.getOption('userDictionaryName');\r\n\t\t\tthis.userDictionaryKey = this.sandbox.getOption('userDictionaryKey');\r\n\t\t\tthis.userDictionaryNameKey = this.sandbox.getOption('userDictionaryNameKey');\r\n\r\n\t\t\tfor (i = 0; i < udWordsFromDictionary.length; i++) {\r\n\t\t\t\tudWordsFromDictionary[i].setStatusForAllInstances(DictionaryManager.wordStatus.unknown);\r\n\t\t\t}\r\n\r\n\t\t\tif(!(typeof this.userDictionaryName === 'string' && this.userDictionaryName.length > 0)) {\r\n\t\t\t\t// Trying initialize wordlist from UD\r\n\t\t\t\ttry {\r\n\t\t\t\t\twordsFromUserDictionary = this.sandbox.DataStorage.getData(this.userDictionaryKey);\r\n\r\n\t\t\t\t\t// FF 3.6 fix. Localstorage in IE stores null instead of undefined that could be parsed\r\n\t\t\t\t\tif(wordsFromUserDictionary == null) {\r\n\t\t\t\t\t\twordsFromUserDictionary = [];\r\n\t\t\t\t\t\tthis.sandbox.DataStorage.setData(this.userDictionaryKey, wordsFromUserDictionary);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} catch(err) {\r\n\t\t\t\t\tthis.sandbox.DataStorage.setData(this.userDictionaryKey, wordsFromUserDictionary);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Trying initialize UD name\r\n\t\t\t\tuserDictionaryName = this.sandbox.DataStorage.getData(this.userDictionaryNameKey);\r\n\t\t\t\tif(typeof userDictionaryName == 'string' && userDictionaryName != null && userDictionaryName.length > 0) {\r\n\t\t\t\t\tthis.userDictionaryName = userDictionaryName;\r\n\t\t\t\t\tthis.sandbox.setOption('userDictionaryName', this.userDictionaryName);\r\n\r\n\t\t\t\t\t// we need to set 'userDictionary' status to all user dictionary words that came from server\r\n\t\t\t\t\tthis.getUserDictionaryFromServer({\r\n\t\t\t\t\t\tname: userDictionaryName,\r\n\t\t\t\t\t\tonSuccess: function(userDictionaryObject) {\r\n\t\t\t\t\t\t\tvar words = userDictionaryObject.wordlist;\r\n\r\n\t\t\t\t\t\t\tfor (var i = 0, wordsLength = words.length; i < wordsLength; i++) {\r\n\t\t\t\t\t\t\t\tudWordsFromDictionary = dictionary.getAllWordsByName(words[i]);\r\n\r\n\t\t\t\t\t\t\t\tif(udWordsFromDictionary.length > 0) {\r\n\t\t\t\t\t\t\t\t\tfor(var j = 0; j < udWordsFromDictionary.length; j++) {\r\n\t\t\t\t\t\t\t\t\t\tudWordsFromDictionary[j].setStatusForAllInstances(DictionaryManager.wordStatus.userDictionary);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tself.setCacheState({\r\n\t\t\t\t\t\t\t\tready: true,\r\n\t\t\t\t\t\t\t\tudModificationTime: userDictionaryObject.modificationTime,\r\n\t\t\t\t\t\t\t\tclear: true\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.sandbox.DataStorage.setData(this.userDictionaryNameKey, null);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// we need to set 'userDictionary' status to all words from local user dictionary\r\n\t\t\tfor (var i = 0, wordsLength = wordsFromUserDictionary.length; i < wordsLength; i++) {\r\n\t\t\t\tudWordsFromDictionary = dictionary.getAllWordsByName(wordsFromUserDictionary[i]);\r\n\r\n\t\t\t\tif(udWordsFromDictionary.length > 0) {\r\n\t\t\t\t\tfor(var j = 0; j < udWordsFromDictionary.length; j++) {\r\n\t\t\t\t\t\tudWordsFromDictionary[j].setStatusForAllInstances(DictionaryManager.wordStatus.userDictionary);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!this.userDictionaryName) {\r\n\t\t\t\tthis.setCacheState({\r\n\t\t\t\t\tready: true,\r\n\t\t\t\t\tudModificationTime: 0,\r\n\t\t\t\t\tclear: true\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\tonSuccessCallback: function(action, data, response) {\r\n\t\t\tif(typeof data.onSuccess === 'function') {\r\n\t\t\t\tdata.onSuccess(response);\r\n\t\t\t}\r\n\r\n\t\t\tif (data.action) {\r\n\t\t\t\tthis.clearCache();\r\n\t\t\t\tthis.setCacheState({ udModificationTime: response.modificationTime });\r\n\t\t\t}\r\n\r\n\t\t\tswitch(action) { //if we need to clear UD words on local storage and cookies, use \"break\", if not - \"return\"\r\n\t\t\t\tcase 'createUserDictionary':\r\n\t\t\t\t\tthis.setUserDictionaryName(response.name);\r\n\t\t\t\t\tthis.sandbox.fireInAllApps('userDictionaryChanged', {name: response.name});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'deleteUserDictionary':\r\n\t\t\t\t\tthis.setUserDictionaryName('');\r\n\t\t\t\t\tthis.sandbox.fireInAllApps('userDictionaryChanged', {name: ''});\r\n\t\t\t\t\tthis.sandbox.fire('userDictionaryStateChanged');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'renameUserDictionary':\r\n\t\t\t\t\tthis.setUserDictionaryName(response.name);\r\n\t\t\t\t\tthis.sandbox.fireInAllApps('userDictionaryChanged', {name: response.name});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'getUserDictionary':\r\n\t\t\t\t\tthis.setUserDictionaryName(response.name);\r\n\t\t\t\t\tthis.sandbox.fireInAllApps('userDictionaryChanged', {name: response.name});\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tthis.clearUserDictionary();\r\n\t\t},\r\n\t\tonErrorCallback: function(data, response) {\r\n\t\t\tif(typeof data.onError === 'function') {\r\n\t\t\t\tdata.onError(response);\r\n\t\t\t}\r\n\t\t},\r\n\t\tsetCacheState: function(data) {\r\n\t\t\tDictionaryManager.Cache.setState(data);\r\n\t\t},\r\n\t\tclearCache: function() {\r\n\t\t\tDictionaryManager.Cache.clear();\r\n\t\t},\r\n\t\tremoteAction: function(action, data) {\r\n\t\t\tdata = data || {};\r\n\t\t\tvar self  = this,\r\n\t\t\t\teventObject = {\r\n\t\t\t\t\tactionMethod: action,\r\n\t\t\t\t\tname: data.name || this.sandbox.getOption('userDictionaryName')\r\n\t\t\t\t},\r\n\t\t\t\treplaceText = data.name || data.newName || data.word;\r\n\r\n\t\t\tfor (var k in data) {\r\n\t\t\t\tif ( Utils.TypeChecker.isFunction(data[k]) === false ) {\r\n\t\t\t\t\teventObject[k] = data[k];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\teventObject.onSuccess =  function(response) {\r\n\t\t\t\tself.onSuccessCallback(action, data, response);\r\n\t\t\t\tself.sandbox.fire('userDictionaryAction', {\r\n\t\t\t\t\trequest: data,\r\n\t\t\t\t\tresponse: response,\r\n\t\t\t\t\taction: data.action || '',\r\n\t\t\t\t\tstatus: 'success',\r\n\t\t\t\t\treplaceText: replaceText,\r\n\t\t\t\t\tmessagePostfix: 'Dic'\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t\teventObject.onError = function(response) {\r\n\t\t\t\tif(data.onError) {\r\n\t\t\t\t\tdata.onError(response);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tself.onErrorCallback(data, response);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.sandbox.fire('userDictionaryAction', {\r\n\t\t\t\t\trequest: data,\r\n\t\t\t\t\tresponse: response,\r\n\t\t\t\t\taction: data.action || '',\r\n\t\t\t\t\tstatus: 'error',\r\n\t\t\t\t\treplaceText: replaceText,\r\n\t\t\t\t\tmessagePostfix: 'Dic'\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\tthis.sandbox.fire('remoteAction', eventObject);\r\n\t\t},\r\n\t\tcreateUserDictionary: function(data) {\r\n\t\t\tdata.wordList = this.getWordsFromUserDictionary();\r\n\t\t\tthis.remoteAction('createUserDictionary', data);\r\n\t\t},\r\n\t\tremoveUserDictionary: function(data) {\r\n\t\t\tthis.remoteAction('deleteUserDictionary', data);\r\n\t\t},\r\n\t\trenameUserDictionary: function(data) {\r\n\t\t\tthis.remoteAction('renameUserDictionary', data);\r\n\t\t},\r\n\t\tgetUserDictionaryFromServer: function(data) {\r\n\t\t\tthis.remoteAction('getUserDictionary', data);\r\n\t\t},\r\n\t\taddWordToUserDictionaryServer: function(data) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tthis.remoteAction('addWordToUserDictionary', {\r\n\t\t\t\tword: data.word,\r\n\t\t\t\taction: data.action,\r\n\t\t\t\tonSuccess: function(response) {\r\n\t\t\t\t\tif(typeof data.onSuccess === 'function') {\r\n\t\t\t\t\t\tdata.onSuccess(response);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tself.clearUserDictionary();\r\n\t\t\t\t\tself.setCacheState({\r\n\t\t\t\t\t\tready: true, // UD will be created after add word command if it was not present on a server\r\n\t\t\t\t\t\tudModificationTime: response.modificationTime\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tonError: data.onError\r\n\t\t\t});\r\n\t\t},\r\n\t\tdeleteWordFromUserDictionaryServer: function(data) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tthis.remoteAction('deleteWordFromUserDictionary', {\r\n\t\t\t\tword: data.word,\r\n\t\t\t\taction: data.action,\r\n\t\t\t\tonSuccess: function(response) {\r\n\t\t\t\t\tif(typeof data.onSuccess === 'function') {\r\n\t\t\t\t\t\tdata.onSuccess(response);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tself.sandbox.fireInAllApps('startSpellCheck');\r\n\t\t\t\t\tself.sandbox.fireInAllApps('startProblemsCheck');\r\n\t\t\t\t\tself.setCacheState({udModificationTime: response.modificationTime});\r\n\t\t\t\t},\r\n\t\t\t\tonError: data.onError\r\n\t\t\t});\r\n\t\t},\r\n\t\tdisconnectFromUserDictionary: function(data) {\r\n\t\t\tthis.setUserDictionaryName('');\r\n\t\t\tthis.sandbox.DataStorage.setData(this.userDictionaryKey, []);\r\n\t\t\tthis.clearCache();\r\n\t\t\t// If something was wrong with UD after page reloading (for example UD was manually removed from a server)\r\n\t\t\t// we need to set cache to ready state after disconnecting from UD\r\n\t\t\tthis.setCacheState({ ready: true });\r\n\t\t\tthis.sandbox.fireInAllApps('userDictionaryChanged', {name: ''});\r\n\t\t\tthis.sandbox.fire('userDictionaryStateChanged');\r\n\t\t\tthis.sandbox.fire('userDictionaryAction', {\r\n\t\t\t\trequest: data,\r\n\t\t\t\tresponse: {},\r\n\t\t\t\taction: data.action || '',\r\n\t\t\t\tstatus: 'success',\r\n\t\t\t\treplaceText: data.name,\r\n\t\t\t\tmessagePostfix: 'Dic'\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetUserDictionary: function(data) {\r\n\t\t\tvar userWordsList = this.sandbox.DataStorage.getData(this.userDictionaryKey),\r\n\t\t\t\tudName =  data.name || this.sandbox.getOption('userDictionaryName');\r\n\r\n\t\t\tif (userWordsList == null) {\r\n\t\t\t\tuserWordsList = [];\r\n\t\t\t}\r\n\r\n\t\t\tif (this.checkUserDictionaryName(udName)) {\r\n\t\t\t\tthis.getUserDictionaryFromServer({\r\n\t\t\t\t\tname: udName,\r\n\t\t\t\t\tonSuccess: data.callback\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tif (typeof data.callback === 'function') {\r\n\t\t\t\t\tdata.callback({wordlist: userWordsList});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\taddWordsToUserDictionary: function(/*Array*/ words) {\r\n\t\t\tfor(var i =0; i < words.length; i++) {\r\n\t\t\t\tthis.addWordToUserDictionary({word: words[i]});\r\n\t\t\t}\r\n\t\t},\r\n\t\tgetWordsFromUserDictionary: function() {\r\n\t\t\tvar userWordsList = this.sandbox.DataStorage.getData(this.userDictionaryKey);\r\n\t\t\tif (userWordsList == null) {\r\n\t\t\t\tuserWordsList = [];\r\n\t\t\t}\r\n\t\t\treturn userWordsList.join();\r\n\t\t},\r\n\t\tcheckUserDictionaryName: function(userDictionaryName) {\r\n\t\t\tvar result;\r\n\r\n\t\t\tif(typeof userDictionaryName == 'string' && userDictionaryName !== '' && userDictionaryName.length > 0) {\r\n\t\t\t\tresult = true;\r\n\t\t\t} else {\r\n\t\t\t\tresult = false;\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t},\r\n\t\tsetWordStatus: function(word, status) {\r\n\t\t\tvar dictionary = DictionaryManager.Dictionary,\r\n\t\t\t\tallLangDictionaries = dictionary.getDictionary(),\r\n\t\t\t\twordStatus,\r\n\t\t\t\twordObject;\r\n\r\n\t\t\tfor(var language in allLangDictionaries) {\r\n\t\t\t\twordObject = dictionary.getWord(word, language);\r\n\r\n\t\t\t\tif(wordObject) {\r\n\t\t\t\t\tswitch(status) {\r\n\t\t\t\t\t\tcase 'userDictionary':\r\n\t\t\t\t\t\t\twordStatus = DictionaryManager.wordStatus.userDictionary;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'unknown':\r\n\t\t\t\t\t\t\twordStatus = DictionaryManager.wordStatus.unknown;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\twordStatus = DictionaryManager.wordStatus.unknown;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\twordObject.setStatusForAllInstances(wordStatus);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tsetCapitalizedWordStatus: function(word, status) {\r\n\t\t\tif ( Utils.isLowercaseLetter(word[0]) ) {\r\n\t\t\t\tthis.setWordStatus( Utils.capitalizeFirstLetter(word), status );\r\n\t\t\t}\r\n\t\t},\r\n\t\taddWordToUserDictionary: function(/*Object*/ data) {\r\n\t\t\tvar userWordsList = this.sandbox.DataStorage.getData(this.userDictionaryKey);\r\n\r\n\t\t\tif (userWordsList == null) {\r\n\t\t\t\tuserWordsList = [];\r\n\t\t\t}\r\n\r\n\t\t\tif(this.checkUserDictionaryName(this.sandbox.getOption('userDictionaryName'))) {\r\n\t\t\t\tthis.addWordToUserDictionaryServer(data);\r\n\t\t\t\tthis.setWordStatus(data.word, 'userDictionary');\r\n\t\t\t\tthis.setCapitalizedWordStatus(data.word, 'userDictionary');\r\n\t\t\t} else if(!userWordsList.includes(data.word)) {\r\n\t\t\t\tuserWordsList.push(data.word);\r\n\t\t\t\tthis.sandbox.DataStorage.setData(this.userDictionaryKey, userWordsList);\r\n\t\t\t\tthis.setWordStatus(data.word, 'userDictionary');\r\n\t\t\t\tthis.setCapitalizedWordStatus(data.word, 'userDictionary');\r\n\r\n\t\t\t\tif (typeof data.onSuccess === 'function') {\r\n\t\t\t\t\tdata.onSuccess({});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.sandbox.fire('userDictionaryAction', {\r\n\t\t\t\t\trequest: data,\r\n\t\t\t\t\tresponse: {},\r\n\t\t\t\t\taction: data.action || '',\r\n\t\t\t\t\tstatus: 'success',\r\n\t\t\t\t\treplaceText: data.word,\r\n\t\t\t\t\tmessagePostfix: 'Dic'\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tthis.clearCache();\r\n\t\t},\r\n\t\tdeleteWordFromUserDictionary: function(/*Object*/ data) {\r\n\t\t\tvar userWordsList = this.sandbox.DataStorage.getData(this.userDictionaryKey),\r\n\t\t\t\tindex;\r\n\r\n\t\t\tif (userWordsList == null) {\r\n\t\t\t\tuserWordsList = [];\r\n\t\t\t}\r\n\r\n\t\t\tif (this.checkUserDictionaryName(this.sandbox.getOption('userDictionaryName'))) {\r\n\t\t\t\tthis.deleteWordFromUserDictionaryServer(data);\r\n\t\t\t\tthis.setWordStatus(data.word, 'unknown');\r\n\t\t\t\tthis.setCapitalizedWordStatus(data.word, 'unknown');\r\n\t\t\t\tthis.clearCache();\r\n\t\t\t} else {\r\n\t\t\t\tindex = userWordsList.indexOf(data.word);\r\n\r\n\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\tuserWordsList.splice(index, 1);\r\n\t\t\t\t\tthis.sandbox.DataStorage.setData(this.userDictionaryKey, userWordsList);\r\n\t\t\t\t\tthis.setWordStatus(data.word, 'unknown');\r\n\t\t\t\t\tthis.setCapitalizedWordStatus(data.word, 'unknown');\r\n\r\n\t\t\t\t\tif (typeof data.onSuccess === 'function') {\r\n\t\t\t\t\t\tdata.onSuccess({});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.clearCache();\r\n\t\t\t\t\tthis.sandbox.fireInAllApps('startSpellCheck');\r\n\t\t\t\t\tthis.sandbox.fireInAllApps('startProblemsCheck');\r\n\r\n\t\t\t\t\tthis.sandbox.fire('userDictionaryAction', {\r\n\t\t\t\t\t\trequest: data,\r\n\t\t\t\t\t\tresponse: {},\r\n\t\t\t\t\t\taction: data.action || '',\r\n\t\t\t\t\t\tstatus: 'success',\r\n\t\t\t\t\t\treplaceText: data.word,\r\n\t\t\t\t\t\tmessagePostfix: 'Dic'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tclearUserDictionary: function() {\r\n\t\t\tthis.sandbox.DataStorage.setData(this.userDictionaryKey, []);\r\n\t\t},\r\n\t\tsetUserDictionaryName: function(name) {\r\n\t\t\tthis.sandbox.DataStorage.setData(this.userDictionaryNameKey, name);\r\n\t\t\tthis.sandbox.setOption('userDictionaryName', name);\r\n\t\t},\r\n\t\tsyncUserDictionaryName: function(data) {\r\n\t\t\tthis.sandbox.setOption('userDictionaryName', data.name);\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * Represents DictionaryManager.Dictionary Object.\r\n\t *\r\n\t * @constructor\r\n\t */\r\n\tDictionaryManager.Dictionary = DictionaryManager.Dictionary || (function() {\r\n\t\tvar wordsStorage = {},\r\n\t\t\twordStoragePrefix = 'word_';\r\n\r\n\t\treturn {\r\n\t\t\tgetWord: function(word, lang) {\r\n\t\t\t\treturn wordsStorage[lang] && wordsStorage[lang][wordStoragePrefix + word];\r\n\t\t\t},\r\n\t\t\tgetWordsFromDictionaryByStatus: function(lang, uid, status) {\r\n\t\t\t\tvar\twords = [];\r\n\r\n\t\t\t\tthis.each(lang, function(wordObject) {\r\n\t\t\t\t\tif(wordObject.getStatus(uid) == status) {\r\n\t\t\t\t\t\twords.push(wordObject);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn words;\r\n\t\t\t},\r\n\r\n\t\t\tgetAllWordsByStatus: function(status) {\r\n\t\t\t\tvar\twords = [];\r\n\r\n\t\t\t\tfor(var language in wordsStorage) {\r\n\t\t\t\t\tthis.each(language, function(wordObject) {\r\n\t\t\t\t\t\tif(wordObject.hasStatusInAnyInstance(status)) {\r\n\t\t\t\t\t\t\twords.push(wordObject);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn words;\r\n\t\t\t},\r\n\r\n\t\t\tgetAllWordsByName: function(word) {\r\n\t\t\t\tvar words = [];\r\n\r\n\t\t\t\tfor(var language in wordsStorage) {\r\n\t\t\t\t\tif(wordsStorage[language][wordStoragePrefix + word]) {\r\n\t\t\t\t\t\twords.push(wordsStorage[language][wordStoragePrefix + word]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn words;\r\n\t\t\t},\r\n\r\n\t\t\tsetStatusToWords: function(words, status, lang, uid) { //new code\r\n\r\n\t\t\t\tfor (var i = 0; i < words.length; i++) {\r\n\r\n\t\t\t\t\tif(!this.getWord(words[i], lang)) {\r\n\t\t\t\t\t\tthis.addWord(words[i], lang);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.getWord(words[i], lang).setStatus(status, uid);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// gets clone of dictionary object as it is\r\n\t\t\tgetDictionary: function() {\r\n\t\t\t\tvar clonedWordsStorage = {};\r\n\r\n\t\t\t\tfor(var key in wordsStorage) {\r\n\t\t\t\t\tif(wordsStorage.hasOwnProperty(key)) {\r\n\t\t\t\t\t\tclonedWordsStorage[key] = wordsStorage[key];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn clonedWordsStorage;\r\n\t\t\t},\r\n\t\t\taddWord: function(word, lang) {\r\n\t\t\t\tvar newWord = new DictionaryManager.Word(word);\r\n\r\n\t\t\t\twordsStorage[lang] = wordsStorage[lang] || {};\r\n\r\n\t\t\t\treturn wordsStorage[lang][wordStoragePrefix + word] = newWord;\r\n\t\t\t},\r\n\t\t\teach: function(lang, callback) {\r\n\r\n\t\t\t\tif(typeof callback === 'function') {\r\n\r\n\t\t\t\t\tfor(var wordKey in wordsStorage[lang]) {\r\n\t\t\t\t\t\tcallback(wordsStorage[lang][wordKey]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tclear: function() {\r\n\t\t\t\twordsStorage = {};\r\n\t\t\t}\r\n\t\t}\r\n\t})();\r\n\r\n\t/**\r\n\t * Represents DictionaryManager.Word Object.\r\n\t *\r\n\t * @constructor\r\n\t * @param {String} \t- Word.\r\n\t */\r\n\tDictionaryManager.Word = function(word) {\r\n\t\tvar statusInInstance = {};\r\n\t\tvar wordInInstance = {};\r\n\t\tvar customDictionariesInInstance = {};\r\n\t\tvar settedInProcessBy = {};\r\n\t\tvar globalStatus;\r\n\r\n\t\t/**\r\n\t\t * Word.\r\n\t\t * @type {String}\r\n\t\t */\r\n\t\tthis.word = word;\r\n\r\n\t\t/**\r\n\t\t * Suggestions collection.\r\n\t\t * @type {Array}\r\n\t\t */\r\n\t\tthis.suggestions = [];\r\n\r\n\t\t/**\r\n\t\t * Returns status of word in specific instance.\r\n\t\t *\r\n\t\t * @param {string} uid \t- Instance Id.\r\n\t\t * @returns {Number}\r\n\t\t */\r\n\t\tthis.getStatus = function(uid /* instance id */) {\r\n\t\t\tvar _status;\r\n\r\n\t\t\tif(typeof statusInInstance[uid] !== 'undefined') {\r\n\t\t\t\t_status = statusInInstance[uid];\r\n\t\t\t}\r\n\r\n\t\t\treturn _status;\r\n\t\t};\r\n\r\n\t\tthis.hasStatusInAnyInstance = function(status) {\r\n\t\t\tvar result = false;\r\n\r\n\t\t\tif(typeof status !== 'undefined') {\r\n\t\t\t\tfor(var instanceUID in wordInInstance) {\r\n\t\t\t\t\tif(statusInInstance[instanceUID] === status) {\r\n\t\t\t\t\t\tresult = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Resets word status to globalStatus or to 'unknown'.\r\n\t\t *\r\n\t\t * @param {string} uid \t- CORE instance Id.\r\n\t\t */\r\n\t\tthis.resetStatus = function(uid /* instance id */) {\r\n\t\t\tif(typeof globalStatus !== 'undefined' && typeof uid !== 'undefined') {\r\n\t\t\t\tthis.setStatus(globalStatus, uid);\r\n\t\t\t} else if(typeof uid !== 'undefined') {\r\n\t\t\t\tthis.setStatus(0, uid);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Sets word 'globalStatus' status.\r\n\t\t *\r\n\t\t * @param {Number} status \t- Id from CORE.DictionaryManager#wordStatus.\r\n\t\t */\r\n\t\tthis.setGlobalStatus = function(status) {\r\n\t\t\tif(typeof status !== 'undefined') {\r\n\t\t\t\tglobalStatus = status;\r\n\r\n\t\t\t\tfor(var instanceUID in wordInInstance) {\r\n\t\t\t\t\tif(statusInInstance[instanceUID] == 0 || statusInInstance[instanceUID] == 3) {\r\n\t\t\t\t\t\tstatusInInstance[instanceUID] = globalStatus;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Sets word status for all instances.\r\n\t\t *\r\n\t\t * @param {Number} status \t- Id from CORE.DictionaryManager#wordStatus.\r\n\t\t */\r\n\t\tthis.setStatusForAllInstances = function(status) {\r\n\t\t\tif(typeof status !== 'undefined') {\r\n\t\t\t\tfor(var instanceUID in wordInInstance) {\r\n\t\t\t\t\tstatusInInstance[instanceUID] = status;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Sets word status for all instances with such custom dictionary.\r\n\t\t *\r\n\t\t * @param {Number} status - Id from CORE.DictionaryManager#wordStatus.\r\n\t\t * @param {String} name - Custom dictionary name.\r\n\t\t */\r\n\t\tthis.setStatusForAllInstancesWithSuchCustomDictionary = function(status, name) {\r\n\t\t\tif (typeof status !== 'undefined') {\r\n\t\t\t\tfor (var instanceUID in wordInInstance) {\r\n\t\t\t\t\tif (customDictionariesInInstance[instanceUID] === name) {\r\n\t\t\t\t\t\tif(statusInInstance[instanceUID] == 0 || statusInInstance[instanceUID] == 3) {\r\n\t\t\t\t\t\t\tstatusInInstance[instanceUID] = status;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Sets word status.\r\n\t\t *\r\n\t\t * @param {Number} status \t- Id from CORE.DictionaryManager#wordStatus.\r\n\t\t * @param {String} uid \t\t- CORE instance Id.\r\n\t\t */\r\n\t\tthis.setStatus = function(status, uid /* instance id */) {\r\n\t\t\tif(typeof status !== 'undefined' && typeof uid !== 'undefined') {\r\n\t\t\t\tstatusInInstance[uid] = status;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Adds information about custom dictionaries in instance.\r\n\t\t *\r\n\t\t * @param {String} customDictionaries - Names of the custom dictionaries.\r\n\t\t * @param {String} uid - CORE instance Id.\r\n\t\t */\r\n\t\tthis.addCustomDictionariesInInstance = function(customDictionary, uid /* instance id */) {\r\n\t\t\tif(typeof uid !== 'undefined') {\r\n\t\t\t\tcustomDictionariesInInstance[uid] = customDictionary;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Sets word in progress.\r\n\t\t *\r\n\t\t * @param {String} uid - CORE instance Id.\r\n\t\t */\r\n\t\tthis.setInProcess = function(uid /* instance id */) {\r\n\t\t\tif(typeof uid !== 'undefined' && !settedInProcessBy[uid]) {\r\n\t\t\t\tsettedInProcessBy[uid] = true;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Removes word from process.\r\n\t\t *\r\n\t\t * @param {String} uid - CORE instance Id.\r\n\t\t */\r\n\t\tthis.removeFromProcess = function(uid /* instance id */) {\r\n\t\t\tif(typeof uid !== 'undefined' && settedInProcessBy[uid]) {\r\n\t\t\t\tdelete settedInProcessBy[uid];\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Check need or no gets word info.\r\n\t\t *\r\n\t\t * @param {String} uid - CORE instance Id.\r\n\t\t */\r\n\t\tthis.isNeedGetWordInfo = function(uid /* instance id */) {\r\n\t\t\tif(typeof uid !== 'undefined') {\r\n\t\t\t\tif (settedInProcessBy[uid]) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor(var instanceUID in settedInProcessBy) {\r\n\t\t\t\t\tif (customDictionariesInInstance[instanceUID] === customDictionariesInInstance[uid]) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Adds word to CORE instance.\r\n\t\t *\r\n\t\t * @param {String} uid \t\t- CORE instance Id.\r\n\t\t */\r\n\t\tthis.addToInstance = function(uid) {\r\n\t\t\twordInInstance[uid] = this.word;\r\n\t\t\t// set GlobalStatus or 'unknown'\r\n\t\t\tthis.resetStatus(uid);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Checks that word exists in CORE instance.\r\n\t\t *\r\n\t\t * @param {String} uid \t\t- CORE instance Id.\r\n\t\t * @returns {Boolean}\r\n\t\t */\r\n\t\tthis.existsInInstance = function(uid) {\r\n\t\t\treturn wordInInstance[uid] ? true : false;\r\n\t\t};\r\n\t};\r\n\r\n\t/**\r\n\t * Represents DictionaryManager.Cache Object.\r\n\t *\r\n\t * @constructor\r\n\t */\r\n\tDictionaryManager.Cache = DictionaryManager.Cache || (function() {\r\n\t\tvar udModificationTime = 0,\r\n\t\t\tprogramVersion = '',\r\n\t\t\tcacheSize = 4000, // default value\r\n\t\t\tlength = 0,\r\n\t\t\tmap = {},\r\n\t\t\thead = null,\r\n\t\t\ttail = null,\r\n\t\t\tcacheName = 'wsc_dictionary_cache',\r\n\t\t\tcacheRestored = false,\r\n\t\t\tcacheSaved = false,\r\n\t\t\tready = false;\r\n\r\n\t\treturn {\r\n\t\t\tgetWord: function(word, lang) {\r\n\t\t\t\tif (ready) {\r\n\t\t\t\t\treturn this.get(lang + word);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\taddWord: function(data, lang) {\r\n\t\t\t\tthis.set(lang + data.word, data);\r\n\t\t\t},\r\n\t\t\tclear: function() {\r\n\t\t\t\tudModificationTime = 0;\r\n\t\t\t\tprogramVersion = '';\r\n\t\t\t\tlength = 0;\r\n\t\t\t\tmap = {};\r\n\t\t\t\thead = null;\r\n\t\t\t\ttail = null;\r\n\t\t\t},\r\n\t\t\tsaveCache: function() {\r\n\t\t\t\tvar cache, item;\r\n\r\n\t\t\t\tif (cacheSaved) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tcacheSaved = true;\r\n\t\t\t\t\tcache = window.localStorage.getItem(cacheName);\r\n\r\n\t\t\t\t\t// If local storage was cleared by user we do not need to save it\r\n\t\t\t\t\tif (cache) {\r\n\t\t\t\t\t\titem = this.toJSON();\r\n\t\t\t\t\t\titem.push({\r\n\t\t\t\t\t\t\tudModificationTime: udModificationTime,\r\n\t\t\t\t\t\t\tprogramVersion: programVersion\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\twindow.localStorage.setItem( cacheName, JSON.stringify(item) );\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (e) {}\r\n\t\t\t},\r\n\t\t\trestoreCache: function() {\r\n\t\t\t\tvar item = [], cache, aditionalData;\r\n\r\n\t\t\t\tif (cacheRestored) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tcacheRestored = true;\r\n\t\t\t\t\tcache = JSON.parse( window.localStorage.getItem(cacheName) );\r\n\r\n\t\t\t\t\tif (!cache) {\r\n\t\t\t\t\t\tthis.clear();\r\n\t\t\t\t\t\t// We need to save empty cache for 'saveCache' functionality.\r\n\t\t\t\t\t\t// So we will save cache only for previous setted cache with empty data.\r\n\t\t\t\t\t\t// If user will clear local storage manually we will not save cache.\r\n\t\t\t\t\t\titem.push({\r\n\t\t\t\t\t\t\tudModificationTime: udModificationTime,\r\n\t\t\t\t\t\t\tprogramVersion: programVersion\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\twindow.localStorage.setItem( cacheName, JSON.stringify(item) );\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\taditionalData = cache.pop();\r\n\t\t\t\t\t\tudModificationTime = aditionalData.udModificationTime;\r\n\t\t\t\t\t\tprogramVersion = aditionalData.programVersion;\r\n\r\n\t\t\t\t\t\tfor (var i = 0; i < cache.length; i++) {\r\n\t\t\t\t\t\t\tthis.set(cache[i].k, cache[i].v);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (e) {}\r\n\t\t\t},\r\n\t\t\tsetState: function(data) {\r\n\t\t\t\tif (data.ready) {\r\n\t\t\t\t\tready = data.ready;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (data.udModificationTime) {\r\n\t\t\t\t\tif ( data.clear && (udModificationTime !== data.udModificationTime) ) {\r\n\t\t\t\t\t\tvar tempProgramVersion = programVersion;\r\n\t\t\t\t\t\tthis.clear();\r\n\t\t\t\t\t\tprogramVersion = tempProgramVersion;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tudModificationTime = data.udModificationTime;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (data.cacheSize) {\r\n\t\t\t\t\tcacheSize = data.cacheSize;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (data.programVersion) {\r\n\t\t\t\t\tif (programVersion !== data.programVersion) {\r\n\t\t\t\t\t\tvar tempUdModificationTime = udModificationTime;\r\n\t\t\t\t\t\tthis.clear();\r\n\t\t\t\t\t\tudModificationTime = tempUdModificationTime;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tprogramVersion = data.programVersion;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tencode: function(s) {\r\n\t\t\t\tvar enc = '',\r\n\t\t\t\t\tstr = '';\r\n\r\n\t\t\t\t// make sure that input is string\r\n\t\t\t\tstr = s.toString();\r\n\r\n\t\t\t\tfor (var i = 0; i < s.length; i++) {\r\n\t\t\t\t\tvar a = s.charCodeAt(i), // create block\r\n\t\t\t\t\t\tb = a ^ 123; // bitwise XOR\r\n\r\n\t\t\t\t\tenc = enc + String.fromCharCode(b);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn enc;\r\n\t\t\t},\r\n\t\t\tget: function(key) {\r\n\t\t\t\tif ( map.hasOwnProperty(key) ) {\r\n\t\t\t\t\tvar value = map[key].value,\r\n\t\t\t\t\t\tnode = new DictionaryManager.Cache.Node(key, value);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tthis.remove(key);\r\n\t\t\t\t\tthis.setHead(node);\r\n\r\n\t\t\t\t\treturn value;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tset: function(key, value) {\r\n\t\t\t\tvar node = new DictionaryManager.Cache.Node(key, value);\r\n\r\n\t\t\t\tif ( map.hasOwnProperty(key) ) {\r\n\t\t\t\t\tthis.remove(key);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// if cache is full\r\n\t\t\t\t\tif (length >= cacheSize) {\r\n\t\t\t\t\t\tdelete map[tail.key];\r\n\t\t\t\t\t\tlength--;\r\n\t\t\t\t\t\ttail = tail.prev;\r\n\r\n\t\t\t\t\t\tif (tail !== null) {\r\n\t\t\t\t\t\t\ttail.next = null;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\thead = null;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.setHead(node);\r\n\t\t\t},\r\n\t\t\tremove: function(key) {\r\n\t\t\t\tif ( map.hasOwnProperty(key) ) {\r\n\t\t\t\t\tvar node = map[key];\r\n\r\n\t\t\t\t\t// update head and tail\r\n\t\t\t\t\tif (node.prev !== null) {\r\n\t\t\t\t\t\tnode.prev.next = node.next;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\thead = node.next;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (node.next !== null) {\r\n\t\t\t\t\t\tnode.next.prev = node.prev;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttail = node.prev;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// actually do the removal stuff\r\n\t\t\t\t\tdelete map[key];\r\n\t\t\t\t\tlength--;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsetHead: function(node) {\r\n\t\t\t\tnode.next = head;\r\n\t\t\t\tnode.prev = null;\r\n\r\n\t\t\t\t// if head exists\r\n\t\t\t\tif (head !== null) {\r\n\t\t\t\t\thead.prev = node;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\thead = node;\r\n\r\n\t\t\t\t// if tail does not exist\r\n\t\t\t\tif (tail === null) {\r\n\t\t\t\t\ttail = node;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlength++;\r\n\t\t\t\tmap[node.key] = node;\r\n\t\t\t},\r\n\t\t\ttoJSON: function() {\r\n\t\t\t\tvar json = [],\r\n\t\t\t\t\tnode = head;\r\n\r\n\t\t\t\twhile (node) {\r\n\t\t\t\t\tvar data = {\r\n\t\t\t\t\t\tk: node.key,\r\n\t\t\t\t\t\tv: node.value\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tjson.push(data);\r\n\t\t\t\t\tnode = node.next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn json;\r\n\t\t\t}\r\n\t\t};\r\n\t})();\r\n\r\n\t/**\r\n\t * Represents DictionaryManager.Cache.Node object.\r\n\t *\r\n\t * @constructor\r\n\t * @param {String} - Key.\r\n\t * @param {Object} - Value.\r\n\t */\r\n\tDictionaryManager.Cache.Node = function(key, value) {\r\n\t\tthis.key = key;\r\n\t\tthis.value = value;\r\n\t\tthis.prev = null;\r\n\t\tthis.next = null;\r\n\t}\r\n\r\n\texports.DictionaryManager = DictionaryManager;\r\n\r\n}( WEBSPELLCHECKER.CORE ));\n// ProblemManager.js\n/**\n * @fileoverview of CORE focus manager.\n */\n\n(function( exports ) {\n\t'use strict';\n\tvar UILib, Utils;\n\t/**\n\t * Represents ProblemManager Module.\n\t *\n\t * @constructor\n\t * @alias CORE.ProblemManager\n\t * @param {String} moduleID\n\t * @param {CORE.Sandbox} sandbox\n\t */\n\tvar ProblemManager = function(moduleID, sandbox) {\n\t\t/**\n\t\t * Module name.\n\t\t *\n\t\t * @type {String}\n\t\t*/\n\t\tvar self = this;\n\t\t/**\n\t\t * Module name.\n\t\t *\n\t\t * @type {String}\n\t\t*/\n\t\tthis.name = moduleID;\n\n\t\tUILib = sandbox.UILib;\n\t\tUtils = sandbox.Utils;\n\n\t\t/**\n\t\t * Reference to ProblemManager module sandbox.\n\t\t *\n\t\t * @type {CORE.Sandbox}\n\t\t */\n\t\tthis.sandbox = sandbox;\n\t};\n\n\n\tProblemManager.prototype = {\n\t\tconstructor: ProblemManager,\n\t\t/**\n\t\t * Called after each registration in core.\n\t\t *\n\t\t * @memberof CORE.ProblemManager#\n\t\t */\n\t\tinit() {},\n        problemTypes: {\n            spelling: {\n                type: 'spelling',\n                getSuggestionsEvent: 'getSuggestionsList',\n                replaceEvent: 'replaceWord',\n                ignoreEvent: 'ignoreWord',\n                ignoreAllEvent: 'ignoreAllWords',\n                problemNodeName: 'spellingNode',\n                replaceField: 'word',\n                attrName: 'data_attribute_name',\n                attrNameBackward: 'data_attribute_name_backward',\n                attrLang: 'data_lang_attribute',\n                nodeName: 'misspelled_word_node',\n                addWord: 'addWordToUserDictionary',\n                classOption: 'misspelled_word_class'\n            },\n            grammar: {\n                type: 'grammar',\n                getSuggestionsEvent: 'getGrammarSuggestionsList',\n                replaceEvent: 'replacePhrase',\n                ignoreEvent: 'ignorePhrase',\n                ignoreAllEvent: 'ignoreAllPhrases',\n                problemNodeName: 'grammarNode',\n                replaceField: 'phrase',\n                attrName: 'problem_grammar_data_attribute',\n                attrNameBackward: 'problem_grammar_data_attribute_backward',\n                attrRuleName: 'problem_grammar_data_attribute_rule',\n                attrLang: 'data_lang_attribute',\n                nodeName: 'problem_grammar_node',\n                classOption: 'problem_grammar_class'\n            }\n        },\n        getProblemInfo(node) {\n            var problemInfo = {},\n                nodeInfo = this.getNodeInfo(node),\n                getSuggestionsEventResult;\n\n            getSuggestionsEventResult = this.sandbox.fire(nodeInfo.getSuggestionsEvent, {problemNode: node});\n            problemInfo.suggestions = getSuggestionsEventResult.suggestionList;\n            problemInfo.type = nodeInfo.type;\n            problemInfo.text = UILib.attr( node, this.sandbox.getOption(nodeInfo.attrName) );\n\n            if ( getSuggestionsEventResult.problemDescription && !this.sandbox.getOption('disableProblemDescription') ) {\n                problemInfo.problemDescription = getSuggestionsEventResult.problemDescription;\n            }\n\n            return problemInfo;\n        },\n        getNodeInfo(node) {\n            var problem;\n\n            for (var type in this.problemTypes) {\n                problem = this.problemTypes[type];\n\n                if ( Utils.isEqualNode( node, this.sandbox.getOption(problem.attrName) ) ) {\n                    return problem;\n                }\n            }\n        },\n        getFullNodeInfo(node) {\n            var problem, attrName, attrNameBackward, classOption, isProblemNode, hasProblemClass;\n\n            for (var type in this.problemTypes) {\n                problem = this.problemTypes[type];\n                attrName = this.sandbox.getOption(problem.attrName);\n                attrNameBackward = this.sandbox.getOption(problem.attrNameBackward);\n                classOption = this.sandbox.getOption(problem.classOption);\n                isProblemNode = Utils.isEqualNode(node, attrName);\n                hasProblemClass = UILib.hasClass(node, classOption);\n\n                // Case for node with old data attribute\n                if ( attrName !== attrNameBackward && Utils.isEqualNode(node, attrNameBackward) ) {\n                    return Object.assign({\n                        broken: true\n                    }, problem);\n                }\n\n                // Case for node with problem class but without data attribute\n                if (!isProblemNode && hasProblemClass) {\n                    return Object.assign({\n                        broken: true\n                    }, problem);\n                }\n\n                // Case for node without problem class but with data attribute\n                if (isProblemNode && !hasProblemClass) {\n                    return Object.assign({\n                        broken: true\n                    }, problem);\n                }\n\n                // Case for node with problem class and with data attribute\n                if (isProblemNode && hasProblemClass) {\n                    return Object.assign({}, problem);\n                }\n            }\n        },\n        getChildProblemNodes(node) {\n            var problemNodes = [],\n                childNodes,\n                problem;\n\n            for (var type in this.problemTypes) {\n                problem = this.problemTypes[type];\n                childNodes = UILib.findNodeChildren( node, this.sandbox.getOption(problem.nodeName), this.sandbox.getOption(problem.attrName) );\n                problemNodes = problemNodes.concat(childNodes);\n            }\n\n            return problemNodes;\n        },\n        getParentProblemNodes(node) {\n            var parentNodes = UILib.parents(node),\n                container = this.sandbox.getOption('container'),\n                problemNodes = [],\n                problem,\n                parentNode;\n\n            for (var i = 0; i < parentNodes.length; i++) {\n                parentNode = parentNodes[i];\n\n                if (parentNode === container) {\n                    break;\n                }\n\n                for (var type in this.problemTypes) {\n                    problem = this.problemTypes[type];\n\n                    if (Utils.isEqualNode(parentNode, this.sandbox.getOption(problem.attrName))) {\n                        problemNodes.push(parentNode);\n                    }\n                }\n            }\n\n            return problemNodes;\n        },\n        getProblemNodeFromMouseEvent(e) {\n            var doc = Utils.getCurrentDocument( this.sandbox.getOption('documentContainer') ),\n                container = this.sandbox.getOption('container'),\n                pointerEvents = (container.style.pointerEvents === 'none'),\n                elements, cssClass, node, parentNode, mainCssClass;\n\n            if (pointerEvents) {\n                container.style.pointerEvents = '';\n            }\n\n            elements = Utils.elementsFromPoint(e.clientX, e.clientY, doc);\n\n            if (pointerEvents) {\n                container.style.pointerEvents = 'none';\n            }\n\n            if (!elements) {\n                return;\n            }\n\n            for (var typeName in this.problemTypes) {\n                cssClass = this.sandbox.getOption(this.problemTypes[typeName].classOption);\n                node = Array.prototype.filter.call(elements, element => UILib.hasClass(element, cssClass) )[0];\n                mainCssClass = mainCssClass ? mainCssClass : cssClass;\n\n                if (node) {\n                    // Native elementsFromPoint functionality in IE11 for nested problem nodes\n                    // returns array without all nodes. So we need to check parent node for this case.\n                    parentNode = UILib.parent(node);\n\n                    if ( UILib.hasClass(parentNode, mainCssClass) ) {\n                        node = parentNode[0];\n                    }\n\n                    return node;\n                }\n            }\n        },\n        getProblemNodesFromPoint(x, y) {\n            var doc = Utils.getCurrentDocument(this.sandbox.getOption('documentContainer')),\n                elements = Utils.elementsFromPoint(x, y, doc),\n                nodes = [],\n                cssClass, node;\n\n            if (!elements) {\n                return;\n            }\n\n            for (var i = 0; i < elements.length; i++) {\n                for (var typeName in this.problemTypes) {\n                    node = elements[i];\n                    cssClass = this.sandbox.getOption(this.problemTypes[typeName].classOption);\n\n                    if ( UILib.hasClass(node, cssClass) ) {\n                        nodes.push(node);\n                    }\n                }\n            }\n\n            return nodes;\n        },\n        getProblemTypes() {\n            var problemTypes = {};\n\n            for (var type in this.problemTypes) {\n                problemTypes[type] = Object.assign({}, this.problemTypes[type]);\n            }\n\n            return problemTypes;\n        }\n    };\n\n\texports.ProblemManager = ProblemManager;\n}( WEBSPELLCHECKER.CORE ));\n // ActionsManager.js\n/**\n * @fileoverview of CORE ActionsManager module.\n */\n\n(function( exports ) {\n    'use strict';\n    var Utils, UILib;\n\t/**\n\t * Represents ActionsManager Module.\n\t *\n\t * @constructor\n\t * @alias CORE.ActionsManager\n\t * @param {String} moduleID\n\t * @param {CORE.this.sandbox} this.sandbox\n\t */\n\tvar ActionsManager = function(moduleID, sandbox) {\n\t\t/**\n\t\t * Module name.\n\t\t *\n\t\t * @type {String}\n\t\t*/\n\t\tthis.name = moduleID;\n\n\t\t/**\n\t\t * Reference to ActionsManager module this.sandbox.\n\t\t *\n\t\t * @type {CORE.this.sandbox}\n\t\t */\n        this.sandbox = sandbox;\n\n        Utils = sandbox.Utils;\n        UILib = sandbox.UILib;\n\t};\n\n    ActionsManager.prototype = {\n        constructor: ActionsManager,\n        init: function() {},\n        getProblemActions(problemNode) {\n            var controlActions = this.sandbox.getOption('controlActions').slice(0),\n                problemInfo = this.sandbox.getProblemInfo(problemNode),\n                result = {};\n\n            if(problemInfo.type === 'grammar') {\n                controlActions.splice( controlActions.indexOf('addWord'), 1 );\n            }\n            controlActions = this.filterBySystemActions(controlActions);\n            result.control = this.getActions( controlActions, []).map(action => {\n                action.call = action.call.bind(this, {node: problemNode});\n                return action;\n            });\n            result.suggestions = problemInfo.suggestions.map(suggestion => {\n                var action = this.getAction('replace');\n                action.text = suggestion;\n                action.call = action.call.bind(this, {node: problemNode, suggestion});\n\n                return action;\n            });\n\n            return result\n        },\n        getStaticActions() {\n            var staticActions = this.filterBySystemActions( this.sandbox.getOption('staticActions') );\n\n            return this.getActions(staticActions, []);\n        },\n        filterBySystemActions(actions) {\n            var coreActionItems = this.sandbox.getOption('actionItems').map( actionItem => actionItem.toLowerCase() );\n            return actions.filter(action => {\n                return coreActionItems.includes(action.toLowerCase());\n            })\n        },\n        getActions: function(actionList, container) {\n            if ( Array.isArray(container) )  {\n                return actionList.map(this.getAction, this);\n            } else if (typeof container === 'object') {\n                actionList.forEach(actionName => {\n                    container[actionName] = this.getAction(actionName);\n                });\n                return container;\n            } else {\n                return this.getAction(actionList);\n            }\n        },\n        getAction(actionName) {\n            var action = this.actions[actionName];\n\n            if(!action) {\n                throw new Error('action - ' + actionName + ' not found.');\n            }\n            action = Object.assign({}, action);\n            action.getName = action.getName && action.getName.bind(this) || function() { return actionName };\n            action.isDisabled = action.isDisabled && action.isDisabled.bind(this) || function() { return false };\n            action.call = action.call.bind(this);\n\n            return action;\n        },\n        //Actions\n        actions: {\n            replace: {\n                call({suggestion, node}) {\n                    var nodeInfo = this.sandbox.getNodeInfo(node),\n                        eventObj = {};\n\n                    eventObj[nodeInfo.replaceField] = suggestion;\n                    eventObj[nodeInfo.problemNodeName] = node;\n                    eventObj.problemType = nodeInfo.type;\n                    this.sandbox.fire(nodeInfo.replaceEvent, eventObj);\n                    this.sandbox.fire('replaceProblem', eventObj);\n\n                    if(nodeInfo.type === 'grammar') {\n                        var grammarNode = this.sandbox.UILib.findNodeParents( node, nodeInfo.nodeName, this.sandbox.getOption(nodeInfo.attrName) )[0];\n                        this.sandbox.fire('removeGrammarMarkupInSelectionNode', {selectionNode: grammarNode});\n                    }\n                }\n            },\n            ignore: {\n                call({node}) {\n                    this._fireEventWithNode('ignoreEvent', node);\n                }\n            },\n            ignoreAll: {\n                call({node}) {\n                    var nodeInfo = this.sandbox.getNodeInfo(node),\n                        eventObj = {};\n\n                    eventObj[nodeInfo.problemNodeName] = node;\n                    eventObj.problemType = nodeInfo.type;\n\n                    this._fireEventWithNode('ignoreAllEvent', node);\n                    this.sandbox.fire('ignoreAllProblems', eventObj);\n                }\n            },\n            addWord: {\n                call({node}) {\n                    setTimeout(() => {\n                        this._fireEventWithNode('addWord', node);\n                    }, 10);\n                }\n            },\n            settings: {\n                call() {\n                    // we should remove selection because in chrome you can type in last focus area\n                    // if new focus area contenteditable = false\n                    if(this.sandbox.Utils.Browser.chrome) {\n                        this.sandbox.getSelection().removeAllRanges();\n                    }\n                    this.sandbox.fire('showUiElement', {\n                        elementName: 'settings'\n                    });\n                }\n            },\n            proofreadDialog: {\n                call() {\n                    // we should remove selection because in chrome you can type in last focus area\n                    // if new focus area contenteditable = false\n                    if(this.sandbox.Utils.Browser.chrome) {\n                        this.sandbox.getSelection().removeAllRanges();\n                    }\n                    this.sandbox.fire('showUiElement', {\n                        elementName: 'proofreadDialog'\n                    });\n                }\n            },\n            contextMenu: {\n                call({node}) {\n                    this.sandbox.fire('showUiElement', {\n                        elementName: 'contextMenu',\n                        parameters: {node}\n                    });\n                }\n            },\n            toggle: {\n                call() {\n                    this.sandbox.fire('toggleApp', {\n                        flag: !this.sandbox.getOption('appStarted')\n                    });\n                }\n            },\n            help: {\n                call() {\n                    window.open(this.sandbox.getOption('wscSupportUrl'), '_blank');\n                }\n            }\n        },\n        // Private\n        _fireEventWithNode(eventType, node, eventData) {\n            var problemInfo = this.sandbox.getNodeInfo(node),\n            eventData = eventData || {};\n\n            eventData[problemInfo.problemNodeName] = node;\n            this.sandbox.fire(problemInfo[eventType], eventData);\n        }\n    };\n\n   exports.ActionsManager = ActionsManager;\n\n})( WEBSPELLCHECKER.CORE );\n\n// themeManager.js\n/**\n * @fileoverview Manage Themes of CORE UI.\n */\n\n(function( exports ) {\n\t'use strict';\n\tif(exports.StyleManager) {\n\t\treturn;\n\t}\n\n\tvar UILib,\n\t\tUtils,\n\t\tlogger,\n\t\tTHEMEPATH = 'themes/all.css',\n\t\t/**\n\t\t * Flag for detecting if theme is loaded\n\t\t * @type {Boolean}\n\t\t */\n\t\tthemeLoaded = false;\n\n\t/**\n\t * @exports CORE.UI.StyleManager\n\t * @requires UILib\n\t */\n\tvar StyleManager = function(moduleID, sandbox) {\n\t\tthis.name = moduleID;\n\t\tthis.doc = (sandbox.getOption('documentContainer').nodeName.toLowerCase() == 'iframe') ? sandbox.getOption('documentContainer').contentWindow.document : document;\n\t\tthis.sandbox = sandbox;\n\t\tthis.basePath = sandbox.getOption('basePath');\n\t\tthis.misspelledNodeClass = sandbox.getOption('misspelled_word_class');\n\t\tthis.problemGrammarClass = sandbox.getOption('problem_grammar_class');\n\n\t\tlogger = sandbox.logger;\n\t\tUILib = sandbox.UILib;\n\t\tUtils = sandbox.Utils;\n\t};\n\n\tStyleManager.prototype = {\n\t\tconstructor: StyleManager,\n\t\tinit: function() {\n\t\t\tvar cssPath = this.sandbox.getOption('cssPath');\n\n\t\t\tthis.loadStyle(cssPath, this.doc);\n\t\t\t// In case with Iframe we should add css to the main page too\n\t\t\t// for case with proofread dialog what add to main page body.\n\t\t\t(this.doc !== document) && this.loadStyle(cssPath);\n\t\t\tthis.addAdditionalStyles();\n\t\t\tthis.getLanguageStyleRules();\n\t\t\t//load Theme\n\t\t\tif(!themeLoaded) {\n\t\t\t\tthis.loadStyle(this.basePath + THEMEPATH);\n\t\t\t\tthemeLoaded = true;\n\t\t\t}\n\t\t},\n\t\tloadStyle: function(path, doc) {\n\t\t\tdoc = doc || document;\n\t\t\tvar basePath = this.basePath,\n\t\t\t\tlinks = doc.getElementsByTagName('link'),\n\t\t\t\tlink;\n\n\n\t\t\tfor (var i = 0; i < links.length; i++) {\n\t\t\t\tif (links[i].href == basePath) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (doc.createStyleSheet) {\n\t\t\t\tif (doc.readyState == 'complete') {\n\t\t\t\t\tcreateStyleSheet(path);\n\t\t\t\t} else {\n\t\t\t\t\tdoc.onreadystatechange = function() {\n\t\t\t\t\t\tif (doc.readyState == 'complete') {\n\t\t\t\t\t\t\tcreateStyleSheet(path);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlink = doc.createElement('link');\n\n\t\t\t\tlink.setAttribute('rel', 'stylesheet');\n\t\t\t\tlink.setAttribute('type', 'text/css');\n\t\t\t\tlink.setAttribute('href', path);\n\n\t\t\t\tdoc.getElementsByTagName('head')[0].appendChild(link);\n\t\t\t}\n\n\t\t\tfunction createStyleSheet(cssPath) {\n\t\t\t\tvar styleSheet, node;\n\n\t\t\t\tstyleSheet = doc.createStyleSheet(cssPath);\n\t\t\t\tnode = styleSheet.ownerNode ? styleSheet.ownerNode : styleSheet.owningElement;\n\t\t\t}\n\t\t},\n\t\taddDynamicStyles: function(stylesObject, doc) {\n\t\t\tdoc = doc || this.doc;\n\t\t\tvar style = doc.createElement('style');\n\t\t\tstyle.setAttribute('data-cke-temp', 'cke_temp');\n\n\t\t\tfor(var selector in stylesObject) {\n\t\t\t\tstyle.cssText += selector + '{' + stylesObject[selector] + '}';\n\t\t\t}\n\n\t\t\tdoc.getElementsByTagName('head')[0].appendChild(style);\n\t\t},\n\t\taddAdditionalStyles: function() {\n\t\t\tvar cssRules = {},\n\t\t\t\tUILib = this.sandbox.UILib,\n\t\t\t\tdocumentNode = this.doc,\n\t\t\t\thtml = documentNode.documentElement,\n\t\t\t\tbody = documentNode.body,\n\t\t\t\trootBgColor = '';\n\n\t\t\t// check <body> first\n\t\t\trootBgColor = UILib.css(body, 'background-color');\n\n\t\t\t// check <html> if there are no bg color styles applied to <body> tag\n\t\t\tif(!rootBgColor) {\n\t\t\t\trootBgColor = UILib.css(html, 'background-color');\n\t\t\t}\n\n\t\t\tif(rootBgColor) {\n\t\t\t\t// if rootBgColor is transparent - do not add rules to stylesheet as it already contains default bg color for nested SCAYT markup\n\t\t\t\trootBgColor = rootBgColor.replace(/ /g, '').toLowerCase();\n\t\t\t\tif(rootBgColor.indexOf('rgba(0,0,0,0)') < 0 && rootBgColor.indexOf('transparent') < 0) {\n\t\t\t\t\tcssRules['.' + this.problemGrammarClass + ' > .' + this.misspelledNodeClass] = 'background-color: ' + rootBgColor + ';';\n\t\t\t\t\tcssRules['.' + this.problemGrammarClass + ' > .red'] = 'background-color: ' + rootBgColor + ';';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.addDynamicStyles(cssRules);\n\t\t},\n\t\tgetLanguageStyleRules: function() {\n\t\t\tvar cssRules = {},\n\t\t\t\tlanguageNodeName = this.sandbox.getOption('languageNodeName'),\n\t\t\t\tmultiLanguageStyles = this.sandbox.getOption('multiLanguageStyles'),\n\t\t\t\tlanguageAttributeName = this.sandbox.getOption('languageAttributeName');\n\n\t\t\tfor(var language in multiLanguageStyles) {\n\t\t\t\tcssRules[languageNodeName + '[' + languageAttributeName + '=' + language + '] .' + this.misspelledNodeClass] = multiLanguageStyles[language];\n\t\t\t}\n\n\t\t\tthis.addDynamicStyles(cssRules);\n\t\t}\n\t};\n\n\t/**\n\t * Manage Themes of CORE UI.\n\t *\n\t * @alias CORE.UI.ThemeManager\n\t */\n\texports.StyleManager = StyleManager;\n\n}( WEBSPELLCHECKER.CORE ));\n// localizationmanager.js\n/**\n * @fileoverview of CORE LocalizationManager.\n */\n(function (exports) {\n\t'use strict';\n\tvar localization;\n\tif(exports.LocalizationManager) {\n\t\treturn;\n\t}\n\t/**\n\t * @exports CORE.prototype.Localization\n\t */\n\texports.prototype.Localization = exports.prototype.Localization || {\n\n\t\t/**\n\t\t * Container localization\n\t\t * @type {Object}\n\t\t */\n\t\tlang: {},\n\t\t/**\n\t\t * Returns the localization for abbreviation\n\t\t * @param  {String} abbreviation abbreviation in language\n\t\t * @param  {String} lang language\n\t\t * @return {String} localization\n\t\t */\n\t\tgetLocal: function (abbreviation, lang) {\n\t\t\tif (!this.lang[lang] || !this.lang[lang][abbreviation]) {\n\t\t\t\treturn abbreviation;\n\t\t\t}\n\n\t\t\treturn this.lang[lang][abbreviation];\n\t\t}\n\t};\n\t/**\n\t * Represents LocalizationManager Module.\n\t *\n\t * @constructor\n\t * @alias CORE.LocalizationManager\n\t * @param {String} moduleID\n\t * @param {CORE.Sandbox} sandbox\n\t */\n\tvar LocalizationManager = function (moduleID, sandbox) {\n\t\t/**\n\t\t * Module name.\n\t\t *\n\t\t * @type {String}\n\t\t */\n\t\tthis.name = moduleID;\n\n\t\t/**\n\t\t * Reference to LocalizationManager module sandbox.\n\t\t *\n\t\t * @type {CORE.Sandbox}\n\t\t */\n\t\tthis.sandbox = sandbox;\n\n\t\t/**\n\t\t * Indicate if localization was loaded.\n\t\t *\n\t\t * @type {Boolean}\n\t\t */\n\t\tthis.localizationLoaded = false;\n\t};\n\t/**\n\t * Module initialization type.\n\t *\n\t * @type {Boolean}\n\t */\n\tLocalizationManager.async = true;\n\n\tLocalizationManager.prototype = {\n\t\tconstructor: LocalizationManager,\n        /**\n\t\t * Async load lang list before start spellchecking\n\t\t * @memberof CORE.LocalizationManager#\n\t\t */\n\t\tinit: function () {\n\t\t\tvar langId = this.sandbox.getOption('localization');\n\n\t\t\tthis.loadLocalization(langId);\n\n\t\t\tthis.sandbox.subscribe('localizationLoaded', function (data) {\n\t\t\t\tthis.handleLocalizationLoad(data);\n\t\t\t});\n\t\t},\n\t\tloadLocalization: function(langId) {\n\t\t\tvar autoDetect = this.sandbox.getOption('detectLocalizationLanguage'),\n\t\t\t\tdefaultLangId = this.sandbox.getOption('localization'),\n\t\t\t\tscriptLocation = this.sandbox.Utils.getLocationInfo( this.sandbox.getOption('basePath') ),\n\t\t\t\tlocalization = exports.prototype.Localization,\n\t\t\t\tself = this;\n\n\t\t\t// Auto detect localization only if 'detectLocalizationLanguage' option is enabled\n\t\t\t// and if user didn't specify any language that differs from default one\n\t\t\tautoDetect = autoDetect && defaultLangId === langId;\n\t\t\t\n\t\t\tif (localization.lang[langId]) {\n\t\t\t\tthis.fireModuleReady();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (autoDetect) {\n\t\t\t\tlangId = this.detect(langId);\n\t\t\t\tthis.sandbox.setOption('localization', langId);\n\t\t\t}\n\t\t\t\n\t\t\tthis.sandbox.IO.loadScript(new this.sandbox.IO.URL({\n\t\t\t\t\tprotocol: scriptLocation.protocol,\n\t\t\t\t\thost: scriptLocation.host,\n\t\t\t\t\tport: scriptLocation.port,\n\t\t\t\t\tpath: scriptLocation.pathname + this.sandbox.getOption('localizationPath') + langId + '/local.js'\n\t\t\t\t}),\n\t\t\t\t// onSuccess\n\t\t\t\tfunction (data) {\n\t\t\t\t\tself.fireModuleReady();\n\t\t\t\t\tself.sandbox.fireInAllApps('localizationLoaded', { lang: langId });\n\t\t\t\t},\n\t\t\t\t// onError\n\t\t\t\tfunction (data) {\n\t\t\t\t\tself.fireModuleReady();\n\t\t\t\t\tself.sandbox.fireInAllApps('localizationLoaded', { lang: langId });\n\t\t\t\t}\n\t\t\t);\n\t\t},\n\t\tdetect: function(defaultLanguage) {\n\t\t\tvar languagesList = this.sandbox.getOption('localizationList'),\n\t\t\t\tbrowserLanguage = navigator.userLanguage || navigator.language || defaultLanguage,\n\t\t\t\tsupportLocale = this.sandbox.getOption('supportLocale'),\n\t\t\t\tparts = browserLanguage.toLowerCase().match( /*REG_REPLACE*//([a-z]+)(?:-([a-z]+))?/),\n\t\t\t\tlang = parts[1],\n\t\t\t\tlocale = parts[2];\n\n\t\t\tif (supportLocale && languagesList.indexOf(lang + '-' + locale) > 0) {\n\t\t\t\tlang = lang + '-' + locale;\n\t\t\t} else if (languagesList.indexOf(lang) < 0) {\n\t\t\t\tlang = defaultLanguage;\n\t\t\t}\n\n\t\t\treturn lang;\n\t\t},\n\t\tfireModuleReady: function() {\n\t\t\tvar self = this;\n\n\t\t\tsetTimeout(function() {\n\t\t\t\t!self.localizationLoaded && self.sandbox.fire('moduleReady', { moduleID: self.name });\n\t\t\t\tself.localizationLoaded = true;\n\t\t\t}, 0);\n\t\t},\n\t\thandleLocalizationLoad: function(data) {\n\t\t\tvar lang = this.sandbox.getOption('localization');\n\n\t\t\tif (lang === data.lang) {\n\t\t\t\tthis.fireModuleReady();\n\t\t\t}\n\t\t}\n\t};\n\n\texports.LocalizationManager = LocalizationManager;\n\n})(WEBSPELLCHECKER.CORE);\n// markup.js\r\n// dependency from spellingmarkup - see markupWords method and removeGrammarMarkupInSelectionNode event there\r\n/**\r\n * @fileoverview of CORE markup module.\r\n */\r\n\r\n(function( exports ) {\r\n\t'use strict';\r\n\tvar UILib;\r\n\t/**\r\n\t* Markup Module constructor.\r\n\t* @constructor\r\n\t* @alias CORE.Markup\r\n\t* @param {String} moduleID\r\n\t* @param {CORE.Sandbox} sandbox\r\n\t*/\r\n\tvar Markup = function(moduleID, sandbox) {\r\n\t\t/**\r\n\t\t* module name\r\n\t\t* @type {String}\r\n\t\t*/\r\n\t\tthis.name = moduleID;\r\n\r\n\t\t/**\r\n\t\t* reference to Markup module sandbox\r\n\t\t* @type {CORE.Sandbox}\r\n\t\t*/\r\n\t\tthis.sandbox = sandbox;\r\n\r\n\t\tUILib = this.sandbox.UILib;\r\n\t};\r\n\r\n\tMarkup.prototype = {\r\n\t\t/**\r\n\t\t* Called after each registration in core\r\n\t\t* @memberof CORE.Markup#\r\n\t\t*/\r\n\t\tinit: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tthis.sandbox.subscribe('markupWords', function(data) {\r\n\t\t\t\tthis.markupWords(data.ranges, data.lang);\r\n\t\t\t}, this);\r\n\r\n\t\t\tthis.sandbox.subscribe({\r\n\t\t\t\teventType: 'keydown',\r\n\t\t\t\telement: this.sandbox.getOption('container'),\r\n\t\t\t\thandler: this.handleKeydown,\r\n\t\t\t\tpriority: 1500,\r\n\t\t\t\tcontext: this\r\n\t\t\t});\r\n\r\n\t\t\tthis.sandbox.subscribe('removeMarkupInSelectionNode', function(data) {\r\n\t\t\t\tthis.removeMarkupInSelectionNode(data);\r\n\t\t\t}, this);\r\n\r\n\t\t\tthis.sandbox.subscribe('removeMarkupInDocument', function() {\r\n\t\t\t\tthis.removeMarkupInDocument();\r\n\t\t\t}, this);\r\n\r\n\t\t\tthis.sandbox.subscribe('removeMarkupFromWords', function(data) {\r\n\t\t\t\tthis.removeMarkupFromWords(data.words);\r\n\t\t\t}, this);\r\n\r\n\t\t\tthis.sandbox.subscribe('removeMarkup', function(data) {\r\n\t\t\t\tdata.spelling && this.removeMarkup(data.nodes);\r\n\t\t\t}, this);\r\n\t\t},\r\n\t\t/**\r\n\t\t* @memberof CORE.Markup#\r\n\t\t* @param {Object} event - HTML DOM Event\r\n\t\t*/\r\n\t\thandleKeydown: function(event) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tUtils = this.sandbox.Utils,\r\n\t\t\t\tcKey = 67,\r\n\t\t\t\txKey = 88,\r\n\t\t\t\taKey = 65,\r\n\t\t\t\tuKey = 90,\r\n\t\t\t\trKey = 89,\r\n\t\t\t\tcopyAction, selectAllAction, undoAction, redoAction, additionalRedoAction,\r\n\t\t\t\tnotShortcutActions, printableKey, notExcludeKey, alternativeKey, monitoredKey,\r\n\t\t\t\texcludeKeyCodes = [\t// key codes that not in range between 40..91\r\n\t\t\t\t\t45,\t\t// 'insert' key\r\n\t\t\t\t],\r\n\t\t\t\talternativeKeyCodes = [ // key codes that shoud remove markup regardless to all other conditions\r\n\t\t\t\t\t8,\t\t// backspace\r\n\t\t\t\t\t106,\t// numpad '*'\r\n\t\t\t\t\t107,\t// numpad '+'\r\n\t\t\t\t\t109,\t// numpad '-'\r\n\t\t\t\t\t110,\t// numpad '.'\r\n\t\t\t\t\t111,\t// numpad '/'\r\n\t\t\t\t\t187,\t// '-' or '_' (+ shift key)\r\n\t\t\t\t\t186,\t// ';' or ':' (+ shift key)\r\n\t\t\t\t\t188,\t// ',' or '<' (+ shift key)\r\n\t\t\t\t\t190,\t// '.' or '>' (+ shift key)\r\n\t\t\t\t\t191,\t// '/' or '?' (+ shift key)\r\n\t\t\t\t\t192,\t// '`' or '~' (+ shift key)\r\n\t\t\t\t\t219,\t// '[' or '{' (+ shift key)\r\n\t\t\t\t\t220,\t// '\\' or '|' (+ shift key)\r\n\t\t\t\t\t221,\t// ']' or '}' (+ shift key)\r\n\t\t\t\t\t222\t\t// \"'\" or '\"' (+ shift key)\r\n\t\t\t\t],\r\n\t\t\t\tmonitoredKeyCodes = [ // key codes which need additional processing\r\n\t\t\t\t\t13,\t\t// enter\r\n\t\t\t\t\t32\t\t// space\r\n\t\t\t\t];\r\n\r\n\r\n\t\t\t// Firefox has another keycode for some key\r\n\t\t\tif (Utils.Browser.gecko) {\r\n\t\t\t\talternativeKeyCodes.push(173);\r\n\t\t\t} else {\r\n\t\t\t\talternativeKeyCodes.push(189);\r\n\t\t\t}\r\n\r\n\t\t\tcopyAction = (event.ctrlKey || event.metaKey) && event.keyCode === cKey;\r\n\t\t\tselectAllAction = (event.ctrlKey || event.metaKey) && event.keyCode === aKey;\r\n\t\t\tundoAction = (event.ctrlKey || event.metaKey) && !event.shiftKey && event.keyCode === uKey;\r\n\t\t\tredoAction = (event.ctrlKey || event.metaKey) && event.shiftKey && event.keyCode === uKey;\r\n\t\t\tadditionalRedoAction = (event.ctrlKey || event.metaKey) && !event.shiftKey && event.keyCode === rKey;\r\n\r\n\t\t\tnotShortcutActions = !copyAction && !selectAllAction && !undoAction && !redoAction && !additionalRedoAction;\r\n\t\t\tprintableKey = (event.keyCode > 40 && event.keyCode < 91) || (event.keyCode >= 96 && event.keyCode <= 105);\r\n\t\t\tnotExcludeKey = excludeKeyCodes.indexOf(event.keyCode) < 0;\r\n\t\t\talternativeKey = alternativeKeyCodes.indexOf(event.keyCode) >= 0;\r\n\t\t\tmonitoredKey = monitoredKeyCodes.indexOf(event.keyCode) >= 0;\r\n\r\n\t\t\tif (notShortcutActions && printableKey && notExcludeKey || alternativeKey || monitoredKey) {\r\n\t\t\t\tif( monitoredKey && this.sandbox.isCaretInEndOfMisspelledWord() ) {\r\n\t\t\t\t\tvar spellingNode = this.getSpellingNodeIfCaretInEndOfIt(),\r\n\t\t\t\t\t\tisNodeContentBroken = spellingNode ? this.sandbox.isNodeContentBroken(spellingNode, this.sandbox.getOption('data_attribute_name')) : false;\r\n\r\n\t\t\t\t\t// If node content are broken we should to remove markup\r\n\t\t\t\t\tif (isNodeContentBroken) {\r\n\t\t\t\t\t\tself.removeMarkupInSelectionNode();\r\n\t\t\t\t\t} else if (spellingNode) {\r\n\t\t\t\t\t\tself.moveCaretFromSpellingNode(spellingNode);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tself.removeMarkupInSelectionNode();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t* @memberof CORE.Markup#\r\n\t\t* @param {Node} node - misspelled node\r\n\t\t*/\r\n\t\tmoveCaretFromSpellingNode: function(node) {\r\n\t\t\tvar spellingNode = node,\r\n\t\t\t\tselection = this.sandbox.getSelection(),\r\n\t\t\t\tdoc = this.sandbox.Utils.getCurrentDocument(this.sandbox.getOption('documentContainer')),\r\n\t\t\t\telement,\r\n\t\t\t\trange,\r\n\t\t\t\tspellingParentNode,\r\n\t\t\t\tself = this;\r\n\r\n\t\t\tspellingParentNode = spellingNode.parentNode;\r\n\t\t\trange = this.sandbox.createRange();\r\n\t\t\telement = document.createTextNode('\\u200C');\r\n\t\t\tspellingParentNode.insertBefore(element, spellingNode.nextSibling);\r\n\t\t\trange.setStartAfter(element);\r\n\t\t\trange.collapse(true);\r\n\t\t\tselection.removeAllRanges();\r\n\t\t\tselection.addRange(range);\r\n\r\n\t\t\tsetTimeout(function() {\r\n\t\t\t\tvar savedSel = self.sandbox.saveSelection();\r\n\r\n\t\t\t\telement.nodeValue = element.nodeValue.replace(/\\u200C/, '');\r\n\r\n\t\t\t\tself.sandbox.restoreSelection(savedSel, true);\r\n\t\t\t}, 0);\r\n\t\t},\r\n\t\t/**\r\n\t\t* @memberof CORE.Markup#\r\n\t\t* @param {Array} ranges - Array of ranges\r\n\t\t*/\r\n\t\tmarkupWords: function(ranges, lang) {\r\n\t\t\tif(ranges.length === 0) {\r\n\t\t\t\treturn; // TODO: move to another place?\r\n\t\t\t}\r\n\r\n\t\t\tvar self = this,\r\n\t\t\t\tdocumentContainer = self.sandbox.getOption('documentContainer'),\r\n\t\t\t\tmisspelled_word_node = self.sandbox.getOption('misspelled_word_node'),\r\n\t\t\t\tdata_attribute_name = self.sandbox.getOption('data_attribute_name'),\r\n\t\t\t\tdataLangAttrName = self.sandbox.getOption('data_lang_attribute'),\r\n\t\t\t\tmisspelled_word_class = self.sandbox.getOption('misspelled_word_class'),\r\n\t\t\t\tspecialCharactersRegex = self.sandbox.getRegExp('specialCharacters').set().onePlus().g();\r\n\r\n\t\t\tvar strong = self.sandbox.Utils.getCurrentDocument(documentContainer).createElement(misspelled_word_node);\r\n\t\t\tthis.sandbox.UILib.addClass(strong, misspelled_word_class);\r\n\r\n\t\t\t// Markup functionality does not broke nodes.\r\n\t\t\t// So we need to lock mutations listener.\r\n\t\t\tthis.sandbox.fireInAllApps('lockMutationsListener', {lock: true});\r\n\r\n\t\t\tfor(var i = 0; i < ranges.length; i++) {\r\n\t\t\t\tif(ranges[i].language === lang) {\r\n\t\t\t\t\tvar _selectionNode = ranges[i].range.commonAncestorContainer();\r\n\t\t\t\t\tvar _spellingParentsNode = self.sandbox.Utils.isEqualNode(_selectionNode, data_attribute_name) ? [_selectionNode] : UILib.findNodeParents(_selectionNode, misspelled_word_node, data_attribute_name);\r\n\r\n\t\t\t\t\tif(_spellingParentsNode.length === 0) {\r\n\t\t\t\t\t\tvar _strong = strong.cloneNode(true);\r\n\t\t\t\t\t\tvar _word = ranges[i].range.toString();\r\n\t\t\t\t\t\t_strong.setAttribute( data_attribute_name,  specialCharactersRegex.replace(_word, '') );\r\n\t\t\t\t\t\tif(lang) {\r\n\t\t\t\t\t\t\t_strong.setAttribute(dataLangAttrName, lang);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t_strong.appendChild(ranges[i].range.extractContents());\r\n\t\t\t\t\t\tranges[i].range.insertNode(_strong);\r\n\r\n\t\t\t\t\t\tvar _spellingChildNodes = UILib.findNodeChildren(_strong, misspelled_word_node, data_attribute_name);\r\n\r\n\t\t\t\t\t\t// TODO needs to refactoring markup module\r\n\t\t\t\t\t\tself.sandbox.fire('markupedNode',  {\r\n\t\t\t\t\t\t\tnode : _strong,\r\n\t\t\t\t\t\t\ttype: 'spelling',\r\n\t\t\t\t\t\t\tword: ranges[i].word,\r\n\t\t\t\t\t\t\tsuggestions: ranges[i].suggestions,\r\n\t\t\t\t\t\t\tindex: ranges[i].index\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\twhile (_spellingChildNodes.length > 0) {\r\n\t\t\t\t\t\t\tvar _spellingNode = _spellingChildNodes.shift();\r\n\t\t\t\t\t\t\tself.removeMarkup(_spellingNode);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Unlock mutations listener after markup functionality.\r\n\t\t\tthis.sandbox.fireInAllApps('lockMutationsListener', {lock: false});\r\n\t\t},\r\n\t\t/**\r\n\t\t* Finds all spelling nodes in document and call [removeMarkup]{@link CORE.Markup#removeMarkup} method\r\n\t\t* @memberof CORE.Markup#\r\n\t\t*/\r\n\t\tremoveMarkupInDocument: function() {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcontainer = self.sandbox.getOption('container'),\r\n\t\t\t\tmisspelled_word_node = self.sandbox.getOption('misspelled_word_node'),\r\n\t\t\t\tdata_attribute_name = self.sandbox.getOption('data_attribute_name'),\r\n\t\t\t\tnodesWithMarkup;\r\n\r\n\t\t\tnodesWithMarkup = UILib.query(container, misspelled_word_node + '[' + data_attribute_name + ']');\r\n\t\t\tself.removeMarkup(nodesWithMarkup);\r\n\t\t},\r\n\t\t/**\r\n\t\t* Finds all spelling nodes with requested words and languages and call [removeMarkup]{@link CORE.Markup#removeMarkup} method\r\n\t\t* @param {Array} words - Array of [words]{@link CORE.DictionaryManager.Word}\r\n\t\t* @memberof CORE.Markup#\r\n\t\t*/\r\n\t\tremoveMarkupFromWords: function(words) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcontainer = self.sandbox.getOption('container'),\r\n\t\t\t\tmisspelled_word_node = self.sandbox.getOption('misspelled_word_node'),\r\n\t\t\t\tdata_attribute_name = self.sandbox.getOption('data_attribute_name'),\r\n\t\t\t\tdataLangAttrName = this.sandbox.getOption('data_lang_attribute'),\r\n\t\t\t\t_spellingNodes = [],\r\n\t\t\t\tlang, foundNodes;\r\n\r\n\t\t\tfor(var i = 0; i < words.length; i++) {\r\n\t\t\t\tfoundNodes = UILib.query(container, misspelled_word_node + '[' + data_attribute_name + '=\"' + words[i].word + '\"]');\r\n\t\t\t\tlang = words[i].lang;\r\n\t\t\t\tif(lang) {\r\n\t\t\t\t\tfoundNodes = UILib.filter(foundNodes, '[' + dataLangAttrName + '=\"' + lang + '\"]');\r\n\t\t\t}\r\n\t\t\t\t_spellingNodes.push.apply(_spellingNodes, foundNodes);\r\n\t\t\t}\r\n\r\n\t\t\tself.removeMarkup(_spellingNodes);\r\n\t\t},\r\n\t\t/**\r\n\t\t* Finds spelling node in current selection and call [removeMarkup]{@link CORE.Markup#removeMarkup} method\r\n\t\t* @param undefined or {Object} that have \"selectionNode\" property that have node or nodes from which we want to remove markup\r\n\t\t* @memberof CORE.Markup#\r\n\t\t*/\r\n\t\tremoveMarkupInSelectionNode: function(data) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tUtils = this.sandbox.Utils,\r\n\t\t\t\tUILib = this.sandbox.UILib,\r\n\t\t\t\tdataAttributeName = self.sandbox.getOption('data_attribute_name'),\r\n\t\t\t\tselectionNode = data && data.selectionNode,\r\n\t\t\t\tremoveInside = data && data.removeInside,\r\n\t\t\t\tforceBookmark = data && data.forceBookmark,\r\n\t\t\t\tselection = self.sandbox.getSelection(),\r\n\t\t\t\tcontainer = this.sandbox.getOption('container'),\r\n\t\t\t\tleftStartNode, rightStartNode,\r\n\t\t\t\trange, leftStartOffset, rightStartOffset,\r\n\t\t\t\tspellingNodesToRemove = []; // misspelled nodes we need to remove from DOM\r\n\r\n\t\t\tfunction getSpellingNodes(nodeArray) {\r\n\t\t\t\tvar result = [];\r\n\r\n\t\t\t\tresult = nodeArray.filter(function(node) {\r\n\t\t\t\t\treturn Utils.isEqualNode(node, dataAttributeName);\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\r\n\t\t\tif(selectionNode) {\r\n\t\t\t\trange = self.sandbox.createRange();\r\n\t\t\t\trange.selectNode(selectionNode);\r\n\t\t\t\tspellingNodesToRemove = range.getNodes();\r\n\t\t\t} else if(selection.rangeCount() > 0) {\r\n\t\t\t\trange = selection.getRangeAt(0);\r\n\r\n\t\t\t\t// no need to check for bakcward selection as start and end containers always in right order\r\n\t\t\t\tleftStartNode = range.startContainer();\r\n\t\t\t\trightStartNode = range.endContainer();\r\n\r\n\t\t\t\tleftStartOffset = range.startOffset();\r\n\t\t\t\trightStartOffset = range.endOffset();\r\n\r\n\t\t\t\t// get neighbour nodes to the borders of selection\r\n\t\t\t\tspellingNodesToRemove = this.getNeighbourSpellingNodes(leftStartNode, rightStartNode, leftStartOffset, rightStartOffset);\r\n\r\n\t\t\t\tif(removeInside) {\r\n\t\t\t\t\tspellingNodesToRemove = spellingNodesToRemove.concat(range.getNodes());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// filter all found nodes and leave only with our markup\r\n\t\t\tspellingNodesToRemove = getSpellingNodes(spellingNodesToRemove);\r\n\t\t\t// make array of unique items to prevent situation when we have two same Grammar nodes\r\n\t\t\tspellingNodesToRemove = Utils.ArrayUtils.arrayUnique(spellingNodesToRemove);\r\n\r\n\t\t\tif(forceBookmark && !this.sandbox.getOption('focused') && spellingNodesToRemove.length > 0) {\r\n\t\t\t\tthis.sandbox.fire({\r\n\t\t\t\t\teventType: 'focus',\r\n\t\t\t\t\telement: container\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i = 0, len = spellingNodesToRemove.length; i < len; i += 1) {\r\n\t\t\t\tself.removeMarkup(spellingNodesToRemove[i]);\r\n\t\t\t}\r\n\t\t},\r\n\t\tgetNeighbourSpellingNodes: function(leftStartNode, rightStartNode, leftStartOffset, rightStartOffset) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tUtils = this.sandbox.Utils,\r\n\t\t\t\tUILib = this.sandbox.UILib,\r\n\t\t\t\tfoundNodes = [],\r\n\t\t\t\tleftDirectionData, rightDirectionData,\r\n\t\t\t\tmisspelledAttrName = this.sandbox.getOption('data_attribute_name'),\r\n\t\t\t\tmisspelledWordNode = this.sandbox.getOption('misspelled_word_node'),\r\n\t\t\t\tbackspaceKeyButtonPressed = self.sandbox.getOption('backspaceKeyButtonPressed'),\r\n\t\t\t\tdeleteKeyButtonPressed = self.sandbox.getOption('deleteKeyButtonPressed');\r\n\r\n\t\t\t// rtl search direction\r\n\t\t\tleftDirectionData = getNearestSpellingNode(false, leftStartNode, leftStartOffset);\r\n\t\t\t// ltr search direction\r\n\t\t\trightDirectionData = getNearestSpellingNode(true, rightStartNode, rightStartOffset);\r\n\r\n\t\t\t// Additional filter for case when we have two or more white space symbols before cursor\r\n\t\t\t// texxt  ^texxt\r\n\t\t\tif (backspaceKeyButtonPressed) {\r\n\t\t\t\tif ( /^\\s{2,}/.test(leftDirectionData.text) ) {\r\n\t\t\t\t\tleftDirectionData.spellingNode = null;\r\n\t\t\t\t\trightDirectionData.spellingNode = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Additional filter for case when we have two or more white space symbols after cursor\r\n\t\t\t// texxt^  texxt\r\n\t\t\tif (deleteKeyButtonPressed) {\r\n\t\t\t\tif ( /^\\s{2,}/.test(rightDirectionData.text) ) {\r\n\t\t\t\t\tleftDirectionData.spellingNode = null;\r\n\t\t\t\t\trightDirectionData.spellingNode = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Additional filter for case when we have one or more white space symbols before and after cursor\r\n\t\t\t// texxt ^ texxt\r\n\t\t\tif (backspaceKeyButtonPressed || deleteKeyButtonPressed) {\r\n\t\t\t\tif ( /^\\s+/.test(leftDirectionData.text) && /^\\s+/.test(rightDirectionData.text) ) {\r\n\t\t\t\t\tleftDirectionData.spellingNode = null;\r\n\t\t\t\t\trightDirectionData.spellingNode = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfoundNodes = foundNodes.concat(leftDirectionData.spellingNode, rightDirectionData.spellingNode);\r\n\r\n\t\t\treturn foundNodes;\r\n\r\n\t\t\tfunction getNearestSpellingNode(direction, startNode, startOffset) {\r\n\t\t\t\tvar container = self.sandbox.getOption('container'),\r\n\t\t\t\t\tnonWhiteSpaceExtended = self.sandbox.getRegExp('nonWhiteSpaceExtended'),\r\n\t\t\t\t\tnonWhiteSpaceExtendedGlobal = nonWhiteSpaceExtended.g(),\r\n\t\t\t\t\tpunctuationRegExp = self.sandbox.getRegExp('punctuationRegExp').set(),\r\n\t\t\t\t\twordBoundaryRegex = self.sandbox.getRegExp('wordBoundaryRegex'),\r\n\t\t\t\t\tblockElementsRegex = self.sandbox.getRegExp('blockElementsRegex'),\r\n\t\t\t\t\tbackspaceKeyButtonPressed = self.sandbox.getOption('backspaceKeyButtonPressed'),\r\n\t\t\t\t\tdeleteKeyButtonPressed = self.sandbox.getOption('deleteKeyButtonPressed'),\r\n\t\t\t\t\tspaceKeyButtonPressed = self.sandbox.getOption('spaceKeyButtonPressed'),\r\n\t\t\t\t\tenterKeyButtonPressed = self.sandbox.getOption('enterKeyButtonPressed'),\r\n\t\t\t\t\tcollapsed = self.sandbox.getSelection().getRangeAt(0).collapsed(),\r\n\t\t\t\t\tspellingNode, text, textWithoutPunctuation, punctuationWasFounded, walker;\r\n\r\n\t\t\t\tif(startNode) {\r\n\t\t\t\t\twalker = new Utils.Walker(startNode, startOffset, direction, container);\r\n\r\n\t\t\t\t\tdo {\r\n\t\t\t\t\t\t// 1. If we have sibling node and this node is block element we should not remove markup from this elements\r\n\t\t\t\t\t\t// <p>texxt</p>\r\n\t\t\t\t\t\t// <p>texxt</p>\r\n\t\t\t\t\t\t// <p>hel^lo</p>\r\n\t\t\t\t\t\t// <p>texxt</p>\r\n\t\t\t\t\t\t// <p>texxt</p>\r\n\t\t\t\t\t\tif ( walker.siblingNode &&\r\n\t\t\t\t\t\t\tblockElementsRegex.test( walker.siblingNode.nodeName.toLowerCase() ) &&\r\n\t\t\t\t\t\t\twalker.textWalkedThrough.length > 0 &&\r\n\t\t\t\t\t\t\tnonWhiteSpaceExtended.test(walker.textWalkedThrough) ) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// 2. If we found spelling node stop further search\r\n\t\t\t\t\t\t// Bug #72148 FF - added check for text walked through to prevent situations like this:\r\n\t\t\t\t\t\t//\r\n\t\t\t\t\t\t// is: \t\t\t<span class=\"spelling-word\">appel</span>[space]<span class=\"spelling-word\">^texxt^</span>\r\n\t\t\t\t\t\t// should be: \t<span class=\"spelling-word\">appel</span>[space]^<span class=\"spelling-word\">texxt</span>^\r\n\t\t\t\t\t\t//\r\n\t\t\t\t\t\t// otherwise we willn't find neighbour misspelled nodes and stay satisfied with first parent misspelled node\r\n\t\t\t\t\t\tif(Utils.isEqualNode(walker.currentNode, misspelledAttrName) && walker.textWalkedThrough.length > 0) {\r\n\t\t\t\t\t\t\tspellingNode = walker.currentNode;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ttext = walker.textWalkedThrough;\r\n\t\t\t\t\t\ttextWithoutPunctuation = punctuationRegExp.g().replace(walker.textWalkedThrough, ' ');\r\n\t\t\t\t\t\tpunctuationWasFounded = punctuationRegExp.search(text) !== -1;\r\n\r\n\t\t\t\t\t\tif(!direction) {\r\n\t\t\t\t\t\t\ttext = text.split('').reverse().join('');\r\n\t\t\t\t\t\t\ttextWithoutPunctuation = textWithoutPunctuation.split('').reverse().join('');\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// 3. If we type space or enter after word boundary symbols (space, dot and another punctuation symbols) we do not need to remove markup.\r\n\t\t\t\t\t\t// texxt.^\r\n\t\t\t\t\t\tif ( (spaceKeyButtonPressed || enterKeyButtonPressed) && !direction && wordBoundaryRegex.test(text) ) {\r\n\t\t\t\t\t\t\t// In some cases misspelled word can be broken by external code.\r\n\t\t\t\t\t\t\t// So misspelled node can be with punctuation symbols like this:\r\n\t\t\t\t\t\t\t// <span class=\"spelling-word\">appel </span>\r\n\t\t\t\t\t\t\t// We need to check if found punctuation symbols not in the misspelled node.\r\n\t\t\t\t\t\t\tspellingNode = UILib.findNodeParents(walker.currentNode, misspelledWordNode, misspelledAttrName)[0];\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// 4. If we type delete after white space symbols we do not need to remove markup.\r\n\t\t\t\t\t\t// texxt ^it\r\n\t\t\t\t\t\tif ( deleteKeyButtonPressed && !direction && text.search(/\\s/) === 0 ) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// 5. If we type backspase before white space symbols we do not need to remove markup.\r\n\t\t\t\t\t\t// it^ texxt\r\n\t\t\t\t\t\tif ( backspaceKeyButtonPressed && direction && text.search(/\\s/) === 0 ) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// 6. If we found punctuation symbols (space, coma and another punctuation symbols) in text we should stop searching\r\n\t\t\t\t\t\tif ( punctuationWasFounded && !deleteKeyButtonPressed && !backspaceKeyButtonPressed ) {\r\n\t\t\t\t\t\t\t// In some cases misspelled word can be broken by external code.\r\n\t\t\t\t\t\t\t// So misspelled node can be with punctuation symbols like this:\r\n\t\t\t\t\t\t\t// <span class=\"spelling-word\">appel </span>\r\n\t\t\t\t\t\t\t// We need to check if found punctuation symbols not in the misspelled node.\r\n\t\t\t\t\t\t\tspellingNode = UILib.findNodeParents(walker.currentNode, misspelledWordNode, misspelledAttrName)[0];\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// 7. If we found word symbols (not white space symbols) in text we should stop searching\r\n\t\t\t\t\t\tnonWhiteSpaceExtendedGlobal.setLastIndex(0);\r\n\t\t\t\t\t\tif ( nonWhiteSpaceExtendedGlobal.test(textWithoutPunctuation) ) {\r\n\t\t\t\t\t\t\tif (nonWhiteSpaceExtendedGlobal.getLastIndex() + 1 <= text.length) {\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} while (walker.getNext());\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tspellingNode: spellingNode,\r\n\t\t\t\t\ttext: text\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t},\r\n\t\tgetSpellingNodeIfCaretInEndOfIt: function() {\r\n\t\t\tvar spellingNode = this.sandbox.getSpellingNodeFromSelection(),\r\n\t\t\t\tselection = this.sandbox.getSelection(),\r\n\t\t\t\tnodes = selection.getRangeAt(0).endContainer().childNodes,\r\n\t\t\t\ttempNode;\r\n\r\n\t\t\tif(!spellingNode && nodes.length) {\r\n\t\t\t\t//because if we haven't spellingNode in selection but consider what we in misspeled node\r\n\t\t\t\t// than selection container - its parent element with offset in child Nodes\r\n\t\t\t\t// we should get node before last - its spelling node\r\n\t\t\t\ttempNode = nodes[selection.getRangeAt(0).startOffset() - 1];\r\n\t\t\t\tspellingNode = tempNode && tempNode.nodeType === 1 ? tempNode : null;\r\n\t\t\t}\r\n\r\n\t\t\treturn spellingNode;\r\n\t\t},\r\n\t\t/**\r\n\t\t* @memberof CORE.Markup#\r\n\t\t* @param {Array} nodes - Array of misspelled nodes\r\n\t\t*/\r\n\t\tremoveMarkup: function(nodes) {\r\n\t\t\t//node = node.parentNode;\r\n\t\t\tvar savedSel, spellingNode, range, fragment,\r\n\t\t\t\tdoc = this.sandbox.Utils.getCurrentDocument(this.sandbox.getOption('documentContainer')),\r\n\t\t\t\tfocused = this.sandbox.isFocused(),\r\n\t\t\t\t_nodes = [].concat(nodes);\r\n\r\n\t\t\tif (focused && _nodes.length > 0) {\r\n\t\t\t\t// TODO: review possibility to move focus check inside saveSelection method.\r\n\t\t\t\tsavedSel = this.sandbox.saveSelection();\r\n\t\t\t}\r\n\r\n\t\t\t// Remove markup functionality does not broke nodes.\r\n\t\t\t// So we need to lock mutations listener.\r\n\t\t\tthis.sandbox.fireInAllApps('lockMutationsListener', {lock: true});\r\n\r\n\t\t\twhile(_nodes.length > 0) {\r\n\t\t\t\tspellingNode = _nodes.shift();\r\n\r\n\t\t\t\tif(spellingNode.innerHTML) {\r\n\t\t\t\t\trange = this.sandbox.createRange();\r\n\t\t\t\t\trange.selectNodeContents(spellingNode);\r\n\t\t\t\t\tfragment = range.extractContents();\r\n\t\t\t\t\trange.selectNode(spellingNode);\r\n\t\t\t\t\trange.deleteContents();\r\n\t\t\t\t\trange.insertNode(fragment);\r\n\t\t\t\t\t// TODO needs to refactoring markup module\r\n\t\t\t\t\tthis.sandbox.fire('removedMarkupInContainer', {\r\n\t\t\t\t\t\tnode : range.commonAncestorContainer(),\r\n\t\t\t\t\t\tremovedNodes: [spellingNode]\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.sandbox.UILib.remove(spellingNode);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.sandbox.restoreSelection(savedSel, true);\r\n\r\n\t\t\t// Unlock mutations listener after remove markup functionality.\r\n\t\t\tthis.sandbox.fireInAllApps('lockMutationsListener', { lock: false });\r\n\t\t}\r\n\t};\r\n\r\n\texports.Markup = Markup;\r\n\r\n}( WEBSPELLCHECKER.CORE ));\n// wordscollector.js\n/**\n * @fileoverview of CORE words collector module.\n */\n\n(function( exports ) {\n\t'use strict';\n\n\t/**\n\t* WordsCollector Module constructor.\n\t* @constructor\n\t* @alias CORE.WordsCollector\n\t* @param {String} moduleID\n\t* @param {CORE.Sandbox} sandbox\n\t*/\n\tvar WordsCollector = function(moduleID, sandbox) {\n\t\t/**\n\t\t* module name\n\t\t* @type {String}\n\t\t*/\n\t\tthis.name = moduleID;\n\n\t\t/**\n\t\t* reference to WordsCollector module sandbox\n\t\t* @type {CORE.Sandbox}\n\t\t*/\n\t\tthis.sandbox = sandbox;\n\t};\n\n\tWordsCollector.prototype = {\n\t\t/**\n\t\t* Called after each registration in core\n\t\t* @memberof CORE.WordsCollector#\n\t\t*/\n\t\tinit: function() {\n\t\t\tthis.sandbox.subscribe('startSpellCheck', function(data) {\n\t\t\t\tthis.startSpellCheck();\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'keydown',\n\t\t\t\telement: this.sandbox.getOption('container'),\n\t\t\t\thandler: function(event) {\n\t\t\t\t\tthis.handleKeydown(event);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe('collectWords', function(data) {\n\t\t\t\tthis.collectWords(data.source, data.ignoreMisspellingsInContainer);\n\t\t\t}, this);\n\t\t},\n\t\t/**\n\t\t* @memberof CORE.WordsCollector#\n\t\t* @param {Object} event - HTML DOM Event\n\t\t*/\n\t\thandleKeydown: function(event) {\n\t\t\tvar self = this,\n\t\t\t\tmultiLanguageMode = this.sandbox.getOption('multiLanguageMode'),\n\t\t\t\tspellCheckSource;\n\n\t\t\tif (event.keyCode == 32 || event.keyCode == 13 || event.charCode == 32 || event.charCode == 13) {\n\t\t\t\tself.sandbox.addDeferredFunction('collectWordsAfterKeypress', {\n\t\t\t\t\tsingle: true,\n\t\t\t\t\tdelay: 0,\n\t\t\t\t\tdeferredFunction: function() {\n\t\t\t\t\t\tvar _selection = self.sandbox.getSelection(),\n\t\t\t\t\t\t\tspellCheckSource;\n\n\t\t\t\t\t\tif (_selection.rangeCount() > 0) {\n\t\t\t\t\t\t\tvar range = _selection.getRangeAt(0);\n\n\t\t\t\t\t\t\tspellCheckSource = multiLanguageMode ? range.commonAncestorContainer() : range;\n\n\t\t\t\t\t\t\tself.sandbox.fire('collectWords', { source: spellCheckSource });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tself.sandbox.addDeferredFunction('collectWordsAfterDelay', {\n\t\t\t\tsingle: true,\n\t\t\t\tdelay: 2000,\n\t\t\t\tdeferredFunction: function() {\n\t\t\t\t\tvar container = self.sandbox.getOption('container'),\n\t\t\t\t\t\trange;\n\n\t\t\t\t\tif(multiLanguageMode) {\n\t\t\t\t\t\tspellCheckSource = container;\n\t\t\t\t\t} else {\n\t\t\t\t\t\trange = self.sandbox.createRange();\n\t\t\t\t\t\trange.selectNodeContents(container);\n\t\t\t\t\t\tspellCheckSource = range;\n\t\t\t\t\t}\n\n\t\t\t\t\tself.sandbox.fire('collectWords', { source: spellCheckSource });\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t* @memberof CORE.WordsCollector#\n\t\t* @fires CORE.Communication.collectWords\n\t\t*/\n\t\tstartSpellCheck: function() {\n\t\t\tvar range = this.sandbox.createRange(),\n\t\t\t\tcontainer = this.sandbox.getOption('container'),\n\t\t\t\tmultiLanguageMode = this.sandbox.getOption('multiLanguageMode'),\n\t\t\t\tspellCheckSource;\n\n\t\t\tif(multiLanguageMode) {\n\t\t\t\t// in case of multiLanguage mode we need to collect words from container all the\n\t\t\t\t// time in oreder to collect all used languages too\n\t\t\t\tspellCheckSource = container;\n\t\t\t} else {\n\t\t\t\trange.selectNodeContents(container);\n\t\t\t\tspellCheckSource = range;\n\t\t\t}\n\n\t\t\tthis.sandbox.fire('collectWords', {\n\t\t\t\tsource:  spellCheckSource\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t* @example\n\t\t* // return words collection without words in elements from ignoreElementsRegex option\n\t\t* range = this.sandbox.createRange();\n\t\t* range.selectNodeContents(document.getElementById('containerID'));\n\t\t* this.collectWords(range.toString());\n\t\t* @example\n\t\t* // return words collection without markuped words\n\t\t* range = this.sandbox.createRange();\n\t\t* range.selectNodeContents(document.getElementById('containerID'));\n\t\t* this.collectWords(range);\n\t\t* @example\n\t\t* // return words collection without words in elements from ignoreElementsRegex option\n\t\t* // and with all languages that used in document\n\t\t* container = document.getElementById('containerID');\n\t\t* this.collectWords(container);\n\t\t*\n\t\t* @memberof CORE.WordsCollector#\n\t\t* @param {String|CORE.RangeCreator.Range} source -\n\t\t* @param {Boolean} ignoreMisspellingsInContainer - will include misspelled words to the result of search if set to 'false'\n\t\t* @returns {Object} - Words Collection\n\t\t* @fires CORE.Communication.wordsCollected\n\t\t*/\n\t\tcollectWords: function(source, ignoreMisspellingsInContainer) {\n\t\t\t/* You can call this method with:\n\t\t\t\t'String' : from range.toString() - toString method will ignore only elements from ignoreElementsRegex\n\t\t\t\t'Range'  : collectWordsInRange method will remove markuped words\n\t\t\t\t'DomNode': collectWordsInContainer will collect words and languages from specified container\n\t\t\t*/\n\t\t\tvar wordsCollection;\n\n\t\t\tswitch (typeof(source)) {\n\t\t\t\tcase 'string':\n\t\t\t\t\twordsCollection = this.collectWordsInString(source);\n\t\t\t\tbreak;\n\t\t\t\tcase 'object':\n\t\t\t\t\tif(source.nodeType) {\n\t\t\t\t\t\twordsCollection = this.collectWordsInContainer(source, ignoreMisspellingsInContainer);\n\t\t\t\t\t} else {\n\t\t\t\t\t\twordsCollection = this.collectWordsInRange(source);\n\t\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tthis.sandbox.fire('wordsCollected', { wordsCollection: wordsCollection });\n\n\t\t\treturn wordsCollection;\n\t\t},\n\t\t/**\n\t\t* @memberof CORE.WordsCollector#\n\t\t* @param {string} - String with some text\n\t\t* @returns {Object} - Words Collection\n\t\t*/\n\t\tcollectWordsInString: function(text) {\n\t\t\tvar currentLanguage = this.sandbox.getOption('lang'),\n\t\t\t\t// get correct minWordLength option (for some languages we need to apply restriction that does not allow user to configure minWordLength option. E.g.: th_TH, ko_KR)\n\t\t\t\tpermanentMinWordLength = this.sandbox.getOption('permanentMinWordLength')[currentLanguage],\n\t\t\t\tminWordLength = this.sandbox.getOption('minWordLength');\n\n\t\t\t// filter all words with length < minWordLength\n\t\t\tvar wordsPrefix = 'word_',\n\t\t\t\twords;\n\n\t\t\twords = this.sandbox.getWordsFromString(text, permanentMinWordLength).wordsCollection;\n\n\t\t\t// new implementation\n\t\t\tvar wordsCollection = {};\n\t\t\tfor (var i = 0; i < words.length; i++) {\n\t\t\t\twordsCollection[wordsPrefix + words[i]] = wordsCollection[wordsPrefix + words[i]] || { word: words[i] }; // TODO: look for another realization\n\t\t\t}\n\n\t\t\twordsCollection = {\n\t\t\t\twords: wordsCollection,\n\t\t\t\tdetectedLanguages: {}\n\t\t\t};\n\t\t\twordsCollection.detectedLanguages[currentLanguage] = 1;\n\t\t\treturn wordsCollection;\n\t\t},\n\t\t/**\n\t\t* @memberof CORE.WordsCollector#\n\t\t* @param {CORE.RangeCreator.Range} range \t- RangeObject\n\t\t* @returns {Object} \t\t\t\t\t\t- Words Collection\n\t\t*/\n\t\tcollectWordsInRange: function(range) {\n\t\t\tvar rangeString = this.createStringWithoutScaytElements( range.commonAncestorContainer() );\n\n\t\t\treturn this.collectWordsInString(rangeString);\n\t\t},\n\n\t\t/**\n\t\t* @memberof CORE.WordsCollector#\n\t\t* @param {Object} container \t\t\t\t- container that contains text for spell checking\n\t\t* @returns {Object} \t\t\t\t\t\t- Words Collection\n\t\t*/\n\t\tcollectWordsInContainer: function(container, ignoreMisspellingsInContainer) {\n\t\t\tvar finder = new WEBSPELLCHECKER.CORE.WordsFinder.Finder(this.sandbox, ignoreMisspellingsInContainer),\n\t\t\t\twordsCollection;\n\n\t\t\t// we will get text and list of existing languages\n\t\t\tfinder.collectBlockInfo(container);\n\n\t\t\twordsCollection = this.collectWordsInString(finder.resultText);\n\t\t\twordsCollection.detectedLanguages = finder.detectedLanguages;\n\n\t\t\treturn wordsCollection;\n\t\t},\n\n\t\t/**\n\t\t* @memberof CORE.WordsCollector#\n\t\t* @returns {String} - String collected from node without misspelled elements\n\t\t*/\n\t\tcreateStringWithoutScaytElements: function(rootNode) {\n\t\t\tvar UILib = this.sandbox.UILib,\n\t\t\t\tresultText = '',\n\t\t\t\tqueue = [rootNode],\n\t\t\t\tnode = queue.shift(),\n\t\t\t\tblockElementsRegex = this.sandbox.getRegExp('blockElementsRegex'),\n\t\t\t\tmisspelled_word_node = this.sandbox.getOption('misspelled_word_node'),\n\t\t\t\tdata_attribute_name = this.sandbox.getOption('data_attribute_name'),\n\t\t\t\tignoreElementsRegex = this.sandbox.getRegExp('ignoreElementsRegex'),\n\t\t\t\tbookmarkClassRegex = new RegExp(/*REG_REPLACE*/\"(^|\\\\s)rangySelectionBoundary(\\\\s|$)\");\n\n\t\t\twhile (node) {\n\t\t\t\tswitch (node.nodeType) {\n\t\t\t\t\tcase 3 :\n\t\t\t\t\t\tresultText += node.nodeValue;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 1 : // Node.ELEMENT_NODE || 1\n\t\t\t\t\t\tvar isSpellingNode = node.nodeName.toLowerCase() == misspelled_word_node.toLowerCase() && node.getAttribute(data_attribute_name);\n\n\t\t\t\t\t\tif(!isSpellingNode && !bookmarkClassRegex.test(UILib.attr(node, 'className')) && !ignoreElementsRegex.match(node.nodeName) ) {\n\t\t\t\t\t\t\tfor (var i=0;i<node.childNodes.length; i++) {\n\t\t\t\t\t\t\t\tqueue.splice(i, 0,node.childNodes[i]);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( blockElementsRegex.match(node.nodeName) ) {\n\t\t\t\t\t\t\t\tif (queue.length > node.childNodes.length) {\n\t\t\t\t\t\t\t\t\tqueue.splice(i, 0, document.createTextNode(' '));\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (resultText.length > 0 && resultText[resultText.length - 1] != ' ') {\n\t\t\t\t\t\t\t\t\tqueue.splice(0, 0, document.createTextNode(' '));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tnode = queue.shift();\n\t\t\t}\n\n\t\t\treturn resultText;\n\t\t}\n\t};\n\n\texports.WordsCollector = WordsCollector;\n\n}( WEBSPELLCHECKER.CORE ));\n// wordsfinder.js\r\n/**\r\n * @fileoverview of CORE words finder module.\r\n */\r\n\r\n(function( exports ) {\r\n\t'use strict';\r\n\r\n\t/**\r\n\t * Represents WordsFinder Module.\r\n\t *\r\n\t * @constructor\r\n\t * @alias CORE.WordsFinder\r\n\t * @param {String} moduleID\r\n\t * @param {CORE.Sandbox} sandbox\r\n\t */\r\n\tvar WordsFinder = function(moduleID, sandbox) {\r\n\t\t/**\r\n\t\t * Module name.\r\n\t\t *\r\n\t\t * @type {String}\r\n\t\t*/\r\n\t\tthis.name = moduleID;\r\n\r\n\t\t/**\r\n\t\t * Reference to WordsFinder module sandbox.\r\n\t\t *\r\n\t\t * @type {CORE.Sandbox}\r\n\t\t */\r\n\t\tthis.sandbox = sandbox;\r\n\t};\r\n\r\n\tWordsFinder.prototype = {\r\n\t\t/**\r\n\t\t * Called after each registration in core.\r\n\t\t *\r\n\t\t * @memberof CORE.WordsFinder#\r\n\t\t */\r\n\t\tinit: function() {\r\n\t\t\tthis.sandbox.subscribe('misspelledWordsFound', function(data) {\r\n\t\t\t\tthis.processMisspelledWords(data.words, data.lang);\r\n\t\t\t}, this);\r\n\t\t},\r\n\t\t/**\r\n\t\t * Checks if misspelled words are present in the current instance and triggers Ranges search for each word.\r\n\t\t * This method can be called trough 'misspelledWordsFound' event from another application.\r\n\t\t *\r\n\t\t * @memberof CORE.WordsFinder#\r\n\t\t * @param {Array<CORE.DictionaryManager.Word>} words \t- Misspelled words collection\r\n\t\t * @param {String} lang \t\t\t\t\t\t\t\t- Language of misspelled words\r\n\t\t * @fires CORE.Communication.markupWords\r\n\t\t */\r\n\t\tprocessMisspelledWords: function(words, lang) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcurrent_lang = self.sandbox.getOption('lang'), // current instance language\r\n\t\t\t\tuid = self.sandbox.getOption('uid');\r\n\r\n\t\t\t/* Check if words is in current instance */\r\n\t\t\tvar wordsInCurrentControl = [];\r\n\t\t\tfor (var i = 0; i < words.length; i++) {\r\n\t\t\t\tif ( words[i].existsInInstance(uid) && (words[i].getStatus(uid) == 1) ) {\r\n\t\t\t\t\twordsInCurrentControl.push(words[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (wordsInCurrentControl.length !== 0) {\r\n\t\t\t\tself.sandbox.addDeferredFunction(\"findWordRangesForMarkupForLang_\" + lang, {\r\n\t\t\t\t\tdelay: 100,\r\n\t\t\t\t\tcollection: wordsInCurrentControl,\r\n\t\t\t\t\tdefferedFunctionArgs: [lang],\r\n\t\t\t\t\tpartialItemsCount: 1,\r\n\t\t\t\t\tdeferredFunction: function(words, lang) {\r\n\t\t\t\t\t\tvar savedSel, ranges,\r\n\t\t\t\t\t\t\tfocused = self.sandbox.isFocused();\r\n\r\n \t\t\t\t\t\tif (focused) {\r\n\t\t\t\t\t\t\tsavedSel = self.sandbox.saveSelection();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tranges = self.findWordRangesForMarkup(words);\r\n\t\t\t\t\t\tself.sandbox.fire('markupWords', { ranges: ranges, lang: lang });\r\n\r\n\t\t\t\t\t\tself.sandbox.restoreSelection(savedSel);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t * !!!! ONLY one word must be processed in this method\r\n\t\t * because sort method for sorting ranges is very slow\r\n\t\t *\r\n\t\t * @memberof CORE.WordsFinder#\r\n\t\t * @param {Array<CORE.DictionaryManager.Word>} words \t- Collection of words\r\n\t\t * @returns {Array<CORE.RangeCreator.Range>} \t\t\t- Collection of Ranges\r\n\t\t */\r\n\t\tfindWordRangesForMarkup: function(words) {\r\n\t\t\t// !!!! ONLY one word must be processed in this method\r\n\t\t\t// !!!! because sort method for sorting ranges is very slow\r\n\r\n\t\t\t// TODO: implement block processing\r\n\t\t\tvar range = this.sandbox.createRange(),\r\n\t\t\t\tcontainer = this.sandbox.getOption( 'container' ),\r\n\t\t\t\tfinder;\r\n\r\n\t\t\trange.selectNodeContents( container );\r\n\r\n\t\t\tfinder = new WordsFinder.Finder( this.sandbox );\r\n\r\n\t\t\tfinder.collectBlockInfo( range.commonAncestorContainer() );\r\n\r\n\t\t\tvar ranges = []; // ranges with words\r\n\t\t\tfor (var i = 0; i < words.length; i++) {\r\n\t\t\t\tfinder.lastIndex = 0;\r\n\t\t\t\twhile(finder.findWord(words[i].word) !== null) {\r\n\t\t\t\t\tranges.push({\r\n\t\t\t\t\t\trange: finder.wordRange,\r\n\t\t\t\t\t\tlanguage: finder.wordLanguage,\r\n\t\t\t\t\t\tword: words[i].word,\r\n\t\t\t\t\t\tsuggestions: words[i].suggestions,\r\n\t\t\t\t\t\tindex: finder.wordIndex\r\n\t\t\t\t\t});\r\n\t\t\t\t\t// NOTE: do not make any changes in wordRange there\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// return sorted ranges for back forward processing on page, this sort will solve problem with modified ranges\r\n\t\t\t// needed for words with same startContainer\r\n\r\n\t\t\t// return ranges.sort(CORE.Utils.sortRangesForMurkup);\t!!!! this sort method is very slow\r\n\t\t\treturn ranges.reverse();\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * Represents WordsFinder object.\r\n\t *\r\n\t * @constructor\r\n\t * @param {CORE.Sandbox} sandbox\r\n\t */\r\n\tWordsFinder.Finder = function(sandbox, ignoreMisspellings) {\r\n\t\t// we shoud not include to the search result marked up misspellings by default\r\n\t\tignoreMisspellings = typeof ignoreMisspellings === 'undefined' ? true : ignoreMisspellings;\r\n\r\n\t\tthis.parts = []; // contains all nodes with indexes\r\n\t\tthis.newParts = { // TODO: rename\r\n\t\t\tgetPos: function(index) {\r\n\t\t\t\twhile(!this[index]) {\r\n\t\t\t\t\tindex--;\r\n\t\t\t\t}\r\n\t\t\t\treturn this[index];\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.foundedProblems = {\r\n\t\t\tprevious: 0,\r\n\t\t\tgetPreviousProblemsCount: function(index) {\r\n\t\t\t\twhile (!this[index] && index > 0) {\r\n\t\t\t\t\tindex--;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn this[index] || 0;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Text model of Node\r\n\t\t *\r\n\t\t * @type {String}\r\n\t\t */\r\n\t\tthis.resultText = '';\r\n\r\n\t\t/**\r\n\t\t * List of found languages\r\n\t\t *\r\n\t\t * @type {Object}\r\n\t\t */\r\n\t\tthis.detectedLanguages = {};\r\n\t\tthis.detectedLanguages[sandbox.getOption('lang')] = 1;\r\n\r\n\t\t/**\r\n\t\t * Latest word index in [resultText]{@link CORE.WordsFinder.Finder#resultText}\r\n\t\t *\r\n\t\t * @type {Number}\r\n\t\t */\r\n\t\tthis.lastIndex = 0; // last found index TODO: rename\r\n\r\n\t\t/**\r\n\t\t * Latest found word range\r\n\t\t *\r\n\t\t * @type {CORE.RangeCreator.Range}\r\n\t\t */\r\n\t\tthis.wordRange = null;\r\n\r\n\t\t/**\r\n\t\t * Word index between founded problems\r\n\t\t *\r\n\t\t * @type {Number}\r\n\t\t */\r\n\t\tthis.wordIndex = 0;\r\n\r\n\t\tthis.reset = function() {\r\n\t\t\tthis.parts = [];\r\n\t\t\tthis.resultText = '';\r\n\t\t\tthis.lastIndex = 0;\r\n\t\t\tthis.wordIndex = 0;\r\n\t\t\tthis.wordRange = null;\r\n\t\t\tthis.detectedLanguages[sandbox.getOption('lang')] = 1;\r\n\t\t};\r\n\r\n\t\t// Get language from node.\r\n\t\t// If there is no 'lang' attribute it will return 'defaultLang'.\r\n\t\t// If found language is not supported return 'null'\r\n\t\tfunction getLang(node, defaultLang) {\r\n\t\t\tvar multiLanguageMode = sandbox.getOption('multiLanguageMode'),\r\n\t\t\t\tlanguagesMap = sandbox.getOption('languagesMap'),\r\n\t\t\t\tlanguageNodeName = sandbox.getOption('languageNodeName'),\r\n\t\t\t\tlanguageAttributeName = sandbox.getOption('languageAttributeName'),\r\n\t\t\t\tresult = defaultLang,\r\n\t\t\t\tlangAttr;\r\n\r\n\t\t\tif(multiLanguageMode) {\r\n\t\t\t\tif(!node.lang || node.nodeName.toLowerCase() !== languageNodeName) {\r\n\t\t\t\t\tnode = sandbox.UILib.parents(node, languageNodeName + '[' + languageAttributeName + ']')[0];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlangAttr = node && node.nodeName.toLowerCase() == languageNodeName ? node.getAttribute(languageAttributeName) : '';\r\n\r\n\t\t\t\tif(langAttr) {\r\n\t\t\t\t\tresult = languagesMap[langAttr] || null;\r\n\t\t\t\t\t// @TODO: implement in release 4.8.1\r\n\t\t\t\t\t// handle cases when user specified unsupported language ISO 639 short code\r\n\t\t\t\t\t// if(!result) {\r\n\t\t\t\t\t// \t// @TODO: remove this temp fix and make global implementation of errors reporting system to the user\r\n\t\t\t\t\t// \tconsole.warn('The language \"' + langAttr + '\" code used for the lang attribute in ISO 639 format is not supported. More details at http://wiki.webspellchecker.net/doku.php?id=installationandconfiguration:supportedlanguages or contact support@webspellchecker.net');\r\n\t\t\t\t\t// }\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Collects string and additional information from specific Node.\r\n\t\t * Provides custom models {newParts} and {resultText} for searching words in document.\r\n\t\t *\r\n\t\t * @param {Node} block\r\n\t\t */\r\n\t\tthis.collectBlockInfo = function(block) {\r\n\t\t\tvar queue = [{ el: block, editable: sandbox.getOption('isProofreadInDialogActive') ? true : block.isContentEditable }],\r\n\t\t\t\tnode = queue.shift(),\r\n\t\t\t\tlang = sandbox.getOption('lang'),\r\n\t\t\t\tself = this;\r\n\r\n\t\t\tvar blockElementsRegex = sandbox.getRegExp('blockElementsRegex'),\r\n\t\t\t\tignoreElements = sandbox.getRegExp('ignoreElementsRegex'),\r\n\t\t\t\tanyCharG = sandbox.getRegExp('anyChar').g(),\r\n\t\t\t\tmisspelledWordNode = sandbox.getOption('misspelled_word_node'),\r\n\t\t\t\tmisspelledDataAttrName = sandbox.getOption('data_attribute_name'),\r\n\t\t\t\tbookmarkClassRegex = /*REG_REPLACE*/new RegExp(\"(^|\\\\s)rangySelectionBoundary(\\\\s|$)\"),\r\n\t\t\t\tindexOffset = 0,\r\n\t\t\t\ttext = '',\r\n\t\t\t\tfoundCharacters = [],\r\n\t\t\t\tspecialCharactersRegex = sandbox.getRegExp('specialCharacters').set().onePlus();\r\n\r\n\t\t\t// Build custom model without tags and special characters\r\n\t\t\tfunction addPart(start, end, node) {\r\n\t\t\t\tif(start === end) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar part = {\r\n\t\t\t\t\tnode: \tnode.el,\r\n\t\t\t\t\tstart: \tself.resultText.length ,\r\n\t\t\t\t\tend: \tself.resultText.length + end - start,\r\n\t\t\t\t\toffset:  start\r\n\t\t\t\t};\r\n\t\t\t\tself.newParts[part.start] = part;\r\n\t\t\t\tself.newParts[part.end] = part;\r\n\t\t\t\tif (node.editable == false) {\r\n\t\t\t\t\tself.resultText +=  anyCharG.replace(node.el.nodeValue, ' ').substring(start, end);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tself.resultText += node.el.nodeValue.substring(start, end);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction addFoundedProblems(index) {\r\n\t\t\t\tvar prevValue = self.foundedProblems[self.foundedProblems.previous] || 0;\r\n\r\n\t\t\t\tself.foundedProblems[index] = prevValue + 1;\r\n\t\t\t\tself.foundedProblems.previous = index;\r\n\t\t\t}\r\n\r\n\t\t\twhile (node) {\r\n\t\t\t\tswitch (node.el.nodeType) {\r\n\t\t\t\t\tcase 3 : // Node.TEXT_NODE || 3\r\n\t\t\t\t\t\tif(node.el.nodeValue.length > 0) { // we should process not empty text nodes as they do not affect resultText value\r\n\t\t\t\t\t\t\tindexOffset = node.indexOffset || 0;\r\n\t\t\t\t\t\t\ttext = node.el.nodeValue;\r\n\t\t\t\t\t\t\t// Find characters in any combination in node value\r\n\t\t\t\t\t\t\tfoundCharacters = specialCharactersRegex.match( text.substring(indexOffset) );\r\n\t\t\t\t\t\t\tif (foundCharacters) {\r\n\t\t\t\t\t\t\t\t// add part without special characters to custom model\r\n\t\t\t\t\t\t\t\taddPart(indexOffset, indexOffset + foundCharacters.index, node);\r\n\t\t\t\t\t\t\t\t// in the next iteration, we will start with a given position\r\n\t\t\t\t\t\t\t\tnode.indexOffset = indexOffset + foundCharacters.index + foundCharacters[0].length;\r\n\t\t\t\t\t\t\t\tqueue.splice(0, 0, node);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t// if we have't more special characters add to the end of the word\r\n\t\t\t\t\t\t\t\taddPart(indexOffset, text.length, node);\r\n\t\t\t\t\t\t\t\tnode.emptyCharsCountInPart = 0;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1 : // Node.ELEMENT_NODE || 1\r\n\t\t\t\t\t\tif (ignoreMisspellings && node.el.nodeName.toLowerCase() == misspelledWordNode.toLowerCase() && node.el.getAttribute(misspelledDataAttrName) ) {\r\n\t\t\t\t\t\t\tthis.resultText += anyCharG.replace(node.el.getAttribute(misspelledDataAttrName), '_');\r\n\t\t\t\t\t\t\taddFoundedProblems(this.resultText.length);\r\n\t\t\t\t\t\t} else if ( !bookmarkClassRegex.test(sandbox.UILib.attr(node.el, 'className')) && !ignoreElements.test(node.el.nodeName) ) {\r\n\t\t\t\t\t\t\tvar _editable = node.el.hasAttribute('contenteditable') ? node.el.isContentEditable : node.editable;\r\n\t\t\t\t\t\t\tvar _lang = getLang(node.el, lang);\r\n\r\n\t\t\t\t\t\t\t// remember new language if so.\r\n\t\t\t\t\t\t\tif(_lang) {\r\n\t\t\t\t\t\t\t\tthis.detectedLanguages[_lang] = 1;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tfor (var i=0;i<node.el.childNodes.length; i++) {\r\n\t\t\t\t\t\t\t\tqueue.splice(i, 0, { el: node.el.childNodes[i], editable: _editable });\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif ( blockElementsRegex.match(node.el.nodeName) ) {\r\n\t\t\t\t\t\t\t\tif (queue.length > node.el.childNodes.length) {\r\n\t\t\t\t\t\t\t\t\tqueue.splice(i, 0, { el: document.createTextNode(' '), editable: true });\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif (this.resultText.length > 0 && this.resultText[this.resultText.length - 1] != ' ') {\r\n\t\t\t\t\t\t\t\t\tqueue.splice(0, 0, { el: document.createTextNode(' '), editable: true });\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnode = queue.shift();\r\n\t\t\t}\r\n\r\n\t\t\tthis.resultText = sandbox.replaceSepatators(this.resultText);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Searches for a word in the Node that was passed to [collectBlockInfo]{@link CORE.WordsFinder.Finder#collectBlockInfo} method\r\n\t\t *\r\n\t\t * @param {string} word - word which you need to find\r\n\t\t * @returns {CORE.RangeCreator.Range} - Range object\r\n\t\t */\r\n\t\tthis.findWord = function(word) {\r\n\t\t\tvar index = this.resultText.indexOf(word, this.lastIndex);\r\n\r\n\t\t\t// need to check for word boundary points\r\n\t\t\tif (index > 0) {\r\n\r\n\t\t\t\t// if index is > 0 checking for previous and next chars\r\n\t\t\t\t// also checking for text length for solving problem with unknown character in end when index + word.length > this.resultText.length\r\n\t\t\t\tthis.lastIndex = index + word.length;\r\n\r\n\t\t\t\tindex = this.resultText.charAt(index - 1).match(/*REG_REPLACE*//\\s/) ? index : \"skipped\";\r\n\t\t\t\tindex = this.lastIndex == this.resultText.length || this.resultText.charAt(index + word.length).match(/*REG_REPLACE*//\\s/) ? index : \"skipped\";\r\n\r\n\t\t\t} else if (index === 0) {\r\n\r\n\t\t\t\t// if index is == 0 checking for next chars only\r\n\t\t\t\tthis.lastIndex = index + word.length;\r\n\t\t\t\tindex = this.lastIndex == this.resultText.length || this.resultText.charAt(index + word.length).match(/*REG_REPLACE*//\\s/) ? index : \"skipped\";\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tif (index == \"skipped\") {\r\n\t\t\t\treturn this.findWord.call(this, word);\r\n\t\t\t}\r\n\r\n\t\t\t// creating range based on index and word.length\r\n\t\t\tvar range = sandbox.createRange();\r\n\t\t\tvar startPos = this.newParts.getPos(index);\r\n\t\t\trange.setStart(startPos.node, index - startPos.start + startPos.offset);\r\n\r\n\t\t\tvar endPos = this.newParts.getPos(index+word.length-1);\r\n\r\n\t\t\trange.setEnd(endPos.node, index+word.length - endPos.start + endPos.offset);\r\n\t\t\trange = sandbox.Utils.fixRangeBoundaryPoints(range);\r\n\r\n\t\t\tthis.wordRange = range;\r\n\t\t\tthis.wordIndex = this.foundedProblems.getPreviousProblemsCount(index);\r\n\r\n\t\t\tvar spellcheckLanguage = sandbox.getOption('lang'),\r\n\t\t\t\tcontainer = range.commonAncestorContainer();\r\n\r\n\t\t\tthis.wordLanguage = getLang(container, spellcheckLanguage);\r\n\r\n\t\t\treturn this.wordRange;\r\n\t\t};\r\n\t};\r\n\r\n\texports.WordsFinder = WordsFinder;\r\n\r\n}( WEBSPELLCHECKER.CORE ));\r\n\n// wordsprocessor.js\r\n/**\r\n * @fileoverview of CORE words processor module.\r\n */\r\n\r\n(function( exports ) {\r\n\t'use strict';\r\n\r\n\t/**\r\n\t * Represents WordsProcessor Module.\r\n\t *\r\n\t * @constructor\r\n\t * @alias CORE.WordsProcessor\r\n\t * @param {String} moduleID\r\n\t * @param {CORE.Sandbox} sandbox\r\n\t */\r\n\tvar WordsProcessor = function(moduleID, sandbox) {\r\n\t\t/**\r\n\t\t * Module name.\r\n\t\t *\r\n\t\t * @type {String}\r\n\t\t*/\r\n\t\tthis.name = moduleID;\r\n\r\n\t\t/**\r\n\t\t * Reference to WordsProcessor module sandbox.\r\n\t\t *\r\n\t\t * @type {CORE.Sandbox}\r\n\t\t */\r\n\t\tthis.sandbox = sandbox;\r\n\t};\r\n\r\n\tWordsProcessor.prototype = {\r\n\t\t/**\r\n\t\t * Called after each registration in core.\r\n\t\t *\r\n\t\t * @memberof CORE.WordsProcessor#\r\n\t\t */\r\n\t\tinit: function() {\r\n\t\t\tthis.sandbox.subscribe(\"replaceWord\", function(data) {\r\n\t\t\t\tthis.replaceWordInSelection(data.word, data.spellingNode);\r\n\t\t\t}, this);\r\n\r\n\t\t\tthis.sandbox.subscribe(\"ignoreWord\", function(data) {\r\n\t\t\t\tthis.ignoreWordInSelection(data.spellingNode);\r\n\t\t\t}, this);\r\n\r\n\t\t\tthis.sandbox.subscribe(\"ignoreAllWords\", function(data) {\r\n\t\t\t\tthis.ignoreWordInDocument(data.spellingNode);\r\n\t\t\t}, this);\r\n\t\t},\r\n\t\t/**\r\n\t\t * Replaces selected word with new one.\r\n\t\t *\r\n\t\t * @param {String} word - Word for replacement\r\n\t\t * @param {Node} spellingNode - misspelled node\r\n\t\t */\r\n\t\treplaceWordInSelection: function(word, spellingNode) {\r\n\t\t\tvar container = this.sandbox.getOption('container'),\r\n\t\t\t\t_spellingNode;\r\n\r\n\t\t\t_spellingNode = spellingNode ? spellingNode : this.sandbox.getSpellingNodeFromSelection();\r\n\r\n\t\t\tif ( _spellingNode && container.contains(_spellingNode) ) {\r\n\t\t\t\tthis.replaceWordByNode(_spellingNode, word);\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t * Ignores selected word.\r\n\t\t *\r\n\t\t * @param {Node} spellingNode - misspelled node\r\n\t\t */\r\n\t\tignoreWordInSelection: function(spellingNode) {\r\n\t\t\tvar container = this.sandbox.getOption('container'),\r\n\t\t\t\t_spellingNode;\r\n\r\n\t\t\t_spellingNode = spellingNode ? spellingNode : this.sandbox.getSpellingNodeFromSelection();\r\n\r\n\t\t\tif ( _spellingNode && container.contains(_spellingNode) ) {\r\n\t\t\t\tthis.ignoreWords([_spellingNode]);\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t * Ignores selected word everywhere in document\r\n\t\t *\r\n\t\t * @param {Node} spellingNode - misspelled node\r\n\t\t */\r\n\t\tignoreWordInDocument: function(spellingNode) {\r\n\t\t\tvar container = this.sandbox.getOption('container'),\r\n\t\t\t\tmisspelled_word_node = this.sandbox.getOption(\"misspelled_word_node\"),\r\n\t\t\t\tdata_attribute_name = this.sandbox.getOption(\"data_attribute_name\"),\r\n\t\t\t\tdataLangAttrName = this.sandbox.getOption('data_lang_attribute'),\r\n\t\t\t\tUILib = this.sandbox.UILib,\r\n\t\t\t\twordNodes = [],\r\n\t\t\t\t_spellingNode, foundNodes, lang;\r\n\r\n\t\t\t_spellingNode = spellingNode ? spellingNode : this.sandbox.getSpellingNodeFromSelection();\r\n\r\n\t\t\tif ( _spellingNode && container.contains(_spellingNode) ) {\r\n\t\t\t\tlang = _spellingNode.getAttribute(dataLangAttrName);\r\n\t\t\t\tfoundNodes = this.sandbox.UILib.query(container, misspelled_word_node + '[' + data_attribute_name + '=\"' + _spellingNode.getAttribute(data_attribute_name) + '\"]');\r\n\t\t\t\t// Now we need to filter found nodes according to current misspelled node language\r\n\t\t\t\tfoundNodes = UILib.filter(foundNodes, '[' + dataLangAttrName + '=\"' + lang + '\"]');\r\n\t\t\t\twordNodes.push.apply(wordNodes, foundNodes);\r\n\r\n\t\t\t\tthis.ignoreWords(wordNodes);\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t * Raplaces misspelled node with word without spelling markup\r\n\t\t *\r\n\t\t * @param {Array<Node>} wordNodes \t- Array of misspelled Nodes\r\n\t\t */\r\n\t\tignoreWords: function(/* array */ wordNodes) {\r\n\t\t\tvar range = this.sandbox.createRange(),\r\n\t\t\t\tdictionary = exports.DictionaryManager.Dictionary,\r\n\t\t\t\tdataAttributeName = this.sandbox.getOption('data_attribute_name'),\r\n\t\t\t\tdataLangAttrName = this.sandbox.getOption('data_lang_attribute'),\r\n\t\t\t\tuid = this.sandbox.getOption('uid'),\r\n\t\t\t\tfocused = this.sandbox.isFocused(),\r\n\t\t\t\tsavedSel, node, word, lang, fragment;\r\n\r\n\t\t\tif (focused && wordNodes.length > 0) {\r\n\t\t\t\t// TODO: review possibility to move focus check inside saveSelection method.\r\n\t\t\t\tsavedSel = this.sandbox.saveSelection();\r\n\t\t\t}\r\n\r\n\t\t\twhile(wordNodes.length > 0) {\r\n\t\t\t\tnode = wordNodes.shift();\r\n\t\t\t\tword = node.getAttribute(dataAttributeName);\r\n\t\t\t\tlang = node.getAttribute(dataLangAttrName);\r\n\r\n\t\t\t\tif (dictionary.getWord(word, lang)) {\r\n\t\t\t\t\tdictionary.getWord(word, lang).setStatus(exports.DictionaryManager.wordStatus.userIgnore, uid); // ignored\r\n\t\t\t\t}\r\n\r\n\t\t\t\trange.selectNodeContents(node);\r\n\t\t\t\tvar fragment = range.extractContents();\r\n\t\t\t\trange.selectNode(node);\r\n\t\t\t\trange.deleteContents();\r\n\t\t\t\trange.insertNode(fragment);\r\n\t\t\t\t// TODO needs to refactoring markup module\r\n\t\t\t\tthis.sandbox.fire('removedMarkupInContainer', {\r\n\t\t\t\t\tancestorContainer : range.commonAncestorContainer(),\r\n\t\t\t\t\tremovedNodes: [node],\r\n\t\t\t\t\ttype: 'spelling',\r\n\t\t\t\t\ttext: word\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tthis.sandbox.restoreSelection(savedSel);\r\n\t\t},\r\n\t\t/**\r\n\t\t * Raplaces misspelled node with new word\r\n\t\t *\r\n\t\t * @param {Node} node \t\t- misspelled Node\r\n\t\t * @param {String} newWord \t- Word for replacement\r\n\t\t */\r\n\t\treplaceWordByNode: function(/* spellingNode */ node, newWord){\r\n\t\t\tvar childNodes = this.sandbox.getChildProblemNodes(node),\r\n\t\t\t\tparentNodes = this.sandbox.getParentProblemNodes(node);\r\n\r\n\t\t\t//TODO Modify selection management.\r\n\t\t\tnode.innerHTML = newWord;\r\n\t\t\tvar range = this.sandbox.createRange();\r\n\t\t\trange.selectNodeContents(node);\r\n\t\t\trange.collapse(false);\r\n\t\t\tvar _selection = this.sandbox.getSelection();\r\n\t\t\t// TODO need rethink mirror based behavior\r\n\t\t\tif ( this.sandbox.getOption('mirrorBasedInstance') || this.sandbox.getSpellingNodeFromSelection() === node ) {\r\n\t\t\t\t_selection.removeAllRanges();\r\n\t\t\t\t_selection.addRange(range);\r\n\t\t\t}\r\n\t\t\tvar savedSel = this.sandbox.saveSelection();\r\n\t\t\trange = this.sandbox.createRange();\r\n\t\t\trange.selectNode(node);\r\n\t\t\tvar fragment = range.createContextualFragment(node.innerHTML);\r\n\t\t\trange.deleteContents();\r\n\t\t\trange.insertNode(fragment);\r\n\t\t\t// TODO needs to refactoring markup module\r\n\t\t\tthis.sandbox.restoreSelection(savedSel);\r\n\t\t\tthis.sandbox.fire('removedMarkupInContainer', {\r\n\t\t\t\tancestorContainer : range.commonAncestorContainer(),\r\n\t\t\t\ttextChanged: true,\r\n\t\t\t\tremovedNodes: [node].concat(childNodes)\r\n\t\t\t});\r\n\t\t\tthis.sandbox.fire('removeMarkup', {\r\n\t\t\t\tnodes: parentNodes,\r\n\t\t\t\tspelling: true\r\n\t\t\t});\r\n\r\n\t\t\tif ( this.sandbox.getOption('mirrorBasedInstance') ) {\r\n\t\t\t\tvar text = this.sandbox.getTextBeforeCursor();\r\n\r\n\t\t\t\tif ( text !== null && text.substring(text.length - newWord.length) !==  newWord) {\r\n\t\t\t\t\ttext += newWord;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.sandbox.fire('textReplaced', {\r\n\t\t\t\t\ttextBeforeCursor: text ? text : null,\r\n\t\t\t\t\tnewText: newWord\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\texports.WordsProcessor = WordsProcessor;\r\n\r\n}( WEBSPELLCHECKER.CORE ));\n// banner.js\r\n/**\r\n * @fileoverview of CORE banner.\r\n */\r\n\r\n(function( exports ) {\r\n\t'use strict';\r\n\r\n\tvar basePath;\r\n\t/**\r\n\t * Represents Banner Module.\r\n\t *\r\n\t * @constructor\r\n\t * @alias CORE.Banner\r\n\t * @param {String} moduleID\r\n\t * @param {CORE.Sandbox} sandbox\r\n\t */\r\n\tvar Banner = function(moduleID, sandbox) {\r\n\t\tvar bannerTemplate = '',\r\n\t\t\teditors = ['scayt_ckeditor', 'scayt_tinymce', 'scayt_froala'],\r\n\t\t\tappType = sandbox.getOption('appType');\r\n\t\tthis.name = moduleID;\r\n\r\n\t\tbasePath = sandbox.getOption('basePath');\r\n\t\tthis.sandbox = sandbox;\r\n\t\tthis.closeBannerTimeout = undefined;\r\n\t\tthis.contextMenuContainer = null;\r\n\t\tif( editors.includes(appType) ) {\r\n\t\t\tthis.template = ( appType !== 'scayt_froala' ) ? bannerTemplates.editor() : bannerTemplates.common();\r\n\t\t\tthis.bannerId = ( appType !== 'scayt_froala' ) ? 'banner_tpl_editor' : 'banner_tpl_default';\r\n\t\t}\r\n\t};\r\n\r\n\tBanner.prototype = {\r\n\t\t/**\r\n\t\t * Called after each registration in core.\r\n\t\t *\r\n\t\t * @memberof CORE.Banner#\r\n\t\t */\r\n\t\tinit: function() {\r\n\t\t\tvar self = this,\r\n\t\t\t\tsandbox = this.sandbox;\r\n\r\n\t\t\t// create template and container\r\n\t\t\tif(!this.template) { return };\r\n\t\t\tthis.sandbox.Template.create(this.bannerId, this.template);\r\n\r\n\t\t\tthis.sandbox.subscribe('showBanner', function(data) {\r\n\t\t\t\tthis.showBannerHandler(data.contextMenuContainerSelector, data.contextMenuContainer);\r\n\t\t\t}, this);\r\n\r\n\t\t\tthis.sandbox.subscribe('hideBanner', function(data) {\r\n\t\t\t\tthis.hideBanner();\r\n\t\t\t}, this);\r\n\t\t},\r\n\t\t/**\r\n\t\t * Checks the need to show banner\r\n\t\t *\r\n\t\t * @param {String} contextMenuContainerSelector \t- CSS Selector for context menu element\r\n\t\t */\r\n\t\tshowBannerHandler: function(contextMenuContainerSelector, contextMenuContainer) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tUILib = this.sandbox.UILib;\r\n\r\n\t\t\tif (self.sandbox.getOption('banner') !== false) {\r\n\t\t\t\tself.sandbox.addDeferredFunction('showBanner', {\r\n\t\t\t\t\tsingle: true,\r\n\t\t\t\t\tdelay: 100,\r\n\t\t\t\t\tdeferredFunction: function() {\r\n\t\t\t\t\t\tcontextMenuContainer = contextMenuContainer || UILib.find(contextMenuContainerSelector)[0];\r\n\r\n\t\t\t\t\t\tself.contextMenuContainer = contextMenuContainer;\r\n\r\n\t\t\t\t\t\tif(contextMenuContainer) {\r\n\t\t\t\t\t\t\tUILib.css(contextMenuContainer, {overflow: 'visible'});\r\n\t\t\t\t\t\t\tself.showBanner(contextMenuContainer);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\t// Links in the banner were inactive (#31690)\r\n\t\tactionLinks : function(event) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tlink = event.target || event.srcElement;\r\n\r\n\t\t\tif (link.href) {\r\n\t\t\t\tif(link.id !== 'closeBanner') {\r\n\t\t\t\t\twindow.open(link.href,\"_blank\");\r\n\t\t\t\t\tif(self.contextMenuContainer) {\r\n\t\t\t\t\t\tself.sandbox.fire({\r\n\t\t\t\t\t\t\teventType: 'focus',\r\n\t\t\t\t\t\t\telement: self.contextMenuContainer\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t * Renders the banner.\r\n\t\t *\r\n\t\t * @param {Node} contextMenuContainer \t- Reference to context menu element\r\n\t\t */\r\n\t\tshowBanner: function(contextMenuContainer) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tUILib = this.sandbox.UILib,\r\n\t\t\t\t_bannerHTML = self.sandbox.Template.render(self.bannerId, {}),\r\n\t\t\t\tbindActionForLinks = UILib.proxy(self.actionLinks, self);\r\n\r\n\t\t\tUILib.append(contextMenuContainer, _bannerHTML);\r\n\t\t\tfunction callback(event) {\r\n\t\t\t\tvar e = event;\r\n\t\t\t\tbindActionForLinks(e);\r\n\r\n\t\t\t\tself.sandbox.unsubscribe({\r\n\t\t\t\t\teventType: 'mousedown',\r\n\t\t\t\t\telement: UILib.find('#wsc_banner')[0],\r\n\t\t\t\t\thandler: callback\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tself.sandbox.subscribe({\r\n\t\t\t\teventType: 'mousedown',\r\n\t\t\t\telement: UILib.find('#wsc_banner')[0],\r\n\t\t\t\thandler: callback\r\n\t\t\t});\r\n\t\t},\r\n\t\t/**\r\n\t\t * Hides the banner\r\n\t\t */\r\n\t\thideBanner: function() {\r\n\t\t\tvar UILib = this.sandbox.UILib,\r\n\t\t\t\twscBanner = UILib.find('#wsc_banner')[0];\r\n\r\n\t\t\tif(wscBanner) {\r\n\t\t\t\tUILib.css(UILib.parent(wscBanner), {overflow: ''});\r\n\t\t\t\tUILib.remove(wscBanner);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tvar bannerTemplates = {\r\n\t\teditor: function(sandbox) {\r\n\t\t\treturn '<div id=\"wsc_banner\" style=\"padding: 2px 18px 14px; border: 1px solid #c7c7c7; box-shadow: 0 0 5px rgba(0,0,0,.1); position: absolute; font-size: 12px; line-height: 1.33; font-family: Arial,Verdana,sans-serif; z-index: 9998; width: 140px; min-height: 60px; background-color: rgb(255, 255, 255); white-space: normal; left: 102%; top: 0; background-position: initial initial; background-repeat: initial initial; color: #3f3f3f; box-sizing: content-box;\">' +\r\n\t\t\t\t'<div style=\"overflow: hidden;\">' +\r\n\t\t\t\t\t'<div class=\"sc-img-banner\">' +\r\n\t\t\t\t\t\t'<img src=\"' + basePath +  'css/webspellchecker-logo-small.png\"><span style=\"display: inline-block; position: relative; font-size: 11px; color: #134aad; font-weight: 700; vertical-align: top; margin-top: 15px;\">WebSpellChecker</span>' +\r\n\t\t\t\t\t'</div>' +\r\n\t\t\t\t'</div>' +\r\n\t\t\t\t'<ul style=\"list-style-type: disc; margin-top: 5px; margin-left: 25px;\">' +\r\n\t\t\t\t\t'<li style=\"color: #3f3f3f; line-height: 1.8;\"><span style=\"color: #1E8914; vertical-align: middle;\" >Accelerated check</span></li>' +\r\n\t\t\t\t\t'<li style=\"color: #3f3f3f; line-height: 1.8;\">More languages</li>' +\r\n\t\t\t\t\t'<li style=\"color: #3f3f3f; line-height: 1.8;\">Technical support</li>' +\r\n\t\t\t\t\t'<li style=\"color: #3f3f3f; line-height: 1.8;\">Extra features</li>' +\r\n\t\t\t\t\t'<li style=\"color: #3f3f3f; line-height: 1.8;\">No banner</li>' +\r\n\t\t\t\t'</ul>' +\r\n\t\t\t\t'<div style=\"text-align: center;\">' +\r\n\t\t\t\t\t'<a target=\"_blank\" href=\"http://www.webspellchecker.net/pricing.html\" style=\"display: inline-block; text-align: center; padding: 3px 16px; border-radius: 6px; background: #1E8914; color: #fff; font-size: 11px; outline: 0; border: 0; cursor: pointer; box-sizing: border-box; line-height: 1.8; margin: 10px auto 0;\">Upgrade Now</a>' +\r\n\t\t\t\t'</div>' +\r\n\t\t\t'</div>';\r\n\t\t},\r\n\t\tcommon: function(sandbox) {\r\n\t\t\treturn '<div id=\"wsc_banner\">' +\r\n\t\t\t\t'<div class=\"wsc-img-banner\">' +\r\n\t\t\t\t\t'<img src=\"' + basePath + 'css/webspellchecker-logo-small.png\"><span>WebSpellChecker</span>' +\r\n\t\t\t\t'</div>' +\r\n\t\t\t\t'<ul class=\"wsc-more-list\">' +\r\n\t\t\t\t\t'<li>No banner</li>' +\r\n\t\t\t\t\t'<li>More languages</li>' +\r\n\t\t\t\t\t'<li>Technical support</li>' +\r\n\t\t\t\t\t'<li>Extra features</li>' +\r\n\t\t\t\t'</ul><div class=\"wsc-button-holder\">' +\r\n\t\t\t\t'<a target=\"_blank\" href=\"http://www.webspellchecker.net/pricing.html\" class=\"wsc-upgrade\">Upgrade Now</a>' +\r\n\t\t\t'</div>';\r\n\t\t}\r\n\t};\r\n\texports.Banner = Banner;\r\n\r\n}( WEBSPELLCHECKER.CORE ));\n// AccessLimiter.js\n/**\n * @fileoverview of CORE business manager.\n */\n\n(function( exports ) {\n\t'use strict';\n\tvar Utils;\n\t// make sure that we declaring AccessLimiter only once\n\tif(exports.AccessLimiter) {\n\t\treturn;\n\t}\n\n\t/**\n\t * Represents AccessLimiter Module.\n\t *\n\t * @constructor\n\t * @alias CORE.AccessLimiter\n\t * @param {String} moduleID\n\t * @param {CORE.Sandbox} sandbox\n\t */\n\tvar AccessLimiter = function(moduleID, sandbox) {\n        /**\n\t\t * Module name.\n\t\t *\n\t\t * @type {String}\n\t\t*/\n\t\tthis.name = moduleID;\n\n\t\tthis.wordsLimit = sandbox.getOption('wordsLimit');\n\n\t\tthis.setTimeoutId = null;\n\t\t/**\n\t\t * Module initialization type.\n\t\t *\n\t\t * @type {Boolean}\n\t\t*/\n\n\t\t/**\n\t\t * Reference to AccessLimiter module sandbox.\n\t\t *\n\t\t * @type {CORE.Sandbox}\n\t\t */\n\t\tthis.sandbox = sandbox;\n\n\t\tUtils = this.sandbox.Utils;\n    };\n\n    AccessLimiter.prototype = {\n\t\t/**\n\t\t * Called after each registration in core.\n\t\t *\n\t\t * @memberof CORE.AccessLimiter#\n\t\t */\n        init: function() {\n\t\t\tvar sandbox = this.sandbox,\n\t\t\t\tfreeze = this.sandbox.getOption('freeze'),\n\t\t\t\tself = this;\n\n\t\t\tif(freeze) {\n\t\t\t\tthis.activateFreeze();\n\t\t\t}\n\t\t},\n\t\tactivateFreeze: function() {\n\t\t\tthis.limitController = AccessLimiter.limitController = AccessLimiter.limitController || new LimitController({wordsLimit: this.wordsLimit});\n\n\t\t\tthis.sandbox.subscribe('getWordsLimit', function(event) {\n\t\t\t\tthis.getWordsLimitHandler(event);\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe('sentWordsCount', function(event) {\n\t\t\t\tthis.sentWordsCountHandler(event.count);\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe('spellCheckEnded', function() {\n\t\t\t\tthis.spellCheckEndedHandler();\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Handler of getWordsLimit event\n\t\t *\n\t\t * @param {Object} event - Communication event\n\t\t * @memberof CORE.AccessLimiter#\n\t\t */\n\t\tgetWordsLimitHandler: function(event) {\n\t\t\tevent.setReturnedData({\n\t\t\t\tdata: this.limitController.getWordsLimit()\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Handler of sentWordsCount event\n\t\t *\n\t\t * @param {Number} count - Number of words what sent to spellcheck\n\t\t * @memberof CORE.AccessLimiter#\n\t\t */\n\t\tsentWordsCountHandler: function(count) {\n\t\t\tcount = this.limitController.getWordsLimit() - count;\n\t\t\tthis.limitController.updateWordsLimit( (count < 0) ? 0 : count );\n\t\t},\n\t\t/**\n\t\t * Handler of spellCheckEnded event\n\t\t *\n\t\t * @memberof CORE.AccessLimiter#\n\t\t */\n\t\tspellCheckEndedHandler: function() {\n\t\t\tvar delay = this.sandbox.getOption('spellCheckDelay');\n\t\t\tvar self = this;\n\n\t\t\tif( this.limitController.isFrozen() && this.setTimeoutId === null ) {\n\t\t\t\tthis.sandbox.fireInAllApps('freeze', {status:true});\n\t\t\t\tthis.setTimeoutId = setTimeout(function(){\n\t\t\t\t\tself.limitController.clear();\n\t\t\t\t\tself.setTimeoutId = null;\n\t\t\t\t\tself.sandbox.fireInAllApps('freeze', {status:false});\n\t\t\t\t\tself.sandbox.fireInAllApps('startSpellCheck', {});\n\t\t\t\t\tself.sandbox.fireInAllApps('startProblemsCheck', {});\n\t\t\t\t}, delay);\n\t\t\t}\n\t\t}\n    };\n\t/**\n\t * AccessLimiter.LimitController constructor.\n\t * @constructor\n\t * Controls limit of words count.\n\t *\n\t * @param {object} options.wordsLimit - Number of words what can be processed for one time.\n\t*/\n\tvar LimitController = function(options) {\n\t\t\tvar freeze = false,\n\t\t\t\twordsLimit = options.wordsLimit;\n\n\t\treturn {\n\t\t\t/**\n\t\t\t* Clear words counter and unfreeze limit controller;\n\t\t\t*/\n\t\t\tclear: function() {\n\t\t\t\twordsLimit = options.wordsLimit;\n\t\t\t\tfreeze = false;\n\t\t\t},\n\t\t\t/**\n\t\t\t*\n\t\t\t* @returns {Boolean} freeze flag\n\t\t\t*/\n\t\t\tisFrozen: function() {\n\t\t\t\treturn freeze;\n\t\t\t},\n\t\t\t/**\n\t\t\t *\n\t\t\t * @returns {Number} Number of words available for processing\n\t\t\t */\n\t\t\tgetWordsLimit: function() {\n\t\t\t\treturn wordsLimit;\n\t\t\t},\n\t\t\t/**\n\t\t\t* set number of words. If the limit is reached than limit controller freezes\n\t\t\t*\n\t\t\t* @param {Number} count - Number of available words\n\t\t\t*/\n\t\t\tupdateWordsLimit: function(count) {\n\t\t\t\twordsLimit = count;\n\t\t\t\tif(count === 0) {\n\t\t\t\t\tfreeze = true;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t};\n\n    exports.AccessLimiter = AccessLimiter;\n})( WEBSPELLCHECKER.CORE );\n// ime.js\r\n/**\r\n * @fileoverview of CORE IME module.\r\n */\r\n\r\n(function( exports ) {\r\n\t'use strict';\r\n\r\n\t/**\r\n\t* Input Method Editor (IME) Plugin constructor.\r\n\t* @constructor\r\n\t* @alias CORE.IME\r\n\t* @param {String} moduleID Module name\r\n\t* @param {CORE.Sandbox} sandbox sandbox\r\n\t*/\r\n\tvar IME = function(moduleID, sandbox) {\r\n\t\tthis.name = moduleID;\r\n\t\tthis.sandbox = sandbox;\r\n\t};\r\n\r\n\tIME.prototype = {\r\n\t\tinit: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tthis.sandbox.subscribe({\r\n\t\t\t\teventType: 'keydown',\r\n\t\t\t\telement: this.getContainer(),\r\n\t\t\t\thandler: this.handleKeydown\r\n\t\t\t});\r\n\r\n\t\t\t// We are tracking IME with using events 'compositionstart', 'compositionend'\r\n\t\t\t// http://www.w3.org/TR/2011/WD-DOM-Level-3-Events-20110531/#events-compositionevents\r\n\t\t\tself.sandbox.subscribe({\r\n\t\t\t\teventType: 'compositionstart',\r\n\t\t\t\telement: this.getContainer(),\r\n\t\t\t\thandler: function(e) {\r\n\t\t\t\t\tself.sandbox.setPaused(true);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tself.sandbox.subscribe({\r\n\t\t\t\teventType: 'compositionend',\r\n\t\t\t\telement: this.getContainer(),\r\n\t\t\t\thandler: function(e) {\r\n\t\t\t\t\tself.sandbox.setPaused(false);\r\n\r\n\t\t\t\t\t// Create new Task in the Deferred Task Manager after works Input Method Editor (IME)\r\n\t\t\t\t\tself.sandbox.addDeferredFunction('collectWordsAfterWorkIME', {\r\n\t\t\t\t\t\tsingle: true,\r\n\t\t\t\t\t\tdelay: 0,\r\n\t\t\t\t\t\tdeferredFunction: function() {\r\n\t\t\t\t\t\t\tvar _selection = self.sandbox.getSelection(),\r\n\t\t\t\t\t\t\t\tmultiLanguageMode = self.sandbox.getOption('multiLanguageMode'),\r\n\t\t\t\t\t\t\t\tspellCheckSource;\r\n\r\n\t\t\t\t\t\t\tif (_selection.rangeCount() > 0) {\r\n\t\t\t\t\t\t\t\tvar range = _selection.getRangeAt(0);\r\n\r\n\t\t\t\t\t\t\t\tspellCheckSource = multiLanguageMode ? range.commonAncestorContainer() : range;\r\n\r\n\t\t\t\t\t\t\t\tself.sandbox.fire('collectWords', { source: spellCheckSource });\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\thandleKeydown: function(event) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\t// This uses key code 229 and 0.\r\n\t\t\t// http://lists.w3.org/Archives/Public/www-dom/2010JulSep/att-0182/keyCode-spec.html#fixed-virtual-key-codes\r\n\t\t\t// paragraf : How to calculate keyCode for keydown and keyup events\r\n\t\t\t// item 2 and 8\r\n\t\t\tif(event.keyCode === 229 || event.keyCode === 0) {\r\n\t\t\t\tself.sandbox.fire('removeMarkupInSelectionNode');\r\n\t\t\t}\r\n\t\t},\r\n\t\tgetContainer: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\treturn self.sandbox.getOption('container');\r\n\t\t}\r\n\t};\r\n\r\n\texports.IME = IME;\r\n\r\n}( WEBSPELLCHECKER.CORE ));\n// InfoGetter.js\n/**\n * @fileoverview of CORE InfoGetter.\n */\n(function( exports ) {\n\t'use strict';\n\n\t/**\n\t * Represents InfoGetter Module.\n\t *\n\t * @constructor\n\t * @alias CORE.InfoGetter\n\t * @param {String} moduleID\n\t * @param {CORE.Sandbox} sandbox\n\t */\n\tvar InfoGetter = function(moduleID, sandbox) {\n\t\t/**\n\t\t * Module name.\n\t\t *\n\t\t * @type {String}\n\t\t */\n\t\tthis.name = moduleID;\n\n\t\t/**\n\t\t * Reference to InfoGetter module sandbox.\n\t\t *\n\t\t * @type {CORE.Sandbox}\n\t\t */\n\t\tthis.sandbox = sandbox;\n\n\t\tthis.infoTypesMap = {\n\t\t\tbanner: 'banner',\n\t\t\tspellingLangList: 'langList',\n\t\t\tgrammarLangList: 'grammarLangList',\n\t\t\tcdModificationTime: 'cdModificationTime',\n\t\t\tprogramVersion: 'programVersion'\n\t\t};\n    };\n\t/**\n\t * Module initialization type.\n\t *\n\t * @type {Boolean}\n\t */\n\tInfoGetter.async = true;\n\n    InfoGetter.prototype = {\n\t\tconstructor: InfoGetter,\n\t\tappSetPause: function() {\n\t\t\tthis.sandbox.setPaused(true);\n\t\t\tthis.sandbox.removeAllDeferredFunctions();\n\t\t},\n        /**\n\t\t * Async load lang list before start spellchecking\n\t\t * @memberof CORE.InfoGetter#\n\t\t */\n        init: function() {\n\t\t\tvar self = this;\n\t\t\t\n            this.sandbox.fire('remoteAction', {\n                actionMethod: 'getInfo',\n                onSuccess: function(data) {\n\t\t\t\t\tvar infoType, currLang, spellingLangList,\n\t\t\t\t\t\tinfoTypesMap = self.infoTypesMap;\n\n\t\t\t\t\tfor (var infoTypeName in infoTypesMap) {\n\t\t\t\t\t\tinfoType = infoTypesMap[infoTypeName];\n\n\t\t\t\t\t\tif (typeof data[infoType] !== undefined) {\n\t\t\t\t\t\t\tself.sandbox.setOption(infoTypeName, data[infoType]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tself.sandbox.setOption('freeze', false);\n\n\t\t\t\t\tspellingLangList = self.sandbox.getOption('spellingLangList');\n\t\t\t\t\tcurrLang = self.sandbox.getOption('lang');\n\t\t\t\t\t\n                    if (!(currLang in spellingLangList.ltr) && !(currLang in spellingLangList.rtl)) {\n\t\t\t\t\t\tself.appSetPause();\n\t\t\t\t\t\tconsole.warn('The defined language code ' + currLang + ' is not available or supported for your customer ID. Please contact us at support@webspellchecker.net or submit a ticket at webspellchecker.net website.');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.sandbox.fire('moduleReady', { moduleID: self.name });\n\t\t\t\t\t}\n                },\n                onError: function(e) {\n\t\t\t\t\tself.appSetPause();\n                }\n            });\n        }\n    };\n\n    exports.InfoGetter = InfoGetter;\n\n})( WEBSPELLCHECKER.CORE );\n// proofreaddialogmanager.js\n/**\n * @fileoverview of Core proofreaddialogmanager module.\n */\n\n(function (exports) {\n    'use strict';\n\n\t/**\n\t * Represents ProofreadDialogManager Module.\n\t *\n\t * @constructor\n\t * @alias CORE.ProofreadDialogManager\n\t * @param {String} moduleID\n\t * @param {CORE.Sandbox} sandbox\n\t */\n    var ProofreadDialogManager = function (moduleID, sandbox) {\n\t\t/**\n\t\t * Module name.\n\t\t *\n\t\t * @type {String}\n\t\t */\n        this.name = moduleID;\n\n\t\t/**\n\t\t * Reference to ProofreadDialogManager module sandbox.\n\t\t *\n\t\t * @type {CORE.Sandbox}\n\t\t */\n        this.sandbox = sandbox;\n\n        /**\n\t\t * Link on the proofreadindialog container.\n\t\t *\n\t\t * @type {Null|Node}\n\t\t */\n        this.proofreadInDialogContainer = null;\n\n        /**\n\t\t * Indicator of the active state of the manager.\n\t\t *\n\t\t * @type {Boolean}\n\t\t */\n        this.active = false;\n\n        /**\n\t\t * Indicator of the finish checking state.\n\t\t *\n\t\t * @type {Boolean}\n\t\t */\n        this.isCheckingFinished = false;\n\n        /**\n\t\t * Indicator of the options commited state.\n\t\t *\n\t\t * @type {Boolean}\n\t\t */\n        this.isSomethingChanged = false;\n\n        /**\n\t\t * Array with words for removing markup after finishProofreadInDialog event.\n\t\t *\n\t\t * @type {Array}\n\t\t */\n        this.wordsForRemovingMarkup = [];\n\n        /**\n\t\t * Array with phrases for removing markup after finishProofreadInDialog event.\n\t\t *\n\t\t * @type {Array}\n\t\t */\n        this.phrasesForRemovingMarkup = [];\n\n        /**\n\t\t * Reference to DataProcessor module.\n\t\t *\n\t\t * @type {CORE.prototype.DataProcessor}\n\t\t */\n        this.DataProcessor = sandbox.DataProcessor;\n\n        /**\n\t\t * Reference to Utils module.\n\t\t *\n\t\t * @type {CORE.prototype.Utils}\n\t\t */\n        this.Utils = sandbox.Utils;\n\n        /**\n\t\t * Reference to Utils module.\n\t\t *\n\t\t * @type {CORE.prototype.Utils}\n\t\t */\n        this.UILib = sandbox.UILib;\n\n        /**\n\t\t * Types store map.\n\t\t *\n\t\t * @type {Object}\n\t\t */\n        this.typesStore = {\n            spelling: {\n                problems: 'words',\n                problem: 'word',\n                problemArray: 'wordsForRemovingMarkup',\n                event: 'removeMarkupFromWords'\n            },\n            grammar: {\n                problems: 'phrases',\n                problem: 'phrase',\n                problemArray: 'phrasesForRemovingMarkup',\n                event: 'removeMarkupFromPhrases'\n            }\n        }\n    };\n\n    ProofreadDialogManager.prototype = {\n\t\t/**\n\t\t * Called after each registration in core.\n\t\t *\n\t\t * @memberof CORE.ProofreadDialogManager#\n\t\t */\n        init: function() {\n            this.saveOriginalContainers();\n\n            this.sandbox.subscribe('setProofreadInDialogContainer', function (data) {\n                this.setProofreadInDialogContainer(data);\n            }, this);\n\n            this.sandbox.subscribe('startProofreadInDialog', function (data) {\n                this.handleStartProofreadInDialog(data);\n            }, this);\n\n            this.sandbox.subscribe('finishProofreadInDialog', function (data) {\n                this.handleFinishProofreadInDialog(data);\n            }, this);\n\n            this.sandbox.subscribe('finishCheckingInDialog', function (data) {\n                this.handleFinishCheckingInDialog(data);\n            }, this);\n\n            this.sandbox.subscribe('optionsCommited', function () {\n                this.handleChanges();\n            }, this);\n\n            this.sandbox.subscribe('userDictionaryChanged', function () {\n                this.handleChanges();\n            }, this);\n\n            this.sandbox.subscribe('removeMarkupFromWords', function (data) {\n                data.type = data.type || 'spelling';\n                this.handleRemoveMarkup(data);\n            }, this);\n\n            this.sandbox.subscribe('removedMarkupInContainer', function (data) {\n                if (data.text) {\n                    var problems = this.typesStore[data.type].problems,\n                        problem = this.typesStore[data.type].problem,\n                        item = {};\n\n                    item[problem] = data.text;\n                    data[problems] = [];\n                    data[problems].push(item);\n                    this.handleRemoveMarkup(data);\n                }\n            }, this);\n        },\n        /**\n\t\t * Save links to the original containers.\n\t\t *\n\t\t * @memberof CORE.ProofreadDialogManager#\n\t\t */\n        saveOriginalContainers: function() {\n            this.originalContainer = this.sandbox.getOption('container');\n            this.originalDocumentContainer = this.sandbox.getOption('documentContainer');\n        },\n        /**\n\t\t * Set link to the proofreadindialog container.\n\t\t *\n\t\t * @memberof CORE.ProofreadDialogManager#\n\t\t * @param {Object} data - Data from event\n\t\t */\n        setProofreadInDialogContainer: function(data) {\n            this.proofreadInDialogContainer = data.container;\n        },\n        /**\n\t\t * Change links to the containers on original containers.\n\t\t *\n\t\t * @memberof CORE.ProofreadDialogManager#\n\t\t */\n        changeToOriginalContainers: function() {\n            this.changeContainers(this.originalContainer, this.originalDocumentContainer);\n        },\n        /**\n\t\t * Change links to the containers on proofreadindialog containers.\n\t\t *\n\t\t * @memberof CORE.ProofreadDialogManager#\n\t\t */\n        changeToProofreadInDialogContainers: function() {\n            this.changeContainers(this.proofreadInDialogContainer, this.proofreadInDialogContainer);\n        },\n        /**\n\t\t * Change containers for main application functionality.\n\t\t *\n\t\t * @memberof CORE.ProofreadDialogManager#\n\t\t * @param {Node} container - Link on the container\n\t\t * @param {Node} documentContainer - Link on the documentContainer\n\t\t */\n        changeContainers: function(container, documentContainer) {\n            this.sandbox.setContainer(container);\n            this.sandbox.setOption('documentContainer', documentContainer);\n        },\n        /**\n\t\t * Set data to proofreadindialog container.\n\t\t *\n\t\t * @memberof CORE.ProofreadDialogManager#\n\t\t * @param {Object} data - Data to setting to container\n\t\t */\n        setDataToProofreadInDialogContainer(data) {\n            var originalContainer = this.sandbox.getOption('originalContainer'),\n                isTextBased = this.Utils.isTextBased(originalContainer),\n                isInputBased = this.Utils.isInputBased(originalContainer);\n\n            data = data || this.sandbox.getDataFromContainer();\n\n            if (isTextBased) {\n                data = this.DataProcessor.textToHtml(data, isInputBased);\n            }\n\n            this.proofreadInDialogContainer.innerHTML = data;\n            !isTextBased && this.processContenteditable({inDialog: true});\n        },\n        /**\n\t\t * Set data to original container.\n\t\t *\n\t\t * @memberof CORE.ProofreadDialogManager#\n\t\t * @param {Object} data - Data to setting to container\n\t\t */\n        setDataToOriginalContainer(data) {\n            var originalContainer = this.sandbox.getOption('originalContainer'),\n                isTextBased = this.Utils.isTextBased(originalContainer),\n                isInputBased = this.Utils.isInputBased(originalContainer);\n\n            !isTextBased && this.processContenteditable({});\n            data = data || this.proofreadInDialogContainer.innerHTML;\n\n            if (isTextBased) {\n                data = this.DataProcessor.htmlToText(data, isInputBased);\n            }\n\n            this.sandbox.setDataToContainer(data);\n        },\n        /**\n\t\t * Handle startProofreadInDialog event.\n\t\t *\n\t\t * @memberof CORE.ProofreadDialogManager#\n\t\t * @param {Object} data - Data from event\n\t\t */\n        handleStartProofreadInDialog: function(data) {\n            if (this.active) {\n                return;\n            }\n\n            this.active = true;\n            this.sandbox.setOption('isProofreadInDialogActive', true);\n            this.sandbox.setMarkupPaused(true);\n            this.setDataToProofreadInDialogContainer();\n            this.changeToProofreadInDialogContainers();\n            this.sandbox.startMarkup();\n            this.sandbox.setMarkupPaused(false);\n        },\n        /**\n\t\t * Handle finishProofreadInDialog event.\n\t\t *\n\t\t * @memberof CORE.ProofreadDialogManager#\n\t\t * @param {Object} data - Data from event\n\t\t */\n        handleFinishProofreadInDialog: function(data) {\n            if (!this.active) {\n                return;\n            }\n\n            this.active = false;\n            this.sandbox.setOption('isProofreadInDialogActive', false);\n\n            if (!this.isCheckingFinished) {\n                this.sandbox.setMarkupPaused(true);\n                this.changeToOriginalContainers();\n                this.sandbox[this.sandbox.getOption('proofreadAsYouType') ? 'startMarkup' : 'stopMarkup']();\n                this.sandbox.setMarkupPaused(false);\n            }\n\n            if (this.isSomethingChanged) {\n                this.sandbox.fire('removeMarkupInDocument', {});\n                this.sandbox.fire('removeMarkupInContainer', {});\n                this.sandbox.startProblemsCheck();\n            }\n\n            this.syncActions();\n\n            this.isCheckingFinished = false;\n            this.isSomethingChanged = false;\n        },\n        /**\n\t\t * Handle finishCheckingInDialog event.\n\t\t *\n\t\t * @memberof CORE.ProofreadDialogManager#\n\t\t * @param {Object} data - Data from event\n\t\t */\n        handleFinishCheckingInDialog: function (data) {\n            if (!this.active) {\n                return;\n            }\n\n            this.isCheckingFinished = true;\n            this.sandbox.setOption('isProofreadInDialogActive', false);\n            this.sandbox.setMarkupPaused(true);\n            this.changeToOriginalContainers();\n            this.setDataToOriginalContainer();\n            this.sandbox[this.sandbox.getOption('proofreadAsYouType') ? 'startMarkup' : 'stopMarkup']();\n            this.sandbox.setMarkupPaused(false);\n        },\n        /**\n\t\t * Handle optionsCommited event.\n\t\t *\n\t\t * @memberof CORE.ProofreadDialogManager#\n\t\t * @param {Object} data - Data from event\n\t\t */\n        handleChanges: function() {\n            if (!this.active) {\n                return;\n            }\n\n            this.isSomethingChanged = true;\n        },\n        /**\n\t\t * Handle remove markup events.\n\t\t *\n\t\t * @memberof CORE.ProofreadDialogManager#\n\t\t * @param {Object} data - Data from event\n\t\t */\n        handleRemoveMarkup: function(data) {\n            if (!this.active) {\n                return;\n            }\n\n            var problems = this.typesStore[data.type].problems,\n                problemArray = this.typesStore[data.type].problemArray;\n\n            this[problemArray] = this[problemArray].concat(data[problems]);\n        },\n        syncActions: function() {\n            for (var item in this.typesStore) {\n                if ( this.typesStore.hasOwnProperty(item) ) {\n                    var event = this.typesStore[item].event,\n                        problems = this.typesStore[item].problems,\n                        problemArray = this.typesStore[item].problemArray,\n                        eventData = {};\n\n                    eventData[problems] = this[problemArray];\n                    this.sandbox.fire(event, eventData);\n                    this[problemArray] = [];\n                }\n            }\n        },\n        processContenteditable: function(data) {\n            var tempAttr = 'data-wsc-contenteditable',\n                removeContenteditable = data.inDialog;\n\n            if (removeContenteditable) {\n                var nodesWithContenteditable = this.UILib.find('[contenteditable]', this.proofreadInDialogContainer);\n\n                for (var i = 0; i < nodesWithContenteditable.length; i++) {\n                    var node = nodesWithContenteditable[i];\n\n                    if (node.isContentEditable) {\n                        node.setAttribute(tempAttr, 'true');\n                        node.removeAttribute('contenteditable');\n                    }\n                }\n            } else {\n                var nodesWithTempAttr = this.UILib.find('[' + tempAttr + ']', this.proofreadInDialogContainer);\n\n                for (var i = 0; i < nodesWithTempAttr.length; i++) {\n                    var node = nodesWithTempAttr[i];\n\n                    node.setAttribute('contenteditable', 'true');\n                    node.removeAttribute(tempAttr);\n                }\n            }\n        },\n\t\t/**\n\t\t * ProofreadDialogManager destructor.\n\t\t *\n\t\t * @memberof CORE.ProofreadDialogManager#\n\t\t */\n        destroy: function() {\n\n        }\n    };\n\n    exports.ProofreadDialogManager = ProofreadDialogManager;\n\n}(WEBSPELLCHECKER.CORE));\n// component.js\r\n/**\r\n * @fileoverview of CORE Component.\r\n */\r\n\r\n/**\r\n * @namespace CORE.UI\r\n */\r\nWEBSPELLCHECKER.CORE.UI = WEBSPELLCHECKER.CORE.UI || {};\r\n\r\n(function( exports, modules ) {\r\n\t'use strict';\r\n\r\n\tvar UILib = modules.UILib,\r\n\t\tUtils = modules.Utils;\r\n\r\n\texports = exports || {};\r\n\t/**\r\n\t * Component abstract class.\r\n\t *\r\n\t * @constructor\r\n\t * @alias CORE.UI.Component\r\n\t */\r\n\tclass Component {\r\n\t\tconstructor(sandbox, {name, title, modificators, hide}) {\r\n\t\t\tthis.sandbox = sandbox;\r\n\t\t\tthis._isVisible = true;\r\n\t\t\tthis.childDataAttr = 'data-children';\r\n\t\t\tthis.prefix = 'wsc';\r\n\r\n\t\t\t/** Private */\r\n\t\t\tthis._elementOf = [];\r\n\t\t\tthis._separators = {\r\n\t\t\t\tmodificator: '--',\r\n\t\t\t\telement: '__',\r\n\t\t\t\tprefix: '-'\r\n\t\t\t};\r\n\t\t\tthis._modificatorsTypes = {\r\n\t\t\t\tfocusable: this.prefix + this._separators.modificator + 'focusable',\r\n\t\t\t\thidden: this.prefix + this._separators.modificator + 'hidden',\r\n\t\t\t\tclearfix: this.prefix + this._separators.modificator + 'clearfix',\r\n\t\t\t\tborderBox: this.prefix + this._separators.modificator + 'border-box',\r\n\t\t\t\tfullscreen: this.prefix + this._separators.modificator + 'fullscreen'\r\n\t\t\t};\r\n\t\t\tthis._errorsMessages = {\r\n\t\t\t\tmodificatorNotRegistred: 'Modificator - \"{mod}\" not registred in component - \"{comp}\". see: registerModificatorsTypes.',\r\n\t\t\t\tcustomModificatorParent: 'For action with custom modificator - \"{mod}\" component - \"{comp}\" should be element of block - \"{block}\".',\r\n\t\t\t\ttemplateData: '{key} - is not defined in template data.'\r\n\t\t\t}\r\n\t\t\t// name what defined by parrent what register this component used registerChildren. By default equal name.\r\n\t\t\tthis._internalName = name;\r\n\t\t\tthis._modificators = modificators || [];\r\n\t\t\tthis._customModificators = [];\r\n\t\t\tthis._events = [];\r\n\t\t\tthis._lifeCycleMethods = ['render', 'show', 'hide', 'remove'];\r\n\t\t\tthis._UIDFields = ['id', 'labelFor'];\r\n\t\t\tthis._lifeCycleHandlers = {\r\n\t\t\t\tbefore: {},\r\n\t\t\t\tafter: {}\r\n\t\t\t};\r\n\t\t\tthis._element = null;\r\n\t\t\tthis._position = null;\r\n\t\t\tthis._children = [];\r\n\t\t\tthis._template = '';\r\n\t\t\tthis._templateData = {\r\n\t\t\t\tprefix: this.prefix\r\n\t\t\t};\r\n\r\n\t\t\tthis._createLifeCycles(this._lifeCycleMethods);\r\n\t\t\thide && this.hide();\r\n\t\t\t/** Setters */\r\n\t\t\tthis._setTemplateField({name});\r\n\t\t\tthis._setTemplateField({title: title || name});\r\n\t\t}\r\n\t\t/**\r\n\t\t * @param {String} childrenName - Set internal name for children component. If not provided used children name.\r\n\t\t */\r\n\t\tregisterChildren(children, childrenName, position) {\r\n\t\t\tvar position,\r\n\t\t\t\tself = this;\r\n\r\n\t\t\tif(typeof childrenName === 'number') {\r\n\t\t\t\tposition = childrenName;\r\n\t\t\t\tchildrenName = undefined;\r\n\t\t\t}\r\n\t\t\tposition = (typeof position === 'undefined') ? this._children.length : position;\r\n\t\t\tif(!children) return;\r\n\t\t\tchildren = Array.isArray(children) ? children : [children];\r\n\t\t\tchildren.forEach(function(child) {\r\n\t\t\t\tchild._elementOf.push({block: self.name, element: childrenName || child.name});\r\n\t\t\t\tif(childrenName) { child._internalName = childrenName; }\r\n\t\t\t\tchild.registerLifeCycleHandler('after', 'remove', function() {\r\n\t\t\t\t\tself._children.splice( self._children.indexOf(child), 1 );\r\n\t\t\t\t});\r\n\t\t\t\tif( !self.isVisible() ) {\r\n\t\t\t\t\tchild._hidByParent = true;\r\n\t\t\t\t\tif( child.isVisible() ) child._isVisible = false;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\t\t\tArray.prototype.splice.apply( this._children, [position, 0].concat(children) );\r\n\t\t\t// We should physically add new items if component already rendered.\r\n\t\t\tif( this.getDOMElement() !== null ) this._renderChildren();\r\n\t\t}\r\n\t\t/**\r\n\t\t * Sometimes we want define component how element of block\r\n\t\t * And if this component is not the direct child of block\r\n\t\t * Used this method we can register this component\r\n\t\t * And in render step it received css classes (block__component)\r\n\t\t * But it work only if component contains in child tree of block.\r\n\t\t */\r\n\t\tregisterBemElements(components, elementName) {\r\n\t\t\tvar proccesElements = (element) => {\r\n\t\t\t\telement._elementOf.push({block: this.name, element: elementName || element._internalName});\r\n\t\t\t\tif( element.getDOMElement() !== null ) this._addChildClasses(element);\r\n\t\t\t}\r\n\t\t\tif( Array.isArray(components) ) {\r\n\t\t\t\tcomponents.forEach(proccesElements);\r\n\t\t\t} else {\r\n\t\t\t\tproccesElements(components);\r\n\t\t\t}\r\n\r\n\t\t\treturn components;\r\n\t\t}\r\n\t\tgetChildren(childName) {\r\n\t\t\tvar result = [];\r\n\r\n\t\t\tfor(var i = 0; i < this._children.length; i += 1) {\r\n\t\t\t\tif(this._children[i]._internalName === childName || this._children[i].name === childName) {\r\n\t\t\t\t\tresult.push(this._children[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(result.length === 0) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\treturn result.length === 1 ? result[0] : result;\r\n\t\t}\r\n\t\trender(model) {\r\n\t\t\tvar template, defaultTemplate = `<div title=\"${this.title}\" class=\"${this._buildCssString({block: this.name})}\"></div>`;\r\n\t\t\tthis.sandbox.Template.create('Component', this.template || defaultTemplate);\r\n\t\t\ttemplate = this.sandbox.Template.render('Component', model || this._templateData);\r\n\t\t\tthis.sandbox.Template.remove('Component');\r\n\t\t\tthis._element = UILib.create(template)[0];\r\n\t\t\tthis._position && UILib.setPosition(this._element, this._position.left, this._position.top);\r\n\t\t\tUILib.addClass( this._element, this._buildModificators() );\r\n\t\t\tthis.isVisible() && this.show();\r\n\t\t\tthis._bindEvents();\r\n\t\t\tthis._renderChildren();\r\n\t\t\treturn this._element;\r\n\t\t}\r\n\t\t['remove_check']() {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tremove() {\r\n\t\t\tthis._unBindEvents();\r\n\t\t\tthis['remove_check'] = () => false;\r\n\t\t\tthis.removeAllChildren();\r\n\t\t\tUILib.remove(this._element);\r\n\t\t\tthis._element = null;\r\n\t\t}\r\n\t\tremoveAllChildren() {\r\n\t\t\twhile (this._children.length) { this._children[0].remove() }\r\n\t\t}\r\n\t\tsetTemplate(template) {\r\n\t\t\tthis.template = template;\r\n\t\t}\r\n\t\taddTemplateData(data) {\r\n\t\t\tdata = Object.assign({}, data);\r\n\t\t\tfor(var k in data) {\r\n\t\t\t\tif( this._UIDFields.includes(k) ) {\r\n\t\t\t\t\tdata[k] += this.getUID();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tObject.assign(this._templateData, data);\r\n\t\t}\r\n\t\tgetUID() {\r\n\t\t\tvar uid = this.sandbox.getOption('uid');\r\n\t\t\treturn uid ? '_' + uid : '';\r\n\t\t}\r\n\t\tgetTemplateData(key) {\r\n\t\t\tif (this._templateData.hasOwnProperty(key)) {\r\n\t\t\t\treturn this._templateData[key];\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error( this._errorsMessages.templateData.replace('{key}', key) );\r\n\t\t\t}\r\n\t\t}\r\n\t\tregisterLifeCycleHandler(prefix, methodName, handler) {\r\n\t\t\tif( this._lifeCycleMethods.includes(methodName) ) {\r\n\t\t\t\tthis._lifeCycleHandlers[prefix][methodName] = this._lifeCycleHandlers[prefix][methodName] || [];\r\n\t\t\t\tthis._lifeCycleHandlers[prefix][methodName].push( handler );\r\n\t\t\t}\r\n\t\t}\r\n\t\t/**\r\n\t\t * Get component's element.\r\n\t\t *\r\n\t\t * @memberof CORE.UI.Component#\r\n\t\t * @returns {HTMLElement} - Component's element\r\n\t\t */\r\n\t\tgetDOMElement() {\r\n\t\t\treturn this._element;\r\n\t\t}\r\n\t\t['show_check'](command) {\r\n\t\t\tif( !(this._isInternalCommand(command) && command.isDeep) ) {\r\n\t\t\t\tthis.removeModificator('hidden');\r\n\t\t\t}\r\n\t\t\treturn  !this.isVisible() && !this._hidByParent;\r\n\t\t}\r\n\t\tshow() {\r\n\t\t\tthis._children.forEach(child => {\r\n\t\t\t\tvar hidByParent = child._hidByParent;\r\n\t\t\t\tdelete child._hidByParent;\r\n\t\t\t\tif(hidByParent && !child._modificators.includes('hidden')) {\r\n\t\t\t\t\tchild.show( new InternalCommand('isDeep', true) );\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tthis._isVisible = true;\r\n\t\t}\r\n\t\t['hide_check'](command) {\r\n\t\t\tif( !(this._isInternalCommand(command) && command.isDeep) ) {\r\n\t\t\t\tthis.addModificator('hidden');\r\n\t\t\t}\r\n\t\t\treturn  this.isVisible();\r\n\t\t}\r\n\t\thide() {\r\n\t\t\tthis._children.forEach(child => {\r\n\t\t\t\tchild._hidByParent = true;\r\n\t\t\t\tif( child.isVisible() ) {\r\n\t\t\t\t\tchild.hide( new InternalCommand('isDeep', true) );\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tthis._isVisible = false;\r\n\t\t}\r\n\t\tisVisible() {\r\n\t\t\treturn this._isVisible;\r\n\t\t}\r\n\t\tgetTitle() {\r\n\t\t\treturn this.title;\r\n\t\t}\r\n\t\tsetTitle(title) {\r\n\t\t\tthis.title = title;\r\n\t\t\tthis.addTemplateData({\r\n\t\t\t\ttitle: this.title\r\n\t\t\t});\r\n\r\n\t\t\tif ( this.getDOMElement() !== null) {\r\n\t\t\t\tUILib.attr(this.getDOMElement(), 'title', title);\r\n\t\t\t}\r\n\t\t}\r\n\t\tsetFocus() {\r\n\t\t\tvar element = this.getDOMElement();\r\n\r\n\t\t\tif (element !== null) {\r\n\t\t\t\telement.focus();\r\n\t\t\t}\r\n\t\t}\r\n\t\tsetAriaLabel(value) {\r\n\t\t\tthis.addTemplateData({\r\n\t\t\t\tariaLabel: value\r\n\t\t\t});\r\n\r\n\t\t\tvar element = this.getDOMElement();\r\n\r\n\t\t\tif (element !== null) {\r\n\t\t\t\tUILib.attr(element, 'aria-label', value);\r\n\t\t\t}\r\n\t\t}\r\n\t\tsetAriaExpanded(value) {\r\n\t\t\tthis.addTemplateData({\r\n\t\t\t\tariaExpanded: value\r\n\t\t\t});\r\n\r\n\t\t\tvar element = this.getDOMElement();\r\n\r\n\t\t\tif (element !== null) {\r\n\t\t\t\tUILib.attr(element, 'aria-expanded', value);\r\n\t\t\t}\r\n\t\t}\r\n\t\tsetTabIndex(value) {\r\n\t\t\tthis.addTemplateData({\r\n\t\t\t\ttabIndex: value\r\n\t\t\t});\r\n\r\n\t\t\tvar element = this.getDOMElement();\r\n\r\n\t\t\tif (element !== null) {\r\n\t\t\t\tUILib.attr(element, 'tabindex', value);\r\n\t\t\t}\r\n\t\t}\r\n\t\tproxyMethodsFrom(component, methods) {\r\n\t\t\tmethods.forEach(method => {\r\n\t\t\t\tthis[method] = component[method].bind(component);\r\n\t\t\t})\r\n\t\t}\r\n\t\tattachEvents(events) {\r\n\t\t\tif( this.getDOMElement() ) {\r\n\t\t\t\tthis._bindEvents( Utils.pushOrConcat([], events) )\r\n\t\t\t}\r\n\t\t\tthis._events = Utils.pushOrConcat(this._events, events);\r\n\t\t}\r\n\t\tsetPosition(position) {\r\n\t\t\tposition = Object.assign({} , position);\r\n\t\t\tposition.left = Math.round(position.left);\r\n\t\t\tposition.top = Math.round(position.top);\r\n\t\t\tif(this._position && this._position.top === position.top && this._position.left === position.left) return;\r\n\t\t\tthis._position = position;\r\n\t\t\tvar element = this.getDOMElement();\r\n\t\t\telement && UILib.setPosition(element, position.left, position.top);\r\n\t\t}\r\n\t\tgetSize() {\r\n\t\t\tvar element = this.getDOMElement();\r\n\t\t\treturn {\r\n\t\t\t\twidth: UILib.outerWidth(element),\r\n\t\t\t\theight: UILib.outerHeight(element)\r\n\t\t\t}\r\n\t\t}\r\n\t\t/*\r\n\t\t * Modificators functionality\r\n\t\t */\r\n\t\tregisterModificatorsTypes(modificatorsTypes, blockName) {\r\n\t\t\tmodificatorsTypes = Object.assign({}, modificatorsTypes);\r\n\t\t\tfor(var k in modificatorsTypes) {\r\n\t\t\t\tmodificatorsTypes[k] =  this._buildCssString({block: blockName || this.name, modificator: modificatorsTypes[k]});\r\n\t\t\t}\r\n\t\t\tObject.assign(this._modificatorsTypes, modificatorsTypes);\r\n\t\t}\r\n\t\taddModificator(modificator) {\r\n\t\t\tif(!this._modificatorsTypes[modificator]) {\r\n\t\t\t\tthrow new Error( this._errorsMessages.modificatorNotRegistred.replace('{mod}', modificator).replace('{comp}', this.name) );\r\n\t\t\t}\r\n\t\t\tthis._modificatorAction({modificator, action: 'add', modificatorsArray: this._modificators});\r\n\t\t}\r\n\t\tremoveModificator(modificator) {\r\n\t\t\tthis._modificatorAction({modificator, action: 'remove', modificatorsArray: this._modificators});\r\n\t\t}\r\n\t\taddCustomModificator(modificator, block) {\r\n\t\t\tthis._customModificatorAction({modificator, block, action: 'add'});\r\n\t\t}\r\n\t\tremoveCustomModificator(modificator, block) {\r\n\t\t\tthis._customModificatorAction({modificator, block, action: 'remove'});\r\n\t\t}\r\n\t\tgetModificators() {\r\n\t\t\treturn this._modificators.slice(0);\r\n\t\t}\r\n\t\tgetFocusableElements() {\r\n\t\t\tvar focusableElements = [\r\n\t\t\t\t\t'input:not([disabled]):not([type=\"hidden\"]):not([aria-hidden]):not([readonly])',\r\n\t\t\t\t\t'[tabindex]:not([tabindex^=\"-\"])'\r\n\t\t\t\t],\r\n\t\t\t\tnodes = this.getDOMElement().querySelectorAll( focusableElements.join(',') ),\r\n\t\t\t\tresult = [];\r\n\r\n\t\t\tfor (var i = 0; i < nodes.length; i++) {\r\n\t\t\t\tvar node = nodes[i],\r\n\t\t\t\t\tcomputed = Utils.getComputedStyle(node);\r\n\r\n\t\t\t\tif (computed['visibility'] === 'hidden') {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (node.tagName.toLowerCase() === 'input' && node.type === 'radio' && !node.checked) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tresult.push(node);\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\tgetTabIndexedElements() {\r\n\t\t\treturn UILib.find('[tabindex]', this.getDOMElement()).filter(element => !Utils.isHidden(element));\r\n\t\t}\r\n\t\tgetNextPrevByActive(elements) {\r\n\t\t\tvar activeElement = document.activeElement,\r\n\t\t\t\tresult = {};\r\n\r\n\t\t\tfor (var i = 0; i < elements.length; i++) {\r\n\t\t\t\tvar element = elements[i];\r\n\r\n\t\t\t\tif (element === activeElement) {\r\n\t\t\t\t\tif (i === elements.length - 1) {\r\n\t\t\t\t\t\tresult.next = elements[0];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tresult.next = elements[i + 1];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (i === 0) {\r\n\t\t\t\t\t\tresult.prev = elements[elements.length - 1];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tresult.prev = elements[i - 1];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\tresetAllTabIndexes() {\r\n\t\t\tvar tabIndexed = ['[tabindex]:not([tabindex^=\"-\"])'],\r\n\t\t\t\tnodes = this.getDOMElement().querySelectorAll(tabIndexed);\r\n\r\n\t\t\tfor (var i = 0; i < nodes.length; i++) {\r\n\t\t\t\tUILib.attr(nodes[i], 'tabindex', -1);\r\n\t\t\t}\r\n\t\t}\r\n\t\t/**\r\n\t\t * Private\r\n\t\t */\r\n\t\t_createLifeCycles(methods) {\r\n\t\t\tvar methodName, self = this,\r\n\t\t\t\tcreateWrapper = function(methodName) {\r\n\t\t\t\t\treturn function() {\r\n\t\t\t\t\t\tvar result;\r\n\r\n\t\t\t\t\t\tif(typeof self[methodName + '_check'] === 'function') {\r\n\t\t\t\t\t\t\tif( !self[methodName + '_check'].apply(self, arguments) ) return false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t(self._lifeCycleHandlers.before[methodName] || []).forEach( handler => handler() );\r\n\t\t\t\t\t\tresult = this['_original_' + methodName].apply(self, arguments);\r\n\t\t\t\t\t\t(self._lifeCycleHandlers.after[methodName] || []).forEach( handler => handler() );\r\n\r\n\t\t\t\t\t\treturn result;\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\tfor(var i = 0; i < methods.length; i += 1) {\r\n\t\t\t\tmethodName = methods[i];\r\n\t\t\t\tthis['_original_' + methodName] = this[methodName];\r\n\t\t\t\tthis[methodName] = createWrapper(methodName);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t_buildCssString({block, element, modificator}) {\r\n\t\t\tvar elementString = (element) ? this._separators.element + element : '',\r\n\t\t\t\tmodificatorString = (modificator) ? this._separators.modificator + modificator : '';\r\n\r\n\t\t\treturn this.prefix + this._separators.prefix + block + elementString + modificatorString;\r\n\t\t}\r\n\t\t_setTemplateField(field) {\r\n\t\t\tvar key = Object.keys(field)[0],\r\n\t\t\t\ttData = {},\r\n\t\t\t\tvalue = field[key];\r\n\r\n\t\t\tthis[key] = value;\r\n\t\t\ttData[key] = value;\r\n\t\t\tthis.addTemplateData(tData);\r\n\t\t}\r\n\t\t_customModificatorAction({modificator, block, action}) {\r\n\t\t\tvar modificatorString = this._buildCustomModificator(modificator, block);\r\n\t\t\tthis._modificatorAction({\r\n\t\t\t\tmodificator: modificatorString,\r\n\t\t\t\taction: action,\r\n\t\t\t\tmodificatorsArray: this._customModificators,\r\n\t\t\t\tmodificatorString: modificatorString\r\n\t\t\t});\r\n\t\t}\r\n\t\t_modificatorAction({modificator, action, modificatorsArray, modificatorString}) {\r\n\t\t\tvar includes = modificatorsArray.includes(modificator),\r\n\t\t\t\tmodificatorString = modificatorString || this._modificatorsTypes[modificator],\r\n\t\t\t\telement = this._element,\r\n\t\t\t\tactionMethods = {\r\n\t\t\t\t\tadd: {\r\n\t\t\t\t\t\tmanageList() {\r\n\t\t\t\t\t\t\tif(includes) { return; }\r\n\t\t\t\t\t\t\tmodificatorsArray.push(modificator);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tmanageClass() { UILib.addClass(element, modificatorString); }\r\n\t\t\t\t\t},\r\n\t\t\t\t\tremove: {\r\n\t\t\t\t\t\tmanageList() {\r\n\t\t\t\t\t\t\tif(!includes) { return; }\r\n\t\t\t\t\t\t\tmodificatorsArray.splice( modificatorsArray.indexOf(modificator), 1 );\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tmanageClass() { UILib.removeClass(element, modificatorString); }\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tactionMethod = actionMethods[action];\r\n\r\n\t\t\tif(!actionMethod) { return; }\r\n\t\t\tactionMethod.manageList();\r\n\t\t\tif(element !== null) {\r\n\t\t\t\tactionMethod.manageClass();\r\n\t\t\t}\r\n\t\t}\r\n\t\t_buildElements() {\r\n\t\t\treturn this._blocks.map((block) => {\r\n\t\t\t\treturn this._buildCssString({block, element: this.name});\r\n\t\t\t}).join(' ');\r\n\t\t}\r\n\t\t_buildModificators() {\r\n\t\t\tvar\tmodificatorsString = '',\r\n\t\t\t\tmodificatorsForCurrentContext,\r\n\t\t\t\tmodificator;\r\n\r\n\t\t\tfor(var i = 0; i < this._modificators.length; i += 1) {\r\n\t\t\t\tmodificator = this._modificatorsTypes[ this._modificators[i] ];\r\n\t\t\t\tif(!modificator) {continue;}\r\n\t\t\t\tmodificatorsString += modificator + ' ';\r\n\t\t\t}\r\n\t\t\tmodificatorsString += this._customModificators.join(' ');\r\n\r\n\t\t\treturn modificatorsString.trim();\r\n\t\t}\r\n\t\t_buildCustomModificator(modificator, block) {\r\n\t\t\tvar elementObj = this._elementOf.filter(element => element.block === block)[0];\r\n\t\t\tif(!elementObj) {\r\n\t\t\t\tthrow new Error(\r\n\t\t\t\t\tthis._errorsMessages.customModificatorParent\r\n\t\t\t\t\t\t.replace('{mod}', modificator)\r\n\t\t\t\t\t\t.replace('{comp}', this.name)\r\n\t\t\t\t\t\t.replace('{block}', block)\r\n\t\t\t\t\t);\r\n\t\t\t}\r\n\t\t\treturn this._buildCssString({block, element: elementObj.element, modificator});\r\n\t\t}\r\n\t\t_addChildClasses(child) {\r\n\t\t\tchild._elementOf.forEach((blockInfo) => {\r\n\t\t\t\tUILib.addClass(child._element, this._buildCssString({block: blockInfo.block, element: blockInfo.element}));\r\n\t\t\t});\r\n\t\t\tUILib.addClass(child._element, this._buildCssString({block: this.name, element: child.name}));\r\n\t\t}\r\n\t\t_renderChildren() {\r\n\t\t\tvar element = this.getDOMElement(),\r\n\t\t\t\telementsWithChildAttr = UILib.find('*[' + this.childDataAttr + ']', element),\r\n\t\t\t\trenderChild = child => {\r\n\t\t\t\t\tvar childElement = child.render();\r\n\t\t\t\t\tthis._addChildClasses(child);\r\n\t\t\t\t\treturn child;\r\n\t\t\t\t},\r\n\t\t\t\tchild, childElement, lastRendered;\r\n\r\n\t\t\tfor(var i = 0; i < this._children.length; i += 1) {\r\n\t\t\t\tchild = this._children[i];\r\n\t\t\t\tif( elementsWithChildAttr.length !== 0 ) {\r\n\t\t\t\t\telementsWithChildAttr.forEach(element => {\r\n\t\t\t\t\t\tvar elementDataName = UILib.attr(element, this.childDataAttr);\r\n\t\t\t\t\t\tif(elementDataName !== child._internalName ) return;\r\n\t\t\t\t\t\tUILib.insertBefore( renderChild(child).getDOMElement(), element );\r\n\t\t\t\t\t})\r\n\t\t\t\t/**\r\n\t\t\t\t * If in template not represented elements with 'data-children' attrs\r\n\t\t\t\t * Try to add child components after last rendered component.\r\n\t\t\t\t * If no rendered components just append to template.\r\n\t\t\t\t * Used for itemlist component what can add and remove child components after render.\r\n\t\t\t\t */\r\n\t\t\t\t} else {\r\n\t\t\t\t\tchildElement = child.getDOMElement();\r\n\t\t\t\t\tif( childElement !== null ) {\r\n\t\t\t\t\t\tlastRendered = childElement;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tchildElement = renderChild(child).getDOMElement();\r\n\t\t\t\t\t\tif(!lastRendered) {\r\n\t\t\t\t\t\t\tUILib.prependTo(childElement, element);\r\n\t\t\t\t\t\t\tlastRendered = childElement;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tUILib.insertAfter(childElement, lastRendered);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\telementsWithChildAttr.forEach(UILib.remove);\r\n\t\t}\r\n\t\t// be careful - break encapsulation\r\n\t\t_findChildren(childName) {\r\n\t\t\tvar result = [],\r\n\t\t\t\tchildren = this.getChildren(childName);\r\n\r\n\t\t\tif(children !== null) {\r\n\t\t\t\tUtils.pushOrConcat(result, children);\r\n\t\t\t}\r\n\t\t\tthis._children.forEach(child => {\r\n\t\t\t\tresult = result.concat( child._findChildren(childName) );\r\n\t\t\t});\r\n\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\t_bindEvents(events) {\r\n\t\t\t(events || this._events).forEach(e => {\r\n\t\t\t\tthis.sandbox.subscribe({\r\n\t\t\t\t\teventType: e.eventType,\r\n\t\t\t\t\thandler: e.handler,\r\n\t\t\t\t\telement: this._element,\r\n\t\t\t\t\tcontext: this\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t}\r\n\t\t_unBindEvents() {\r\n\t\t\tthis._events.forEach(e => {\r\n\t\t\t\tthis.sandbox.unsubscribe({\r\n\t\t\t\t\teventType: e.eventType,\r\n\t\t\t\t\thandler: e.handler,\r\n\t\t\t\t\telement: this._element,\r\n\t\t\t\t\tcontext: this\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t}\r\n\t\t_isInternalCommand(obj) {\r\n\t\t\treturn obj instanceof InternalCommand;\r\n\t\t}\r\n\t};\r\n\r\n\tclass InternalCommand {\r\n\t\tconstructor(name, value) {\r\n\t\t\tthis[name] = value;\r\n\t\t}\r\n\t}\r\n\r\n\texports.Component = Component;\r\n\r\n}( WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype ));\n// tabitem.js\r\n/**\r\n * @fileoverview of CORE tabitem.\r\n */\r\n\r\n(function( exports, modules ) {\r\n\t'use strict';\r\n\r\n\tvar Utils = modules.Utils,\r\n\t\tComponent = exports.Component,\r\n\t\tUILib = modules.UILib;\r\n\r\n\tclass Icon extends Component {\r\n\t\tconstructor(sandbox, parameters) {\r\n\t\t\tparameters = Object.assign({name: 'icon'}, parameters);\r\n\t\t\tsuper(sandbox, parameters);\r\n\t\t\tthis.setTemplate('<span class=\"<%=prefix%>-icon <%=prefix%>-icon-<%=iconName%>\"></span>');\r\n\t\t\tthis.registerModificatorsTypes({\r\n\t\t\t\tbig: 'big',\r\n\t\t\t\tactive: 'active',\r\n\t\t\t\tsmall: 'small',\r\n\t\t\t\tsuccess: 'success',\r\n\t\t\t\terror: 'error',\r\n\t\t\t\tconfirm: 'confirm'\r\n\t\t\t}, 'icon-' + parameters.iconName);\r\n\t\t\tthis.addTemplateData({\r\n\t\t\t\ticonName: parameters.iconName\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tactivate() {\r\n\t\t\tthis.addModificator('active');\r\n\t\t}\r\n\r\n\t\tdeactivate() {\r\n\t\t\tthis.removeModificator('active');\r\n\t\t}\r\n\t}\r\n\texports.Icon = Icon;\r\n\r\n}( WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype ));\n// input.js\n/**\n * @fileoverview of Input component.\n */\n\n/**\n * @namespace CORE.UI\n */\n\n(function (exports, modules) {\n    'use strict';\n\n    var UILib = modules.UILib,\n        Component = exports.Component,\n        Utils = modules.Utils;\n\n    /**\n     * Input class.\n     *\n     * @constructor\n     * @alias CORE.UI.Input\n     */\n    class Input extends Component {\n        constructor(sandbox, parameters) {\n            parameters = Object.assign({name: 'input'}, parameters);\n            parameters.modificators =  parameters.modificators || [];\n            parameters.modificators.push('focusable');\n            super(sandbox, parameters);\n            this.setTemplate('<input placeholder=\"<%=placeholder%>\" id=\"<%=prefix%>-<%=id%>\" name=\"<%=attrName%>\" maxlength=\"<%=maxLength%>\" class=\"<%=prefix%>-input <%=prefix%>-<%=type%>\" type=\"<%=type%>\" value=\"<%=value%>\" <%=disabled%> <%=checked%> autocomplete=\"<%=autocomplete%>\" autocorrect=\"<%=autocorrect%>\" autocapitalize=\"<%=autocapitalize%>\" spellcheck=\"<%=spellcheck%>\" aria-labelledby=\"<%=labelledBy%>\" />');\n            this.addTemplateData({\n                id: parameters.id || '',\n                attrName: parameters.attrName || '',\n                type: parameters.type || 'text',\n                value: parameters.value || '',\n                placeholder: parameters.placeholder || '',\n                maxLength: parameters.maxLength || '',\n                disabled: parameters.disabled ? 'disabled' : '',\n                style: parameters.style || '',\n                autocomplete: parameters.autocomplete || '',\n                autocorrect: parameters.autocorrect || '',\n                autocapitalize: parameters.autocapitalize || '',\n                spellcheck: parameters.spellcheck || '',\n                labelledBy: parameters.labelledBy ? (this.prefix + '-label-' + parameters.labelledBy) : '',\n                checked: (parameters.checked) ? 'checked' : ''\n            });\n            this.build(parameters);\n        }\n\n        build(parameters) {\n            if (typeof parameters.onKeydown === 'function') {\n                this.attachEvents({\n                    eventType: 'keydown',\n                    handler: function (event) {\n                        parameters.onKeydown(event);\n                    }\n                });\n            }\n        }\n\n        getAttrName() {\n            return this.getTemplateData('attrName');\n        }\n\n        getValue() {\n            return this._getField('value');\n        }\n\n        setValue(value) {\n            this._setField('value', value);\n        }\n\n        getChecked() {\n            return !!this._getField('checked');\n\t\t}\n\n\t\tsetChecked(value) {\n            this._setField('checked', !!value);\n        }\n\n        setFocus() {\n            var element = this.getDOMElement();\n\n            if (element) {\n                element.focus();\n            }\n        }\n\n        _getField(fieldName) {\n            var element = this.getDOMElement();\n\n            if (element) {\n                return element[fieldName];\n            } else {\n                return this.getTemplateData(fieldName);\n            }\n        }\n\n        _setField(fieldName, value) {\n            var element = this.getDOMElement();\n\n            if (element) {\n                element[fieldName] = value;\n            } else {\n                var data = {};\n                data[fieldName] = value;\n                this.addTemplateData(data);\n            }\n        }\n    }\n\n    exports.Input = Input;\n\n}(WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype));\n// label.js\n/**\n * @fileoverview of Label component.\n */\n\n/**\n * @namespace CORE.UI\n */\n\n(function (exports, modules) {\n    'use strict';\n\n    var UILib = modules.UILib,\n        Component = exports.Component,\n        Utils = modules.Utils;\n\n    /**\n     * Label class.\n     *\n     * @constructor\n     * @alias CORE.UI.Label\n     */\n    class Label extends Component {\n        constructor(sandbox, parameters) {\n            parameters = Object.assign({name: 'label'}, parameters);\n            super(sandbox, parameters);\n            this.setTemplate('<label for=\"<%=prefix%>-<%=labelFor%>\" class=\"<%=prefix%>-label\" id=\"<%=prefix%>-label-<%=id%>\" title=\"<%=labelTitle%>\"><%=labelText%></label>');\n            this.addTemplateData({\n                labelFor: parameters.labelFor || '',\n                id: parameters.id || '',\n                labelText: parameters.labelText || '',\n                labelTitle: parameters.labelText || '',\n            });\n        }\n    }\n\n    exports.Label = Label;\n\n}(WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype));\n// textInput.js\r\n/**\r\n * @fileoverview of TextInput component.\r\n */\r\n\r\n/**\r\n * @namespace CORE.UI\r\n */\r\n\r\n(function (exports, modules) {\r\n\t'use strict';\r\n\r\n\tvar UILib = modules.UILib,\r\n\t\tComponent = exports.Component,\r\n\t\tUtils = modules.Utils,\r\n\t\tInput = exports.Input,\r\n\t\tLabel = exports.Label;\r\n\r\n    /**\r\n     * TextInput class.\r\n     *\r\n     * @constructor\r\n     * @alias CORE.UI.TextInput\r\n     */\r\n\tclass TextInput extends Component {\r\n\t\tconstructor(sandbox, parameters) {\r\n\t\t\tparameters = Object.assign({name: 'textInput'}, parameters);\r\n\t\t\tsuper(sandbox, parameters);\r\n\t\t\tthis.setTemplate('<div class=\"<%=prefix%>-input-wrapper <%=prefix%>-input-wrapper\">\t<div data-children=\"label\"></div>\t<div data-children=\"input\"></div></div>');\r\n\t\t\tthis.build(parameters);\r\n\t\t}\r\n\r\n\t\tbuild(parameters) {\r\n\t\t\tthis.buildInput(parameters);\r\n\t\t\tthis.buildLabel(parameters);\r\n\t\t\tthis.proxyMethodsFrom( this.getChildren('input'), ['getValue', 'setValue', 'setFocus'] );\r\n\t\t}\r\n\r\n\t\tbuildInput(parameters) {\r\n\t\t\tvar input = new Input(this.sandbox, {\r\n\t\t\t\tid: parameters.id || '',\r\n\t\t\t\ttype: parameters.type || 'text',\r\n\t\t\t\tvalue: parameters.value || '',\r\n\t\t\t\tplaceholder: parameters.placeholder || '',\r\n\t\t\t\tmaxLength: parameters.maxLength || '',\r\n\t\t\t\tdisabled: parameters.disabled ? 'disabled' : '',\r\n\t\t\t\tstyle: parameters.style || '',\r\n\t\t\t\tautocomplete: parameters.autocomplete || 'off',\r\n\t\t\t\tautocorrect: parameters.autocorrect || 'off',\r\n\t\t\t\tautocapitalize: parameters.autocapitalize || 'off',\r\n\t\t\t\tspellcheck: parameters.spellcheck || 'false',\r\n\t\t\t\tlabelledBy: parameters.id || '',\r\n\t\t\t\tonKeydown: parameters.onKeydown\r\n\t\t\t});\r\n\t\t\tthis.registerChildren(input);\r\n\t\t}\r\n\r\n\t\tbuildLabel(parameters) {\r\n\t\t\tvar label = new Label(this.sandbox, {\r\n\t\t\t\tid: parameters.id ? parameters.id : '',\r\n\t\t\t\tlabelFor: parameters.id || '',\r\n\t\t\t\tlabelText: parameters.placeholder || '',\r\n\t\t\t\thide: true\r\n\t\t\t});\r\n\t\t\tthis.registerChildren(label);\r\n\t\t}\r\n\t}\r\n\r\n\texports.TextInput = TextInput;\r\n\r\n}(WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype));\n// form.js\r\n/**\r\n * @fileoverview of Form component.\r\n */\r\n\r\n/**\r\n * @namespace CORE.UI\r\n */\r\n\r\n(function (exports, modules) {\r\n\t'use strict';\r\n\r\n\tvar UILib = modules.UILib,\r\n\t\tComponent = exports.Component,\r\n\t\tUtils = modules.Utils;\r\n\r\n\r\n\tvar controlsStrategys = {\r\n\t\tcheckInputs(controls) {\r\n\t\t}\r\n\t}\r\n    /**\r\n     * Form class.\r\n     *\r\n     * @constructor\r\n     * @alias CORE.UI.Form\r\n     */\r\n\tclass Form extends Component {\r\n\t\tconstructor(sandbox, parameters) {\r\n\t\t\tparameters = Object.assign({name: 'form'}, parameters);\r\n\t\t\tsuper(sandbox, parameters);\r\n\t\t\tthis.setTemplate('<div class=\"<%=prefix%>-form\">    <div data-children=\"content\"></div></div>');\r\n\t\t\tthis.build(parameters);\r\n\t\t}\r\n\r\n\t\tbuild(parameters) {\r\n\t\t\tvar self = this;\r\n\t\t\tthis.registerChildren(parameters.content, 'content');\r\n\r\n\t\t\tthis.controlsStrategies = {\r\n\t\t\t\tradio(controls) {\r\n\t\t\t\t\tvar result = {}, checked = false;\r\n\r\n\t\t\t\t\tcontrols.forEach(control => {\r\n\t\t\t\t\t\tif( !checked && control.getChecked() === true ) {\r\n\t\t\t\t\t\t\tresult[ control.getAttrName() ] = control.getValue();\r\n\t\t\t\t\t\t\tchecked = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t},\r\n\t\t\t\tcheckbox(controls) {\r\n\t\t\t\t\tvar result = {};\r\n\r\n\t\t\t\t\tcontrols.forEach(control => { result[ control.getAttrName() ] = control.getChecked(); });\r\n\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tserializeToPlainObject() {\r\n\t\t\tvar results = {};\r\n\r\n\t\t\tfor(var controlType in this.controlsStrategies) {\r\n\t\t\t\tObject.assign(\r\n\t\t\t\t\tresults,\r\n\t\t\t\t\tthis.controlsStrategies[controlType]( this._findChildren(controlType) )\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\treturn results;\r\n\t\t}\r\n \t}\r\n\r\n\texports.Form = Form;\r\n\r\n}(WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype));\n// button.js\r\n/**\r\n * @fileoverview of Button component.\r\n */\r\n\r\n/**\r\n * @namespace CORE.UI\r\n */\r\n\r\n(function (exports, modules) {\r\n\t'use strict';\r\n\r\n\tvar UILib = modules.UILib,\r\n\t\tComponent = exports.Component,\r\n\t\tUtils = modules.Utils;\r\n\r\n    /**\r\n     * Button class.\r\n     *\r\n     * @constructor\r\n     * @alias CORE.UI.Button\r\n     */\r\n\tclass Button extends Component {\r\n\t\tconstructor(sandbox, parameters) {\r\n\t\t\tparameters = Object.assign({name: 'button'}, parameters);\r\n\t\t\tsuper(sandbox, parameters);\r\n\t\t\tthis.setTemplate('<a class=\"<%=prefix%>-<%=name%>\" href=\"<%=href%>\" title=\"<%=title%>\" style=\"<%=style%>\" target=\"<%=target%>\" role=\"<%=role%>\" aria-label=\"<%=ariaLabel%>\" aria-level=\"<%=ariaLevel%>\" aria-expanded=\"<%=ariaExpanded%>\" tabindex=\"<%=tabIndex%>\">    <div data-children=\"icon\"></div>    <span class=\"<%=prefix%>-<%=name%>__text\"><%=text%></span></a>');\r\n\t\t\tthis.addTemplateData({\r\n\t\t\t\thref: parameters.href || 'javascript:void(0)',\r\n\t\t\t\ttitle: parameters.title || '',\r\n\t\t\t\ttarget: parameters.target || '',\r\n\t\t\t\ttext: parameters.text || '',\r\n\t\t\t\tstyle: parameters.style || '',\r\n\t\t\t\trole: parameters.role || 'button',\r\n\t\t\t\tariaLevel: parameters.ariaLevel || '',\r\n\t\t\t\tariaLabel: parameters.ariaLabel || parameters.title || '',\r\n\t\t\t\tariaExpanded: parameters.ariaExpanded !== undefined ? parameters.ariaExpanded : '',\r\n\t\t\t\ttabIndex: parameters.tabIndex || 0\r\n\t\t\t});\r\n\t\t\tthis.registerModificatorsTypes({\r\n\t\t\t\ttext: 'text',\r\n\t\t\t\tdisable: 'disable'\r\n\t\t\t});\r\n\t\t\t/** buttons focusable by default */\r\n\t\t\tthis.addModificator('focusable');\r\n\t\t\tthis.disabled = false;\r\n\t\t\tthis.build(parameters);\r\n\t\t}\r\n\r\n\t\tbuild(parameters) {\r\n\t\t\tif(parameters.icon) {\r\n\t\t\t\tthis.registerIcon(parameters.icon);\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof parameters.onClick === 'function') {\r\n\t\t\t\tthis.attachEvents({\r\n\t\t\t\t\teventType: 'click',\r\n\t\t\t\t\thandler: function(event) {\r\n\t\t\t\t\t\tif (this.disabled) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tparameters.onClick(event);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof parameters.onKeydown === 'function') {\r\n\t\t\t\tthis.attachEvents({\r\n\t\t\t\t\teventType: 'keydown',\r\n\t\t\t\t\thandler: function (event) {\r\n\t\t\t\t\t\tif (this.disabled) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tparameters.onKeydown(event);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof parameters.onFocus === 'function') {\r\n\t\t\t\tthis.attachEvents({\r\n\t\t\t\t\teventType: 'focus',\r\n\t\t\t\t\thandler: function (event) {\r\n\t\t\t\t\t\tif (this.disabled) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tparameters.onFocus(event);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof parameters.onBlur === 'function') {\r\n\t\t\t\tthis.attachEvents({\r\n\t\t\t\t\teventType: 'blur',\r\n\t\t\t\t\thandler: function (event) {\r\n\t\t\t\t\t\tif (this.disabled) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tparameters.onBlur(event);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tregisterIcon(icon) {\r\n\t\t\tthis.registerChildren(icon);\r\n\t\t}\r\n\r\n\t\tsetText(text) {\r\n\t\t\tthis.addTemplateData({text});\r\n\t\t\tvar element = this.getDOMElement();\r\n\t\t\tif( element !== null ) {\r\n\t\t\t\tvar cssString = this._buildCssString({block: this.name, element: 'text'});\r\n\t\t\t\tUILib.find( '.' + cssString, element )[0].innerHTML = text;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tgetText() {\r\n\t\t\treturn this.getTemplateData('text');\r\n\t\t}\r\n\r\n\t\tenable() {\r\n\t\t\tthis.disabled = false;\r\n\t\t\tthis.removeModificator('disable');\r\n\t\t}\r\n\r\n\t\tdisable() {\r\n\t\t\tthis.disabled = true;\r\n\t\t\tthis.addModificator('disable');\r\n\t\t}\r\n\r\n\t\tactivate() {\r\n\t\t\tvar icon = this.getChildren('icon');\r\n\t\t\ticon && icon.activate();\r\n\t\t}\r\n\r\n\t\tdeactivate() {\r\n\t\t\tvar icon = this.getChildren('icon');\r\n\t\t\ticon && icon.deactivate();\r\n\t\t}\r\n \t}\r\n\r\n\texports.Button = Button;\r\n\r\n}(WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype));\n// item.js\n/**\n * @fileoverview of CORE item list.\n */\n\n(function( exports, modules ) {\n\t'use strict';\n\tvar Utils = modules.Utils,\n\t\tComponent = exports.Component,\n\t\tButton = exports.Button,\n\t\tUILib = modules.UILib;\n\n\t/**\n\t* Description of item list click callback.\n\t*\n\t* @callback CORE.UI.ItemList~onClicks\n\t*/\n\tclass Item extends Component {\n\t\tconstructor(sandbox, parameters) {\n\t\t\tparameters = Object.assign({name: 'item'}, parameters);\n\t\t\tsuper(sandbox, parameters);\n\t\t\tthis.setTemplate('<li class=\"<%=prefix%>-item\" role=\"<%=role%>\">\t<div data-children=\"content\"></div></li>');\n\t\t\tthis.addTemplateData({\n\t\t\t\trole: parameters.role || ''\n\t\t\t});\n\t\t\tthis.build(parameters.itemContent);\n\t\t}\n\n\t\tbuild(content) {\n\t\t\tthis.registerChildren( content instanceof Component ? content : new Button(this.sandbox, content), 'content' );\n\t\t}\n\t}\n\n\texports.Item = Item;\n\n}( WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype ));\n// itemlist.js\r\n/**\r\n * @fileoverview of CORE item list.\r\n */\r\n\r\n(function( exports, modules ) {\r\n\t'use strict';\r\n\tvar Component = exports.Component;\r\n\tvar Item = exports.Item;\r\n\tvar UILib = modules.UILib;\r\n\tvar Utils = modules.Utils;\r\n\r\n\tclass ItemList extends Component {\r\n\t\tconstructor(sandbox, parameters) {\r\n\t\t\tparameters = Object.assign({name: 'list'}, parameters);\r\n\t\t\tsuper(sandbox, parameters);\r\n\t\t\tthis.setTemplate('<ul class=\"<%=prefix%>-list\" id=\"<%=controlsBy%>\" role=\"<%=role%>\" aria-label=\"<%=ariaLabel%>\">    <div data-children=\"item\"></div></ul>');\r\n\t\t\tthis.addTemplateData({\r\n\t\t\t\tcontrolsBy: parameters.controlsBy || '',\r\n\t\t\t\trole: parameters.role || '',\r\n\t\t\t\tariaLabel: parameters.ariaLabel || ''\r\n\t\t\t});\r\n\t\t\tthis.itemRole = parameters.itemRole || '';\r\n\t\t\tthis.changeTabIndexOnFocus = parameters.changeTabIndexOnFocus || false;\r\n\t\t\tthis.nextKey = parameters.nextKey || 40;\r\n\t\t\tthis.prevKey = parameters.prevKey || 38;\r\n\t\t\tthis.keyboardTrapped = false;\r\n\r\n\t\t\tthis.build(parameters);\r\n\t\t}\r\n\t\tbuild(parameters) {\r\n\t\t\tif (typeof parameters.onFocusin === 'function') {\r\n\t\t\t\tthis.attachEvents({\r\n\t\t\t\t\teventType: 'focusin',\r\n\t\t\t\t\thandler: function (event) {\r\n\t\t\t\t\t\tthis.handleFocusin(event);\r\n\t\t\t\t\t\tparameters.onFocusin(event);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (typeof parameters.onFocusout === 'function') {\r\n\t\t\t\tthis.attachEvents({\r\n\t\t\t\t\teventType: 'focusout',\r\n\t\t\t\t\thandler: function (event) {\r\n\t\t\t\t\t\tthis.handleFocusout(event);\r\n\t\t\t\t\t\tparameters.onFocusout(event);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\taddItems(itemsContents) {\r\n\t\t\tfor(var i = 0; i < itemsContents.length; i += 1) {\r\n\t\t\t\tthis.addItem(itemsContents[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\taddItem(itemContent, position) {\r\n\t\t\tvar item = new Item(this.sandbox, {\r\n\t\t\t\trole: this.itemRole,\r\n\t\t\t\titemContent\r\n\t\t\t});\r\n\r\n\t\t\titem.addTemplateData(this.templateData);\r\n\t\t\titem.getChildren('content').registerLifeCycleHandler( 'after', 'remove', item.remove.bind(item) );\r\n\t\t\tthis.registerChildren(item, 'item', position);\r\n\r\n\t\t\treturn item;\r\n\t\t}\r\n\t\tremoveAllItems() {\r\n\t\t\tthis.removeAllChildren();\r\n\t\t}\r\n\t\tgetLength() {\r\n\t\t\treturn this._children.length;\r\n\t\t}\r\n\t\thandleFocusin(event) {\r\n\t\t\tif (!this.keyboardTrapped) {\r\n\t\t\t\tthis.sandbox.subscribe({\r\n\t\t\t\t\teventType: 'keydown',\r\n\t\t\t\t\telement: this.getDOMElement(),\r\n\t\t\t\t\thandler: this.trapKeyboard,\r\n\t\t\t\t\tcontext: this\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.keyboardTrapped = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\thandleFocusout(event) {\r\n\t\t\tif ( !this.getDOMElement().contains(event.relatedTarget) ) {\r\n\t\t\t\tthis.sandbox.unsubscribe({\r\n\t\t\t\t\teventType: 'keydown',\r\n\t\t\t\t\telement: this.getDOMElement(),\r\n\t\t\t\t\thandler: this.trapKeyboard,\r\n\t\t\t\t\tcontext: this\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.keyboardTrapped = false;\r\n\t\t\t}\r\n\t\t}\r\n\t\ttrapKeyboard(event) {\r\n\t\t\tvar key = event.keyCode;\r\n\r\n\t\t\tif (key === this.prevKey) {\r\n\t\t\t\tthis.handlePrevKeyPress(event);\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t} else if (key === this.nextKey) {\r\n\t\t\t\tthis.handleNextKeyPress(event);\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t}\r\n\t\t}\r\n\t\thandlePrevKeyPress(event) {\r\n\t\t\tvar prev = this.getNextPrevByActive( this.getTabIndexedElements() ).prev;\r\n\r\n\t\t\tif (prev) {\r\n\t\t\t\tprev.focus();\r\n\r\n\t\t\t\tif (this.changeTabIndexOnFocus) {\r\n\t\t\t\t\tthis.resetAllTabIndexes();\r\n\t\t\t\t\tUILib.attr(prev, 'tabindex', 0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\thandleNextKeyPress(event) {\r\n\t\t\tvar next = this.getNextPrevByActive( this.getTabIndexedElements() ).next;\r\n\r\n\t\t\tif (next) {\r\n\t\t\t\tnext.focus();\r\n\r\n\t\t\t\tif (this.changeTabIndexOnFocus) {\r\n\t\t\t\t\tthis.resetAllTabIndexes();\r\n\t\t\t\t\tUILib.attr(next, 'tabindex', 0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\texports.ItemList = ItemList;\r\n\r\n}( WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype ));\n// textInput.js\r\n/**\r\n * @fileoverview of Checkbox component.\r\n */\r\n\r\n/**\r\n * @namespace CORE.UI\r\n */\r\n\r\n(function (exports, modules) {\r\n\t'use strict';\r\n\r\n\tvar UILib = modules.UILib,\r\n\t\tComponent = exports.Component,\r\n\t\tUtils = modules.Utils,\r\n\t\tInput = exports.Input,\r\n\t\tLabel = exports.Label;\r\n\r\n    /**\r\n     * Checkbox class.\r\n     *\r\n     * @constructor\r\n     * @alias CORE.UI.Checkbox\r\n     */\r\n\tclass Checkbox extends Component {\r\n\t\tconstructor(sandbox, parameters) {\r\n\t\t\tparameters = Object.assign({name: 'checkbox'}, parameters);\r\n\t\t\tsuper(sandbox, parameters);\r\n\t\t\tthis.setTemplate('<span class=\"<%=prefix%>-checkbox-wrapper <%=prefix%>-input-wrapper\">\t<div data-children=\"input\"></div>\t<div data-children=\"label\"></div></span>');\r\n\t\t\tthis.build(parameters);\r\n\t\t}\r\n\r\n\t\tbuild(parameters) {\r\n\t\t\tthis.buildInput(parameters);\r\n\t\t\tthis.buildLabel(parameters);\r\n\t\t\tthis.proxyMethodsFrom( this.getChildren('input'), ['getAttrName', 'getValue', 'setValue', 'getChecked', 'setChecked'] );\r\n\t\t}\r\n\r\n\t\tbuildInput(parameters) {\r\n\t\t\tvar input = new Input(this.sandbox, {\r\n\t\t\t\tattrName: parameters.attrName,\r\n\t\t\t\tid: parameters.id,\r\n\t\t\t\ttype: 'checkbox',\r\n\t\t\t\tvalue: parameters.value,\r\n\t\t\t\tlabelledBy: parameters.id,\r\n\t\t\t\tchecked: parameters.checked || false\r\n\t\t\t});\r\n\t\t\tthis.registerChildren(input);\r\n\t\t}\r\n\r\n\t\tbuildLabel(parameters) {\r\n\t\t\tvar label = new Label(this.sandbox, {\r\n\t\t\t\tid: parameters.id,\r\n\t\t\t\tlabelText: parameters.placeholder || '',\r\n\t\t\t\tlabelFor: parameters.id\r\n\t\t\t});\r\n\t\t\tthis.registerChildren(label);\r\n\t\t}\r\n\t}\r\n\r\n\texports.Checkbox = Checkbox;\r\n\r\n}(WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype));\n// textInput.js\r\n/**\r\n * @fileoverview of Radio component.\r\n */\r\n\r\n/**\r\n * @namespace CORE.UI\r\n */\r\n\r\n(function (exports, modules) {\r\n\t'use strict';\r\n\r\n\tvar UILib = modules.UILib,\r\n\t\tComponent = exports.Component,\r\n\t\tUtils = modules.Utils,\r\n\t\tInput = exports.Input,\r\n\t\tLabel = exports.Label;\r\n\r\n    /**\r\n     * Radio class.\r\n     *\r\n     * @constructor\r\n     * @alias CORE.UI.Radio\r\n     */\r\n\tclass Radio extends Component {\r\n\t\tconstructor(sandbox, parameters) {\r\n\t\t\tparameters = Object.assign({name: 'radio'}, parameters);\r\n\t\t\tsuper(sandbox, parameters);\r\n\t\t\tthis.setTemplate('<div class=\"<%=prefix%>-radio-wrapper <%=prefix%>-input-wrapper\">\t<div data-children=\"input\"></div>\t<div data-children=\"label\"></div></div>');\r\n\t\t\tthis.build(parameters);\r\n\t\t}\r\n\r\n\t\tbuild(parameters) {\r\n\t\t\tthis.buildInput(parameters);\r\n\t\t\tthis.buildLabel(parameters);\r\n\t\t\tthis.proxyMethodsFrom( this.getChildren('input'), ['getAttrName', 'getValue', 'setValue', 'getChecked', 'setChecked'] );\r\n\t\t}\r\n\r\n\t\tbuildInput(parameters) {\r\n\t\t\tvar input = new Input(this.sandbox, {\r\n\t\t\t\tattrName: parameters.attrName,\r\n\t\t\t\tid: parameters.id,\r\n\t\t\t\ttype: 'radio',\r\n\t\t\t\tvalue: parameters.value,\r\n\t\t\t\tlabelledBy: parameters.id,\r\n\t\t\t\tchecked: parameters.checked || false\r\n\t\t\t});\r\n\t\t\tthis.registerChildren(input);\r\n\t\t}\r\n\r\n\t\tbuildLabel(parameters) {\r\n\t\t\tvar label = new Label(this.sandbox, {\r\n\t\t\t\tid: parameters.id,\r\n\t\t\t\tlabelText: parameters.placeholder || '',\r\n\t\t\t\tlabelFor: parameters.id\r\n\t\t\t});\r\n\t\t\tthis.registerChildren(label);\r\n\t\t}\r\n\t}\r\n\r\n\texports.Radio = Radio;\r\n\r\n}(WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype));\n// tab.js\r\n/**\r\n * @fileoverview of CORE tab.\r\n */\r\n\r\n(function( exports, modules ) {\r\n\t'use strict';\r\n\r\n\tvar Utils = modules.Utils,\r\n\t\tComponent = exports.Component,\r\n\t\tUILib = modules.UILib;\r\n\r\n\texports = exports || {};\r\n\r\n\t/**\r\n\t * Tab class.\r\n\t *\r\n\t * @constructor\r\n\t * @alias CORE.UI.Tab\r\n\t */\r\n\tclass Page extends Component {\r\n\t\tconstructor(sandbox, parameters) {\r\n\t\t\tparameters = Object.assign({name: 'page'}, parameters);\r\n\t\t\tsuper(sandbox, parameters);\r\n\t\t\tthis.setTemplate('<div class=\"<%=prefix%>-page <%=prefix%>--clearfix\" id=\"<%=prefix%>-<%=role%>-<%=id%>\" role=\"<%=role%>\" aria-labelledby=\"<%=prefix%>-<%=ariaLabelledFor%>-<%=id%>\">    <div class=\"<%=prefix%>-page__content\">        <div class=\"<%=prefix%>-page__header\"><%=title%></div>        <div data-children=\"body\"></div>    </div>    <div class=\"<%=prefix%>-page__description\"></div></div>');\r\n\t\t\tthis.addTemplateData({\r\n\t\t\t\ttitle: parameters.content.getTitle(),\r\n\t\t\t\tid: parameters.id || '',\r\n\t\t\t\trole: parameters.role || '',\r\n\t\t\t\tariaLabelledFor: parameters.ariaLabelledFor || ''\r\n\t\t\t})\r\n\t\t\tthis.build(parameters);\r\n\t\t}\r\n\t\tbuild(parameters) {\r\n\t\t\tthis.registerChildren(parameters.content, 'body');\r\n\t\t}\r\n\t}\r\n\r\n\texports.Page = Page;\r\n\r\n}( WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype ));\n// tabitem.js\r\n/**\r\n * @fileoverview of CORE tabitem.\r\n */\r\n\r\n(function( exports, modules ) {\r\n\t'use strict';\r\n\r\n\tvar Utils = modules.Utils,\r\n\t\tComponent = exports.Component,\r\n\t\tIcon = exports.Icon,\r\n\t\tUILib = modules.UILib;\r\n\r\n\texports = exports || {};\r\n\r\n\t/**\r\n\t * TabNavlink class.\r\n\t *\r\n\t * @constructor\r\n\t * @alias CORE.UI.Tab\r\n\t * @param {Object} definition - tab options.\r\n\t * @param {String} [definition.title] - text of tab switcher button. If it doesn't specified it would be taken from id of tab.\r\n\t */\r\n\tclass TabNavlink extends Component {\r\n\t\tconstructor(sandbox, parameters) {\r\n\t\t\tparameters = Object.assign({name: 'tab-nav-link'}, parameters);\r\n\t\t\tsuper(sandbox, parameters);\r\n\t\t\tthis.setTemplate('<a class=\"<%=prefix%>-tab-nav-link\" href=\"javascript:void(0)\" title=\"<%=title%>\" id=\"<%=prefix%>-<%=role%>-<%=id%>\" tabindex=\"<%=tabIndex%>\" role=\"<%=role%>\" aria-controls=\"<%=prefix%>-<%=ariaControlsFor%>-<%=id%>\" aria-selected=\"<%=ariaSelected%>\">    <div class=\"<%=prefix%>-tab-nav-link__left\">        <div data-children=\"icon\"></div>    </div>    <span class=\"<%=prefix%>-tab-nav-link__text\"><%=title%></span>    <div class=\"<%=prefix%>-tab-nav-link__right\">        <div data-children=\"iconArrow\"></div>    </div></a>');\r\n\t\t\tthis.addTemplateData({\r\n\t\t\t\ttitle: parameters.title,\r\n\t\t\t\tid: parameters.id || '',\r\n\t\t\t\trole: parameters.role || '',\r\n\t\t\t\tariaControlsFor: parameters.ariaControlsFor || '',\r\n\t\t\t\ttabIndex: parameters.tabIndex || 0,\r\n\t\t\t\tariaSelected: parameters.ariaSelected || 'false'\r\n\t\t\t});\r\n\t\t\tthis.addModificator('focusable');\r\n\t\t\tthis.build(parameters);\r\n\t\t}\r\n\t\tbuild(parameters) {\r\n\t\t\tthis.registerIcons(parameters.icon);\r\n\t\t}\r\n\t\tregisterIcons(externalIcon) {\r\n\t\t\tif(externalIcon) {\r\n\t\t\t\tthis.registerChildren(externalIcon);\r\n\t\t\t}\r\n\r\n\t\t\tthis.registerChildren( new Icon(this.sandbox, {\r\n\t\t\t\ticonName: 'right'\r\n\t\t\t}), 'iconArrow');\r\n\t\t}\r\n\t\tactivateAriaTabAttributes() {\r\n\t\t\tvar element = this.getDOMElement();\r\n\r\n\t\t\tthis.addTemplateData({\r\n\t\t\t\ttabIndex: 0,\r\n\t\t\t\tariaSelected: true\r\n\t\t\t});\r\n\r\n\t\t\tif (element !== null) {\r\n\t\t\t\tUILib.attr(element, 'tabindex', 0);\r\n\t\t\t\tUILib.attr(element, 'aria-selected', true);\r\n\t\t\t}\r\n\t\t}\r\n\t\tdeactivateAriaTabAttributes() {\r\n\t\t\tvar element = this.getDOMElement();\r\n\r\n\t\t\tthis.addTemplateData({\r\n\t\t\t\ttabIndex: -1,\r\n\t\t\t\tariaSelected: false\r\n\t\t\t});\r\n\r\n\t\t\tif (element !== null) {\r\n\t\t\t\tUILib.attr(element, 'tabindex', -1);\r\n\t\t\t\tUILib.attr(element, 'aria-selected', false);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\texports.TabNavlink = TabNavlink;\r\n\r\n}( WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype ));\n// tab.js\r\n/**\r\n * @fileoverview of CORE tab.\r\n */\r\n\r\n(function( exports, modules ) {\r\n\t'use strict';\r\n\r\n\tvar Utils = modules.Utils,\r\n\t\tComponent = exports.Component,\r\n\t\tPage = exports.Page,\r\n\t\tTabNavlink = exports.TabNavlink,\r\n\t\tItemList = exports.ItemList,\r\n\t\tUILib = modules.UILib;\r\n\r\n\texports = exports || {};\r\n\r\n\t/**\r\n\t * Tab class.\r\n\t *\r\n\t * @constructor\r\n\t * @alias CORE.UI.Tabs\r\n\t */\r\n\tclass Tabs extends Component {\r\n\t\tconstructor(sandbox, parameters) {\r\n\t\t\tparameters = Object.assign({name: 'tabs'}, parameters);\r\n\t\t\tsuper(sandbox, parameters);\r\n\t\t\tthis.setTemplate('<div class=\"<%=prefix%>-tabs\">    <div data-children=\"nav\"></div>    <div data-children=\"page\"></div></div>');\r\n\t\t\tthis.activeSection = null;\r\n\t\t\tthis.build(parameters);\r\n\t\t}\r\n\t\tbuild(parameters) {\r\n\t\t\tvar list = new ItemList(this.sandbox, {\r\n\t\t\t\trole: parameters.role || '',\r\n\t\t\t\titemRole: 'none',\r\n\t\t\t\tariaLabel: parameters.ariaLabel || '',\r\n\t\t\t\tonFocusin: function() {}.bind(this),\r\n\t\t\t\tonFocusout: function() {}.bind(this)\r\n\t\t\t});\r\n\t\t\tthis.registerLifeCycleHandler('after', 'show', () => {\r\n\t\t\t\tthis.activateSectionByIndex(0);\r\n\t\t\t});\r\n\t\t\tthis.registerChildren(list, 'nav');\r\n\t\t}\r\n\t\tcreateTab(component) {\r\n\t\t\tvar nav =  this.getChildren('nav'),\r\n\t\t\t\tcomponentTitle = component.getTitle(),\r\n\t\t\t\tcomponentTitleLowerCased = componentTitle.toLowerCase();\r\n\r\n\t\t\tvar tabNavlink = new TabNavlink(this.sandbox, {\r\n\t\t\t\ttitle: componentTitle,\r\n\t\t\t\ticon: component.icon,\r\n\t\t\t\trole: 'tab',\r\n\t\t\t\tid: componentTitleLowerCased,\r\n\t\t\t\tariaControlsFor: 'tabpanel',\r\n\t\t\t\ttabIndex: -1,\r\n\t\t\t\tariaSelected: false\r\n\t\t\t});\r\n\r\n\t\t\tvar navItem = nav.addItem(tabNavlink);\r\n\t\t\tthis.registerBemElements(navItem);\r\n\t\t\tvar tabContent = new Page(this.sandbox, {\r\n\t\t\t\tcontent: component,\r\n\t\t\t\thide: true,\r\n\t\t\t\trole: 'tabpanel',\r\n\t\t\t\tid: componentTitleLowerCased,\r\n\t\t\t\tariaLabelledFor: 'tab'\r\n\t\t\t});\r\n\t\t\tthis.registerChildren(tabContent, 'page');\r\n\t\t\tthis.bindNavWithContent(navItem, tabContent);\r\n\t\t\tthis.bindNavLinkWithNavItem(tabNavlink, navItem);\r\n\t\t}\r\n\t\tbindNavWithContent(navItem, tabContent) {\r\n\t\t\tnavItem.attachEvents({\r\n\t\t\t\teventType: 'click',\r\n\t\t\t\thandler: () => this.activateSection(navItem, tabContent)\r\n\t\t\t});\r\n\t\t}\r\n\t\tbindNavLinkWithNavItem(tabNavlink, navItem) {\r\n\t\t\ttabNavlink.attachEvents({\r\n\t\t\t\teventType: 'focus',\r\n\t\t\t\thandler: () => {\r\n\t\t\t\t\tnavItem.addCustomModificator('focus', this.name);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\ttabNavlink.attachEvents({\r\n\t\t\t\teventType: 'blur',\r\n\t\t\t\thandler: () => {\r\n\t\t\t\t\tnavItem.removeCustomModificator('focus', this.name);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tactivateSection(navItem, component) {\r\n\t\t\tif (this.activeSection) {\r\n\t\t\t\tthis.activeSection.component.hide();\r\n\t\t\t\tthis.activeSection.navItem.removeCustomModificator('active', this.name);\r\n\t\t\t\tthis.activeSection.navItem.getChildren('content').deactivateAriaTabAttributes();\r\n\t\t\t}\r\n\r\n\t\t\tnavItem.addCustomModificator('active', this.name);\r\n\t\t\tnavItem.getChildren('content').activateAriaTabAttributes();\r\n\t\t\tcomponent.show();\r\n\t\t\tthis.activeSection = {navItem, component};\r\n\t\t}\r\n\t\tactivateSectionByIndex(index) {\r\n\t\t\tvar tabContents = this.getChildren('page') || [],\r\n\t\t\t\tnav = this.getChildren('nav'),\r\n\t\t\t\tnavItems= nav && nav.getChildren('item') || [];\r\n\r\n\t\t\tif (tabContents[index] && navItems[index]) {\r\n\t\t\t\tthis.activateSection(navItems[index], tabContents[index]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\texports.Tabs = Tabs;\r\n\r\n}( WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype ));\n// dialogwidget.js\n/**\n * @fileoverview of CORE DialogWidget module.\n */\n\n/**\n * @namespace CORE.UI\n */\n\n(function( exports, modules ) {\n\tvar UILib = modules.UILib,\n\t\tComponent = exports.Component,\n        Utils = modules.Utils;\n\n\tclass Dialog extends Component{\n\t\tconstructor(sandbox, parameters) {\n\t\t\tparameters = Object.assign({name: 'dialog'}, parameters);\n\t\t\tsuper(sandbox, parameters);\n\t\t\tthis.setTemplate('<div class=\"<%=prefix%>-overlay\">\t<div class=\"<%=prefix%>-dialog-holder\">\t\t<div class=\"<%=prefix%>-dialog\" role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"<%=prefix%>-header-title<%=id%>\">\t\t\t<div data-children=\"header\"></div>\t\t\t<div data-children=\"text-box\"></div>\t\t\t<div data-children=\"confirm-box\"></div>\t\t\t<div class=\"<%=prefix%>-body <%=prefix%>--clearfix\">\t\t\t\t<div data-children=\"menu\"></div>\t\t\t\t<div data-children=\"content\"></div>\t\t\t</div>\t\t</div>\t</div></div>');\n\t\t\tthis.addTemplateData({\n\t\t\t\tid: ''\n\t\t\t});\n\t\t\tthis.fullscreen = false;\n\t\t\tthis.textChanges = 0;\n\t\t\tthis.build(parameters);\n\n\t\t\tthis.registerLifeCycleHandler('after', 'show', () => {\n\t\t\t\tthis.sandbox.subscribe({\n\t\t\t\t\teventType: 'keydown',\n\t\t\t\t\telement: document,\n\t\t\t\t\thandler: this.trapKeyboard,\n\t\t\t\t\tcontext: this\n\t\t\t\t});\n\n\t\t\t\tthis.setFocusToFirstElement();\n\t\t\t\tthis.textChanges = 0;\n\t\t\t});\n\n\t\t\tthis.registerLifeCycleHandler('before', 'hide', () => {\n\t\t\t\tthis.sandbox.unsubscribe({\n\t\t\t\t\teventType: 'keydown',\n\t\t\t\t\telement: document,\n\t\t\t\t\thandler: this.trapKeyboard,\n\t\t\t\t\tcontext: this\n\t\t\t\t});\n\n\t\t\t\tthis.restoreDialog();\n\t\t\t\tthis.sandbox.getOption('originalContainer').focus();\n\t\t\t});\n\t\t}\n\n\t\tbuild(parameters) {\n\t\t\tthis.builder = parameters.builder;\n\t\t\tvar menu = this.builder.buildMenu(),\n\t\t\t\tcontent = this.builder.buildContent({\n\t\t\t\t\tcloseDialogHandler: this.closeDialog.bind(this),\n\t\t\t\t\tsetFocusToFirstElement: this.setFocusToFirstElement.bind(this)\n\t\t\t\t}),\n\t\t\t\theader = this.builder.buildHeader({\n\t\t\t\t\tcloseDialogHandler: this.closeDialogWithCheckTextChanges.bind(this),\n\t\t\t\t\tmaximizeRestoreDialogHandler: this.maximizeRestoreDialog.bind(this)\n\t\t\t\t}),\n\t\t\t\ttextBox = this.builder.buildTextBox({\n\t\t\t\t\tclosable: true,\n\t\t\t\t\tsetFocusToFirstElement: this.setFocusToFirstElement.bind(this)\n\t\t\t\t}),\n\t\t\t\tconfirmBox = this.builder.buildConfirmBox({\n\t\t\t\t\tactions: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: 'leave',\n\t\t\t\t\t\t\tcall: this.closeDialog.bind(this)\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: 'stay',\n\t\t\t\t\t\t\tcall: function () {\n\t\t\t\t\t\t\t\tconfirmBox.hide();\n\t\t\t\t\t\t\t\tthis.setFocusToFirstElement();\n\t\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t});\n\n\t\t\tthis.registerChildren(header);\n\t\t\tthis.registerChildren(textBox, 'text-box');\n\t\t\tthis.registerChildren(confirmBox, 'confirm-box');\n\t\t\tthis.registerChildren(menu, 'menu');\n\t\t\tthis.registerChildren(content, 'content');\n\t\t\tthis.registerChildren( this.builder.buildFooter() );\n\t\t\tif(content && menu) {\n\t\t\t\tthis.buildMenuButton(menu, header, content);\n\t\t\t}\n\n\t\t\ttextBox.registerLifeCycleHandler('before', 'hide', () => {\n\t\t\t\ttextBox.removeStateModificators();\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe('userDictionaryAction', function (data) {\n\t\t\t\tthis.handleShowMessage(data);\n\t\t\t}, this);\n\n\t\t\tthis.sandbox.subscribe('removedMarkupInContainer', function (data) {\n\t\t\t\tdata && data.textChanged && this.textChanges++;\n\t\t\t}, this);\n\t\t}\n\n\t\tbuildMenuButton(menu, header, content) {\n\t\t\tvar menuButton = header.buildMenuButton(() => {\n\t\t\t\tif( menu.isVisible() ) {\n\t\t\t\t\tmenu.hide();\n\t\t\t\t\tcontent.show();\n\t\t\t\t} else {\n\t\t\t\t\tmenu.show();\n\t\t\t\t\tcontent.addModificator('hidden');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tmenu.registerLifeCycleHandler('after', 'show', () => {\n\t\t\t\tmenuButton.activate();\n\t\t\t\tmenuButton.setTitle( this.sandbox.getLocal('btn_proofreadDialog') );\n\t\t\t\tmenuButton.setAriaLabel( this.sandbox.getLocal('btn_proofreadDialog') );\n\t\t\t});\n\t\t\tmenu.registerLifeCycleHandler('after', 'hide', () => {\n\t\t\t\tmenuButton.deactivate();\n\t\t\t\tmenuButton.setTitle( this.sandbox.getLocal('btn_settings') );\n\t\t\t\tmenuButton.setAriaLabel( this.sandbox.getLocal('btn_settings') );\n\t\t\t});\n\t\t}\n\n\t\tshowMenu() {\n\t\t\tvar menu = this.getChildren('menu');\n\t\t\tmenu && menu.show();\n\t\t}\n\n\t\tshowContent() {\n\t\t\tvar content = this.getChildren('content');\n\t\t\tcontent &&  content.show();\n\t\t}\n\n\t\tcloseDialog() {\n\t\t\tvar menu = this.getChildren('menu'),\n\t\t\t\tcontent = this.getChildren('content'),\n\t\t\t\ttextBox = this.getChildren('text-box'),\n\t\t\t\tconfirmBox = this.getChildren('confirm-box');\n\n\t\t\tmenu && menu.hide();\n\t\t\tcontent && content.hide();\n\t\t\ttextBox && textBox.hide();\n\t\t\tconfirmBox && confirmBox.hide();\n\t\t\tthis.hide();\n\t\t}\n\n\t\tcloseDialogWithCheckTextChanges() {\n\t\t\tif (this.textChanges) {\n\t\t\t\tthis.sandbox.fire('showMessage', {\n\t\t\t\t\tmessage: this.sandbox.getLocal('message_confirm_closeWithoutSave'),\n\t\t\t\t\tmodificator: 'confirm',\n\t\t\t\t\ttype: 'confirm'\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.closeDialog();\n\t\t\t}\n\t\t}\n\n\t\ttrapKeyboard(event) {\n\t\t\tswitch (event.keyCode) {\n\t\t\t\tcase 9:\n\t\t\t\t\tthis.handleTabPress(event);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 27:\n\t\t\t\t\tthis.handleEscPress(event);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\thandleTabPress(event) {\n\t\t\tvar focusable = this.getNextPrevByActive( this.getFocusableElements() );\n\n\t\t\tif (event.shiftKey) {\n\t\t\t\tif (focusable.prev) {\n\t\t\t\t\tfocusable.prev.focus();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (focusable.next) {\n\t\t\t\t\tfocusable.next.focus();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tevent.preventDefault();\n\t\t}\n\n\t\thandleEscPress(event) {\n\t\t\tthis.closeDialogWithCheckTextChanges();\n\t\t}\n\n\t\thandleShowMessage(data) {\n\t\t\tvar postfix, messageTemplate, message;\n\n\t\t\tif (!data.action) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tpostfix = data.messagePostfix || '';\n\t\t\tmessageTemplate = this.sandbox.getLocal('message_' + data.status + '_' + data.action + postfix);\n\t\t\tmessage = data.replaceText ? messageTemplate.replace('%s', data.replaceText) : messageTemplate;\n\n\t\t\tthis.sandbox.fire('showMessage', {\n\t\t\t\tmessage: message,\n\t\t\t\tmodificator: data.status,\n\t\t\t\ttype: 'text'\n\t\t\t});\n\t\t}\n\n\t\tmaximizeRestoreDialog() {\n\t\t\tif (!this.fullscreen) {\n\t\t\t\tthis.maximizeDialog();\n\t\t\t} else {\n\t\t\t\tthis.restoreDialog();\n\t\t\t}\n\t\t}\n\n\t\tmaximizeDialog() {\n\t\t\tvar maximizeRestoreButton = this.getChildren('header').getChildren('maximizeRestoreButton');\n\n\t\t\tthis.addModificator('fullscreen');\n\t\t\tmaximizeRestoreButton.activate();\n\t\t\tmaximizeRestoreButton.setTitle( this.sandbox.getLocal('btn_restore') );\n\t\t\tmaximizeRestoreButton.setAriaLabel( this.sandbox.getLocal('btn_restore') );\n\t\t\tthis.fullscreen = true;\n\t\t}\n\n\t\trestoreDialog() {\n\t\t\tvar maximizeRestoreButton = this.getChildren('header').getChildren('maximizeRestoreButton');\n\n\t\t\tthis.removeModificator('fullscreen');\n\t\t\tmaximizeRestoreButton.deactivate();\n\t\t\tmaximizeRestoreButton.setTitle( this.sandbox.getLocal('btn_maximize') );\n\t\t\tmaximizeRestoreButton.setAriaLabel( this.sandbox.getLocal('btn_maximize') );\n\t\t\tthis.fullscreen = false;\n\t\t}\n\n\t\tsetFocusToFirstElement() {\n\t\t\tvar focusable = this.getFocusableElements();\n\n\t\t\tif (focusable.length) {\n\t\t\t\tfocusable[0].focus();\n\t\t\t}\n\t\t}\n\t}\n\n\texports.Dialog = Dialog;\n\n}( WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype ));\n// progressbar.js\r\n/**\r\n * @fileoverview of CORE progressbar.\r\n */\r\n\r\n(function( exports, modules ) {\r\n\t'use strict';\r\n\r\n\tvar Utils = modules.Utils,\r\n\t\tComponent = exports.Component,\r\n\t\tUILib = modules.UILib;\r\n\r\n\tclass ProgressBar extends Component {\r\n\t\tconstructor(sandbox, parameters) {\r\n\t\t\tparameters = Object.assign({name: 'progressbar'}, parameters);\r\n\t\t\tsuper(sandbox, parameters);\r\n\t\t\tthis.setTemplate('<span class=\"<%=prefix%>-progressbar\" role=\"progressbar\" aria-valuenow=\"100\" aria-valuemin=\"0\" aria-valuemax=\"100\"></span>');\r\n\t\t\tthis.registerModificatorsTypes({\r\n\t\t\t\tactive: 'active'\r\n\t\t\t});\r\n\r\n\t\t\tthis.sandbox.subscribe('spellCheckStarted', function (data) {\r\n\t\t\t\tthis.addModificator('active');\r\n\t\t\t\tthis.setAriaValueNow(0);\r\n\t\t\t}, this, -2000);\r\n\r\n\t\t\tthis.sandbox.subscribe('spellCheckEnded', function (data) {\r\n\t\t\t\tthis.removeModificator('active');\r\n\t\t\t\tthis.setAriaValueNow(100);\r\n\t\t\t}, this, -2000);\r\n\t\t}\r\n\r\n\t\tsetAriaValueNow(value) {\r\n\t\t\tvar element = this.getDOMElement();\r\n\r\n\t\t\tif (element !== null) {\r\n\t\t\t\tUILib.attr(element, 'aria-valuenow', value);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\texports.ProgressBar = ProgressBar;\r\n\r\n}( WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype ));\n// dialogwidget.js\n/**\n * @fileoverview of CORE DialogWidget module.\n */\n\n/**\n * @namespace CORE.UI\n */\n\n(function( exports, modules ) {\n\tvar UILib = modules.UILib,\n\t\tComponent = exports.Component,\n\t\tUtils = modules.Utils,\n\t\tIcon = exports.Icon,\n\t\tButton = exports.Button,\n\t\tProgressBar = exports.ProgressBar;\n\n\tclass Header extends Component {\n\t\tconstructor(sandbox, parameters) {\n\t\t\tparameters = Object.assign({name: 'header'}, parameters);\n\t\t\tsuper(sandbox, parameters);\n\t\t\tthis.setTemplate('<div class=\"<%=prefix%>-header\">\t<div class=\"<%=prefix%>-header-left <%=prefix%>--clearfix\">\t\t<div data-children=\"menuButton\"></div>\t\t<div class=\"<%=prefix%>-logo <%=prefix%>--float-right\"></div>\t</div>\t<div class=\"<%=prefix%>-header-right <%=prefix%>--clearfix\">\t\t<div class=\"<%=prefix%>-header-buttons <%=prefix%>-header-right__buttons <%=prefix%>--clearfix <%=prefix%>--float-right\">\t\t\t<div data-children=\"progressBar\"></div>\t\t\t<div data-children=\"maximizeRestoreButton\"></div>\t\t\t<div data-children=\"closeDialogButton\"></div>\t\t</div>\t</div>\t<div class=\"<%=prefix%>-header-title\" id=\"<%=prefix%>-header-title<%=id%>\"><%=title%></div>\t<div data-children=\"banner\"></div></div>');\n\t\t\tthis.addTemplateData({\n\t\t\t\tid: ''\n\t\t\t});\n\t\t\tthis.registerModificatorsTypes({\n\t\t\t\twithBanner: 'withBanner'\n\t\t\t});\n\t\t\tthis.build(parameters);\n\t\t}\n\n\t\tbuild(parameters) {\n\t\t\tvar self = this;\n\n\t\t\tif (parameters.banner) {\n\t\t\t\tthis.registerChildren(parameters.banner, 'banner');\n\t\t\t\tthis.addModificator('withBanner');\n\t\t\t}\n\n\t\t\tif (parameters.closeDialogHandler) {\n\t\t\t\tthis.buildCloseDialogButton(parameters.closeDialogHandler);\n\t\t\t}\n\t\t\t\n\t\t\tif (parameters.maximizeRestoreDialogHandler) {\n\t\t\t\tthis.buildMaximizeRestoreButton(parameters.maximizeRestoreDialogHandler);\n\t\t\t}\n\n\t\t\tthis.buildProgressBar();\n\t\t}\n\n\t\tcreateIcon(iconName) {\n\t\t\tvar icon = new Icon(this.sandbox, {\n\t\t\t\ticonName: iconName\n\t\t\t});\n\t\t\tthis.registerBemElements(icon);\n\n\t\t\treturn icon;\n\t\t}\n\n\t\tbuildMenuButton(handler) {\n\t\t\tthis.menuIcon = this.createIcon('menu');\n\t\t\tthis.menuButton = new Button(this.sandbox, {\n\t\t\t\ttitle: this.sandbox.getLocal('btn_settings'),\n\t\t\t\ticon: this.menuIcon,\n\t\t\t\tonClick: handler\n\t\t\t});\n\t\t\tthis.registerChildren(this.menuButton, 'menuButton');\n\n\t\t\treturn this.menuButton\n\t\t}\n\n\t\tbuildCloseDialogButton(closeDialogHandler) {\n\t\t\tthis.registerChildren(new Button(this.sandbox, {\n\t\t\t\ttitle: this.sandbox.getLocal('btn_close'),\n\t\t\t\ticon: this.createIcon('close'),\n\t\t\t\tonClick: closeDialogHandler\n\t\t\t}), 'closeDialogButton');\n\t\t}\n\n\t\tbuildMaximizeRestoreButton(maximizeRestoreDialogHandler) {\n\t\t\tthis.registerChildren(new Button(this.sandbox, {\n\t\t\t\ttitle: this.sandbox.getLocal('btn_maximize'),\n\t\t\t\ticon: this.createIcon('maximizeRestore'),\n\t\t\t\tonClick: maximizeRestoreDialogHandler\n\t\t\t}), 'maximizeRestoreButton');\n\t\t}\n\n\t\tbuildProgressBar() {\n\t\t\tthis.registerChildren(new ProgressBar(this.sandbox, {}), 'progressBar');\n\t\t}\n\t}\n\n\texports.Header = Header;\n\n}( WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype ));\n\n\n// textbox.js\n/**\n * @fileoverview of TextBox component.\n */\n\n/**\n * @namespace CORE.UI\n */\n\n(function (exports, modules) {\n    'use strict';\n\n    var UILib = modules.UILib,\n        Component = exports.Component,\n        Utils = modules.Utils;\n\n    /**\n     * TextBox class.\n     *\n     * @constructor\n     * @alias CORE.UI.Input\n     */\n    class TextBox extends Component {\n        constructor(sandbox, parameters) {\n            parameters = Object.assign({ name: 'text-box' }, parameters);\n            super(sandbox, parameters);\n            this.setTemplate('<div class=\"<%=prefix%>-text-box\"></div>');\n        }\n\n        setHtml(html) {\n            UILib.html(this._element, html);\n        }\n    }\n\n    exports.TextBox = TextBox;\n\n}(WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype));\n// messagebox.js\n/**\n * @fileoverview of MessageBox component.\n */\n\n/**\n * @namespace CORE.UI\n */\n\n(function (exports, modules) {\n    'use strict';\n\n    var UILib = modules.UILib,\n        Component = exports.Component,\n        Utils = modules.Utils,\n        Button = exports.Button,\n        Icon = exports.Icon,\n        ItemList = exports.ItemList,\n        TextBox = exports.TextBox;\n\n    /**\n     * MessageBox class.\n     *\n     * @constructor\n     * @alias CORE.UI.Input\n     */\n    class MessageBox extends Component {\n        constructor(sandbox, parameters) {\n            parameters = Object.assign({ name: 'message-box' }, parameters);\n            super(sandbox, parameters);\n            this.setFocusToFirstElement = parameters.setFocusToFirstElement || function() {};\n            this.setTemplate('<div class=\"<%=prefix%>-message-box\">    <div data-children=\"icon-box\"></div>    <div data-children=\"text-box\"></div>    <div data-children=\"close-message-box-button\"></div>    <div class=\"<%=prefix%>-message-box__buttons\">        <div data-children=\"actions\"></div>    </div></div>');\n            this.addTemplateData({\n\n            });\n            this.stateModificators = {\n                success: 'success',\n                error: 'error',\n                confirm: 'confirm'\n            };\n            this.registerModificatorsTypes(this.stateModificators);\n            this.timeoutDelay = 5000;\n            this.timeoutId = null;\n            this.closable = parameters.closable || false;\n            this.type = parameters.type || 'text';\n\n            this.build(parameters);\n\n            this.sandbox.subscribe('showMessage', function (data) {\n                if (data.type === this.type) {\n                    this.handleShowMessage(data);\n                }\n            }, this);\n\n            this.sandbox.subscribe('hideMessage', function (data) {\n                this.handleHideMessage(data);\n            }, this);\n        }\n\n        build(parameters) {\n            this.buildIconBox();\n            this.buildTextBox();\n\n            if (this.closable) {\n                this.buildCloseMessageBoxButton();\n            }\n\n            if (parameters.actions) {\n                this.buildMessageActions(parameters.actions);\n            }\n        }\n\n        buildIconBox() {\n            this.registerChildren(this.createIcon('message'), 'icon-box');\n        }\n\n        buildTextBox() {\n            this.registerChildren(new TextBox(this.sandbox), 'text-box');\n        }\n\n        buildCloseMessageBoxButton(parameters) {\n            this.registerChildren(new Button(this.sandbox, {\n                title: this.sandbox.getLocal('btn_close'),\n                icon: this.createIcon('remove'),\n                onClick: this.handleCloseMessageButtonClick.bind(this)\n            }), 'close-message-box-button');\n        }\n\n        buildMessageActions(actions) {\n            this.registerChildren(new ItemList(this.sandbox), 'actions');\n            actions.forEach(action => {\n                this.createActionsItem(action);\n            });\n        }\n\n        createIcon(iconName) {\n            var icon = new Icon(this.sandbox, {\n                iconName: iconName\n            });\n            this.registerBemElements(icon);\n\n            return icon;\n        }\n\n        handleShowMessage(data) {\n            var self = this,\n                icon = this.getChildren('icon-box');\n\n            this.sandbox.fire('hideMessage', {});\n\n            if (data.modificator in this.stateModificators) {\n                this.addModificator(data.modificator);\n                icon.addModificator(data.modificator);\n            }\n\n            this.setHtml(data.message);\n            this.show();\n\n            if (this.closable) {\n                this.timeoutId = setTimeout(function () {\n                    self.hide();\n                }, this.timeoutDelay);\n            }\n        }\n\n        handleHideMessage(data) {\n            this.clearTimeout();\n            this.hide();\n        }\n\n        handleCloseMessageButtonClick() {\n            this.handleHideMessage();\n            this.setFocusToFirstElement();\n        }\n\n        setHtml(html) {\n            this.getChildren('text-box').setHtml(html);\n        }\n\n        removeStateModificators() {\n            var icon = this.getChildren('icon-box');\n\n            for (var item in this.stateModificators) {\n                this.removeModificator(this.stateModificators[item]);\n                icon.removeModificator(this.stateModificators[item]);\n            }\n        }\n\n        clearTimeout() {\n            clearTimeout(this.timeoutId);\n            this.timeoutId = null;\n        }\n\n        createActionsItem(item, parameters) {\n            var actionsContainer = this.getChildren('actions'),\n                parameters = parameters || {};\n\n            actionsContainer.addItem({\n                title: this.sandbox.getLocal('btn_' + item.name),\n                text: this.sandbox.getLocal('btn_' + item.name),\n                modificators: ['text'],\n                onClick: item.call\n            });\n        }\n    }\n\n    exports.MessageBox = MessageBox;\n\n}(WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype));\n// worditem.js\n/**\n * @fileoverview of WordItem component.\n */\n\n/**\n * @namespace CORE.UI\n */\n\n(function (exports, modules) {\n    'use strict';\n\n    var UILib = modules.UILib,\n        Component = exports.Component,\n        Utils = modules.Utils,\n        Icon = exports.Icon,\n        Button = exports.Button;\n\n    /**\n     * WordItem class.\n     *\n     * @constructor\n     * @alias CORE.UI.Input\n     */\n    class WordItem extends Component {\n        constructor(sandbox, parameters) {\n            parameters = Object.assign({ name: 'word-item' }, parameters);\n            super(sandbox, parameters);\n            this.text = parameters.text || '';\n            this.setTemplate('<div class=\"<%=prefix%>-word-item\" role=\"gridcell\">    <span class=\"<%=prefix%>-word-item__text\"><%=text%></span>    <div data-children=\"deleteWordButton\"></div></div>');\n            this.addTemplateData({\n                text: this.text\n            });\n            this.build(parameters);\n        }\n\n        build(parameters) {\n            this.buildDeleteButton(parameters);\n            this.proxyMethodsFrom( this.getChildren('deleteWordButton'), ['enable', 'disable'] );\n        }\n\n        buildDeleteButton(parameters) {\n            this.registerChildren(new Button(this.sandbox, {\n                title: this.sandbox.getLocal('btn_deleteWord'),\n                icon: this.createIcon('remove'),\n                tabIndex: -1,\n                ariaLabel: this.sandbox.getLocal('btn_deleteWord') + ' ' + this.text,\n                onClick: parameters.handleDeleteWord\n            }), 'deleteWordButton');\n        }\n\n        createIcon(iconName) {\n            var icon = new Icon(this.sandbox, {\n                iconName: iconName\n            });\n\n            return icon;\n        }\n    }\n\n    exports.WordItem = WordItem;\n\n}(WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype));\n// About.js\n/**\n * @fileoverview of CORE About.\n */\n\n/**\n * @namespace CORE.UI\n */\nWEBSPELLCHECKER.CORE.UI = WEBSPELLCHECKER.CORE.UI || {};\n\n(function( exports, modules ) {\n\t'use strict';\n\n\tvar UILib = modules.UILib,\n\t\tComponent = exports.Component,\n\t\tIcon = exports.Icon,\n\t\tUtils = modules.Utils;\n\n\texports = exports || {};\n\n\t/**\n\t * About abstract class.\n\t *\n\t * @constructor\n\t * @alias CORE.UI.About\n\t */\n\tclass About extends Component {\n\t\tconstructor(sandbox, parameters) {\n\t\t\tparameters = Object.assign({name: 'about'}, parameters);\n\t\t\tsuper(sandbox, parameters);\n\t\t\tthis.setTitle(this.sandbox.getLocal('About'));\n\t\t\tthis.setTemplate('<div class=\"<%=prefix%>-about\">\t<div class=\"<%=prefix%>-about__text\"><%=textVersion%></div>\t<div class=\"<%=prefix%>-copyright\"><%=textCopyrights%></div></div>');\n\t\t\tthis.addTemplateData({\n\t\t\t\ttextVersion: sandbox.getLocal('version') + sandbox.getOption('wscVersion'),\n\t\t\t\ttextCopyrights: sandbox.getLocal('text_copyrights')\n\t\t\t});\n\t\t\tthis.icon = new Icon(sandbox, {iconName: this.name});\n\t\t}\n\t}\n\n\texports.About = About;\n\n}( WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype ));\n// Languages.js\n/**\n * @fileoverview of CORE Languages.\n */\n\n/**\n * @namespace CORE.UI\n */\nWEBSPELLCHECKER.CORE.UI = WEBSPELLCHECKER.CORE.UI || {};\n\n(function( exports, modules ) {\n\t'use strict';\n\n\tvar Component = exports.Component,\n\t\tIcon = exports.Icon,\n\t\tRadio = exports.Radio,\n\t\tItemList = exports.ItemList,\n\t\tForm = exports.Form,\n\t\tUtils = modules.Utils;\n\n\texports = exports || {};\n\n\t/**\n\t * Languages abstract class.\n\t *\n\t * @constructor\n\t * @alias CORE.UI.Languages\n\t */\n\tclass Languages extends Component {\n\t\tconstructor(sandbox, parameters) {\n\t\t\tparameters = Object.assign({name: 'languages'}, parameters);\n\t\t\tsuper(sandbox, parameters);\n\t\t\tthis.setTitle(this.sandbox.getLocal('Languages'));\n\t\t\tthis.setTemplate('<div class=\"<%=prefix%>-languages\">    <div data-children=\"form\"></div></div>');\n\t\t\tthis.icon = new Icon(sandbox, {iconName: this.name});\n\t\t\tthis.build();\n\t\t}\n\n\t\tbuild() {\n\t\t\tthis.spellingLangList = this.sandbox.getOption('spellingLangList');\n\t\t\tthis.spellingLangList = Object.assign({}, this.spellingLangList.ltr, this.spellingLangList.rtl);\n\t\t\tthis.languagesList = this.buildLanguagesList(this.spellingLangList);\n\t\t\tthis.registerBemElements(this.languagesList);\n\t\t\tthis.form = new Form(this.sandbox, {\n\t\t\t\tcontent: this.languagesList\n\t\t\t});\n\t\t\tthis.registerChildren(this.form);\n\t\t}\n\n\t\tbuildLanguagesList(spellingLangList) {\n\t\t\tvar langList = new ItemList(this.sandbox),\n\t\t\t\tspellingLangList = Utils.invertObject(spellingLangList);\n\n\t\t\tObject.keys(spellingLangList).sort().forEach(spellingLang => {\n\t\t\t\tvar code = spellingLangList[spellingLang],\n\t\t\t\t\tlanguagesItem = new Radio(this.sandbox, {\n\t\t\t\t\t\tvalue: code,\n\t\t\t\t\t\tplaceholder: spellingLang,\n\t\t\t\t\t\tid: 'lang-' + code,\n\t\t\t\t\t\tattrName: 'lang'\n\t\t\t\t\t});\n\t\t\t\tlangList.addItem(languagesItem);\n\t\t\t})\n\n\t\t\treturn langList;\n\t\t}\n\n\t\tdefineValues() {\n\t\t\tvar languagesList = this.languagesList.getChildren('item'),\n\t\t\t\tcurrentLang = this.sandbox.getOption('lang');\n\n\t\t\tlanguagesList.forEach( item => {\n\t\t\t\tvar checkbox = item.getChildren('content'),\n\t\t\t\t\toptionName = checkbox.getValue(),\n\t\t\t\t\tisChecked = currentLang === optionName;\n\n\t\t\t\tcheckbox.setChecked(isChecked);\n\t\t\t})\n\t\t}\n\n\t\tgetValue() {\n\t\t\treturn this.form.serializeToPlainObject();\n\t\t}\n\t}\n\n\texports.Languages = Languages;\n\n}( WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype ));\n// Options.js\n/**\n * @fileoverview of CORE Options.\n */\n\n/**\n * @namespace CORE.UI\n */\nWEBSPELLCHECKER.CORE.UI = WEBSPELLCHECKER.CORE.UI || {};\n\n(function( exports, modules ) {\n\t'use strict';\n\n\tvar UILib = modules.UILib,\n\t\tComponent = exports.Component,\n\t\tIcon = exports.Icon,\n\t\tCheckbox = exports.Checkbox,\n\t\tInput = exports.Input,\n\t\tItemList = exports.ItemList,\n\t\tForm = exports.Form,\n\t\tUtils = modules.Utils;\n\n\texports = exports || {};\n\n\t/**\n\t * Options class.\n\t *\n\t * @constructor\n\t * @alias CORE.UI.Options\n\t */\n\tclass Options extends Component {\n\t\tconstructor(sandbox, parameters) {\n\t\t\tparameters = Object.assign({name: 'options'}, parameters);\n\t\t\tsuper(sandbox, parameters);\n\t\t\tthis.setTitle(this.sandbox.getLocal('Options'));\n\t\t\tthis.setTemplate('<div class=\"<%=prefix%>-options\">    <div data-children=\"form\"></div></div>');\n\t\t\tthis.icon = new Icon(sandbox, {iconName: this.name});\n\t\t\tthis.proofreadOptions = this.sandbox.getOption('proofreadOptions');\n\t\t\tthis.build(parameters);\n\t\t}\n\n\t\tbuild(parameters) {\n\t\t\tthis.optionsList = this.buildOptionsList(parameters.proofreadOptions);\n\t\t\tthis.registerBemElements(this.optionsList);\n\n\t\t\tthis.form = new Form(this.sandbox, {\n\t\t\t\tcontent: this.optionsList\n\t\t\t});\n\t\t\tthis.registerChildren(this.form);\n\t\t}\n\n\t\tbuildOptionsList(proofreadOptions) {\n\t\t\tvar OptionsItem = null;\n\n\t\t\tvar optionsList = new ItemList(this.sandbox);\n\t\t\tthis.proofreadOptions.forEach( optionName => {\n\t\t\t\tOptionsItem = new Checkbox(this.sandbox, {\n\t\t\t\t\tvalue: optionName,\n\t\t\t\t\tplaceholder: this.sandbox.getLocal('label_' + optionName),\n\t\t\t\t\tid: 'option-' + optionName,\n\t\t\t\t\tattrName: optionName\n\t\t\t\t});\n\t\t\t\toptionsList.addItem(OptionsItem);\n\t\t\t});\n\n\t\t\treturn optionsList;\n\t\t}\n\n\t\tdefineValues() {\n\t\t\tvar optionItems = this.optionsList.getChildren('item');\n\t\t\toptionItems.forEach( item => {\n\t\t\t\tvar checkbox = item.getChildren('content'),\n\t\t\t\t\toptionName = checkbox.getValue(),\n\t\t\t\t\tisChecked = !!this.sandbox.getOption(optionName);\n\n\t\t\t\tcheckbox.setChecked(isChecked);\n\t\t\t})\n\t\t}\n\n\t\tgetValue() {\n\t\t\treturn this.form.serializeToPlainObject();\n\t\t}\n\t}\n\n\texports.Options = Options;\n\n}( WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype ));\n// dictionary.js\n/**\n * @fileoverview of Dictionary component.\n */\n\n/**\n * @namespace CORE.UI\n */\n\n(function (exports, modules) {\n    'use strict';\n\n    var UILib = modules.UILib,\n        Component = exports.Component,\n        Utils = modules.Utils,\n        Icon = exports.Icon,\n        Button = exports.Button,\n        TextInput = exports.TextInput,\n        ItemList = exports.ItemList,\n        WordItem = exports.WordItem;\n\n    /**\n     * Dictionary class.\n     *\n     * @constructor\n     * @alias CORE.UI.Dictionary\n     */\n    class Dictionaries extends Component {\n        constructor(sandbox, parameters) {\n            parameters = Object.assign({name: 'dictionaries'}, parameters);\n            super(sandbox, parameters);\n            this.setTemplate('<div class=\"<%=prefix%>-dictionaries\">    <div class=\"<%=prefix%>-dictionaries__preferences\">        <div class=\"<%=prefix%>-dictionaries__input\">            <div data-children=\"dictionaryNameInput\"></div>        </div>        <div class=\"<%=prefix%>-dictionaries__buttons <%=prefix%>-dictionaries__udcotrols\">            <div data-children=\"deleteDictionaryButton\"></div>            <div data-children=\"renameDictionaryButton\"></div>        </div>        <div class=\"<%=prefix%>-dictionaries__buttons\">            <div data-children=\"createDictionaryButton\"></div>            <div data-children=\"connectDictionaryButton\"></div>            <div data-children=\"disconnectDictionaryButton\"></div>        </div>    </div>    <div class=\"<%=prefix%>-dictionaries__words\">        <div class=\"<%=prefix%>-dictionaries__input\">            <div data-children=\"addWordInput\"></div>        </div>        <div class=\"<%=prefix%>-dictionaries__buttons <%=prefix%>-dictionaries__udcotrols\">            <div data-children=\"addToDictionaryButton\"></div>        </div>        <div data-children=\"words-list\"></div>    </div></div>');\n            this.setTitle(this.sandbox.getLocal('Dictionaries'));\n            this.udWordsItems = {};\n            this.build();\n\n            this.registerLifeCycleHandler('before', 'show', () => {\n                this.getUserDictionary();\n            });\n        }\n\n        build() {\n\t\t\tthis.icon = new Icon(this.sandbox, {\n                iconName: this.name\n            });\n            this.buildDictionaryNameInput();\n            this.buildDeleteDictionaryButton();\n            this.buildRenameDictionaryButton();\n            this.buildCreateDictionaryButton();\n            this.buildConnectDictionaryButton();\n            this.buildDisconnectDictionaryButton();\n            this.buildAddWordInput();\n            this.buildAddToDictionaryButton();\n            this.buildWordsList();\n\n            this.sandbox.subscribe('userDictionaryAction', function(data) {\n                this.handleUserDictionaryAction(data);\n            }, this);\n            this.toggleDictionaryStates( this.sandbox.getOption('userDictionaryName') );\n        }\n\n        createIcon(iconName) {\n            var icon = new Icon(this.sandbox, {\n                iconName: iconName\n            });\n            this.registerBemElements(icon);\n\n            return icon;\n        }\n\n        createButton(parameters) {\n            parameters.onClick = parameters.onClick && parameters.onClick.bind(this);\n\n            return new Button(this.sandbox, parameters);;\n        }\n\n        buildDictionaryNameInput() {\n            this.registerChildren( new TextInput(this.sandbox, {\n                id: 'dictionaryNameInput',\n                maxLength: '64',\n                placeholder: this.sandbox.getLocal('placeholder_fieldNameDic')\n            }), 'dictionaryNameInput');\n        }\n\n        buildDeleteDictionaryButton() {\n            this.registerChildren( this.createButton({\n                title: this.sandbox.getLocal('btn_deleteDic'),\n                icon: this.createIcon('trash'),\n                onClick: this.handleDeleteDictionary\n            }), 'deleteDictionaryButton');\n        }\n\n        buildRenameDictionaryButton() {\n            this.registerChildren( this.createButton({\n                title: this.sandbox.getLocal('btn_renameDic'),\n                icon: this.createIcon('edit'),\n                onClick: this.handleRenameDictionary\n            }), 'renameDictionaryButton');\n        }\n\n        buildCreateDictionaryButton() {\n            this.registerChildren( this.createButton({\n                title: this.sandbox.getLocal('btn_createDic'),\n                text: this.sandbox.getLocal('btn_createDic'),\n                modificators: ['text'],\n                onClick: this.handleCreateDictionary\n            }), 'createDictionaryButton')\n        }\n\n        buildConnectDictionaryButton() {\n            this.registerChildren( this.createButton({\n                title: this.sandbox.getLocal('btn_connectDic'),\n                text: this.sandbox.getLocal('btn_connectDic'),\n                modificators: ['text'],\n                onClick: this.handleConnectDictionary\n            }), 'connectDictionaryButton');\n        }\n\n        buildDisconnectDictionaryButton() {\n            this.registerChildren( this.createButton({\n                title: this.sandbox.getLocal('btn_disconnectDic'),\n                text: this.sandbox.getLocal('btn_disconnectDic'),\n                modificators: ['text'],\n                onClick: this.handleDisconnectDictionary\n            }), 'disconnectDictionaryButton');\n        }\n\n        buildAddWordInput() {\n            this.registerChildren( new TextInput(this.sandbox, {\n                id: 'addWordInput',\n                maxLength: '64',\n                placeholder: this.sandbox.getLocal('placeholder_fieldAddWord'),\n                onKeydown: this.handleWordInputKeydown.bind(this)\n            }), 'addWordInput');\n        }\n\n        buildAddToDictionaryButton() {\n            this.registerChildren( this.createButton({\n                title: this.sandbox.getLocal('btn_addWord'),\n                icon: this.createIcon('addWord'),\n                onClick: this.handleAddToDictionary\n            }), 'addToDictionaryButton');\n        }\n\n        buildWordsList() {\n            this.registerChildren(new ItemList(this.sandbox, {\n                role: 'grid',\n                itemRole: 'row',\n                ariaLabel: this.sandbox.getLocal('text_dictionaryWords'),\n                changeTabIndexOnFocus: true,\n                onFocusin: function() {}.bind(this),\n                onFocusout: function() {}.bind(this)\n            }), 'words-list');\n        }\n\n        buildWordsListItems(words) {\n            for (var i = 0; i < words.length; i++) {\n                this.createWordItem(words[i]);\n            }\n        }\n\n        clearWordsList() {\n            this.getChildren('words-list').removeAllItems();\n            this.udWordsItems = {};\n        }\n\n        createWordItem(word) {\n            var wordsList = this.getChildren('words-list'),\n                addWordInput = this.getChildren('addWordInput');\n\n            var wordItem = new WordItem(this.sandbox, {\n                text: word,\n                handleDeleteWord: () => {\n                    wordsList.handleNextKeyPress();\n                    this.sandbox.fire('deleteWordFromUserDictionary', { word });\n                    wordItem.disable();\n                    !wordsList.getChildren('item') && addWordInput.setFocus();\n                }\n            });\n\n            wordsList.addItem(wordItem);\n            this.udWordsItems[word] = wordItem;\n\n            if (!wordsList.getFocusableElements().length) {\n                this.activateFirstWord();\n            }\n        }\n\n        activateFirstWord() {\n            var wordsList = this.getChildren('words-list'),\n                words = wordsList.getChildren('item'),\n                word;\n\n            if (words) {\n                if (words.length) {\n                    word = words[0];\n                } else {\n                    word = words;\n                }\n            }\n\n            if (word) {\n                word.getChildren('word-item').getChildren('deleteWordButton').setTabIndex(0);\n            }\n        }\n\n        getUserDictionary() {\n            var self = this;\n\n            this.sandbox.fire('getUserDictionary', {\n                callback(response) {\n                    if (!response.error) {\n                        self.clearWordsList();\n                        self.buildWordsListItems(response.wordlist);\n                    }\n                }\n            });\n        }\n\n        handleUserDictionaryAction(data) {\n            var name = this.sandbox.getOption('userDictionaryName');\n\n            this.toggleDictionaryStates(name);\n            this.toggleWordsList(data);\n            this.handleAddWordState(data);\n            this.handleDeleteWord(data);\n        }\n\n        handleDeleteDictionary() {\n            var name = this.sandbox.getOption('userDictionaryName');\n\n            name && this.sandbox.fire('removeUserDictionary', { name: name });\n        }\n\n        handleRenameDictionary() {\n            var name = this.getChildren('dictionaryNameInput').getValue();\n\n            name && this.sandbox.fire('renameUserDictionary', { newName: name });\n        }\n\n        handleCreateDictionary() {\n            var name = this.getChildren('dictionaryNameInput').getValue();\n\n            name && this.sandbox.fire('createUserDictionary', { name: name });\n        }\n\n        handleConnectDictionary() {\n            var dictionaryNameInput = this.getChildren('dictionaryNameInput'),\n                name = dictionaryNameInput.getValue();\n\n            if (name) {\n                this.sandbox.fire('restoreUserDictionary', { name: name });\n            }\n\n            dictionaryNameInput.setFocus();\n        }\n\n        handleDisconnectDictionary() {\n            var dictionaryNameInput = this.getChildren('dictionaryNameInput'),\n                name = this.sandbox.getOption('userDictionaryName');\n\n            if (name) {\n                this.sandbox.fire('disconnectFromUserDictionary', { name: name });\n            }\n\n            dictionaryNameInput.setValue('');\n            dictionaryNameInput.setFocus();\n        }\n\n        handleWordInputKeydown(e) {\n            var keyCode = e.keyCode || e.which,\n                addWordInput = this.getChildren('addWordInput'),\n                addToDictionaryButton = this.getChildren('addToDictionaryButton');\n\n            if (keyCode === 13 && addWordInput.getValue() && !addToDictionaryButton.disabled) {\n                this.handleAddToDictionary();\n            }\n        }\n\n        handleAddToDictionary() {\n            var addWordInput = this.getChildren('addWordInput'),\n                word = addWordInput.getValue(),\n                addToDictionaryButton = this.getChildren('addToDictionaryButton'),\n                wordBoundaryRegex = this.sandbox.getRegExp('wordBoundaryRegexAndQuotes');\n\n            if (!word) {\n                return;\n            }\n\n            if (wordBoundaryRegex.test(word)) {\n                this.sandbox.fire('userDictionaryAction', {\n                    request: {},\n                    response: {},\n                    action: 'wordWithBannedSymbols',\n                    status: 'error',\n                    replaceText: word,\n                    messagePostfix: 'Dic'\n                });\n\n                return;\n            }\n\n            if (this.udWordsItems[word]) {\n                this.sandbox.fire('userDictionaryAction', {\n                    request: {},\n                    response: {},\n                    action: 'wordAlreadyAdded',\n                    status: 'success',\n                    replaceText: word,\n                    messagePostfix: 'Dic'\n                });\n\n                addWordInput.setValue('');\n\n                return;\n            }\n\n            addToDictionaryButton.disable();\n            this.sandbox.fire('addWordToUserDictionary', { word: word });\n        }\n\n        toggleDictionaryStates(dictionaryName) {\n            var deleteDictionaryButton = this.getChildren('deleteDictionaryButton'),\n                renameDictionaryButton = this.getChildren('renameDictionaryButton'),\n                createDictionaryButton = this.getChildren('createDictionaryButton'),\n                connectDictionaryButton = this.getChildren('connectDictionaryButton'),\n                disconnectDictionaryButton = this.getChildren('disconnectDictionaryButton'),\n                dictionaryNameInput = this.getChildren('dictionaryNameInput');\n\n            if (dictionaryName) {\n                deleteDictionaryButton.enable();\n                renameDictionaryButton.enable();\n                createDictionaryButton.disable();\n                connectDictionaryButton.hide();\n                disconnectDictionaryButton.show();\n                dictionaryNameInput.setValue(dictionaryName);\n            } else {\n                deleteDictionaryButton.disable();\n                renameDictionaryButton.disable();\n                createDictionaryButton.enable();\n                connectDictionaryButton.show();\n                disconnectDictionaryButton.hide();\n                dictionaryNameInput.setValue('');\n            }\n        }\n\n        toggleWordsList(data) {\n            if (!data.action || data.status === 'error') {\n                return;\n            }\n\n            switch (data.action) {\n                case 'restore':\n                    this.clearWordsList();\n                    this.buildWordsListItems(data.response.wordlist);\n                    break;\n                case 'disconnect':\n                    this.clearWordsList();\n                    break;\n                case 'remove':\n                    this.clearWordsList();\n                    break;\n            }\n        }\n\n        handleAddWordState(data) {\n            if (!data.action || data.action !== 'addWord') {\n                return;\n            }\n\n            var addWordInput = this.getChildren('addWordInput'),\n                addToDictionaryButton = this.getChildren('addToDictionaryButton');\n\n            if (data.status !== 'error') {\n                this.createWordItem( addWordInput.getValue() );\n                addWordInput.setValue('');\n            }\n\n            addToDictionaryButton.enable();\n        }\n\n        handleDeleteWord(data) {\n            if (!data.action || data.action !== 'deleteWord') {\n                return;\n            }\n\n            var wordItem = this.udWordsItems[data.request.word];\n            wordItem.enable();\n\n            if (data.status !== 'error') {\n                wordItem.remove();\n                delete this.udWordsItems[data.request.word];\n            }\n        }\n    }\n\n    exports.Dictionaries = Dictionaries;\n\n}(WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype));\n// description.js\n/**\n * @fileoverview of Description component.\n */\n\n/**\n * @namespace CORE.UI\n */\n\n(function (exports, modules) {\n    'use strict';\n\n    var UILib = modules.UILib,\n        Component = exports.Component,\n        Utils = modules.Utils;\n\n    /**\n     * Description class.\n     *\n     * @constructor\n     * @alias CORE.UI.Input\n     */\n    class Description extends Component {\n        constructor(sandbox, parameters) {\n            parameters = Object.assign({ name: 'description' }, parameters);\n            super(sandbox, parameters);\n            this.setTemplate('<div class=\"<%=prefix%>-problem-item__description\"><%=description%></div>');\n            this.addTemplateData({\n                description: parameters.problemDescription || ''\n            });\n            this.build(parameters);\n        }\n\n        build(parameters) {}\n    }\n\n    exports.Description = Description;\n\n}(WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype));\n// problemitem.js\n/**\n * @fileoverview of ProblemItem component.\n */\n\n/**\n * @namespace CORE.UI\n */\n\n(function (exports, modules) {\n    'use strict';\n\n    var UILib = modules.UILib,\n        Component = exports.Component,\n        Utils = modules.Utils,\n        Description = exports.Description,\n        ItemList = exports.ItemList,\n        Icon = exports.Icon,\n        Button = exports.Button;\n\n    /**\n     * ProblemItem class.\n     *\n     * @constructor\n     * @alias CORE.UI.Input\n     */\n    class ProblemItem extends Component {\n        constructor(sandbox, parameters) {\n            parameters = Object.assign({ name: 'problem-item' }, parameters);\n            super(sandbox, parameters);\n            this.text = parameters.text || '';\n            this.node = parameters.node || null;\n            this.nodesContainer = parameters.nodesContainer || null;\n            this.resetAllTabIndexesInSectionsContainer = parameters.resetAllTabIndexesInSectionsContainer || function() {};\n            this.showHideButton = parameters.showHideButton || null;\n            this.active = false;\n            this.more = false;\n            this.suggestionPreview = '';\n            this.activeNodeClass = sandbox.getOption('problem_text_active');\n            this.setTemplate('<div class=\"<%=prefix%>-problem-item\">    <div data-children=\"overlay\"></div>    <div class=\"<%=prefix%>-problem-item__top <%=prefix%>--clearfix\">        <div class=\"<%=prefix%>-problem-item__header\">            <div class=\"<%=prefix%>-problem-item__text\"><%=text%></div>            <div class=\"<%=prefix%>-problem-item__button <%=prefix%>-problem-item__icon--arrow <%=prefix%>-icon <%=prefix%>-icon-arrow\"></div>        </div>        <div class=\"<%=prefix%>-problem-item__suggestion-preview\"><%=suggestionPreview%></div>        <div data-children=\"suggestions\"></div>    </div>    <div data-children=\"description\"></div>    <div class=\"<%=prefix%>-problem-item__actions-wrapper\">        <div class=\"<%=prefix%>-problem-item__buttons\">            <div data-children=\"actions\"></div>        </div>    </div></div>');\n            this.addTemplateData({\n                text: parameters.info.text || ''\n            });\n            this.registerModificatorsTypes({\n                spelling: 'spelling',\n                grammar: 'grammar',\n                active: 'active',\n                more: 'more'\n            });\n            this.build(parameters);\n        }\n\n        build(parameters) {\n            var problemDescription = parameters.info.problemDescription,\n                suggestionsActions = parameters.actions.suggestions || [],\n                maxSuggestionsCount = Math.min(\n                    this.sandbox.getOption('suggestionsCount') + this.sandbox.getOption('moreSuggestionsCount'),\n                    suggestionsActions.length\n                ),\n                controlActions = parameters.actions.control || [];\n\n            this.buildOverlay(parameters);\n            this.buildSuggestions(suggestionsActions, maxSuggestionsCount);\n            this.buildControlActions(controlActions);\n            problemDescription && this.buildDescription(problemDescription);\n            if(maxSuggestionsCount > 1 || problemDescription) {\n                this.buildUpDown();\n            }\n        }\n\n        buildOverlay(parameters) {\n            this.registerChildren(new Button(this.sandbox, {\n                tabIndex: -1,\n                role: 'treeitem',\n                ariaLevel: 2,\n                ariaExpanded: false,\n                onClick: this.handleOverlayClick.bind(this),\n                onKeydown: this.handleOverlayKeyDown.bind(this)\n            }), 'overlay');\n        }\n\n        buildSuggestions(suggestionsActions, maxSuggestionsCount) {\n            this.registerChildren(new ItemList(this.sandbox, {\n                role: 'group',\n                itemRole: 'none'\n            }), 'suggestions');\n            for(var i = 0; i < maxSuggestionsCount; i += 1) {\n                this.createSuggestionsItem(suggestionsActions[i]);\n            }\n            if(maxSuggestionsCount === 0) {\n                this.createSuggestionsItem({ text: this.sandbox.getLocal('btn_noSuggestions'), onClick: ()=>{} });\n            }\n        }\n\n        buildControlActions(controlActions) {\n            this.registerChildren(new ItemList(this.sandbox, {\n                role: 'group',\n                itemRole: 'none'\n            }), 'actions');\n            controlActions.forEach(action => {\n                this.createActionsItem(action);\n            });\n        }\n\n        buildUpDown() {\n            var actionsContainer = this.getChildren('actions'),\n                item;\n\n            this.upDownIcon = this.createIcon('chevron');\n\n            item = actionsContainer.addItem({\n                title: this.sandbox.getLocal('btn_showMore'),\n                icon: this.upDownIcon,\n                tabIndex: -1,\n                onClick: this.handleUpDown.bind(this),\n                onKeydown: this.handleButtonsKeyDown.bind(this)\n            });\n\n            this.upDownButton = item.getChildren('content');\n        }\n\n        buildDescription(problemDescription) {\n            this.registerChildren(new Description(this.sandbox, {problemDescription}), 'description');\n        }\n\n        createIcon(iconName) {\n            var icon = new Icon(this.sandbox, {\n                iconName: iconName\n            });\n\n            return icon;\n        }\n\n        createActionsItem(item, parameters) {\n            var actionsContainer = this.getChildren('actions'),\n                parameters = parameters || {};\n\n            actionsContainer.addItem({\n                title: this.sandbox.getLocal( 'btn_' + item.getName() ),\n                icon: this.createIcon( item.getName() ),\n                tabIndex: -1,\n                role: 'treeitem',\n                ariaLevel: 3,\n                onClick: item.call,\n                onKeydown: this.handleButtonsKeyDown.bind(this)\n            });\n        }\n\n        createSuggestionsItem(item, parameters) {\n            var suggestionsContainer = this.getChildren('suggestions'),\n                listItem;\n\n            listItem = suggestionsContainer.addItem({\n                title: item.text,\n                text: item.text,\n                modificators: ['text'],\n                tabIndex: -1,\n                role: 'treeitem',\n                ariaLevel: 3,\n                onClick: item.call,\n                onKeydown: this.handleButtonsKeyDown.bind(this)\n            });\n            this.registerBemElements(listItem, 'suggestion');\n\n            if (!this.suggestionPreview) {\n                this.suggestionPreview = item.text;\n\n                this.addTemplateData({\n                    suggestionPreview: item.text\n                });\n            }\n        }\n\n        handleOverlayClick() {\n            this.addActive();\n        }\n\n        handleOverlayKeyDown(event) {\n            switch (event.keyCode) {\n                case 37:\n                    if (this.showHideButton) {\n                        this.resetAllTabIndexesInSectionsContainer();\n                        this.showHideButton.setTabIndex(0);\n                        this.showHideButton.setFocus();\n                    }\n                    event.preventDefault();\n                    break;\n                case 39:\n                    this.addActive();\n                    event.preventDefault();\n                    break;\n                default:\n                    break;\n            }\n        }\n\n        handleButtonsKeyDown(event) {\n            switch (event.keyCode) {\n                case 37:\n                    if (this.active) {\n                        var overlay = this.getChildren('overlay');\n\n                        this.removeActive();\n                        this.resetAllTabIndexesInSectionsContainer();\n                        overlay.setTabIndex(0);\n                        overlay.setFocus();\n                    }\n                    event.preventDefault();\n                    break;\n                default:\n                    break;\n            }\n        }\n\n        addActive() {\n            var overlay = this.getChildren('overlay');\n\n            this.active = true;\n            this.addModificator('active');\n            overlay.setAriaExpanded(true);\n            !this.more && this.handleUpDown();\n            this.addActiveNode();\n            this.scrollToNodeInContainer();\n        }\n\n        removeActive() {\n            var overlay = this.getChildren('overlay');\n\n            this.active = false;\n            this.removeModificator('active');\n            overlay.setAriaExpanded(false);\n            this.more && this.handleUpDown();\n            this.removeActiveNode();\n        }\n\n        addActiveNode() {\n            UILib.addClass(this.node, this.activeNodeClass);\n        }\n\n        removeActiveNode() {\n            UILib.removeClass(this.node, this.activeNodeClass);\n        }\n\n        handleUpDown() {\n            if(!this.upDownButton) { return; }\n            this.more = !this.more;\n\n            if (this.more) {\n                this.addModificator('more')\n                this.upDownIcon.addModificator('active');\n                this.upDownButton.setTitle( this.sandbox.getLocal('btn_showLess') );\n                this.upDownButton.setAriaLabel( this.sandbox.getLocal('btn_showLess') );\n            } else {\n                this.removeModificator('more');\n                this.upDownIcon.removeModificator('active');\n                this.upDownButton.setTitle( this.sandbox.getLocal('btn_showMore') );\n                this.upDownButton.setAriaLabel( this.sandbox.getLocal('btn_showMore') );\n            }\n\n            this.resetAllTabIndexesInSectionsContainer();\n            this.upDownButton.setTabIndex(0);\n        }\n\n        scrollToNodeInContainer() {\n            Utils.scrollToNodeInContainer(this.nodesContainer, this.node);\n        }\n    }\n\n    exports.ProblemItem = ProblemItem;\n\n}(WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype));\n// ContentContainer.js\n/**\n * @fileoverview of CORE ContentContainer.\n */\n\n/**\n * @namespace CORE.UI\n */\nWEBSPELLCHECKER.CORE.UI = WEBSPELLCHECKER.CORE.UI || {};\n\n(function (exports, modules) {\n    'use strict';\n\n    var UILib = modules.UILib,\n        Component = exports.Component,\n        Utils = modules.Utils;\n\n    exports = exports || {};\n\n\t/**\n\t * ContentContainer class.\n\t *\n\t * @constructor\n\t * @alias CORE.UI.ContentContainer\n\t */\n    class ContentContainer extends Component {\n        constructor(sandbox, parameters) {\n            parameters = Object.assign({ name: 'content-container' }, parameters);\n            super(sandbox, parameters);\n            this.setTemplate('<div class=\"<%=prefix%>-content-container\"></div>');\n            this.build(parameters);\n        }\n\n        build(parameters) { }\n    }\n\n    exports.ContentContainer = ContentContainer;\n\n}(WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype));\n// problemssection.js\n/**\n * @fileoverview of ProblemsSection component.\n */\n\n/**\n * @namespace CORE.UI\n */\n\n(function (exports, modules) {\n    'use strict';\n\n    var UILib = modules.UILib,\n        Component = exports.Component,\n        ItemList = exports.ItemList,\n        Utils = modules.Utils,\n        Icon = exports.Icon,\n        Button = exports.Button;\n\n    /**\n     * ProblemsSection class.\n     *\n     * @constructor\n     * @alias CORE.UI.ProblemsSection\n     */\n    class ProblemsSection extends Component {\n        constructor(sandbox, parameters) {\n            parameters = Object.assign({ name: 'problems-section' }, parameters);\n            super(sandbox, parameters);\n            this.header = parameters.header || '';\n            this.resetAllTabIndexesInSectionsContainer = parameters.resetAllTabIndexesInSectionsContainer || function() {};\n            this.setTemplate('<div class=\"<%=prefix%>-problems-section\">    <div class=\"<%=prefix%>-problems-section__header-wrapper\">        <div class=\"<%=prefix%>-problems-section__header\"><%=header%></div>        <div data-children=\"section-toggle-button\"></div>    </div>    <div data-children=\"items\"></div></div>');\n            this.addTemplateData({\n                header: this.header\n            });\n            this.registerModificatorsTypes({\n                active: 'active',\n                empty: 'empty'\n            });\n            this.addModificator('active');\n            this.addModificator('empty');\n            this.active = true;\n            this.build(parameters);\n        }\n\n        build(parameters) {\n            this.buildShowHideButton(parameters);\n            this.buildProblemsSectionItems(parameters);\n        }\n\n        buildShowHideButton(parameters) {\n            this.icon = this.createIcon('section-toggle');\n            this.icon.addModificator('active');\n            this.registerChildren(new Button(this.sandbox, {\n                title: this.sandbox.getLocal('btn_hideSection'),\n                icon: this.icon,\n                tabIndex: -1,\n                role: parameters.role || '',\n                ariaLevel: parameters.ariaLevel || '',\n                ariaExpanded: true,\n                onClick: this.handleShowHideSection.bind(this),\n                onKeydown: this.handleShowHideButtonKeyDown.bind(this)\n            }), 'section-toggle-button');\n        }\n\n        buildProblemsSectionItems(parameters) {\n            var problemsSectionItems = new ItemList(this.sandbox, {\n                role: 'group',\n                itemRole: 'none'\n            });\n\n            problemsSectionItems.registerLifeCycleHandler('after', 'hide', () => {\n                problemsSectionItems.removeAllItems();\n            });\n            this.registerChildren(problemsSectionItems, 'items');\n        }\n\n        getProblemItems() {\n            var problemsSectionItems = this.getChildren('items'),\n                items = ( problemsSectionItems && problemsSectionItems.getChildren('item') ) || [];\n\n            return Array.isArray(items) ? items : [items];\n        }\n\n        createIcon(iconName) {\n            var icon = new Icon(this.sandbox, {\n                iconName: iconName\n            });\n\n            return icon;\n        }\n\n        handleShowHideSection() {\n            var showHideButton = this.getChildren('section-toggle-button');\n\n            if (this.active) {\n                this.removeActive();\n                showHideButton.setTitle( this.sandbox.getLocal('btn_showSection') );\n                showHideButton.setAriaLabel( this.sandbox.getLocal('btn_showSection') );\n                showHideButton.setAriaExpanded(false);\n            } else {\n                this.addActive();\n                showHideButton.setTitle( this.sandbox.getLocal('btn_hideSection') );\n                showHideButton.setAriaLabel( this.sandbox.getLocal('btn_hideSection') );\n                showHideButton.setAriaExpanded(true);\n            }\n\n            this.resetAllTabIndexesInSectionsContainer();\n            showHideButton.setTabIndex(0);\n            this.active = !this.active;\n        }\n\n        handleShowHideButtonKeyDown(event) {\n            switch (event.keyCode) {\n                case 37:\n                    if (this.active) {\n                        this.handleShowHideSection();\n                    }\n\n                    event.preventDefault();\n                    break;\n                case 39:\n                    if (!this.active) {\n                        this.handleShowHideSection();\n                    }\n                    \n                    event.preventDefault();\n                    break;\n                default:\n                    break;\n            }\n        }\n\n        addActive() {\n            this.addModificator('active');\n            this.icon.addModificator('active');\n        }\n\n        removeActive() {\n            this.removeModificator('active');\n            this.icon.removeModificator('active');\n        }\n    }\n\n    exports.ProblemsSection = ProblemsSection;\n\n}(WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype));\n// problemscontainer.js\n/**\n * @fileoverview of CORE ProblemsContainer.\n */\n\n/**\n * @namespace CORE.UI\n */\nWEBSPELLCHECKER.CORE.UI = WEBSPELLCHECKER.CORE.UI || {};\n\n(function (exports, modules) {\n    'use strict';\n\n    var UILib = modules.UILib,\n        Component = exports.Component,\n        ItemList = exports.ItemList,\n        ProblemItem = exports.ProblemItem,\n        Utils = modules.Utils;\n\n    exports = exports || {};\n\n\t/**\n\t * ProblemsContainer class.\n\t *\n\t * @constructor\n\t * @alias CORE.UI.ProblemsContainer\n\t */\n    class ProblemsContainer extends Component {\n        constructor(sandbox, parameters) {\n            parameters = Object.assign({ name: 'problems-container' }, parameters);\n            super(sandbox, parameters);\n            this.setFocusToFirstElement = parameters.setFocusToFirstElement || function() {};\n            this.activeItem = null;\n            this.problemsSections = {};\n            this.setTemplate('<div class=\"<%=prefix%>-problems-container\">    <div data-children=\"sections\"></div></div>');\n            this.addTemplateData({\n                ariaLabel: parameters.ariaLabel || ''\n            });\n            this.registerLifeCycleHandler('after', 'hide', () => {\n                this.activeItem = null;\n            });\n            this.build(parameters);\n        }\n\n        build(parameters) {\n            this.sandbox.subscribe( 'spellCheckEnded', () => {\n                if ( this.isVisible() ) {\n                    this.activateFirstItem();\n                }\n            });\n            this.buildProblemsSectionsContainer(parameters);\n        }\n\n        activateFirstItem() {\n            var problemItems,\n                sectionsPriority = ['spelling', 'grammar'],\n                activated = false;\n\n            if (this.activeItem === null) {\n                for (var i = 0; i < sectionsPriority.length; i += 1) {\n                    problemItems = this.problemsSections[sectionsPriority[i]].getProblemItems();\n\n                    if (problemItems.length) {\n                        problemItems[0].getChildren('content').addActive();\n                        activated = true\n                        break;\n                    }\n                }\n\n                !activated && this.setFocusToFirstElement();\n            }\n        }\n\n        buildProblemsSectionsContainer(parameters) {\n            this.registerChildren(new ItemList(this.sandbox, {\n                role: 'tree',\n                itemRole: 'none',\n                ariaLabel: this.sandbox.getLocal('text_suggestionsContainer'),\n                changeTabIndexOnFocus: true,\n                onFocusin: function() {}.bind(this),\n                onFocusout: function() {}.bind(this)\n            }), 'sections');\n            this.buildProblemsSectionsItems(parameters);\n        }\n\n        buildProblemsSectionsItems(parameters) {\n            parameters.sections.forEach(section => {\n                this.createProblemsSection(section);\n            });\n        }\n\n        createProblemsSection(section) {\n            var sectionsContainer = this.getChildren('sections'),\n                component = section.component,\n                parameters = section.parameters || {},\n                problemsSection;\n\n            parameters.role = 'treeitem';\n            parameters.ariaLevel = 1;\n            parameters.resetAllTabIndexesInSectionsContainer = this.resetAllTabIndexesInSectionsContainer.bind(this);\n            problemsSection = new component(this.sandbox, parameters);\n            sectionsContainer.addItem(problemsSection);\n            this.problemsSections[parameters.type] = problemsSection;\n            this.registerBemElements(problemsSection, 'section');\n            problemsSection.registerLifeCycleHandler('before', 'show', () => {\n                problemsSection.addActive();\n                problemsSection.addModificator('empty');\n            });\n        }\n\n        createProblemItem(item) {\n            var problemsSection = this.problemsSections[item.type],\n                self = this,\n                problemsSectionItems;\n\n            if (!problemsSection) {\n                return;\n            }\n\n            problemsSectionItems = problemsSection.getChildren('items');\n\n            var problemItem = new ProblemItem(this.sandbox, {\n                    info: this.sandbox.getProblemInfo(item.node),\n                    actions: this.sandbox.getProblemActions(item.node),\n                    node: item.node,\n                    nodesContainer: item.nodesContainer,\n                    resetAllTabIndexesInSectionsContainer: this.resetAllTabIndexesInSectionsContainer.bind(this),\n                    showHideButton: problemsSection.getChildren('section-toggle-button')\n                }),\n                itemListItem;\n\n            if (typeof problemItem.addActive === 'function') {\n                var originalFunction = problemItem.addActive;\n\n                problemItem.addActive = function () {\n                    originalFunction.apply(problemItem, arguments);\n                    self.handleActiveItem(problemItem);\n                }\n            }\n            problemItem.registerLifeCycleHandler('before', 'remove', () => {\n                if (problemItem === this.activeItem) this.activeItem = null;\n            });\n            problemItem.addModificator(item.type);\n            itemListItem = problemsSectionItems.addItem(problemItem, item.index);\n            problemsSection.removeModificator('empty');\n\n            itemListItem.registerLifeCycleHandler('after', 'remove', () => {\n                setTimeout(() => {\n                    this.activateFirstItem();\n\n                    if (!problemsSectionItems.getLength()) {\n                        problemsSection.addModificator('empty');\n                    }\n                }, 0);\n            });\n\n            return problemItem;\n        }\n\n        handleActiveItem(item) {\n            var suggestions = item.getChildren('suggestions').getChildren('item'),\n                suggestion = suggestions.length ? suggestions[0] : suggestions,\n                button = suggestion.getChildren('content');\n\n            if (this.activeItem && this.activeItem !== item) {\n                this.activeItem.removeActive();\n            }\n\n            this.resetAllTabIndexesInSectionsContainer();\n            this.activeItem = item;\n            button.setTabIndex(0);\n            button.setFocus();\n        }\n\n        resetAllTabIndexesInSectionsContainer() {\n            this.getChildren('sections').resetAllTabIndexes();\n        }\n    }\n\n    exports.ProblemsContainer = ProblemsContainer;\n\n}(WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype));\n// ProofreadDialog.js\n/**\n * @fileoverview of CORE ProofreadDialog.\n */\n\n/**\n * @namespace CORE.UI\n */\nWEBSPELLCHECKER.CORE.UI = WEBSPELLCHECKER.CORE.UI || {};\n\n(function( exports, modules ) {\n\t'use strict';\n\n\tvar UILib = modules.UILib,\n\t\tComponent = exports.Component,\n\t\tContentContainer = exports.ContentContainer,\n\t\tProblemsContainer = exports.ProblemsContainer,\n\t\tProblemsSection = exports.ProblemsSection,\n\t\tButton = exports.Button,\n\t\tIcon = exports.Icon,\n\t\tUtils = modules.Utils;\n\n\texports = exports || {};\n\n\t/**\n\t * ProofreadDialog class.\n\t *\n\t * @constructor\n\t * @alias CORE.UI.ProofreadDialog\n\t */\n\tclass ProofreadDialog extends Component {\n\t\tconstructor(sandbox, parameters) {\n\t\t\tparameters = Object.assign({name: 'proofreaddialog'}, parameters);\n\t\t\tsuper(sandbox, parameters);\n\t\t\tthis.setTemplate('<div class=\"<%=prefix%>-proofreaddialog\">    <div data-children=\"content-container\"></div>    <div data-children=\"problems-container\"></div>    <div data-children=\"finish-checking-button\"></div></div>');\n\t\t\tthis.icon = new Icon(sandbox, {iconName: this.name});\n\t\t\tthis.problemItems = [];\n\t\t\tthis.build(parameters);\n\n\t\t\tthis.sandbox.subscribe('markupedNode', function (data) {\n\t\t\t\tif ( !this.sandbox.getOption('isProofreadInDialogActive') ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.handleMarkupedNode(data);\n\t\t\t}, this);\n\n\t\t\tthis.sandbox.subscribe('removedMarkupInContainer', function (data) {\n\t\t\t\tdata && data.removedNodes && this.handleRemovedMarkupInContainer(data);\n\t\t\t}, this);\n\t\t}\n\n\t\tbuild(parameters) {\n\t\t\tthis.registerLifeCycleHandler('after', 'show', () => {\n\t\t\t\tthis.sandbox.fire('startProofreadInDialog', {});\n\t\t\t});\n\t\t\tthis.registerLifeCycleHandler('before', 'hide', () => {\n\t\t\t\tthis.sandbox.fire('finishProofreadInDialog', {});\n\t\t\t\twhile(this.problemItems.length) this.problemItems[0].problemItem.remove();\n\t\t\t});\n\t\t\tthis.buildContentContainer(parameters);\n\t\t\tthis.buildProblemsContainer(parameters);\n\t\t\tthis.buildFinishCheckingButton(parameters);\n\t\t}\n\n\t\tbuildContentContainer(parameters) {\n\t\t\tvar contentContainer = new ContentContainer(this.sandbox, {}),\n\t\t\t\tself = this;\n\n\t\t\tcontentContainer.registerLifeCycleHandler('after', 'render', () => {\n\t\t\t\tself.sandbox.fire('setProofreadInDialogContainer', { container: contentContainer.getDOMElement() });\n\t\t\t});\n\t\t\tcontentContainer.registerLifeCycleHandler('after', 'hide', () => {\n\t\t\t\tcontentContainer.getDOMElement().innerHTML = '';\n\t\t\t});\n\t\t\tthis.registerChildren(contentContainer, 'content-container');\n\t\t}\n\n\t\tbuildProblemsContainer(parameters) {\n\t\t\tvar problemsSections = [\n\t\t\t\t\t{\n\t\t\t\t\t\tcomponent: ProblemsSection,\n\t\t\t\t\t\tparameters: {\n\t\t\t\t\t\t\theader: this.sandbox.getLocal('text_spellingSectionHeader'),\n\t\t\t\t\t\t\ttype: 'spelling'\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tcomponent: ProblemsSection,\n\t\t\t\t\t\tparameters: {\n\t\t\t\t\t\t\theader: this.sandbox.getLocal('text_grammarSectionHeader'),\n\t\t\t\t\t\t\ttype: 'grammar'\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tproblemsContainer = new ProblemsContainer(this.sandbox, {\n\t\t\t\t\tsections: problemsSections,\n\t\t\t\t\tsetFocusToFirstElement: parameters.setFocusToFirstElement\n\t\t\t\t});\n\n\t\t\tthis.registerChildren(problemsContainer, 'problems-container');\n\t\t}\n\n\t\tbuildFinishCheckingButton(parameters) {\n\t\t\tvar finishCheckingButton = new Button(this.sandbox, {\n\t\t\t\ttitle: this.sandbox.getLocal('btn_finishChecking'),\n\t\t\t\ticon: this.createIcon('tick'),\n\t\t\t\tonClick: function() {\n\t\t\t\t\tthis.handleFinishChecking();\n\t\t\t\t\tparameters.closeDialogHandler();\n\t\t\t\t}.bind(this)\n\t\t\t});\n\n\t\t\tthis.registerChildren(finishCheckingButton, 'finish-checking-button');\n\t\t}\n\n\t\tcreateIcon(iconName) {\n\t\t\tvar icon = new Icon(this.sandbox, {\n\t\t\t\ticonName: iconName\n\t\t\t});\n\t\t\tthis.registerBemElements(icon);\n\n\t\t\treturn icon;\n\t\t}\n\n\t\thandleMarkupedNode(data) {\n\t\t\tvar self = this,\n\t\t\t\tproblemsContainer,\n\t\t\t\tcontentContainer,\n\t\t\t\tproblemItem;\n\n\t\t\tif ( !this.sandbox.getOption('isProofreadInDialogActive') ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tproblemsContainer = this.getChildren('problems-container');\n\t\t\tcontentContainer = this.getChildren('content-container');\n\t\t\tdata.nodesContainer = contentContainer.getDOMElement();\n\t\t\tproblemItem = problemsContainer.createProblemItem(data);\n\t\t\tproblemItem.registerLifeCycleHandler('before', 'remove', () => {\n\t\t\t\tvar index;\n\n\t\t\t\tthis.problemItems.forEach((item, i) => {\n\t\t\t\t\tif(typeof index !== 'undefined') return;\n\t\t\t\t\tindex = (item.problemItem === problemItem) ? i : undefined;\n\t\t\t\t})\n\t\t\t\tthis.problemItems.splice(index, 1);\n\t\t\t\tself.unbindNodeClick(data.node);\n\t\t\t});\n\t\t\tthis.bindNodeClick(data.node, problemItem, problemsContainer);\n\t\t\tthis.problemItems.push({\n\t\t\t\tnode: data.node,\n\t\t\t\tproblemItem: problemItem\n\t\t\t});\n\t\t}\n\n\t\thandleRemovedMarkupInContainer(data) {\n\t\t\tif (!this.sandbox.getOption('isProofreadInDialogActive')) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\twhile (data.removedNodes.length > 0) {\n\t\t\t\tvar problemNode = data.removedNodes.shift();\n\n\t\t\t\tfor (var i = 0; i < this.problemItems.length; i++) {\n\t\t\t\t\tvar item = this.problemItems[i];\n\n\t\t\t\t\tif (item.node === problemNode) {\n\t\t\t\t\t\titem.problemItem.remove();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\thandleFinishChecking(data) {\n\t\t\tthis.sandbox.fire('finishCheckingInDialog', {});\n\t\t}\n\n\t\tbindNodeClick(node, problemItem, scrollContainer) {\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'click',\n\t\t\t\telement: node,\n\t\t\t\thandler: function (event) {\n\t\t\t\t\tproblemItem.addActive();\n\t\t\t\t\tUtils.scrollToNodeInContainer( scrollContainer.getDOMElement(), problemItem.getDOMElement() );\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tunbindNodeClick(node) {\n\t\t\tthis.sandbox.unsubscribe({\n\t\t\t\teventType: 'click',\n\t\t\t\telement: node\n\t\t\t});\n\t\t}\n\t}\n\n\texports.ProofreadDialog = ProofreadDialog;\n\n}( WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype ));\n// Banner.js\r\n/**\r\n * @fileoverview of CORE Banner.\r\n */\r\n\r\n/**\r\n * @namespace CORE.UI\r\n */\r\nWEBSPELLCHECKER.CORE.UI = WEBSPELLCHECKER.CORE.UI || {};\r\n\r\n(function( exports, modules ) {\r\n\t'use strict';\r\n\r\n\tvar UILib = modules.UILib,\r\n\t\tComponent = exports.Component,\r\n\t\tIcon = exports.Icon,\r\n\t\tUtils = modules.Utils;\r\n\r\n\texports = exports || {};\r\n\r\n\t/**\r\n\t * Banner abstract class.\r\n\t *\r\n\t * @constructor\r\n\t * @alias CORE.UI.Banner\r\n\t */\r\n\tclass Banner extends Component {\r\n\t\tconstructor(sandbox, parameters) {\r\n\t\t\tparameters = Object.assign({name: 'banner'}, parameters);\r\n\t\t\tsuper(sandbox, parameters);\r\n\t\t\tthis.setTemplate('<div class=\"<%=prefix%>-banner\">\t<span class=\"<%=prefix%>-banner__text\"><%=text%></span>\t<a target=\"_blank\" class=\"<%=prefix%>-banner__link\" href=\"<%=linkHref%>\"><%=linkText%></a></div>');\r\n\t\t\tthis.addTemplateData( this.sandbox.getOption('bannerInfo') );\r\n\t\t\tthis.build()\r\n\t\t}\r\n\r\n\t\tbuild() {\r\n\t\t\tthis.registerChildren( new Icon(this.sandbox, { iconName: 'exclamatory' }) )\r\n\t\t}\r\n\t}\r\n\r\n\texports.Banner = Banner;\r\n\r\n}( WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype ));\n// Settings.js\r\n/**\r\n * @fileoverview of CORE Settings.\r\n */\r\n\r\n/**\r\n * @namespace CORE.UI\r\n */\r\nWEBSPELLCHECKER.CORE.UI = WEBSPELLCHECKER.CORE.UI || {};\r\n\r\n(function( exports, modules ) {\r\n\t'use strict';\r\n\r\n\tvar UILib = modules.UILib,\r\n\t\tComponent = exports.Component,\r\n\t\tTabs = exports.Tabs,\r\n\t\tUtils = modules.Utils;\r\n\r\n\texports = exports || {};\r\n\r\n\t/**\r\n\t * Settings abstract class.\r\n\t *\r\n\t * @constructor\r\n\t * @alias CORE.UI.Settings\r\n\t */\r\n\tclass Settings extends Component {\r\n\t\tconstructor(sandbox, parameters) {\r\n\t\t\tparameters = Object.assign({name: 'settings'}, parameters);\r\n\t\t\tsuper(sandbox, parameters);\r\n\t\t\tthis.setTemplate('<div class=\"<%=prefix%>-settings\">\t<div data-children=\"tabs\"></div></div>');\r\n\t\t\tthis.settingComponents = [];\r\n\t\t\tthis.build();\r\n\t\t}\r\n\t\tbuild() {\r\n\t\t\tvar tabsNav;\r\n\r\n\t\t\tthis.tabs = new Tabs(this.sandbox, {\r\n\t\t\t\trole: 'tablist',\r\n\t\t\t\tariaLabel: this.sandbox.getLocal('btn_settings')\r\n\t\t\t});\r\n\t\t\tthis.registerChildren(this.tabs);\r\n\t\t\tthis.registerBemElements( this.tabs.getChildren('nav') );\r\n\t\t\tthis.registerLifeCycleHandler('before', 'hide', () => {\r\n\t\t\t\tvar options = this.getOptions();\r\n\t\t\t\tthis.sandbox.fire('commitOptions', {changedOptions: options});\r\n\t\t\t});\r\n\t\t\tthis.sandbox.subscribe( 'commitOptions', () => this.defineValues() );\r\n\t\t\tthis.registerLifeCycleHandler( 'before', 'show', () => this.defineValues() );\r\n\t\t\tthis.registerLifeCycleHandler('after', 'remove', () => { this.settingComponents = []; });\r\n\t\t}\r\n\t\tregisterSettingsElements(element) {\r\n\t\t\tthis.settingComponents.push(element);\r\n\t\t\t/** Form list items has same css styles */\r\n\t\t\tvar form = element.getChildren('form'),\r\n\t\t\t\tlists = form && form.getChildren('list'),\r\n\t\t\t\titems = lists && lists.getChildren('item');\r\n\r\n\t\t\tif(items) {\r\n\t\t\t\tthis.registerBemElements(items);\r\n\t\t\t}\r\n\t\t}\r\n\t\tcreateSetting(settingComponent) {\r\n\t\t\tvar settingComponent = new settingComponent(this.sandbox);\r\n\t\t\tthis.registerSettingsElements(settingComponent);\r\n\t\t\tthis.tabs.createTab(settingComponent);\r\n\t\t}\r\n\t\tdefineValues() {\r\n\t\t\tthis.settingComponents.forEach( settingComponent => settingComponent.defineValues && settingComponent.defineValues() );\r\n\t\t}\r\n\t\tgetOptions() {\r\n\t\t\tvar options = {};\r\n\t\t\tthis.settingComponents.forEach(settingComponent => {\r\n\t\t\t\tvar settingValue = settingComponent.getValue && settingComponent.getValue();\r\n\r\n\t\t\t\tif(settingValue) {\r\n\t\t\t\t\tObject.assign(options, settingValue);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn options;\r\n\t\t}\r\n\t}\r\n\r\n\texports.Settings = Settings;\r\n\r\n}( WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype ));\n// tab.js\r\n/**\r\n * @fileoverview of CORE tab.\r\n */\r\n\r\n(function( exports, modules ) {\r\n\t'use strict';\r\n\r\n\tvar Utils = modules.Utils,\r\n\t\tComponent = exports.Component,\r\n\t\tIcon = exports.Icon,\r\n\t\tItemList = exports.ItemList,\r\n\t\tUILib = modules.UILib,\r\n\t\tUIMetrics;\r\n\r\n\texports = exports || {};\r\n\r\n\t/**\r\n\t * Tab class.\r\n\t *\r\n\t * @constructor\r\n\t * @alias CORE.UI.ContextMenu\r\n\t */\r\n\tclass ContextMenu extends Component {\r\n\t\tconstructor(sandbox, parameters) {\r\n\t\t\tparameters = Object.assign({name: 'contextmenu'}, parameters);\r\n\t\t\tsuper(sandbox, parameters);\r\n\t\t\tUIMetrics = this.sandbox.UIMetrics;\r\n\t\t\tthis.setTemplate('<div class=\"<%=prefix%>-contextmenu\">\t<div data-children=\"list\"></div></div>');\r\n\t\t\tthis.problemItems = [];\r\n\t\t\tthis.problemNode = null;\r\n\t\t\tthis.activeNodeClass = sandbox.getOption('problem_text_active');\r\n\t\t\tthis.delay = 500;\r\n\t\t\tthis.generalEvents = [];\r\n\t\t\tthis.build();\r\n\t\t}\r\n\r\n\t\tbuild(parameters) {\r\n\t\t\tthis.list = new ItemList(this.sandbox, {\r\n\t\t\t\trole: 'menu',\r\n\t\t\t\titemRole: 'none',\r\n\t\t\t\tariaLabel: this.sandbox.getLocal('text_correctionBox')\r\n\t\t\t});\r\n\t\t\tthis.registerChildren(this.list);\r\n\t\t\tthis.registerLifeCycleHandler('after', 'hide', () => {\r\n\t\t\t\tthis.deactiveteNode();\r\n\t\t\t\tthis.problemNode = null;\r\n\t\t\t\tthis.clearProblemItems();\r\n\t\t\t});\r\n\t\t\tthis.registerLifeCycleHandler('after', 'show', () => {\r\n\t\t\t\tthis.activeteNode();\r\n\t\t\t});\r\n\t\t\tthis.registerLifeCycleHandler('after', 'render', () => {\r\n\t\t\t\tthis.defineBehavior();\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tshowAtPosition({problemNode}) {\r\n\t\t\tthis.problemNode = problemNode;\r\n\t\t\tthis.buildProblemItems(this.problemNode);\r\n\t\t\tthis.setPosition( this.definePosition(this.problemNode) );\r\n\t\t\tthis.show();\r\n\t\t}\r\n\r\n\t\tgetProblemNode() {\r\n\t\t\treturn this.problemNode;\r\n\t\t}\r\n\r\n\t\tcreateItems(actions) {\r\n\t\t\tvar res = []\r\n\r\n\t\t\tactions.forEach((action, i) => {\r\n\t\t\t\tres[res.length] = this.createItem({\r\n\t\t\t\t\ttitle: action.getName(),\r\n\t\t\t\t\thandler: action.call,\r\n\t\t\t\t\tposition: i\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t\tthis.createSection(res);\r\n\r\n\t\t\treturn res;\r\n\t\t}\r\n\r\n\t\tcreateItem({title, text, handler, icon, position, modificator}) {\r\n\t\t\tvar item, button;\r\n\r\n\t\t\tif(icon !== null) {\r\n\t\t\t\ticon = (icon instanceof Component) ? icon : new Icon(this.sandbox, {iconName: icon || title})\r\n\t\t\t}\r\n\t\t\ttitle = this.sandbox.getLocal('btn_' + title);\r\n\t\t\ttitle = this.sandbox.RegularsManager.wrap('btn_').start().replace(title, '' );\r\n\t\t\ttext = (typeof text === 'undefined') ? title : text,\r\n\t\t\titem = this.list.addItem({ title, text, icon, tabIndex: -1, role: 'menuitem', onClick: (e) => { !handler(e) && this.hide(); } }, position);\r\n\t\t\t// Button shouldn't have the focus on click because in case with iframe we lose focus and can't restore sel.\r\n\t\t\titem.attachEvents([{\r\n\t\t\t\teventType: 'mousedown',\r\n\t\t\t\thandler: e => e.preventDefault()\r\n\t\t\t}]);\r\n\t\t\tthis.registerBemElements(item);\r\n\t\t\tbutton = item.getChildren('content');\r\n\t\t\tthis.registerBemElements(button, 'button');\r\n\t\t\tmodificator && button.addCustomModificator(modificator, this.name);\r\n\t\t\ticon && this.registerBemElements(icon);\r\n\r\n\t\t\treturn item\r\n\t\t}\r\n\r\n\t\tcreateSection(items) {\r\n\t\t\tif(!items.length) return;\r\n\t\t\titems[0].addCustomModificator('firstInSection', this.name);\r\n\t\t\titems[items.length - 1].addCustomModificator('lastInSection', this.name);\r\n\r\n\t\t\treturn items;\r\n\t\t}\r\n\r\n\t\tbuildStaticItems() {\r\n\t\t\tthis.createItems( this.sandbox.getStaticActions() );\r\n\t\t}\r\n\r\n\t\tbuildProblemItems(problemNode) {\r\n\t\t\tvar problemInfo = this.sandbox.getProblemInfo(problemNode),\r\n\t\t\t\tactions = this.sandbox.getProblemActions(problemNode);\r\n\r\n\t\t\tthis.clearProblemItems();\r\n\t\t\tthis.problemItems = this.problemItems.concat(\r\n\t\t\t\tthis.createItems(actions.control),\r\n\t\t\t\tthis.createSection( actions.suggestions.length ?  this.buildSuggestions(actions.suggestions) : [this.buildNoSuggestions()] ),\r\n\t\t\t\tproblemInfo.problemDescription ?\r\n\t\t\t\tthis.createSection([ this.buildDescriptionItem(problemInfo.problemDescription) ]) : []\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tclearProblemItems() {\r\n\t\t\tthis.problemItems.forEach( item => item.remove() );\r\n\t\t\tthis.problemItems = [];\r\n\t\t}\r\n\r\n\t\tbuildSuggestions(suggestionsActions) {\r\n\t\t\tvar suggestionsCount = this.sandbox.getOption('suggestionsCount'),\r\n\t\t\t\tmoreSuggestionsCount = this.sandbox.getOption('moreSuggestionsCount'),\r\n\t\t\t\tfullSuggestionsCount = Math.min(suggestionsCount + moreSuggestionsCount, suggestionsActions.length),\r\n\t\t\t\tmoreSuggestionsItems = [],\r\n\t\t\t\titems = [],\r\n\t\t\t\titem, suggestionsAction;\r\n\r\n\t\t\tfor(var i = 0; i < fullSuggestionsCount; i += 1) {\r\n\t\t\t\tsuggestionsAction = suggestionsActions[i];\r\n\t\t\t\titem = this.createItem({\r\n\t\t\t\t\ttitle: suggestionsAction.text,\r\n\t\t\t\t\ttext: suggestionsAction.text,\r\n\t\t\t\t\thandler: suggestionsAction.call,\r\n\t\t\t\t\tposition: i,\r\n\t\t\t\t\ticon: 'suggestion',\r\n\t\t\t\t\tmodificator: 'suggestion',\r\n\t\t\t\t});\r\n\t\t\t\titems.push(item);\r\n\t\t\t\tif(i >= suggestionsCount) {\r\n\t\t\t\t\tmoreSuggestionsItems.push(item);\r\n\t\t\t\t\titem.hide();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(moreSuggestionsCount > 0 && suggestionsActions.length > suggestionsCount) {\r\n\t\t\t\titems.push( this.buildMoreSuggestionItem({\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\tmoreSuggestionsItems.forEach((item) => { item.isVisible() ? item.hide() : item.show(); });\r\n\t\t\t\t\t},\r\n\t\t\t\t\tposition: fullSuggestionsCount\r\n\t\t\t\t}) );\r\n\t\t\t}\r\n\r\n\t\t\treturn items;\r\n\t\t}\r\n\r\n\t\tbuildMoreSuggestionItem({handler, position}) {\r\n\t\t\tvar icon = new Icon(this.sandbox, {iconName: 'chevron'}),\r\n\t\t\t\tmoreSuggestionsItem = this.createItem({\r\n\t\t\t\t\ttitle: 'showMore',\r\n\t\t\t\t\ttext: '',\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\thandler();\r\n\t\t\t\t\t\tif(!moreSuggestionsItem.open) {\r\n\t\t\t\t\t\t\ticon.addModificator('active');\r\n\t\t\t\t\t\t\tmoreSuggestionsItem.open = true;\r\n\t\t\t\t\t\t\tmoreSuggestionsItem.getChildren('content').setTitle( this.sandbox.getLocal('btn_showLess') );\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ticon.removeModificator('active');\r\n\t\t\t\t\t\t\tmoreSuggestionsItem.open = false;\r\n\t\t\t\t\t\t\tmoreSuggestionsItem.getChildren('content').setTitle( this.sandbox.getLocal('btn_showMore') );\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t},\r\n\t\t\t\t\tmodificator: 'moreSuggestions',\r\n\t\t\t\t\ticon, position\r\n\t\t\t\t});\r\n\r\n\t\t\tmoreSuggestionsItem.open = false;\r\n\r\n\t\t\treturn moreSuggestionsItem;\r\n\t\t}\r\n\r\n\t\tbuildNoSuggestions() {\r\n\t\t\treturn this.createItem({\r\n\t\t\t\ttitle: 'noSuggestions',\r\n\t\t\t\thandler: () => true,\r\n\t\t\t\tposition: 0\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tbuildDescriptionItem(problemDescription) {\r\n\t\t\treturn this.createItem({\r\n\t\t\t\ttitle: 'description',\r\n\t\t\t\ttext: problemDescription,\r\n\t\t\t\thandler: () => true,\r\n\t\t\t\tposition: 0,\r\n\t\t\t\tmodificator: 'description'\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tdefineBehavior() {\r\n\t\t\tvar mouseoverTimer,\r\n\t\t\t\tcontainer = this.sandbox.getOption('mirrorBasedInstance') || this.sandbox.getOption('isModelEditor') ? this.sandbox.getOption('originalContainer') : this.sandbox.getOption('container'),\r\n\t\t\t\tcursorCases = {\r\n\t\t\t\t\tproblem: {\r\n\t\t\t\t\t\tcomponentOpen: (problemNode) => {\r\n\t\t\t\t\t\t\tclearTimer();\r\n\t\t\t\t\t\t\tif(problemNode === this.getProblemNode() ) return;\r\n\t\t\t\t\t\t\tthis.deactiveteNode();\r\n\t\t\t\t\t\t\tthis.activeteNode(problemNode);\r\n\t\t\t\t\t\t\tthis.showAtPosition({problemNode});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tcomponentClose: (problemNode) => {\r\n\t\t\t\t\t\t\tthis.activeteNode(problemNode);\r\n\t\t\t\t\t\t\tif(!mouseoverTimer) {\r\n\t\t\t\t\t\t\t\treturn () => this.showAtPosition({problemNode});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnoProblem: {\r\n\t\t\t\t\t\tcomponentOpen: () => {\r\n\t\t\t\t\t\t\tif(!mouseoverTimer) {\r\n\t\t\t\t\t\t\t\treturn () => this.hide();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tcomponentClose: () => {\r\n\t\t\t\t\t\t\tthis.deactiveteNode();\r\n\t\t\t\t\t\t\tclearTimer();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tclearTimer = () => {\r\n\t\t\t\t\tclearTimeout(mouseoverTimer);\r\n\t\t\t\t\tmouseoverTimer = undefined;\r\n\t\t\t\t},\r\n\t\t\t\tclearAndHide = () => {\r\n\t\t\t\t\tclearTimer();\r\n\t\t\t\t\tthis.hide();\r\n\t\t\t\t},\r\n\t\t\t\tcursorAnalysis = e => {\r\n\t\t\t\t\tvar problemNode = this.sandbox.getProblemNodeFromMouseEvent(e),\r\n\t\t\t\t\t\topenState = this.isVisible() ? 'componentOpen' : 'componentClose',\r\n\t\t\t\t\t\tproblemState = problemNode && this.sandbox.getOption('container').contains(problemNode) ? 'problem' : 'noProblem',\r\n\t\t\t\t\t\tdelayFunction;\r\n\r\n\t\t\t\t\tdelayFunction = cursorCases[problemState][openState](problemNode);\r\n\t\t\t\t\tif(delayFunction) { mouseoverTimer = setTimeout( () => { delayFunction(); clearTimer(); }, this.delay) };\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\tthis.attachEvents([\r\n\t\t\t\t{ eventType: 'mouseleave', handler: cursorAnalysis },\r\n\t\t\t\t{ eventType: 'mouseenter', handler: clearTimer }\r\n\t\t\t]);\r\n\t\t\tthis.attachGeneralEvents([\r\n\t\t\t\t{\r\n\t\t\t\t\teventType: 'mousemove',\r\n\t\t\t\t\telement: container,\r\n\t\t\t\t\thandler: cursorAnalysis\r\n\t\t\t\t},{\r\n\t\t\t\t\teventType: 'mouseleave',\r\n\t\t\t\t\telement: container,\r\n\t\t\t\t\thandler: (e) => {\r\n\t\t\t\t\t\tvar relatedTarget = e.relatedTarget;\r\n\r\n\t\t\t\t\t\twhile (relatedTarget) {\r\n\t\t\t\t\t\t\tif (this.getDOMElement() === relatedTarget) return\r\n\t\t\t\t\t\t\trelatedTarget = relatedTarget.parentNode;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcursorAnalysis(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t},{\r\n\t\t\t\t\teventType: 'keydown',\r\n\t\t\t\t\telement: this.sandbox.getOption('currentDocument'),\r\n\t\t\t\t\thandler: clearAndHide\r\n\t\t\t\t}\r\n\t\t\t]);\r\n\t\t\tthis.attachGeneralEvents({\r\n\t\t\t\teventType: this.sandbox.getOption('isTouchDevice') ? 'orientationchange' : 'resize',\r\n\t\t\t\telement: window,\r\n\t\t\t\thandler: clearAndHide\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tattachGeneralEvents(eventsData) {\r\n\t\t\teventsData = Array.isArray(eventsData) ? eventsData : [eventsData];\r\n\t\t\teventsData.forEach(eventData => {\r\n\t\t\t\tthis.sandbox.subscribe(eventData);\r\n\t\t\t\tthis.generalEvents.push(eventData);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tdetachGeneralEvents() {\r\n\t\t\tthis.generalEvents.forEach(e => this.sandbox.unsubscribe(e));\r\n\t\t\tthis.generalEvents = [];\r\n\t\t}\r\n\r\n\t\tactiveteNode(problemNode) {\r\n\t\t\tif(this.activatedNode) return;\r\n\t\t\tthis.activatedNode = problemNode;\r\n\t\t\tUILib.addClass(problemNode || this.problemNode, this.activeNodeClass);\r\n\t\t}\r\n\r\n\t\tdeactiveteNode(problemNode) {\r\n\t\t\tif(!this.activatedNode) return;\r\n\t\t\tUILib.removeClass(problemNode ||this.activatedNode, this.activeNodeClass);\r\n\t\t\tthis.activatedNode = null;\r\n\t\t}\r\n\r\n\t\tdefinePosition(problemNode) {\r\n\t\t\tvar rect = problemNode.getBoundingClientRect(),\r\n\t\t\t\tcontextmenuSize = this.getSize(),\r\n\t\t\t\twindowSize = UIMetrics.getWindowSize(),\r\n\t\t\t\tscrollInfo = UIMetrics.getScrollInfo(),\r\n\t\t\t\tdocumentHeight = UIMetrics.getDocumentHeight(),\r\n\t\t\t\tisIframe = this.sandbox.getOption('isIframe'),\r\n\t\t\t\tiframe = isIframe ? this.sandbox.getOption('documentContainer') : null,\r\n\t\t\t\tiframeComputed = isIframe ? Utils.getComputedStyle(iframe) : null,\r\n\t\t\t\trightSide = false;\r\n\r\n\t\t\tvar position = Utils.reduceCoordinates([\r\n\t\t\t\t\t{top: 0, left: 0},\r\n\t\t\t\t\tscrollInfo,\r\n\t\t\t\t\tthis.sandbox.getOption('isTouchDevice') ? this.getOffset(problemNode) : rect,\r\n\t\t\t\t\tisIframe ? iframe.getBoundingClientRect() : null,\r\n\t\t\t\t\tisIframe ? { top: iframeComputed['borderTop'], left: iframeComputed['borderLeft']} : null,\r\n\t\t\t\t\tisIframe ? { top: iframeComputed['paddingTop'], left: iframeComputed['paddingLeft']} : null\r\n\t\t\t\t])\r\n\r\n\t\t\t// Check right side\r\n\t\t\tif (position.left + contextmenuSize.width > windowSize.width + scrollInfo.left) {\r\n\t\t\t\trightSide = true;\r\n\t\t\t\tposition.left = position.left - contextmenuSize.width + rect.width;\r\n\r\n\t\t\t\t// Make sure that we fit viewport from left side\r\n\t\t\t\tif (position.left < scrollInfo.left) {\r\n\t\t\t\t\tposition.left = scrollInfo.left;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Check bottom side\r\n\t\t\tif (position.top + contextmenuSize.height + rect.height > windowSize.height + scrollInfo.top) {\r\n\t\t\t\tposition.top = position.top - contextmenuSize.height;\r\n\r\n\t\t\t\t// Make sure that we fit viewport from top side\r\n\t\t\t\tif (position.top < scrollInfo.top) {\r\n\t\t\t\t\tif ( scrollInfo.top + contextmenuSize.height <= documentHeight ) { // We have enough scroll space from bottom side\r\n\t\t\t\t\t\tposition.top = scrollInfo.top;\r\n\t\t\t\t\t} else { // We haven't\r\n\t\t\t\t\t\tposition.top = documentHeight - contextmenuSize.height;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t// In case with the small screens, or resized screens to a small area,\r\n\t\t\t\t\t// we need additionally to change the left position in order not to overlap\r\n\t\t\t\t\t// a problem node\r\n\t\t\t\t\tif (rightSide) {\r\n\t\t\t\t\t\tposition.left = position.left - rect.width + (rect.width / 2);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tposition.left = position.left + (rect.width / 2);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tposition.top += rect.height;\r\n\t\t\t}\r\n\r\n\t\t\treturn position;\r\n\t\t}\r\n\r\n\t\tgetOffset(element) {\r\n\t\t\tvar top = 0,\r\n\t\t\t\tleft = 0;\r\n\r\n\t\t\twhile (element) {\r\n\t\t\t\ttop = top + parseInt(element.offsetTop - element.scrollTop + element.clientTop);\r\n\t\t\t\tleft = left + parseInt(element.offsetLeft - element.scrollLeft + element.clientLeft);\r\n\t\t\t\telement = element.offsetParent;\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\ttop: top,\r\n\t\t\t\tleft: left\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\texports.ContextMenu = ContextMenu;\r\n\r\n}( WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype ));\n// badge.js\n/**\n * @fileoverview of CORE Badge module.\n */\n\n(function( exports, modules ) {\n\t'use strict';\n\n\tvar Utils = modules.Utils,\n\t\tComponent = exports.Component,\n\t\tIcon = exports.Icon,\n\t\tButton = exports.Button,\n\t\tItemList = exports.ItemList,\n\t\tUILib = modules.UILib,\n\t\tUIMetrics;\n\n\texports = exports || {};\n\n\tclass Badge extends Component {\n\t\tconstructor(sandbox, parameters) {\n\t\t\tparameters = Object.assign({name: 'badge'}, parameters);\n\t\t\tsuper(sandbox, parameters);\n\t\t\tthis.setTemplate('<div class=\"<%=prefix%>-badge\" style=\"<%=style%>\" tabindex=\"0\" aria-controls=\"<%=ariaControls%>\" aria-expanded=\"<%=ariaExpanded%>\" aria-haspopup=\"<%=ariaHaspopup%>\">\t<div class=\"<%=prefix%>-badge__inner\">\t\t<div data-children=\"list\"></div>\t\t<div data-children=\"label-button\"></div>\t</div></div>');\n\t\t\tthis.addTemplateData({\n\t\t\t\tstyle: parameters.style || 'position: absolute; visibility: hidden; z-index: 0',\n\t\t\t\tariaHaspopup: true,\n\t\t\t\tariaExpanded: false,\n\t\t\t\tariaControls: this.prefix + '-' + this.name + this.getUID()\n\t\t\t});\n\t\t\tthis.container = this.sandbox.getOption('documentContainer');\n\t\t\tthis.problemsCount = 0;\n\t\t\tthis.timeoutDelay = 2000;\n\t\t\tthis.timeoutId;\n\t\t\tthis.expandedByKey = false;\n\t\t\tthis.registerModificatorsTypes({\n\t\t\t\tsmall: 'small',\n\t\t\t\terror: 'error',\n\t\t\t\tdisabled: 'disabled',\n\t\t\t\tchecking: 'checking',\n\t\t\t\tanimationMove: 'animationMove',\n\t\t\t\tmanyErrors: 'manyErrors',\n\t\t\t\tfocused: 'focused',\n\t\t\t\texpanded: 'expanded'\n\t\t\t});\n\t\t\tthis.setInitialState();\n\t\t\tthis.alwaysViewed = ['toggle'];\n\t\t\tthis.registerLifeCycleHandler('after', 'render', () => {\n\t\t\t\tthis.build(parameters);\n\t\t\t});\n\t\t\tthis.registerLifeCycleHandler('before', 'remove', () => {\n\t\t\t\tthis.destroy();\n\t\t\t});\n\t\t}\n\n\t\tbuild(parameters) {\n\t\t\tvar self = this;\n\t\t\tthis.list = new ItemList(this.sandbox, {\n\t\t\t\trole: 'menu',\n\t\t\t\titemRole: 'none',\n\t\t\t\tariaLabel: this.sandbox.getLocal('text_productActions'),\n\t\t\t\tcontrolsBy: this.prefix + '-' + this.name + this.getUID(),\n\t\t\t\tprevKey: 37,\n\t\t\t\tnextKey: 39,\n\t\t\t\tonFocusin: function() {}.bind(this),\n\t\t\t\tonFocusout: function() {}.bind(this)\n\t\t\t});\n\t\t\tthis.registerChildren(this.list);\n\t\t\tthis.sandbox.getStaticActions().reverse().map( action => {\n\t\t\t\tvar item = this.list.addItem({\n\t\t\t\t\ttitle: this.sandbox.getLocal( 'btn_' + action.getName() ),\n\t\t\t\t\ticon: this.registerBemElements( new Icon( this.sandbox, { iconName: action.getName() } ) ),\n\t\t\t\t\trole: 'menuitem',\n\t\t\t\t\ttabIndex: -1,\n\t\t\t\t\tonClick: (e) => {\n\t\t\t\t\t\taction.call(e);\n\t\t\t\t\t\tthis.setUnfocusedState();\n\t\t\t\t\t},\n\t\t\t\t\ttext: ''\n\t\t\t\t});\n\t\t\t\tthis.registerBemElements(item, 'button');\n\t\t\t\tif( !this.alwaysViewed.includes(action.getName()) ) {\n\t\t\t\t\titem.addCustomModificator('visible-toggle', this.name);\n\t\t\t\t}\n\t\t\t\treturn item;\n\t\t\t});\n\t\t\tthis.labelButton = new Button(this.sandbox, {\n\t\t\t\ttitle: this.sandbox.getOption('productName'),\n\t\t\t\ticon: this.registerBemElements( new Icon(this.sandbox, { iconName: this.name }), 'label-icon' ),\n\t\t\t\ttabIndex: -1\n\t\t\t});\n\t\t\tthis.registerChildren(this.labelButton, 'label-button');\n\t\t\tthis.attachEvents();\n\n\t\t\tthis.sandbox.subscribe('startSpellCheck, startGrammarCheck, startProblemsCheck', function(data) {\n\t\t\t\tself.setChecking(true);\n\t\t\t}, this, -2000);\n\n\t\t\tthis.sandbox.subscribe('spellCheckEnded', function(data) {\n\t\t\t\tself.update();\n\t\t\t\tself.changeBgColor();\n\t\t\t\tself.setChecking();\n\t\t\t}, this, -2000);\n\n\t\t\tthis.sandbox.subscribe('startProofreadInDialog', function(data) {\n\t\t\t\tself.isEnabled = false;\n\t\t\t}, this, 1000);\n\n\t\t\tthis.sandbox.subscribe('finishProofreadInDialog, finishCheckingInDialog', function(data) {\n\t\t\t\tif ( self.sandbox.getOption('proofreadAsYouType') ) {\n\t\t\t\t\tself.isEnabled = true;\n\t\t\t\t}\n\t\t\t}, this, 2000);\n\n\t\t\tthis.sandbox.subscribe('removedMarkupInContainer, removeMarkupFromWords, removeMarkupFromProblems, ignoreAllProblems', function(data) {\n\t\t\t\tself.update();\n\t\t\t\tself.changeBgColor();\n\t\t\t}, this, -2000);\n\n\t\t\tthis.sandbox.subscribe('periodicalChecking', function (data) {\n\t\t\t\tself.changePosition();\n\t\t\t}, this);\n\n\t\t\tthis.sandbox.subscribe('toggleApp', function(data) {\n\t\t\t\tif(data.flag) {\n\t\t\t\t\tif ( self.sandbox.getOption('proofreadAsYouType') ) {\n\t\t\t\t\t\tself.isEnabled = true;\n\t\t\t\t\t\tself.setChecking(true);\n\t\t\t\t\t}\n\n\t\t\t\t\tself.setDisabled();\n\t\t\t\t} else {\n\t\t\t\t\tself.problemsCount = 0;\n\t\t\t\t\tself.changeBgColor();\n\t\t\t\t\tself.setChecking();\n\t\t\t\t\tself.setDisabled(true);\n\t\t\t\t\tself.isEnabled = false;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t/**\n\t\t * Set initial state for wsc button.\n\t\t *\n\t\t * @memberof CORE.Badge#\n\t\t */\n\t\tsetInitialState() {\n\t\t\tif ( this.sandbox.getOption('appStarted') ) {\n\t\t\t\tif ( this.sandbox.getOption('proofreadAsYouType') ) {\n\t\t\t\t\tthis.isEnabled = true;\n\t\t\t\t} else {\n\t\t\t\t\tthis.isEnabled = false;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.isEnabled = false;\n\t\t\t\tthis.setDisabled(true);\n\t\t\t}\n\t\t}\n\t\t/**\n\t\t * Set wsc button to checking state.\n\t\t *\n\t\t * @memberof CORE.Badge#\n\t\t * @param {Boolean} checking - State\n\t\t */\n\t\tsetChecking(checking) {\n\t\t\tif (!this.isEnabled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (checking) {\n\t\t\t\tthis.addModificator('checking');\n\t\t\t} else {\n\t\t\t\tthis.removeModificator('checking');\n\t\t\t}\n\t\t}\n\t\t/**\n\t\t * Update view with new number of misspelled words.\n\t\t *\n\t\t * @memberof CORE.UI.Badge#\n\t\t */\n\t\tupdate() {\n\t\t\tif (!this.isEnabled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.problemsCount = this.sandbox.getProblemsCount() || 0;\n\n\t\t\tif (this.problemsCount <= 99) {\n\t\t\t\tthis.labelButton.setText(this.problemsCount || '');\n\t\t\t\tthis.removeModificator('manyErrors');\n\t\t\t} else {\n\t\t\t\tthis.labelButton.setText('99+');\n\t\t\t\tthis.addModificator('manyErrors');\n\t\t\t}\n\t\t}\n\t\t/**\n\t\t * Attach event handlers.\n\t\t *\n\t\t * @memberof CORE.UI.Badge#\n\t\t */\n\t\tattachEvents() {\n\t\t\tif (this.sandbox.getOption('isTouchDevice')) {\n\t\t\t\tthis.sandbox.subscribe({\n\t\t\t\t\teventType: 'orientationchange',\n\t\t\t\t\telement: window,\n\t\t\t\t\thandler: this.changePosition,\n\t\t\t\t\tcontext: this\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.sandbox.subscribe({\n\t\t\t\t\teventType: 'resize',\n\t\t\t\t\telement: window,\n\t\t\t\t\thandler: this.changePosition,\n\t\t\t\t\tcontext: this\n\t\t\t\t}, this);\n\t\t\t}\n\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'keydown',\n\t\t\t\telement: this.getDOMElement(),\n\t\t\t\thandler: this.handleKeydown,\n\t\t\t\tcontext: this\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'focusin',\n\t\t\t\telement: this.getDOMElement(),\n\t\t\t\thandler: this.handleFocusin,\n\t\t\t\tcontext: this\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'focusout',\n\t\t\t\telement: this.getDOMElement(),\n\t\t\t\thandler: this.handleFocusout,\n\t\t\t\tcontext: this\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'mouseenter',\n\t\t\t\telement: this.getDOMElement(),\n\t\t\t\thandler: this.handleMouseenter,\n\t\t\t\tcontext: this\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'mouseleave',\n\t\t\t\telement: this.getDOMElement(),\n\t\t\t\thandler: this.handleMouseleave,\n\t\t\t\tcontext: this\n\t\t\t});\n\t\t}\n\t\t/**\n\t\t * Detach event handlers.\n\t\t *\n\t\t * @memberof CORE.UI.Badge#\n\t\t */\n\t\tdetachEvents() {\n\t\t\tif (this.sandbox.getOption('isTouchDevice')) {\n\t\t\t\tthis.sandbox.unsubscribe({\n\t\t\t\t\teventType: 'orientationchange',\n\t\t\t\t\telement: window,\n\t\t\t\t\thandler: this.changePosition\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.sandbox.unsubscribe({\n\t\t\t\t\teventType: 'resize',\n\t\t\t\t\telement: window,\n\t\t\t\t\thandler: this.changePosition\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.sandbox.unsubscribe({\n\t\t\t\teventType: 'keydown',\n\t\t\t\telement: this.getDOMElement(),\n\t\t\t\thandler: this.handleKeydown,\n\t\t\t\tcontext: this\n\t\t\t});\n\n\t\t\tthis.sandbox.unsubscribe({\n\t\t\t\teventType: 'focusin',\n\t\t\t\telement: this.getDOMElement(),\n\t\t\t\thandler: this.handleFocusin,\n\t\t\t\tcontext: this\n\t\t\t});\n\n\t\t\tthis.sandbox.unsubscribe({\n\t\t\t\teventType: 'focusout',\n\t\t\t\telement: this.getDOMElement(),\n\t\t\t\thandler: this.handleFocusout,\n\t\t\t\tcontext: this\n\t\t\t});\n\n\t\t\tthis.sandbox.unsubscribe({\n\t\t\t\teventType: 'mouseenter',\n\t\t\t\telement: this.getDOMElement(),\n\t\t\t\thandler: this.handleMouseenter,\n\t\t\t\tcontext: this\n\t\t\t});\n\n\t\t\tthis.sandbox.unsubscribe({\n\t\t\t\teventType: 'mouseleave',\n\t\t\t\telement: this.getDOMElement(),\n\t\t\t\thandler: this.handleMouseleave,\n\t\t\t\tcontext: this\n\t\t\t});\n\t\t}\n\t\t/**\n\t\t * Change button position.\n\t\t *\n\t\t * @memberof CORE.UI.Badge#\n\t\t * @param {Object|Undefined} data - Data from event\n\t\t */\n\t\tchangePosition(data) {\n\t\t\tvar self = this,\n\t\t\t\tdelay = 0;\n\n\t\t\t// For 'orientationchange' event we need to change position after\n\t\t\t// browser reflow/repaint actions\n\t\t\tif (data && data.type === 'orientationchange') {\n\t\t\t\tdelay = 500;\n\t\t\t}\n\n\t\t\tthis.timeoutId = setTimeout(function() {\n\t\t\t\tself.setPositionAndSize();\n\t\t\t}, delay);\n\t\t}\n\t\t/**\n\t\t * Change wsc button background color.\n\t\t *\n\t\t * @memberof CORE.Badge#\n\t\t */\n\t\tchangeBgColor() {\n\t\t\tif (!this.isEnabled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.problemsCount > 0) {\n\t\t\t\tthis.addModificator('error');\n\t\t\t} else {\n\t\t\t\tthis.removeModificator('error');\n\t\t\t}\n\t\t}\n\t\t/**\n\t\t * Sets position and size of wsc button.\n\t\t *\n\t\t * @memberof CORE.UI.Badge#\n\t\t */\n\t\tsetPositionAndSize() {\n\t\t\tvar position = this.getPosition();\n\n\t\t\tif (position.small) {\n\t\t\t\tthis.addModificator('small');\n\t\t\t\t// We need to add additional class for small state\n\t\t\t} else {\n\t\t\t\tthis.removeModificator('small');\n\t\t\t}\n\n\t\t\tthis.setZIndex();\n\t\t\tthis.setPosition(position);\n\n\t\t\tif( !this.isVisible() ) {\n\t\t\t\tthis.show();\n\t\t\t};\n\t\t}\n\t\t/**\n\t\t * Sets z-index of wsc button.\n\t\t *\n\t\t * @memberof CORE.UI.Badge#\n\t\t */\n\t\tsetZIndex() {\n\t\t\tvar zIndex = Utils.getMaxZIndex(this.container),\n\t\t\t\tcurrentZIndex = parseInt( this.getDOMElement().style.zIndex );\n\n\t\t\tif (currentZIndex !== zIndex) {\n\t\t\t\tthis.getDOMElement().style.zIndex = zIndex;\n\t\t\t}\n\t\t}\n\t\t/**\n\t\t * Set wsc button to disabled state.\n\t\t *\n\t\t * @memberof CORE.Badge#\n\t\t * @param {Boolean} disabled - State\n\t\t */\n\t\tsetDisabled(disabled) {\n\t\t\tif (disabled) {\n\t\t\t\tthis.addModificator('disabled');\n\t\t\t} else {\n\t\t\t\tthis.removeModificator('disabled');\n\t\t\t}\n\t\t}\n\t\t/**\n\t\t * Get position of wsc button.\n\t\t *\n\t\t * @memberof CORE.UI.Badge#\n\t\t * @returns {Object} - Badge position\n\t\t */\n\t\tgetPosition() {\n\t\t\tvar position = {left: 0, top: 0, small: false},\n\t\t\t\thtml = document.documentElement,\n\t\t\t\thtmlBox = html.getBoundingClientRect(),\n\t\t\t\tcontainerBox = this.container.getBoundingClientRect(),\n\t\t\t\tcontainerHeight = containerBox.bottom - containerBox.top,\n\t\t\t\tcontainerWidth = containerBox.right - containerBox.left,\n\t\t\t\tcontainerClientHeight = this.container.clientHeight,\n\t\t\t\tcontainerClientWidth = this.container.clientWidth,\n\t\t\t\tisInputBased = Utils.isInputBased( this.sandbox.getOption('originalContainer') ),\n\t\t\t\tsmallOffset = isInputBased ? 14 : 18,\n\t\t\t\tbigOffset = 32;\n\n\t\t\t// 38x38 - is a size of the big button with right and bottom paddings\n\t\t\t// For small container we should create small badge\n\t\t\tif (containerClientHeight < 38 || containerClientWidth < 38) {\n\t\t\t\tposition.left = containerBox.left - htmlBox.left + html.offsetLeft + containerWidth - smallOffset;\n\t\t\t\tposition.top = containerBox.top - htmlBox.top + html.offsetTop + containerHeight - smallOffset;\n\t\t\t\tposition.small = true;\n\t\t\t} else {\n\t\t\t\tposition.left = containerBox.left - htmlBox.left + html.offsetLeft + containerWidth - bigOffset;\n\t\t\t\tposition.top = containerBox.top - htmlBox.top + html.offsetTop + containerHeight - bigOffset;\n\t\t\t}\n\n\t\t\treturn position;\n\t\t}\n\t\t/**\n\t\t * Add all needed attributes and modificators for show badge button actions.\n\t\t *\n\t\t * @memberof CORE.Badge#\n\t\t */\n\t\taddRequiredForShowActions() {\n\t\t\tthis.setAriaExpanded(true);\n\t\t\tthis.addModificator('expanded');\n\t\t}\n\t\t/**\n\t\t * Remove all needed attributes and modificators for hide badge button actions.\n\t\t *\n\t\t * @memberof CORE.Badge#\n\t\t */\n\t\tremoveRequiredForHideActions() {\n\t\t\tthis.setAriaExpanded(false);\n\t\t\tthis.removeModificator('expanded');\n\t\t}\n\t\t/**\n\t\t * Mouseenter event handler on badge button.\n\t\t *\n\t\t * @memberof CORE.Badge#\n\t\t * @param {Object} event - Event data object\n\t\t */\n\t\thandleMouseenter(event) {\n\t\t\tthis.addRequiredForShowActions();\n\t\t}\n\t\t/**\n\t\t * Mouseleave event handler on badge button.\n\t\t *\n\t\t * @memberof CORE.Badge#\n\t\t * @param {Object} event - Event data object\n\t\t */\n\t\thandleMouseleave(event) {\n\t\t\tthis.removeRequiredForHideActions();\n\t\t\t\n\t\t\tif (this.expandedByKey) {\n\t\t\t\tthis.setFocus();\n\t\t\t\tthis.setTabIndex(0);\n\t\t\t\tthis.expandedByKey = false;\n\t\t\t}\n\t\t}\n\t\t/**\n\t\t * Keydown event handler on badge button.\n\t\t *\n\t\t * @memberof CORE.Badge#\n\t\t * @param {Object} event - Event data object\n\t\t */\n\t\thandleKeydown(event) {\n\t\t\tswitch (event.keyCode) {\n\t\t\t\tcase 13:\n\t\t\t\tcase 32:\n\t\t\t\t\tif ( this.getDOMElement() === event.target ) {\n\t\t\t\t\t\tvar tabIndexed;\n\n\t\t\t\t\t\tthis.addRequiredForShowActions();\n\t\t\t\t\t\tthis.setTabIndex(-1);\n\t\t\t\t\t\ttabIndexed = this.list.getTabIndexedElements();\n\n\t\t\t\t\t\tif (tabIndexed.length) {\n\t\t\t\t\t\t\ttabIndexed[tabIndexed.length - 1].focus();\n\t\t\t\t\t\t\tthis.expandedByKey = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 27:\n\t\t\t\t\tthis.removeRequiredForHideActions();\n\t\t\t\t\tthis.setFocus();\n\t\t\t\t\tthis.setTabIndex(0);\n\t\t\t\t\tthis.expandedByKey = false;\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\t/**\n\t\t * Focusin event handler on badge button.\n\t\t *\n\t\t * @memberof CORE.Badge#\n\t\t * @param {Object} event - Event data object\n\t\t */\n\t\thandleFocusin(event) {\n\t\t\tthis.addModificator('focused');\n\t\t}\n\t\t/**\n\t\t * Focusout event handler on badge button.\n\t\t *\n\t\t * @memberof CORE.Badge#\n\t\t * @param {Object} event - Event data object\n\t\t */\n\t\thandleFocusout(event) {\n\t\t\tif ( !this.getDOMElement().contains(event.relatedTarget) ) {\n\t\t\t\tthis.setUnfocusedState();\n\t\t\t}\n\t\t}\n\t\t/**\n\t\t * Set unfocused badge button state.\n\t\t *\n\t\t * @memberof CORE.Badge#\n\t\t */\n\t\tsetUnfocusedState() {\n\t\t\tthis.removeModificator('focused');\n\t\t\tthis.removeRequiredForHideActions();\n\t\t\tthis.setTabIndex(0);\n\t\t}\n\t\t/**\n\t\t * Badge destructor.\n\t\t *\n\t\t * @memberof CORE.UI.Badge#\n\t\t */\n\t\tdestroy() {\n\t\t\t// remove all wsc button items\n\t\t\tthis.detachEvents();\n\t\t\tclearTimeout(this.timeoutId);\n\t\t}\n\t}\n\n\t/**\n\t * Badge module.\n\t *\n\t * @alias CORE.UI.Badge\n\t */\n\texports.Badge = Badge;\n}( WEBSPELLCHECKER.CORE.UI, WEBSPELLCHECKER.CORE.prototype ));\n// dialogwidget.js\n/**\n * @fileoverview of CORE DialogWidget module.\n */\n\n/**\n * @namespace CORE.UI\n */\n\n(function( exports, modules, UI ) {\n\t'use strict';\n\n\tvar UILib, Utils = modules.Utils,\n\t\tDialog = UI.Dialog,\n\t\tSettings = UI.Settings,\n\t\tHeader = UI.Header,\n\t\tItemList = UI.ItemList,\n\t\tMessageBox = UI.MessageBox,\n\t\tProofreadDialog = UI.ProofreadDialog,\n\t\tContextMenu = UI.ContextMenu,\n\t\tBanner = UI.Banner,\n\t\tBadge = UI.Badge;\n\n\n\tvar settingsComponents = {\n\t\toptions: UI.Options,\n\t\tlanguages: UI.Languages,\n\t\tdictionaries: UI.Dictionaries,\n\t\tabout: UI.About\n\t}\n\n\tfunction UIBuilder(name, sandbox) {\n\t\tthis.name = name;\n\t\tthis.sandbox = sandbox;\n\n\t\tthis.components = {};\n\n\t\tUILib = sandbox.UILib;\n\t}\n\n\tUIBuilder.prototype = {\n\t\tconstructor: UIBuilder,\n\t\tinit() {\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'showUiElement',\n\t\t\t\thandler: this.showUiElement\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'hideUiElement',\n\t\t\t\thandler: this.hideUiElement\n\t\t\t});\n\n\t\t\tvar contextMenu = this.buildElement('contextMenu');\n\t\t\tif( this.sandbox.getOption('enableBadgeButton') && this.sandbox.getOption('isMutationObserver') ) {\n\t\t\t\tvar badge = this.buildElement('badge', (elementHtml) => {\n\t\t\t\t\tUILib.appendTo(elementHtml, 'body');\n\t\t\t\t});\n\n\t\t\t\tbadge.setPositionAndSize();\n\t\t\t\tsetTimeout(() => { badge.addModificator('animationMove') }, 100);\n\t\t\t} else {\n\t\t\t\tcontextMenu.buildStaticItems();\n\t\t\t}\n\t\t},\n\t\tdestroy() {\n\t\t\tfor(var k in this.components) {\n\t\t\t\tthis.components[k].remove();\n\t\t\t\tdelete this.components[k];\n\t\t\t}\n\t\t},\n\t\tshowUiElement(event) {\n\t\t\tvar component = this.components[event.elementName];\n\n\t\t\tif(!component) {\n\t\t\t\tcomponent = this.buildElement(event.elementName);\n\t\t\t}\n\t\t\tcomponent.show(event.parameters);\n\t\t},\n\t\thideUiElement(event) {\n\t\t\tvar component = this.components[event.elementName];\n\n\t\t\tif (component) {\n\t\t\t\tcomponent.hide();\n\t\t\t}\n\t\t},\n\t\tbuildElement(elementName, append) {\n\t\t\tappend = append || UILib.appendTo.bind(UILib);\n\t\t\tvar component = this.directors[elementName] && this.directors[elementName](this.sandbox, this.components);\n\n\t\t\tif (!component) {\n\t\t\t\tthrow new Error(elementName + ' - is not defined in UIBuilder module.');\n\t\t\t}\n\t\t\tcomponent.addModificator('borderBox');\n\t\t\tthis.components[elementName] = component;\n\n\t\t\tif ( !component.getDOMElement() ) {\n\t\t\t\tappend( component.render(), 'body' );\n\t\t\t}\n\n\t\t\treturn component;\n\t\t},\n\t\tdirectors: {\n\t\t\t_createFacade(component) {\n\t\t\t\treturn {\n\t\t\t\t\tshow: () => component.show(),\n\t\t\t\t\thide: () => component.hide(),\n\t\t\t\t\trender: () => component.render(),\n\t\t\t\t\tremove: () => component.remove(),\n\t\t\t\t\tgetDOMElement: () => component.getDOMElement(),\n\t\t\t\t\taddModificator: (m) => component.addModificator(m),\n\t\t\t\t}\n\t\t\t},\n\t\t\tWSCDialog(sandbox, components) {\n\t\t\t\tif(!components['WSCDialog']) {\n\t\t\t\t\tcomponents['WSCDialog'] = new Dialog(sandbox, { builder: new WSCDialogBuilder(sandbox), hide: true });\n\t\t\t\t}\n\n\t\t\t\treturn components['WSCDialog'];\n\t\t\t},\n\t\t\tproofreadDialog(sandbox, components) {\n\t\t\t\tvar WSCDialog = this.WSCDialog(sandbox, components),\n\t\t\t\t\tcomponentFacade = this._createFacade(WSCDialog);\n\n\t\t\t\tcomponentFacade.show = function() {\n\t\t\t\t\tWSCDialog.show();\n\t\t\t\t\tWSCDialog.showContent();\n\t\t\t\t}\n\n\t\t\t\treturn componentFacade;\n\t\t\t},\n\t\t\tsettings(sandbox, components) {\n\t\t\t\tvar WSCDialog = this.WSCDialog(sandbox, components),\n\t\t\t\t\tcomponentFacade = this._createFacade(WSCDialog);\n\n\t\t\t\tcomponentFacade.show = function() {\n\t\t\t\t\tWSCDialog.show();\n\t\t\t\t\tWSCDialog.showMenu();\n\t\t\t\t};\n\n\t\t\t\treturn componentFacade;\n\t\t\t},\n\t\t\tcontextMenu(sandbox, components) {\n\t\t\t\tvar contextMenu = new ContextMenu(sandbox, {hide: true}),\n\t\t\t\t\tcomponentFacade = this._createFacade(contextMenu);\n\n\t\t\t\tcomponentFacade.show = function(parameters) {\n\t\t\t\t\tcontextMenu.showAtPosition(parameters);\n\t\t\t\t}\n\t\t\t\tcomponentFacade.buildStaticItems = contextMenu.buildStaticItems.bind(contextMenu);\n\t\t\t\tcontextMenu.registerLifeCycleHandler('after', 'show', () => {\n\t\t\t\t\tsandbox.fire('showBanner', { contextMenuContainer: contextMenu.getDOMElement() });\n\t\t\t\t});\n\t\t\t\tcontextMenu.registerLifeCycleHandler('before', 'hide', () => {\n\t\t\t\t\tsandbox.fire('hideBanner');\n\t\t\t\t});\n\t\t\t\treturn componentFacade;\n\t\t\t},\n\t\t\tbadge(sandbox, components) {\n\t\t\t\treturn new Badge(sandbox, {hide: true});\n\t\t\t}\n\t\t}\n\t}\n\n\tclass DialogBuilder {\n\t\tbuildHeader(parameters) {\n\t\t\treturn new Header(this.sandbox, parameters);\n\t\t}\n\t\tbuildTextBox(parameters) {\n\t\t\tparameters.hide = true;\n\t\t\tparameters.type = 'text';\n\t\t\treturn new MessageBox(this.sandbox, parameters);\n\t\t}\n\t\tbuildConfirmBox(parameters) {\n\t\t\tparameters.hide = true;\n\t\t\tparameters.type = 'confirm';\n\t\t\treturn new MessageBox(this.sandbox, parameters);\n\t\t}\n\t\tbuildMenu() {}\n\t\tbuildContent() {}\n\t\tbuildFooter() {}\n\t}\n\n\tclass WSCDialogBuilder extends DialogBuilder {\n\t\tconstructor(sandbox) {\n\t\t\tsuper();\n\t\t\tthis.sandbox = sandbox;\n\t\t}\n\t\tbuildHeader(parameters) {\n\t\t\tparameters.title = \"WebSpellChecker Proofreader\";\n\t\t\tparameters.banner = this.sandbox.getOption('banner') && new Banner(this.sandbox);\n\t\t\treturn super.buildHeader(parameters);\n\t\t}\n\t\tbuildTextBox(parameters) {\n\t\t\treturn super.buildTextBox(parameters);\n\t\t}\n\t\tbuildConfirmBox(parameters) {\n\t\t\treturn super.buildConfirmBox(parameters);\n\t\t}\n\t\tbuildMenu() {\n\t\t\tif( !this.sandbox.getOption('actionItems').includes('settings') ) { return; }\n\t\t\tvar settings = new Settings(this.sandbox, {hide: true}),\n\t\t\t\tsettingsSections = Utils.ArrayUtils.arrayUnique( this.sandbox.getOption('settingsSections').concat( this.sandbox.getOption('defaultSettingsSections') ) );\n\n\t\t\tsettingsSections.forEach(sectionName => {\n\t\t\t\tif(settingsComponents[sectionName]) {\n\t\t\t\t\tsettings.createSetting(settingsComponents[sectionName]);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn settings;\n\t\t}\n\t\tbuildContent(parameters) {\n\t\t\tparameters = Object.assign({}, parameters, {hide: true});\n\t\t\tif( this.sandbox.getOption('actionItems').includes('proofreadDialog') ) {\n\t\t\t\treturn new ProofreadDialog(this.sandbox, parameters);\n\t\t\t}\n\t\t}\n\t\tbuildFooter() {\n\t\t\treturn null;\n\t\t}\n\n\t}\n\n\texports.UIBuilder = UIBuilder;\n\n}( WEBSPELLCHECKER.CORE, WEBSPELLCHECKER.CORE.prototype, WEBSPELLCHECKER.CORE.UI ));\n// dataProcessor.js\n/**\n * @fileoverview Static Module. Preprocess HTML created in wrapper div\n */\n(function( exports ) {\n\t'use strict';\n\n\tvar DataProcessor = {\n\t\t/**\n\t\t * Return text\n\t\t * @param {string} HTML\n\t\t * @return {string} text\n\t\t */\n\t\t// @TODO: for now this method appliable only to text based controls (input, textarea)\n\t\thtmlToText: function( html, isInline ) {\n\t\t\tvar blockElements = 'address|article|aside|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h[1-6]|header|hgroup|hr|li|main|nav|noscript|ol|output|p|pre|section|table|tfoot|ul|video';\n\n\t\t\thtml = html .replace(/*REG_REPLACE*/ new RegExp('<(' + blockElements + ')(>|.*?[^?]>)', 'gi'), '<br class=\"wsc-marker\">$&' ) // add <br> before block tags\n\t\t\t\t\t\t.replace(/*REG_REPLACE*/ new RegExp('<\\/(' + blockElements + ')(>|.*?[^?]>)', 'gi'), '$&<br class=\"wsc-marker\">' ) // add <br> after block tags\n\t\t\t\t\t\t.replace(/*REG_REPLACE*//<br class=\"wsc-marker\">\\s*<br class=\"wsc-marker\">/gi, '<br class=\"wsc-marker\">' ) // replace double <br> with single <br>\n\t\t\t\t\t\t.replace(/*REG_REPLACE*//^(<br class=\"wsc-marker\">)+/gi, '') // remove <br> from the start of the string\n\t\t\t\t\t\t.replace(/*REG_REPLACE*//(<br class=\"wsc-marker\">)+$/gi, '') // remove <br> from the end of the string\n\t\t\t\t\t\t.replace( /*REG_REPLACE*//<br class=\"wsc-marker\">/gi, '\\r\\n' )\n\t\t\t\t\t\t.replace( /*REG_REPLACE*//<br>/gi, '\\r\\n' )\n\t\t\t\t\t\t.replace( /*REG_REPLACE*//&nbsp;/g, ' ' )\n\t\t\t\t\t\t.replace( /*REG_REPLACE*//\\ufeff/g, '' ) // remove zero-width space added by rangy\n\t\t\t\t\t\t.replace( /*REG_REPLACE*//\\u0002/g, '' ); // fix for FireFox (without it FF shows \"Start of text\" character);\n\n\t\t\t// remove bogus <BR> if so\n\t\t\thtml = html.replace( /*REG_REPLACE*//<br[^>]*class[^>]*=[^>]*\"[^>]*wsc-bogus[^>]*\"[^>]*>/g , '' );\n\t\t\t// remove all HTML entities\n\t\t\thtml = this.encodingTools.htmlDecode(html);\n\n\t\t\tif(isInline) {\n\t\t\t\thtml = html.replace( /*REG_REPLACE*//\\r\\n/g, ' ' );\n\t\t\t}\n\n\t\t\treturn html;\n\t\t},\n\n\t\t/**\n\t\t * Return html\n\t\t * @param {string} text\n\t\t * @return {string} HTML\n\t\t */\n\t\t// @TODO: for now this method appliable only to text based controls (input, textarea)\n\t\ttextToHtml: function ( text, isInline ) {\n\t\t\ttext = text .replace( /*REG_REPLACE*//</gi, '&lt;' )\n\t\t\t\t\t\t.replace( /*REG_REPLACE*//>/gi, '&gt;' )\n\t\t\t\t\t\t.replace( /*REG_REPLACE*//\\r\\n/g, '<br>' )\n\t\t\t\t\t\t.replace( /*REG_REPLACE*//\\n/gi, '<br>' )\n\t\t\t\t\t\t.replace( /*REG_REPLACE*//\\t/gi, '&nbsp;&nbsp;&nbsp;&nbsp;' );\n\n\t\t\tif(isInline) {\n\t\t\t\t// In input elements it is impossible to show fiew spaces in a row at some cases(e.g. during paste).\n\t\t\t\t// we need to replace all spaces with &nbsp; .\n\t\t\t\t// Also please note that we can't replace spaces with &nbsp; for all controls\n\t\t\t\t// as it will prevent line-breaks.\n\t\t\t\ttext = text.replace( /*REG_REPLACE*// /g, '&nbsp;' );\n\n\t\t\t\ttext = text.replace(/*REG_REPLACE*//<br>/gi, '&nbsp;');\n\t\t\t}\n\n\t\t\treturn text;\n\t\t},\n\n\t\t// @TODO\n\t\thtmlToPlainText: function( html ) {\n\t\t\treturn this.encodingTools.htmlDecode(html);\n\t\t},\n\n\t\ttagsToLowerCase: function( html ) {\n\t\t\treturn html = html.replace( /*REG_REPLACE*//<\\/?[A-Z]+>/g, function( match ) {\n\t\t\t\treturn match.toLowerCase();\n\t\t\t} );\n\t\t},\n\n\t\tgetHtmlWithoutSpellingNodes: function( html, misspelledWordNode, misspelledWordClass ) {\n\t\t\tvar html = this.getHtmlWithoutGivenNodes(html, misspelledWordNode, misspelledWordClass);\n\t\t\t// backward compatibility for old classes\n\t\t\thtml = this.getHtmlWithoutGivenNodes(html, 'span', 'scayt-misspell-word');\n\n\t\t\treturn html;\n\t\t},\n\n\t\tgetHtmlWithoutGrammarNodes: function( html, problemGrammarNode, problemGrammarClass ) {\n\t\t\tvar html = this.getHtmlWithoutGivenNodes(html, problemGrammarNode, problemGrammarClass);\n\t\t\t// backward compatibility for old classes\n\t\t\thtml = this.getHtmlWithoutGivenNodes(html, 'span', 'gramm-problem');\n\n\t\t\treturn html;\n\t\t},\n\n\t\tgetHtmlWithoutRangyMarkerNodes: function( html ) {\n\t\t\tvar html = this.getHtmlWithoutGivenNodes(html, 'span', 'rangySelectionBoundary');\n\n\t\t\thtml = html.replace( /*REG_REPLACE*//\\ufeff/g, '' );\n\n\t\t\treturn html;\n\t\t},\n\n\t\tgetHtmlWithoutGivenNodes: function( html, element, findBy ) {\n\t\t\tvar startElementIndex = 0;\n\t\t\tvar endElementIndex = 0;\n\t\t\tvar text = html;\n\t\t\tvar isLastElement = false;\n\t\t\tvar Utils = exports.Utils;\n\t\t\tvar element = Utils.Browser.ie && Utils.Browser.version === 8 ? element.toUpperCase() : element; // In IE8 tags are in upper case\n\n\t\t\twhile ( text.indexOf( findBy ) !== -1 ) {\n\t\t\t\tstartElementIndex = text.indexOf( '<' + element, startElementIndex );\n\t\t\t\tendElementIndex = text.indexOf( '>', startElementIndex );\n\n\t\t\t\tisLastElement = ( startElementIndex === text.lastIndexOf( '<' + element ) ) ? true : false;\n\n\t\t\t\tif ( text.indexOf( findBy, startElementIndex ) > endElementIndex ) { //if true, means that this element is not needed element\n\t\t\t\t\tif( isLastElement ) break;\n\n\t\t\t\t\tstartElementIndex = endElementIndex;\n\t\t\t\t\tcontinue; //continue to next element\n\t\t\t\t} else {\n\t\t\t\t\ttext = \ttext.substring( 0, startElementIndex ) + // html before element\n\t\t\t\t\t\t\ttext.substring( endElementIndex + 1, text.indexOf( '</' + element + '>', endElementIndex) ) + //text inside element\n\t\t\t\t\t\t\ttext.substring( text.indexOf( '</' + element + '>', endElementIndex ) + element.length + 3, text.length ); //html after element\n\n\t\t\t\t\tif( isLastElement ) break;\n\n\t\t\t\t\tstartElementIndex = 0;\n\t\t\t\t\tendElementIndex = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn text;\n\t\t},\n\n\t\t// @TODO: Remove me in 4.8.2\n\t\t// Previous approach. Does not work as we do not process correctly\n\t\t// data if it is 'htmlifiedtext'. Time consuming.\n\t\t//\n\t\t// Returns:\n\t\t// * 'htmlifiedtext' if content looks like transformed by browser from plain text.\n\t\t//\t\tSee clipboard/paste.html TCs for more info.\n\t\t// * 'html' if it is not 'htmlifiedtext'.\n\t\t// recogniseContentType: function( data ) {\n\t\t// \tvar Utils = exports.Utils;\n\n\t\t// \tif ( Utils.Browser.webkit ) {\n\t\t// \t\t// Plain text or ( <div><br></div> and text inside <div> ).\n\t\t// \t\tif ( !data.match( /^[^<]*$/g ) && !data.match( /^(<div><br( ?\\/)?><\\/div>|<div>[^<]*<\\/div>)*$/gi ) )\n\t\t// \t\t\treturn 'html';\n\t\t// \t} else if ( Utils.Browser.ie ) {\n\t\t// \t\t// Text and <br> or ( text and <br> in <p> - paragraphs can be separated by new \\r\\n ).\n\t\t// \t\tif ( !data.match( /^([^<]|<br( ?\\/)?>)*$/gi ) && !data.match( /^(<p>([^<]|<br( ?\\/)?>)*<\\/p>|(\\r\\n))*$/gi ) )\n\t\t// \t\t\treturn 'html';\n\t\t// \t} else if ( Utils.Browser.gecko || Utils.Browser.opera ) {\n\t\t// \t\t// Text or <br>.\n\t\t// \t\tif ( !data.match( /^([^<]|<br( ?\\/)?>)*$/gi ) )\n\t\t// \t\t\treturn 'html';\n\t\t// \t} else\n\t\t// \t\treturn 'html';\n\n\t\t// \treturn 'htmlifiedtext';\n\t\t// },\n\n\t\t// Returns:\n\t\t// * 'html' if data contains any not encoded HTML tags\n\t\t// * 'text' if not\n\t\trecogniseContentType: function( data ) {\n\t\t\tvar htmlRegex = /*REG_REPLACE*/new RegExp(\n\t\t\t\t\t'<[\\s]*[a-z0-9]+[\\s]*>' + '|' + \t\t// open tag\n\t\t\t\t\t'<[\\s]*\\/[\\s]*[a-z0-9]+[\\s]*>' + '|' + \t// close tag\n\t\t\t\t\t'<[\\s]*[a-z0-9]+[\\s]*\\/[\\s]*>'\t\t \t// single self-closing tag\n\t\t\t\t\t, 'gi'\t\t\t\t\t\t\t\t\t// global and not register sensitive\n\t\t\t\t);\n\n\t\t\tif(data.match(htmlRegex)) {\n\t\t\t\treturn 'html';\n\t\t\t}\n\n\t\t\treturn 'text';\n\t\t},\n\n\t\tencodingTools: (function(){\n\t\t\tvar specialCharactersFilter = {\t// Bug in IE8 - Empty lines are removed\n\t\t\t\t\tsymbolsToSave: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsearchFor: /*REG_REPLACE*//\\n/g,\n\t\t\t\t\t\t\treplaceWith: '__%N%__'\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsearchFor: /*REG_REPLACE*//\\r/g,\n\t\t\t\t\t\t\treplaceWith: '__%R%__'\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\tsymbolsToRestore: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsearchFor: /*REG_REPLACE*//__%N%__/g,\n\t\t\t\t\t\t\treplaceWith: '\\n'\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsearchFor: /*REG_REPLACE*//__%R%__/g,\n\t\t\t\t\t\t\treplaceWith: '\\r'\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\tsave: function(text) {\n\t\t\t\t\t\ttext = text || '';\n\n\t\t\t\t\t\tfor(var i = 0; i < this.symbolsToSave.length; i++) {\n\t\t\t\t\t\t\ttext = text.replace(this.symbolsToSave[i].searchFor, this.symbolsToSave[i].replaceWith);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn text;\n\t\t\t\t\t},\n\t\t\t\t\trestore: function(text) {\n\t\t\t\t\t\ttext = text || '';\n\n\t\t\t\t\t\tfor(var i = 0; i < this.symbolsToRestore.length; i++) {\n\t\t\t\t\t\t\ttext = text.replace(this.symbolsToRestore[i].searchFor, this.symbolsToRestore[i].replaceWith);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn text;\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\treturn {\n\t\t\t\thtmlEncode: function( html ) {\n\t\t\t\t\tvar result, node, text;\n\n\t\t\t\t\tresult = specialCharactersFilter.save(html);\n\n\t\t\t\t\tnode = document.createElement( 'span' ),\n\t\t\t\t\ttext = document.createTextNode( result );\n\n\t\t\t\t\tnode.appendChild( text );\n\n\t\t\t\t\tresult = specialCharactersFilter.restore(node.innerHTML);\n\n\t\t\t\t\treturn result;\n\t\t\t\t},\n\n\t\t\t\thtmlDecode: function( html ) {\n\t\t\t\t\tvar result,\n\t\t\t\t\t\tnode = document.createElement( 'span' );\n\n\t\t\t\t\tresult = specialCharactersFilter.save(html);\n\n\t\t\t\t\tnode.innerHTML = result;\n\n\t\t\t\t\tresult = specialCharactersFilter.restore(node.textContent || node.innerText);\n\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t};\n\t\t}())\n\n\t};\n\n\t/**\n\t * Static Module. Preprocess HTML created in wrapper div\n\t *\n\t * @alias CORE.prototype.DataProcessor\n\t */\n\texports.DataProcessor = DataProcessor;\n\n})( WEBSPELLCHECKER.CORE.prototype );\n(function( exports ) {\n\t'use strict';\n\n\t// make sure that we declaring clipboardManager only once\n\tif(exports.clipboardManager) {\n\t\treturn;\n\t}\n\n\tvar UILib = exports.UILib,\n\t\tUtils = exports.Utils,\n\t\tDataProcessor = exports.DataProcessor,\n\t\tinstances = [],\n\t\tdefaultDataType = 'html',\n\t\tpasteEvent = Utils.Browser.ie ? 'beforepaste' : 'paste', // For IE we want to use here 'beforepaste' as 'paste' is too late to store bookmark.\n\t\tTRANSFER_TYPE = {\n\t\t\tINTERNAL: 1,\t// data came from DOM 'paste' event\n\t\t\tEXTERNAL: 2\t\t// data came as result of external firing of 'paste' event (E.g. paste dialog submitting).\n\t\t\t\t\t\t\t// All transfer marked as EXTERNAL by default. See 'getTransferType' below for details.\n\t\t};\n\n\tvar pasteHolder = {\n\n\t\tinit: function(sandbox) {\n\t\t\tthis.sandbox = sandbox;\n\n\t\t\tif(!this.initialized) {\n\t\t\t\tthis.initialized = true;\n\n\t\t\t\tfor(var contentType in this.contentTypes) {\n\t\t\t\t\tthis.contentTypes[contentType].element = UILib.create(this.contentTypes[contentType].template)[0];\n\t\t\t\t\tUILib.appendTo(this.contentTypes[contentType].element, 'body');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t// Used for fixing IE jumping screen when we do focus on pasteHolder element.\n\t\tgetScrollTop: function() {\n\t\t\treturn UILib.scrollTop(window) + 10 + 'px';\n\t\t},\n\n\t\t// Used for fixing IE jumping screen when we do focus on pasteHolder element.\n\t\tgetScrollLeft: function() {\n\t\t\treturn UILib.scrollLeft(window) + 'px';\n\t\t},\n\n\t\tcontentTypes: {\n\t\t\ttext: {\n\t\t\t\ttemplate: '<textarea id=\"sc-hidden-paste-text-holder\" style=\"position:absolute;left:-99999px;\"></textarea>',\n\t\t\t\telement: null,\n\t\t\t\tcleanup: function() {\n\t\t\t\t\tthis.element.value = '';\n\t\t\t\t\tthis.element.style.top = pasteHolder.getScrollTop();\n\t\t\t\t\tpasteHolder.sandbox.fire({\n\t\t\t\t\t\teventType: 'focus',\n\t\t\t\t\t\telement: this.element\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tgetData: function() {\n\t\t\t\t\treturn this.element.value;\n\t\t\t\t},\n\t\t\t\tsetData: function(data) {\n\t\t\t\t\tthis.element.value = data;\n\t\t\t\t}\n\t\t\t},\n\t\t\thtml: {\n\t\t\t\ttemplate: '<div contenteditable=\"true\" id=\"sc-hidden-paste-html-holder\" style=\"position:absolute;left:-99999px;\"></div>',\n\t\t\t\telement: null,\n\t\t\t\tcleanup: function() {\n\t\t\t\t\tthis.element.innerHTML = '';\n\t\t\t\t\tthis.element.style.top = pasteHolder.getScrollTop();\n\t\t\t\t\tpasteHolder.sandbox.fire({\n\t\t\t\t\t\teventType: 'focus',\n\t\t\t\t\t\telement: this.element\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tgetData: function() {\n\t\t\t\t\treturn this.element.innerHTML;\n\t\t\t\t},\n\t\t\t\tsetData: function(data) {\n\t\t\t\t\tthis.element.innerHTML = data;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tgetPastedData: function(contentType, callback) {\n\t\t\tvar self = this,\n\t\t\t\tIE11 = (Utils.Browser.ie && Utils.Browser.version === 11);\n\n\t\t\tif(!callback) {\n\t\t\t\tcallback = contentType;\n\t\t\t\tcontentType = 'html';\n\t\t\t}\n\n\t\t\tif(this.contentTypes[contentType].element && typeof callback === 'function') {\n\t\t\t\tthis.contentTypes[contentType].cleanup();\n\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tvar data = self.contentTypes[contentType].getData();\n\n\t\t\t\t\t// Fix for: https://webspellchecker.atlassian.net/browse/WP-1905\n\t\t\t\t\tif (IE11 && contentType === 'html' && data === '<br>') {\n\t\t\t\t\t\tdata = '';\n\t\t\t\t\t}\n\n\t\t\t\t\tcallback(data);\n\t\t\t\t}, 0);\n\t\t\t}\n\t\t}\n\t};\n\n\tvar ClipboardManager = {\n\n\t\tadd: function( sandbox, container, forcePlainText, isPasteDialog ) {\n\t\t\tinstances.push({\n\t\t\t\tsandbox: sandbox,\n\t\t\t\tcontainer: container\n\t\t\t});\n\t\t\tpasteHolder.init(sandbox);\n\t\t\tattachEvents( sandbox, container, forcePlainText, isPasteDialog );\n\t\t},\n\n\t\tremove: function( uid ) {\n\t\t\tvar instanceToRemove;\n\n\t\t\tfor( var i = 0; i < instances.length; i++ ) {\n\t\t\t\tif( instances[i].sandbox.getOption( 'uid' ) === uid ) {\n\t\t\t\t\tinstanceToRemove = instances[i];\n\t\t\t\t\tdetachEvents(instanceToRemove);\n\t\t\t\t\tinstances.splice( i, 1 );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t};\n\n\tfunction attachEvents( sandbox, container, forcePlainText, isPasteDialog ) {\n\t\tvar isFocused = sandbox.getFocused(),\n\t\t\tisIframe = sandbox.getOption('isIframe'),\n\t\t\tpreventPasteEvent = false,\n\t\t\tpreventBeforePasteEvent = false,\n\t\t\tpreventToFastPasteEvent = false,\n\t\t\tUtils = exports.Utils,\n\t\t\tsavedSelection;\n\n\t\tsandbox.subscribe({\n\t\t\teventType: 'focus',\n\t\t\telement: container,\n\t\t\thandler: function(event) {\n\t\t\t\tisFocused = true;\n\t\t\t}\n\t\t});\n\t\tsandbox.subscribe({\n\t\t\teventType: 'blur',\n\t\t\telement: container,\n\t\t\thandler: function(event) {\n\t\t\t\tisFocused = false;\n\t\t\t}\n\t\t});\n\n\t\tsandbox.subscribe({\n\t\t\teventType: 'cut',\n\t\t\telement: container,\n\t\t\thandler: function(event) {\n\t\t\t\tsandbox.fire({\n\t\t\t\t\teventType: 'cutProcessed',\n\t\t\t\t\tdata: event\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tsandbox.subscribe({\n\t\t\teventType: 'copy',\n\t\t\telement: container,\n\t\t\thandler: function(event) {\n\t\t\t\tsandbox.fire({\n\t\t\t\t\teventType: 'copyProcessed',\n\t\t\t\t\tdata: event\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tsandbox.subscribe({\n\t\t\teventType: pasteEvent,\n\t\t\telement: container,\n\t\t\thandler: pasteEventHandler\n\t\t});\n\n\t\tfunction pasteEventHandler(event) {\n\t\t\tvar savedContent,\n\t\t\t\te = event,\n\t\t\t\tdataFromPasteBin = '',\n\t\t\t\tdataType = forcePlainText ? 'text' : defaultDataType,\n\t\t\t\tclipboardData = null,\n\t\t\t\tUtils = sandbox.Utils,\n\t\t\t\tcurrentDocument = Utils.getCurrentDocument(sandbox.getOption('documentContainer')),\n\t\t\t\tisTextBasedContainer = sandbox.getOption('isTextBasedContainer'),\n\t\t\t\tarrayOfTypes = [];\n\n\t\t\t// In EDGE we haven't access to Event clipboardData.\n\t\t\tif(Utils.Browser.edge) {\n\t\t\t\tclipboardData = Utils.getWindowByDocument(currentDocument).clipboardData;\n\t\t\t} else {\n\t\t\t\tclipboardData = e && e.clipboardData;\n\t\t\t}\n\n\t\t\t// Trick for IE11 - it fires beforepaste event twice.. We need to prevent it from second execution.\n\t\t\t// And trick for all IE whit bug #78286 for prevent to fast paste event.\n\t\t\tif(preventBeforePasteEvent || preventToFastPasteEvent) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tpreventBeforePasteEventNow();\n\n\t\t\tif(isFocused) {\n\t\t\t\tsavedSelection = sandbox.saveSelection();\n\t\t\t}\n\t\t\tsavedContent = container.innerHTML;\n\n\t\t\tif(clipboardData && clipboardData.getData) {// For WebKit\n\t\t\t\t// get data from clipboard, put into editdiv, cleanup, then cancel event\n\t\t\t\t// we need to convert here \"e.clipboardData.types\" object into array because in some browsers\n\t\t\t\t// isn't possible to correctly use \"test\" method\n\t\t\t\tif(isArray(clipboardData.types)) {\n\t\t\t\t\tfor(var i = 0; i < clipboardData.types.length; i++) {\n\t\t\t\t\t\tarrayOfTypes[i] = clipboardData.types[i];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tpreventPasteEvent = true;\n\n\t\t\t\t// forced 'text' data type\n\t\t\t\tif(forcePlainText && /*REG_REPLACE*//text\\/plain/.test(arrayOfTypes)) {\n\t\t\t\t\tdataType = 'text';\n\t\t\t\t\tdataFromPasteBin = clipboardData.getData('text/plain');\n\t\t\t\t} else\n\t\t\t\t// try to get as 'html' first\n\t\t\t\tif(/*REG_REPLACE*//text\\/html/.test(arrayOfTypes)) {\n\t\t\t\t\tdataType = 'html';\n\t\t\t\t\tdataFromPasteBin = clipboardData.getData('text/html');\n\t\t\t\t}\n\t\t\t\t// if it is not possible then get as plain 'text'\n\t\t\t\telse if(/*REG_REPLACE*//text\\/plain/.test(arrayOfTypes)) {\n\t\t\t\t\tdataType = 'text';\n\t\t\t\t\tdataFromPasteBin = clipboardData.getData('text/plain');\n\t\t\t\t}\n\t\t\t\t// everithing else\n\t\t\t\telse {\n\t\t\t\t\tdataFromPasteBin = '';\n\t\t\t\t}\n\n\t\t\t\t// For fix bug #77177 with pasted HTML mnemonics\n\t\t\t\tif (isTextBasedContainer) {\n\t\t\t\t\tdataFromPasteBin = dataFromPasteBin.replace(/*REG_REPLACE*//&/gi, '&amp;');\n\t\t\t\t}\n\n\t\t\t\tcontainer.innerHTML = dataFromPasteBin;\n\n\t\t\t\tprocessPaste(container, savedContent, function(pastedData) {\n\t\t\t\t\tsandbox.restoreSelection(savedSelection);\n\n\t\t\t\t\t// Bugs #78287 and #78292 in IE\n\t\t\t\t\t// When user click on Edit menu IE fire onbeforepaste event with empty data\n\t\t\t\t\t// We should prevent this behaviour\n\t\t\t\t\tif (Utils.Browser.ie && !pastedData) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// wait a bit for selection restore\n\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\tsandbox.fire('pasteProcessed', {\n\t\t\t\t\t\t\tevent: e,\n\t\t\t\t\t\t\ttext: pastedData,\n\t\t\t\t\t\t\tcontentType: dataType,\n\t\t\t\t\t\t\tpasteInto: container,\n\t\t\t\t\t\t\ttransferType: TRANSFER_TYPE.INTERNAL\n\t\t\t\t\t\t});\n\t\t\t\t\t}, 0);\n\t\t\t\t});\n\t\t\t} else {// Everything else - allow browser to paste content into hidden container, then replace text in editor\n\t\t\t\tdataType = forcePlainText ? 'text' : 'html';\n\n\t\t\t\tpasteHolder.getPastedData(dataType, function(pastedData) {\n\t\t\t\t\tsandbox.fire({\n\t\t\t\t\t\teventType: 'focus',\n\t\t\t\t\t\telement: container\n\t\t\t\t\t});\n\t\t\t\t\tsandbox.restoreSelection(savedSelection);\n\n\t\t\t\t\t// Bugs #78287 and #78292 in IE\n\t\t\t\t\t// When user click on Edit menu IE fire onbeforepaste event with empty data\n\t\t\t\t\t// We should prevent this behaviour\n\t\t\t\t\tif (Utils.Browser.ie && !pastedData) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// wait a bit for selection restore\n\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\tsandbox.fire('pasteProcessed', {\n\t\t\t\t\t\t\tevent: e,\n\t\t\t\t\t\t\ttext: pastedData,\n\t\t\t\t\t\t\tcontentType: dataType,\n\t\t\t\t\t\t\tpasteInto: container,\n\t\t\t\t\t\t\ttransferType: TRANSFER_TYPE.INTERNAL\n\t\t\t\t\t\t});\n\t\t\t\t\t}, 0);\n\t\t\t\t});\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\n\t\tsandbox.subscribe({\n\t\t\teventType: 'paste',\n\t\t\telement: container,\n\t\t\thandler: function(event) {\n\t\t\t\tif(preventPasteEvent) {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// here we will determine content type of data to paste\n\t\t// to use it later in other subscribers (if it wasn't specifyed)\n\t\tsandbox.subscribe('pasteProcessed', function(data) {\n\t\t\tvar target = data.pasteInto,\n\t\t\t\ttransferType = getTransferType(data);\n\n\t\t\t// @TODO: review later in context of event subscribe\\unsubscribe flow\n\t\t\t// As paste events fired globally we need to make sure\n\t\t\t// that we process one paste event per container\n\t\t\tif(target != container) return;\n\n\t\t\t// If forced type is 'html' we don't need to know true data type.\n\t\t\tif ( data.contentType == 'html' ) {\n\t\t\t\tdata.contentTrueType = 'html';\n\t\t\t} else {\n\t\t\t\tdata.contentTrueType = DataProcessor.recogniseContentType( data.text );\n\t\t\t}\n\n\t\t\t// Unify text markup.\n\t\t\tif ( data.contentTrueType == 'html' ) {\n\t\t\t\t// IE - lower cased tags.\n\t\t\t\tdata.text = DataProcessor.tagsToLowerCase( data.text );\n\t\t\t}\n\n\t\t\tif ( data.contentType == 'text' && data.contentTrueType == 'html' ) {\n\t\t\t\tdata.text = DataProcessor.encodingTools.htmlEncode(data.text);\n\t\t\t}\n\n\t\t\tif ( data.contentType == 'auto' ) {\n\t\t\t\tdata.contentType = data.contentTrueType == 'html' ? 'html' : 'text';\n\t\t\t}\n\t\t}, sandbox, 2000);\n\n\t\t// here we will physically paste data into container\n\t\tsandbox.subscribe('pasteProcessed', function(data) {\n\t\t\tvar target = data.pasteInto;\n\n\t\t\t// @TODO: review later in context of event subscribe\\unsubscribe flow\n\t\t\t// As paste events fired globally we need to make sure\n\t\t\t// that we process one paste event per container\n\t\t\tif(target != container) return;\n\n\t\t\t// We need to prevent to fast paste event for IE\n\t\t\tpreventToFastPasteEvent = true;\n\n\t\t\t// FF needs some time to proceed with possible actions in another 'paste' subscribers\n\t\t\t// that was processed before this\n\t\t\tsetTimeout(function() {\n\t\t\t\tvar elementNode = document.createElement('span'),\n\t\t\t\t\tselection, selectionRange, elementNodeRange, nodeContentsRange;\n\n\t\t\t\t// Fix for bug WP-998\n\t\t\t\t// When user inserts text into Paste dialog its insert to blurred control\n\t\t\t\tif (isPasteDialog && isIframe) {\n\t\t\t\t\t// For paste event in paste dialog we need to get selection in main window not in iframe\n\t\t\t\t\tselection = sandbox.getSelection(true);\n\t\t\t\t} else {\n\t\t\t\t\tselection = sandbox.getSelection();\n\t\t\t\t}\n\n\t\t\t\tselectionRange = selection.getRangeAt(0);\n\t\t\t\telementNode.innerHTML = data.text;\n\n\t\t\t\tselectionRange.deleteContents();\n\t\t\t\tselectionRange.insertNode(elementNode);\n\n\t\t\t\telementNodeRange = sandbox.createRange(),\n\t\t\t\tnodeContentsRange = sandbox.createRange();\n\t\t\t\telementNodeRange.selectNode(elementNode);\n\t\t\t\tnodeContentsRange.selectNodeContents(elementNode);\n\t\t\t\telementNodeRange.commonAncestorContainer().insertBefore(nodeContentsRange.extractContents(), elementNode);\n\n\t\t\t\t// we need to move caret to the end of pasted text\n\t\t\t\tselectionRange.setStartBefore(elementNode);\n\t\t\t\tselectionRange.collapse(true);\n\t\t\t\tselection.removeAllRanges();\n\t\t\t\tselection.addRange(selectionRange);\n\n\t\t\t\t// Allow next paste event\n\t\t\t\tpreventToFastPasteEvent = false;\n\n\t\t\t\t// and finally delete empty node\n\t\t\t\tUILib.remove(elementNode);\n\t\t\t\t// Signal that paste is finished\n\t\t\t\tsandbox.fire('afterPaste');\n\t\t\t}, 0);\n\t\t}, sandbox, -2000); // we need to process this handler as late as possible as this is final 'paste' action\n\n\t\t// Trick for IE11 - it fires beforepaste event twice.. We need to prevent it from second execution.\n\t\tfunction preventBeforePasteEventNow() {\n\t\t\tpreventBeforePasteEvent = true;\n\t\t\t// We need to wait a little bit here as clipboardData.getData method\n\t\t\t// is time consuming and we can't know when it will finish.\n\t\t\t// And IE11 fires beforepaste twice as soon as first beforepaste handler\n\t\t\t// proceed.\n\t\t\tsetTimeout( function() {\n\t\t\t\tpreventBeforePasteEvent = false;\n\t\t\t}, 100 );\n\t\t}\n\t}\n\n\tfunction processPaste( elem, savedContent, readyCallback ) {\n\t\tvar pastedData = elem.innerHTML;\n\n\t\telem.innerHTML = savedContent;\n\n\t\tif(typeof readyCallback === 'function') {\n\t\t\treadyCallback(pastedData);\n\t\t}\n\t}\n\n\tfunction detachEvents( instanceObj ) {\n\t\tvar container = instanceObj.container,\n\t\t\tsandbox = instanceObj.sandbox;\n\n\t\t// We should work with focus event separately. Related to FireFox iframe behavior.\n\t\tsandbox.unsubscribe({eventType: 'focus', element: container});\n\t\tsandbox.unsubscribe({eventType: 'blur, cut, copy, paste, beforepaste', element: container});\n\n\t\tsandbox.unsubscribe('pasteProcessed', sandbox);\n\t}\n\n\tfunction isArray(obj) {\n\t\treturn obj && !(obj.propertyIsEnumerable('length')) && typeof obj === 'object' && typeof obj.length === 'number';\n\t}\n\n\tfunction getTransferType(eventData) {\n\t\teventData.transferType = eventData.transferType || TRANSFER_TYPE.EXTERNAL;\n\n\t\treturn eventData.transferType;\n\t}\n\n\texports.clipboardManager = ClipboardManager;\n\n})( WEBSPELLCHECKER.CORE.prototype );\n// wrapper.js\n/**\n * @fileoverview Instancebased Module. Create wrap on Textarea, input e.g\n */\n\n /*\n  * @TODO:\n  * - make ids of wrappers unique, not hardcoded\n  */\n\n(function( exports ) {\n\t// Can't use 'use strict' mode due to Safari bug:\n\t// TypeError: Attempted to assign to readonly property\n\n\tvar UILib, Utils, DataProcessor;\n\n\t/**\n\t * Create div contenteditable for use on textarea and input like text, search\n\t * @exports CORE.prototype.Wrapper\n\t * @requires UILib\n\t * @requires Utils\n\t * @param {node|string}\telement\n\t */\n\tvar Wrapper = function(moduleID, sandbox) {\n\n\t\tvar self = this;\n\t\t/**\n\t\t * Module name.\n\t\t *\n\t\t * @type {String}\n\t\t*/\n\t\tthis.name = moduleID;\n\n\t\t/**\n\t\t * Reference to DragAndDropManager module sandbox.\n\t\t *\n\t\t * @type {CORE.Sandbox}\n\t\t */\n\t\tthis.sandbox = sandbox;\n\n\t\tUtils = this.Utils = sandbox.Utils;\n\t\tUILib = this.UILib = sandbox.UILib;\n\n\t\tDataProcessor = this.DataProcessor = sandbox.DataProcessor;\n\t\t/**\n\t\t * Link on the container.\n\t\t *\n\t\t * @type {Node}\n\t\t */\n\t\tthis.originalElement = this.sandbox.getOption('originalContainer');\n\n\t\tthis.styles =  this.sandbox.getOption('styles');\n\t\t/**\n\t\t * Checks whether original element is control with text behavior\n\t\t * @return {boolean}\n\t\t */\n\t\tthis.isTextBased = (function() {\n\t\t\tvar availableTypes = ['textarea','text','email','search','url'];\n\n\t\t\treturn availableTypes.indexOf(self.originalElement.type ) >= 0;\n\t\t}());\n\t\tthis.sandbox.setOption('isTextBasedContainer', this.isTextBased);\n\n\t\t/**\n\t\t * Checks whether original element is input with 'inline' text behavior\n\t\t * @return {boolean}\n\t\t */\n\t\tthis.isInputBased = (function() {\n\t\t\tvar inputFieldTypes = ['text', 'email', 'search', 'url'];\n\n\t\t\treturn inputFieldTypes.indexOf( self.originalElement.type ) >= 0;\n\t\t}());\n\t\t/**\n\t\t * wrapper prefix\n\t\t *\n\t\t * @type {Object}\n\t\t */\n\t\tthis.prefix = 'wsc-';\n\t\tthis.fakeElement = this.createFakeElement();\n\t\t/**\n\t\t * Indicate text based or not current container.\n\t\t *\n\t\t * @type {Boolean}\n\t\t */\n\t\tthis.isTextBasedContainer = this.sandbox.getOption('isTextBasedContainer');\n\t};\n\n\tWrapper.prototype = {\n\t\t/**\n\t\t * Called after each registration in core.\n\t\t *\n\t\t * @memberof CORE.Wrapper#\n\t\t */\n\t\tinit: function() {\n\t\t\tvar eventProxyInstance;\n\n\t\t\tthis.attachEvents();\n\t\t\tthis.setMaxLength();\n\t\t\tif(this.fakeElement) {\n\t\t\t\tthis.adjustStyles(this.originalElement, this.fakeElement, this.styles);\n\t\t\t\teventProxyInstance = eventProxy(this.fakeElement, this.sandbox, this);\n\t\t\t\teventProxyInstance.init(this.originalElement);\n\t\t\t\t// set initial data\n\t\t\t\tthis.fakeElement.innerHTML = this.DataProcessor.textToHtml(this.originalElement.value, this.isInputBased);\n\t\t\t\t// hide original\n\t\t\t\tthis.UILib.hide(this.originalElement);\n\t\t\t\t// save link on fake element\n\t\t\t\tthis.originalElement.proofraytFakeElement = this.fakeElement;\n\t\t\t\tthis.sandbox.setContainer(this.fakeElement);\n\t\t\t\tthis.sandbox.setOption('documentContainer', this.fakeElement);\n\t\t\t} else {\n\t\t\t\tUILib.attr(this.originalElement, 'aria-readonly', false);\n\t\t\t\tUILib.attr(this.originalElement, 'spellcheck', false);\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Destructor of module. Called from core\n\t\t *\n\t\t * @memberof CORE.Deferred#\n\t\t */\n\t\tdestroy: function() {\n\t\t\tif(this.fakeElement) {\n\t\t\t\tthis.UILib.remove(this.fakeElement);\n\n\t\t\t\tthis.originalElement.proofraytFakeElement = null;\n\t\t\t\tthis.UILib.css(this.originalElement, {\n\t\t\t\t\t'display': ''\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.detachEvents();\n\t\t},\n\t\t/* PUBLIC METHODS*/\n\t\t/**\n\t\t * Return Original element\n\t\t * @return {Node} Original Element\n\t\t */\n\t\tgetOriginalElement: function() {\n\t\t\treturn this.originalElement;\n\t\t},\n\t\t/**\n\t\t * Return Wrapper fake element\n\t\t * @return {Node} fake element\n\t\t */\n\t\tgetFakeElement: function() {\n\t\t\treturn this.fakeElement;\n\t\t},\n\t\t/**\n\t\t * Return element that is used for text typing\n\t\t * @return {Node} container element\n\t\t */\n\t\tgetTextContainer: function() {\n\t\t\treturn this.fakeElement || this.originalElement;\n\t\t},\n\t\t/**\n\t\t * Set text or html to text container\n\t\t * @param {string} data - text or html string\n\t\t */\n\t\tsetData: function(data) {\n\t\t\t// remove possible spelling and spelling nodes first\n\t\t\tvar DataProcessor = this.DataProcessor;\n\t\t\tdata = this.sandbox.getHtmlWithoutSpellingNodes(data);\n\t\t\tdata = this.sandbox.getHtmlWithoutGrammarNodes(data);\n\n\t\t\tif(this.fakeElement) {\n\t\t\t\t// set data to text based wrapper and preprocess it before\n\t\t\t\tthis.fakeElement.innerHTML = DataProcessor.textToHtml(data, this.isInputBased);\n\t\t\t\tthis.originalElement.value = DataProcessor.htmlToText(this.fakeElement.innerHTML, this.isInputBased);\n\t\t\t} else {\n\t\t\t\tthis.originalElement.innerHTML = data;\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Set text or html to text container\n\t\t * @param {string} data - text or html string\n\t\t */\n\t\tgetData: function() {\n\t\t\t// For text based elements we should use 'value' (textarea, input)\n\t\t\t// For other - html of container\n\t\t\treturn this.originalElement.value || this.sandbox.getHtmlWithoutProblemNodes(this.originalElement.innerHTML);\n\t\t},\n\t\tcreateFakeElement: function (){\n\t\t\tvar element = null,\n\t\t\t\toriginalElementId,\n\t\t\t\tself = this;\n\n\t\t\t// We need to create fake element for text based sources (input, textarea etc.)\n\t\t\tif(self.isTextBased && isVisible(self.originalElement)) {\n\t\t\t\telement = UILib.create('<div>')[0];\n\n\t\t\t\tif (!self.originalElement.disabled && !self.originalElement.readOnly) {\n\t\t\t\t\tUILib.attr(element, 'contenteditable', true);\n\t\t\t\t}\n\n\t\t\t\tUILib.attr(element, 'aria-readonly', false);\n\t\t\t\tUILib.addClass(element, self.prefix + 'wrapper');\n\n\t\t\t\toriginalElementId = UILib.attr(self.originalElement, 'id');\n\t\t\t\tif(originalElementId) {\n\t\t\t\t\tUILib.attr(element, 'id', self.prefix + originalElementId);\n\t\t\t\t}\n\n\t\t\t\tUILib.insertAfter(element, self.originalElement);\n\t\t\t}\n\n\t\t\treturn element;\n\t\t},\n\t\t// Setup default wrapper styles, copy styles and classes from original element to fake element.\n\t\tadjustStyles: function(fromElement, toElement, addStyles) {\n\t\t\tvar inlineStyles, classList, wrapperStylesNode,\n\t\t\t\tdefaultStyles = '.' + this.prefix + 'wrapper{' +\n\t\t\t\t\t'overflow: auto;' +\n\t\t\t\t\t'overflow-x: hidden;' +\n\t\t\t\t\t'padding: 1px;' +\n \t\t\t\t\t'font-style: normal;' +\n \t\t\t\t\t'font-weight: normal;' +\n \t\t\t\t\t'text-align: start;' +\n\t\t\t\t\t'color: #000;' +\n\t\t\t\t\t'border: 1px solid #b3b3b3;' +\n\t\t\t\t\t'background: #fff;' +\n\t\t\t\t'}' +\n\t\t\t\t'.' + this.prefix + 'input{' +\n\t\t\t\t\t'overflow-y: hidden;' +\n\t\t\t\t\t'white-space: nowrap;' +\n\t\t\t\t\t'border-color: #a9a9a9;' +\n\t\t\t\t'}' +\n\t\t\t\t'.' + this.prefix + 'textarea{' +\n\t\t\t\t\t'white-space: pre-wrap;' +\n\t\t\t\t\t'padding: 2px;' +\n\t\t\t\t\t'border-color: #808080;' +\n\t\t\t\t\t'-moz-appearance: textfield-multiline;' +\n \t\t\t\t\t'-webkit-appearance: textfield;' +\n \t\t\t\t\t'appearance: textfield;' +\n\t\t\t\t\t'resize: both;' +\n\t\t\t\t'}' +\n\t\t\t\t'.' + this.prefix + 'wrapper[contentEditable=true]:empty:before{' +\n\t\t\t\t\t'content: attr(data-placeholder);' +\n\t\t\t\t\t'color: #888;' +\n\t\t\t\t'}';\n\n\t\t\t// copy all inline styles\n\t\t\tinlineStyles = UILib.attr(fromElement, 'style');\n\t\t\t// Fix SCRIPT16389 error in IE10.\n\t\t\t// Attempts to read 'style' attribute via jQuip, when it hasn't been specifyed directly, will return a CSSStyleDeclaration object.\n\t\t\t// Native 'setAttribute' method does not support setting this object as value for 'style' attribute, and throws an error.\n\t\t\t// Use 'cssText' property of CSSStyleDeclaration object in order to get styles string.\n\t\t\t// @TODO: should be fixed in jQuip or its adapter. Check 'attr' method work flow.\n\t\t\tinlineStyles = typeof inlineStyles === 'string' ? inlineStyles : inlineStyles.cssText;\n\t\t\tUILib.attr(toElement, 'style', inlineStyles);\n\n\t\t\t// copy classes\n\t\t\tclassList = UILib.attr(fromElement, 'class');\n\t\t\tUILib.addClass(toElement, classList);\n\n\t\t\t// set up default styles for wrapper\n\t\t\twrapperStylesNode = UILib.find('#' + this.prefix + 'wrapper-styles')[0];\n\t\t\tif(!wrapperStylesNode || wrapperStylesNode.innerHTML !== defaultStyles) {\n\t\t\t\tvar styleNode = UILib.create('<style>')[0];\n\n\t\t\t\tUILib.attr(styleNode, 'id', this.prefix + 'wrapper-styles');\n\t\t\t\tUILib.attr(styleNode, 'type', 'text/css');\n\n\t\t\t\t// solve 'unknown runtime error' in IE\n\t\t\t\tif(styleNode.styleSheet) {\n\t\t\t\t\tstyleNode.styleSheet.cssText = defaultStyles;\n\t\t\t\t} else {\n\t\t\t\t\tstyleNode.innerHTML = defaultStyles;\n\t\t\t\t}\n\n\t\t\t\tUILib.prependTo(styleNode, 'head');\n\t\t\t}\n\n\t\t\t// Setup styles for text layout according to elements type\n\t\t\tUILib.addClass(toElement, this.prefix + ( this.isInputBased ? 'input' : 'textarea' ) );\n\n\t\t\t// Setup size\n\t\t\tvar width = UILib.css(fromElement, 'width');\n\t\t\tvar height = UILib.css(fromElement, 'height');\n\n\t\t\tUILib.css(toElement, {\n\t\t\t\t'width': width,\n\t\t\t\t'height': height\n\t\t\t});\n\n\t\t\t// Setup font\n\t\t\tvar fontFamily = UILib.css(fromElement, 'fontFamily');\n\t\t\tvar fontSize = UILib.css(fromElement, 'fontSize');\n\n\t\t\tUILib.css(toElement, {\n\t\t\t\t'fontFamily': fontFamily,\n\t\t\t\t'fontSize': fontSize\n\t\t\t});\n\n\t\t\t// disable native HTML5 spell check mechanism\n\t\t\tUILib.attr(toElement, 'spellcheck', 'false');\n\n\t\t\t// Setup additional attributes\n\t\t\tvar title = UILib.attr(fromElement, 'title');\n\t\t\tvar placeholder = UILib.attr(fromElement, 'placeholder');\n\n\t\t\tUILib.attr(toElement, 'title', title);\n\t\t\tUILib.attr(toElement, 'data-placeholder', placeholder);\n\n\t\t\t// Set additional styles from initialization options of Wrapper\n\t\t\tif(typeof(addStyles) === 'object') {\n\t\t\t\tUILib.css(toElement, this.styles);\n\t\t\t}\n\t\t},\n\t\tattachEvents: function() {\n\t\t\tvar preventDOMEvent, preventAppEvent, charLength, self = this;\n\n\t\t\t// Text control specific subscribers\n\t\t\t// They are normalizing DOM events flow basing on\n\t\t\t// type of generated control\n\t\t\tif(this.fakeElement) {\n\t\t\t\t// process DOM 'keydown' event and prevent unwanted behavior\n\t\t\t\tthis.sandbox.subscribe({\n\t\t\t\t\teventType: 'keydown',\n\t\t\t\t\telement: this.fakeElement,\n\t\t\t\t\thandler: function(event) {\n\t\t\t\t\t\tvar e = event;\n\t\t\t\t\t\tcharLength = 1;\n\t\t\t\t\t\tpreventDOMEvent = false;\n\t\t\t\t\t\tpreventAppEvent = false;\n\n\t\t\t\t\t\t// process enter\n\t\t\t\t\t\tif(e.keyCode === 13) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t// Prevent default browser behavior to prevent new lines creating in\n\t\t\t\t\t\t\t// input-based text elements to replicate original behavior\n\t\t\t\t\t\t\tpreventDOMEvent = true;\n\t\t\t\t\t\t\t// For contenteditable elements insert \"<br>\" tag instead of \"\\r\\n\"\n\t\t\t\t\t\t\tif(self.isInputBased) {\n\t\t\t\t\t\t\t\tpreventAppEvent = true;\n\t\t\t\t\t\t\t} else\n\t\t\t\t\t\t\t// We do not want to rise app keypress event for this case as visually\n\t\t\t\t\t\t\t// we wan't see any changes - enter will not appear in DOM node.\n\t\t\t\t\t\t\tif( e.altKey || e.ctrlKey ) {\n\t\t\t\t\t\t\t\tpreventAppEvent = true;\n\t\t\t\t\t\t\t} else\n\t\t\t\t\t\t\t// case with text based control without inline behavior (e.g. textarea)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t// Actually length of \"\\r\\n\".\n\t\t\t\t\t\t\t\t// We need to transfer this info through app 'keypress' event\n\t\t\t\t\t\t\t\t// as we will change standart 'enter' behavior\n\t\t\t\t\t\t\t\tcharLength = 2;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.sandbox.fire({\n\t\t\t\t\t\t\teventType: 'keydownCharLengthOnFakeElement',\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tcharLength: charLength\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tpriority: 2000\n\t\t\t\t});\n\n\t\t\t\t// Each time when user release the key button we need to synch between fake element and original element\n\t\t\t\tthis.sandbox.subscribe({\n\t\t\t\t\teventType: 'keyup',\n\t\t\t\t\telement: this.fakeElement,\n\t\t\t\t\thandler: function(event) {\n\t\t\t\t\t\tself.originalElement.value = self.DataProcessor.htmlToText(self.fakeElement.innerHTML, self.isInputBased);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.sandbox.subscribe({\n\t\t\t\t\teventType: 'keydown',\n\t\t\t\t\telement: self.getOriginalElement(),\n\t\t\t\t\thandler: function(event) {\n\t\t\t\t\t\tvar e = event;\n\t\t\t\t\t\tif(preventAppEvent) {\n\t\t\t\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif(preventDOMEvent) {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tpriority: 2000\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t//---------------------------App events----------------------------------\n\n\t\t\t// We should preprocess 'paste' data here first depending on type of\n\t\t\t// desired behavior (allow only text or mixed text/html pasting).\n\t\t\tself.sandbox.subscribe('pasteProcessed', this.onPasteHandler, self, 1000);\n\n\t\t\tif(this.fakeElement) {\n\t\t\t\t// enter keypress event handler for textarea based control\n\t\t\t\t// replace newline characters with <br> tag\n\t\t\t\t// and delete keypress event handler for remove <br> tag\n\t\t\t\t// created by Firefox when conteneditable element is empty (bug #78428)\n\t\t\t\tif(!self.isInputBased) {\n\n\t\t\t\t\tself.sandbox.subscribe({\n\t\t\t\t\t\teventType: 'keydown',\n\t\t\t\t\t\telement: this.originalElement,\n\t\t\t\t\t\thandler: function(event) {\n\t\t\t\t\t\t\tvar evt = event;\n\n\t\t\t\t\t\t\tif( evt.keyCode === 13 ) {\n\t\t\t\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t\t\t\tself.onEnterKeyHandler();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif( Utils.Browser.gecko && (evt.keyCode === 8 || evt.keyCode === 46) ) {\n \t\t\t\t\t\t\t\tself.onDeleteKeyHandler();\n \t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// Text based wrapper specyfic logic.\n\t\t\t\t// Each time when 'replaceWord', 'paste' or 'drop' is fired we need to synchronize value of fake element with original one.\n\t\t\t\tself.sandbox.subscribe('afterPaste,replaceWord,replacePhrase,afterDrop,undo,redo', function(data) {\n\t\t\t\t\tself.originalElement.value = self.DataProcessor.htmlToText(self.fakeElement.innerHTML, self.isInputBased);\n\t\t\t\t}, self, -2000); // We want to process this handler as late as possible to make sure\n\t\t\t\t\t\t\t\t// that synch action will be processed with correct data\n\t\t\t}\n\t\t},\n\t\t// set initial settings for max length functionality\n\t\tsetMaxLength: function() {\n\t\t\tvar maxLength;\n\n\t\t\t// We replicate maxlength functionality only for those elements that have its native support\n\t\t\tif(!this.isTextBased) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tmaxLength = parseInt(UILib.attr(this.originalElement, 'maxlength'), 10);\n\n\t\t\tif(maxLength >= 0) {\n\t\t\t\tthis.sandbox.setOption('maxLength', maxLength);\n\t\t\t}\n\t\t},\n\t\tdetachEvents: function() {\n\t\t\tvar self = this;\n\t\t\tself.sandbox.unsubscribe('replaceWord', self);\n\t\t\tself.sandbox.unsubscribe('afterPaste', self);\n\t\t\tself.sandbox.unsubscribe('paste', self);\n\t\t\tself.sandbox.unsubscribe('keypress', self);\n\t\t\tself.sandbox.unsubscribe('afterDrop', self);\n\t\t\tself.sandbox.unsubscribe('undo', self);\n\t\t\tself.sandbox.unsubscribe('redo', self);\n\t\t\tself.sandbox.unsubscribe({\n\t\t\t\teventType: 'keydown, keyup',\n\t\t\t\telement:  self.getTextContainer()\n\t\t\t});\n\t\t},\n\t\tonEnterKeyHandler: function() {\n\t\t\tvar selection = this.sandbox.getSelection(),\n\t\t\t\tbrTag = UILib.create('<br>')[0],\n\t\t\t\trange;\n\n\t\t\t// remove selected text first if so\n\t\t\trange = selection.getRangeAt(0);\n\t\t\tif(!range.collapsed()) {\n\t\t\t\trange.deleteContents();\n\t\t\t\trange.collapse(true);\n\t\t\t}\n\n\t\t\t// add bogus <BR> if needed\n\t\t\tif(this.isEndOfContainer(range)) {\n\t\t\t\tthis.appendBogus();\n\t\t\t}\n\n\t\t\t// enter action processing\n\t\t\trange.insertNode(brTag);\n\t\t\trange.setStartAfter(brTag);\n\n\t\t\t// Update caret position\n\t\t\tselection.removeAllRanges();\n\t\t\tselection.addRange(range);\n\t\t},\n\t\tonDeleteKeyHandler: function() {\n\t\t\tvar container = this.sandbox.getOption('container');\n\n \t\t\tsetTimeout(function() {\n \t\t\t\tif (container.innerHTML === '<br>') {\n \t\t\t\t\tcontainer.innerHTML = '';\n \t\t\t\t}\n \t\t\t}, 0);\n\t\t},\n\t\t// Paste data preprocessing before it would be physically pasted into DOM\n\t\tonPasteHandler: function (data) {\n\t\t\tvar target = data.pasteInto,\n\t\t\t\tself = this,\n\t\t\t\tcontainer = self.sandbox.getOption('container'),\n\t\t\t\ttextFragment;\n\n\t\t\t// @TODO: review later in context of event subscribe\\unsubscribe flow\n\t\t\t// As paste events fired globally we need to make sure\n\t\t\t// that we process max length only for original container (not for paste helper from Paste dialog)\n\t\t\tif(target !== container) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// remove all misspelled nodes if so\n\t\t\tdata.text = self.sandbox.getHtmlWithoutSpellingNodes(data.text);\n\n\t\t\t// remove all Grammar nodes if so\n\t\t\tdata.text = self.sandbox.getHtmlWithoutGrammarNodes(data.text);\n\n\t\t\t// remove <meta> tag from html\n\t\t\tdata.text = data.text.replace(/*REG_REPLACE*//<meta.*?>/i, '');\n\t\t\t// remove style attribute from html\n\t\t\tdata.text = data.text.replace(/*REG_REPLACE*//style=\"[^\\\"]*\"/gi, '');\n\t\t\t// clear text from additional elements after paste\n\t\t\ttextFragment = data.text.match(/*REG_REPLACE*//<!--StartFragment-->([\\s\\S]*?)<!--EndFragment-->/i);\n\t\t\tdata.text = textFragment ? textFragment[1] : data.text;\n\n\t\t\tif(self.isTextBased) {\n\t\t\t\tif(data.contentType === 'html') {\n\t\t\t\t\t// first lets remove all HTML enteties\n\t\t\t\t\tdata.text = self.DataProcessor.htmlToText(data.text);\n\t\t\t\t\t// then lets turn data back to encoded HTML text\n\t\t\t\t\tdata.text = self.DataProcessor.encodingTools.htmlEncode(data.text);\n\t\t\t\t}\n\n\t\t\t\t// Transform text to html back with replacing some\n\t\t\t\t// special symbols depending on text control type\n\t\t\t\tdata.text = self.DataProcessor.textToHtml(data.text, self.isInputBased);\n\t\t\t}\n\t\t},\n\t\t// Checks whether current range is at the end of container.\n\t\t// E.g. at this cases function should return true (root div is our container):\n\t\t// 1. <div>sample text^</div>\n\t\t// 2. <div><p>sample text^</p></div>\n\t\t// 3. <div>sample text^<span></span></div>\n\t\t// At this cases function should return false (root div is our container):\n\t\t// 1. <div>sample tex^t</div>\n\t\t// 2. <div><p>sample ^text</p></div>\n\t\t// 3. <div>sample text^<span></span><br/></div>\n\t\tisEndOfContainer: function(range) {\n\t\t\tvar self = this,\n\t\t\t\tcontainer = self.sandbox.getOption('container'),\n\t\t\t\tclonedRange = range.cloneRange(),\n\t\t\t\tnodesFromRange, brNodesFromRange;\n\n\t\t\t// Set new range between end of incoming range and end of container\n\t\t\tclonedRange.collapse(false);\n\t\t\tclonedRange.setEnd(container, container.childNodes.length);\n\n\t\t\t// check that there is no text till the end of container\n\t\t\tif(clonedRange.toString().length > 0) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// check that there is no <BR>s\n\t\t\tnodesFromRange = clonedRange.getNodes();\n\t\t\tbrNodesFromRange = nodesFromRange.filter(function(node) {\n\t\t\t\treturn node.nodeName.toLowerCase() === 'br';\n\t\t\t});\n\t\t\tif(brNodesFromRange.length > 0) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\t\t// @TODO: In FF there is a nightmare with <BR> tags appearing on different actions.\n\t\t// We should handle all those cases in order to correctly calculate maxlength functionality\n\t\t// Appends bogus <BR> tag to the end of editable container\n\t\t// in order to make cursor blink (e.g. while performing Enter action\n\t\t// at the very end of text)\n\t\tappendBogus: function() {\n\t\t\tvar self = this,\n\t\t\t\tcontainer = self.sandbox.getOption('container'),\n\t\t\t\tbogus;\n\n\t\t\tbogus = UILib.find('br.wsc-bogus', container)[0];\n\t\t\t// if we already created one - just make sure that it is\n\t\t\t// at the end of container\n\t\t\tbogus = bogus || UILib.create('<br class=\"wsc-bogus\">')[0];\n\t\t\t// In FF is already implemented similar functionality. Mark our bogus BR like it\n\t\t\t// was created by FF.\n\t\t\tif(Utils.Browser.gecko) {\n\t\t\t\tUILib.attr(bogus, 'type', '_moz');\n\t\t\t}\n\n\t\t\tUILib.appendTo(bogus, container);\n\t\t}\n\t};\n\n\n\t// object that manage event proxying between two DOM elements\n\tvar eventProxy = function( element, sandbox, wrapper ) {\n\t\tvar fromElement = element || this, selection, focusData, blurData,\n\t\t\teventsMap = [\n\t\t\t\t'click', 'focus', 'keypress', 'keydown', 'keyup', 'blur',\n\t\t\t\t'mouseout', 'change', 'dblclick', 'mousedown', 'mousemove',\n\t\t\t\t'mouseover', 'mouseup', 'select', 'paste', 'cut', 'copy',\n\t\t\t\t'contextmenu', 'drag', 'dragend', 'dragenter', 'dragleave',\n\t\t\t\t'dragover', 'dragstart', 'drop'\n\t\t\t];\n\n\t\treturn {\n\t\t\tinit: function( toElement ) {\n\n\t\t\t\tsandbox.addEventProxy({\n\t\t\t\t\tfrom: fromElement,\n\t\t\t\t\tto: toElement,\n\t\t\t\t\teventsNames: eventsMap\n\t\t\t\t});\n\n\t\t\t\t// In IE we subscribe on 'beforepaste' event and broke original 'paste' event\n\t\t\t\t// So we should fire 'paste' event on original element manually\n\t\t\t\tif (Utils.Browser.ie) {\n\t\t\t\t\tsandbox.subscribe('pasteProcessed', function(data) {\n\t\t\t\t\t\tsandbox.fire({\n\t\t\t\t\t\t\telement: toElement,\n\t\t\t\t\t\t\teventType: 'paste'\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// We do not have 'select' event in our fake element\n\t\t\t\t// So we should spy for the 'mouseup' event and check selection\n\t\t\t\t// If selection not collapsed we fire 'select' event on original element\n\t\t\t\tsandbox.subscribe({\n\t\t\t\t\telement : fromElement,\n\t\t\t\t\teventType: 'mouseup',\n\t\t\t\t\thandler: function(event) {\n\t\t\t\t\t\tselection = sandbox.getSelection();\n\n\t\t\t\t\t\tif (selection.rangeCount() > 0 && !selection.getRangeAt(0).collapsed()) {\n\t\t\t\t\t\t\tsandbox.fire({\n\t\t\t\t\t\t\t\telement: toElement,\n\t\t\t\t\t\t\t\teventType: 'select'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// We do not have 'change' event in our fake element\n\t\t\t\t// So we should spy for the 'focus' and 'blur' events, save snapshots and check their\n\t\t\t\t// If snapshots are different we fire 'change' event on original element\n\t\t\t\tsandbox.subscribe({\n\t\t\t\t\telement: fromElement,\n\t\t\t\t\teventType: 'focus',\n\t\t\t\t\thandler: function(event) {\n\t\t\t\t\t\tfocusData = DataProcessor.htmlToText(fromElement.innerHTML, wrapper.isInputBased);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tsandbox.subscribe({\n\t\t\t\t\telement: fromElement,\n\t\t\t\t\teventType: 'blur',\n\t\t\t\t\thandler: function(event) {\n\t\t\t\t\t\tblurData = DataProcessor.htmlToText(fromElement.innerHTML, wrapper.isInputBased);\n\n\t\t\t\t\t\tif (focusData !== blurData) {\n\t\t\t\t\t\t\tsandbox.fire({\n\t\t\t\t\t\t\t\telement: toElement,\n\t\t\t\t\t\t\t\teventType: 'change'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t};\n\n\t/* PRIVATE METHODS*/\n\n\tfunction isVisible(element) {\n\t\treturn UILib.is(element, ':visible');\n\t}\n\n\texports.Wrapper = Wrapper;\n})( WEBSPELLCHECKER.CORE );\n// maxlength.js\n/**\n * @fileoverview of CORE MaxLength module.\n */\n\n(function( exports ) {\n\t'use strict';\n\n\t/**\n\t* Max Length (MaxLength) Plugin constructor.\n\t* @constructor\n\t* @alias CORE.MaxLength\n\t* @param {String} moduleID Module name\n\t* @param {CORE.Sandbox} sandbox sandbox\n\t*/\n\tvar MaxLength = function(moduleID, sandbox) {\n\t\tthis.name = moduleID;\n\t\tthis.sandbox = sandbox;\n\t\tthis.maxLength = this.sandbox.getOption('maxLength');\n\t\tthis.blockDOMKeyDown = false;\n\t\tthis.isInputBased = this.sandbox.UILib.hasClass(this.sandbox.getOption('container'), 'proofrayt-input');\n\t\tthis.keydownCharLength = 1;\n\t};\n\n\tMaxLength.prototype = {\n\t\tinit: function() {\n\t\t\tvar self = this;\n\n\t\t\t// is maxlength attribute wasn't specifyed correctly\n\t\t\t// stop further calculations\n\t\t\tif(this.maxLength < 0) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Priority 2000 set here to make sure that we will be able to prevent this event\n\t\t\t// from handling in other app subscribers.\n\t\t\t// If 'keypress' app event occurs in system then this key or key combination\n\t\t\t// is allowed by CORE.Wrapper module.\n\t\t\t// Please note that app 'keypress' event will be handled before DOM subscriber to\n\t\t\t// 'keydown' event.\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'keydown',\n\t\t\t\telement: this.sandbox.getOption('container'),\n\t\t\t\thandler: this.onKeyDownHandler,\n\t\t\t\tpriority: 2000\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'keydownCharLengthOnFakeElement',\n\t\t\t\thandler: function(event) {\n\t\t\t\t\tthis.keydownCharLength = event.charLength;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// priority -2000 is set for pasting into DOM\n\t\t\t// priority 1000 is set for data preprocessing\n\t\t\t// so we need here to be between two stages of this event\n\t\t\t// to make sure that we operate with already preprocessed data\n\t\t\t// but still can prevent the 'paste' event itslef or modify incoming data\n\t\t\tself.sandbox.subscribe('pasteProcessed', this.onPasteHandler, self, 0);\n\n\t\t\t// priority -2000 is set for add content into DOM\n\t\t\t// so we need here to be earlier than content will be added\n\t\t\tself.sandbox.subscribe('drop', this.onDropHandler, self, 0);\n\t\t},\n\n\t\t// here goes logic of max length when key is pressed\n\t\t// In general we should handle max length checking only when\n\t\t// we may theoretically add some symbol to text container.\n\t\t// No backspace, cut, copy, paste, delete etc. actions\n\t\tonKeyDownHandler: function(event) {\n\t\t\tvar Utils = this.sandbox.Utils,\n\t\t\t\tevt = event,\n\t\t\t\tcKey = 67,\n\t\t\t\txKey = 88,\n\t\t\t\taKey = 65,\n\t\t\t\tcutAction, copyAction, selectAllAction,\n\t\t\t\talternativeKeyCodes = [ // key codes that shoud trigger check max length regardless to all other conditions\n\t\t\t\t\t// 13,\t\t// enter\n\t\t\t\t\t// 32,\t\t// space\n\t\t\t\t\t186,\t// ';' or ':' (+ shift key)\n\t\t\t\t\t187,\t// '-' or '_' (+ shift key)\n\t\t\t\t\t188,\t// ',' or '<' (+ shift key)\n\t\t\t\t\t189,\t// '=' or '+' (+ shift key)\n\t\t\t\t\t190,\t// '.' or '>' (+ shift key)\n\t\t\t\t\t191,\t// '/' or '?' (+ shift key)\n\t\t\t\t\t192,\t// '`' or '~' (+ shift key)\n\t\t\t\t\t219,\t// '[' or '{' (+ shift key)\n\t\t\t\t\t220,\t// '\\' or '|' (+ shift key)\n\t\t\t\t\t221,\t// ']' or '}' (+ shift key)\n\t\t\t\t\t222,\t// \"'\" or '\"' (+ shift key)\n\t\t\t\t\t96,\t\t//Numpad 0\n\t\t\t\t\t97,\t\t//Numpad 1\n\t\t\t\t\t98,\t\t//Numpad 2\n\t\t\t\t\t99,\t\t//Numpad 3\n\t\t\t\t\t100,\t//Numpad 4\n\t\t\t\t\t101,\t//Numpad 5\n\t\t\t\t\t102,\t//Numpad 6\n\t\t\t\t\t103,\t//Numpad 7\n\t\t\t\t\t104,\t//Numpad 8\n\t\t\t\t\t105,\t//Numpad 9\n\t\t\t\t\t106,\t//Numpad *\n\t\t\t\t\t107,\t//Numpad +\n\t\t\t\t\t109,\t//Numpad -\n\t\t\t\t\t110,\t//Numpad .\n\t\t\t\t\t111\t\t//Numpad /\n\t\t\t\t],\n\t\t\t\t// each object contain exact state of 'keydown' event that need to be true\n\t\t\t\tconditionalCases = [\n\t\t\t\t\t// enter visually takes place\n\t\t\t\t\t{\n\t\t\t\t\t\tkeyCode: 13,\n\t\t\t\t\t\taltKey: false,\n\t\t\t\t\t\tctrlKey: false\n\t\t\t\t\t},\n\t\t\t\t\t// space visually takes place\n\t\t\t\t\t{\n\t\t\t\t\t\tkeyCode: 32,\n\t\t\t\t\t\taltKey: false\n\t\t\t\t\t}\n\t\t\t\t];\n\n\t\t\t// returns 'true' when one of conditionalCases is satisfyed by incoming 'keydown' event\n\t\t\tfunction checkConditionalCases(e) {\n\t\t\t\tvar result = false,\n\t\t\t\t\tmediumResult = true;\n\n\t\t\t\tfor(var i = 0; i < conditionalCases.length; i += 1) {\n\t\t\t\t\tmediumResult = true;\n\t\t\t\t\tfor(var prop in conditionalCases[i]) {\n\t\t\t\t\t\tmediumResult = mediumResult && e[prop] === conditionalCases[i][prop];\n\t\t\t\t\t\tif(!mediumResult) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tresult = result || mediumResult;\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\t// reset value each time when there is a possibility to prevent DOM event\n\t\t\tthis.blockDOMKeyDown = false;\n\n\t\t\tcutAction = (evt.ctrlKey || evt.metaKey) && evt.keyCode === xKey;\n\t\t\tcopyAction = (evt.ctrlKey || evt.metaKey) && evt.keyCode === cKey;\n\t\t\tselectAllAction = (evt.ctrlKey || evt.metaKey) && evt.keyCode === aKey;\n\n\t\t\tif(\n\t\t\t\t!cutAction && !copyAction && !selectAllAction && // do not handle this cases. Paste events are handled separately.\n\t\t\t\t( !evt.ctrlKey && !evt.altKey && !evt.metaKey && evt.keyCode >= 48 && evt.keyCode <= 90) || // numeric + alphabet symbols\n\t\t\t\t( !evt.ctrlKey && !evt.altKey && alternativeKeyCodes.indexOf(evt.keyCode) >= 0 ) || // other characters. See description above.\n\t\t\t\tcheckConditionalCases(evt) // all other special cases\n\t\t\t\t// @TODO: implement case when char appears with ALT+NUMPAD keycode combination\n\t\t\t) {\n\t\t\t\t// sometimes length of incoming character may not be\n\t\t\t\t// equal to 1. This is caused by CORE.Wrapper module\n\t\t\t\t// and its 'keydown' preprocessing logic.\n\t\t\t\t// E.g. enter key down will be represented with <br> tag\n\t\t\t\t// for textarea, but will be complitely ignored for text input element.\n\n\t\t\t\tif( this.checkMaxLength( this.keydownCharLength ) > 0 ) {\n\t\t\t\t\t// so we need to prevent this key\n\t\t\t\t\tthis.blockDOMKeyDown = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// @TODO: In IE8 it does not work. As DOM event is fired before our App 'keypress' event.\n\t\t\t// Need to find another solution for this case. May be fix in jquip (check how subscribe work in iE8 there..)\n\t\t\t//\n\t\t\t// We need to subscribe to DOM 'keydown' event directly in order to be able to\n\t\t\t// prevent it if needed.\n\t\t\t// Please note that app 'keypress' event will be handled before DOM subscriber to\n\t\t\t// 'keydown' event.\n\t\t\tif(this.blockDOMKeyDown) {\n\t\t\t\tevt.preventDefault();\n\t\t\t\tevt.stopPropagation();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\n\t\t// cut exceeded symbols from the end of pasted data if max length has been reached\n\t\tonPasteHandler: function(data) {\n\t\t\tvar target = data.pasteInto,\n\t\t\t\tDataProcessor = this.sandbox.DataProcessor,\n\t\t\t\tcontainer = this.sandbox.getOption('container'),\n\t\t\t\tpastedData = data.text,\n\t\t\t\tcharsExceeded;\n\n\t\t\t// @TODO: review later in context of event subscribe\\unsubscribe flow\n\t\t\t// As paste events fired globally we need to make sure\n\t\t\t// that we process max length only for original container (E.g. not for paste helper from Paste dialog)\n\t\t\tif(target != container) return;\n\n\t\t\t// Transform current data to text.\n\t\t\tpastedData = DataProcessor.htmlToText(pastedData, this.isInputBased);\n\n\t\t\tcharsExceeded = this.checkMaxLength(pastedData.length);\n\n\t\t\tif(charsExceeded > 0) {\n\t\t\t\tpastedData = pastedData.substring( 0, pastedData.length - charsExceeded );\n\t\t\t\t// Encode data back to original state as we decoded it before (in DataProcessor.htmlToText method)\n\t\t\t\tpastedData = DataProcessor.textToHtml(pastedData, this.isInputBased);\n\t\t\t\tdata.text = pastedData;\n\t\t\t}\n\t\t},\n\n\t\t// cut exceeded symbols from the end of dropped data if max length has been reached\n\t\tonDropHandler: function(data) {\n\t\t\tvar DataProcessor = this.sandbox.DataProcessor,\n\t\t\t\tcontainer = this.sandbox.getOption('container'),\n\t\t\t\tdroppedData = data.text,\n\t\t\t\tcharsExceeded;\n\n\t\t\t// We shouldn't cut text for internal drag and drop\n\t\t\tif (data.dropState === 1) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Transform current data to text.\n\t\t\tdroppedData = DataProcessor.htmlToText(droppedData, this.isInputBased);\n\n\t\t\tcharsExceeded = ( this.getTextLength() + droppedData.length ) - this.maxLength;\n\n\t\t\tif(charsExceeded > 0) {\n\t\t\t\tdroppedData = droppedData.substring( 0, droppedData.length - charsExceeded );\n\t\t\t\t// Encode data back to original state as we decoded it before (in DataProcessor.htmlToText method)\n\t\t\t\tdroppedData = DataProcessor.textToHtml(droppedData, this.isInputBased);\n\t\t\t\tdata.text = droppedData;\n\t\t\t}\n\t\t},\n\n\t\t// @TODO: In FF there is a nightmare with <BR> tags appearing on different actions.\n\t\t// We should handle all those cases in order to correctly calculate maxlength functionality\n\t\t/**\n\t\t* @memberof CORE.MaxLength#\n\t\t* @param {Number} incomingCharsLength - amount of characters that need to be added to current text\n\t\t* @return {Number} charsExceeded - amount of exceeded characters due to max length restrictions\n\t\t*/\n\t\tcheckMaxLength: function(incomingCharsLength) {\n\t\t\tvar charsExceeded = 0,\n\t\t\t\trange;\n\n\t\t\t// remove selected text first if so\n\t\t\trange = this.sandbox.getSelection().getRangeAt(0);\n\t\t\tif(!range.collapsed()) {\n\t\t\t\trange.deleteContents();\n\t\t\t\trange.collapse(true);\n\t\t\t}\n\n\t\t\tcharsExceeded = ( this.getTextLength() + incomingCharsLength ) - this.maxLength;\n\n\t\t\treturn charsExceeded;\n\t\t},\n\n\t\t/**\n\t\t* @memberof CORE.MaxLength#\n\t\t* @return {Number} contentLength - amount of text symbols in control\n\t\t*/\n\t\tgetTextLength: function() {\n\t\t\tvar container = this.sandbox.getOption('container'),\n\t\t\t\tDataProcessor = this.sandbox.DataProcessor,\n\t\t\t\thtml, textLength = -1;\n\n\t\t\thtml = container.innerHTML;\n\n\t\t\t// @TODO: remove / transfer this fix. It should be solved globally.\n\t\t\t// Hardcore fix for Gecko: remove all <BR> tags inside of input container html\n\t\t\t// as they may be created automatically by browser during different user actions.\n\t\t\tif(this.isInputBased && this.sandbox.Utils.Browser.gecko) {\n\t\t\t\thtml = html.replace(/*REG_REPLACE*//<br>/gi, '');\n\t\t\t}\n\n\t\t\ttextLength = DataProcessor.htmlToText( html, this.isInputBased ).length;\n\n\t\t\treturn textLength;\n\t\t}\n\t};\n\n\texports.MaxLength = MaxLength;\n\n}( WEBSPELLCHECKER.CORE ));\n// focusmanager.js\n/**\n * @fileoverview of CORE focus manager.\n */\n\n(function( exports ) {\n\t'use strict';\n\n\t/**\n\t * Represents FocusManager Module.\n\t *\n\t * @constructor\n\t * @alias CORE.FocusManager\n\t * @param {String} moduleID\n\t * @param {CORE.Sandbox} sandbox\n\t */\n\tvar FocusManager = function(moduleID, sandbox) {\n\t\t/**\n\t\t * Module name.\n\t\t *\n\t\t * @type {String}\n\t\t*/\n\t\tvar self = this;\n\t\t/**\n\t\t * Module name.\n\t\t *\n\t\t * @type {String}\n\t\t*/\n\t\tthis.name = moduleID;\n\n\t\tthis.UILib = sandbox.UILib;\n\t\tthis.Utils = sandbox.Utils;\n\n\t\tthis.control = sandbox.getOption('container');\n\t\tthis.controlFocused = sandbox.getOption('focused');\n\n\t\tthis.browser = this.Utils.Browser;\n\t\t/**\n\t\t * Dictionary with event names.\n\t\t * @type {Object.<string, CORE.FocusManager.eventsNames>}\n\t\t */\n\t\tthis.eventsNames = {\n\t\t\tfocus: 'focus',\n\t\t\tblur: 'blur',\n\t\t\tbeforefocus : 'beforefocus',\n\t\t\tbeforeblur : 'beforemanualcontrolblur',\n\t\t\trestoreSelection: 'restoreSelection'\n\t\t};\n\t\t/**\n\t\t * Reference to EventProxy module sandbox.\n\t\t *\n\t\t * @type {CORE.Sandbox}\n\t\t */\n\t\tthis.sandbox = sandbox;\n\t\t/**\n\t\t * Bookmark for saving/restoring selection\n\t\t *\n\t\t * @type {object}\n\t\t */\n\t\tthis.bookmark = null;\n\t};\n\n\n\tFocusManager.prototype = {\n\t\tconstructor: FocusManager,\n\t\t/**\n\t\t * Called after each registration in core.\n\t\t *\n\t\t * @memberof CORE.FocusManager#\n\t\t */\n\t\tinit: function(){\n\t\t\tvar sandbox = this.sandbox,\n\t\t\t\tself = this,\n\t\t\t\tcontrol = this.control;\n\n\t\t\tsandbox.subscribe({\n\t\t\t\teventType: this.eventsNames.focus,\n\t\t\t\telement: control,\n\t\t\t\thandler: this.focusHandler\n\t\t\t});\n\n\t\t\tsandbox.subscribe({\n\t\t\t\teventType: this.eventsNames.restoreSelection,\n\t\t\t\telement: control,\n\t\t\t\thandler: this.restoreSelection\n\t\t\t});\n\n\t\t\tsandbox.subscribe({\n\t\t\t\teventType: this.eventsNames.beforeblur,\n\t\t\t\thandler: this.beforeBlurHandler\n\t\t\t});\n\n\t\t},\n\t\t/**\n\t\t * Handler of restoreSelection event\n\t\t *\n\t\t * @param {Object} event - Communication event\n\t\t */\n\t\trestoreSelection: function(event) {\n\t\t\tif(!this.bookmark) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.sandbox.fire({\n\t\t\t\teventType: 'focus',\n\t\t\t\telement: this.control\n\t\t\t});\n\t\t\t// restore selection on control if bookmark not equal null\n\t\t\tthis.sandbox.restoreSelection(this.bookmark);\n\t\t\tthis.bookmark = null;\n\t\t},\n\t\t/**\n\t\t * Handler of focus event\n\t\t *\n\t\t * @param {Object} event - Communication event\n\t\t */\n\t\tfocusHandler: function(event) {\n\t\t\tvar self = this;\n\t\t\t// we remove selection if bookmark not equal null\n\t\t\t// we should wait restoreSelection method\n\t\t\tsetTimeout(function() {\n\t\t\t\tif(self.bookmark) {\n\t\t\t\t\tself.sandbox.removeMarkers(self.bookmark);\n\t\t\t\t}\n\t\t\t}, 0);\n\t\t},\n\t\t/**\n\t\t * Handler of beforeBlurHandler event\n\t\t *\n\t\t * @param {Object} event - Communication event\n\t\t */\n\t\tbeforeBlurHandler: function(event) {\n\t\t\tthis.bookmark = this.sandbox.saveSelection();\n\t\t\t//this.sandbox.getSelection().removeAllRanges();\n\t\t}\n\t};\n\n\texports.FocusManager = FocusManager;\n}( WEBSPELLCHECKER.CORE ));\n// draganddropmanager.js\n/**\n * @fileoverview of CORE drag and drop manager.\n */\n\n(function( exports ) {\n\t'use strict';\n\n\tvar UILib = exports.prototype.UILib,\n\t\tUtils = exports.prototype.Utils,\n\t\tDataProcessor = exports.prototype.DataProcessor,\n\t\tdropStates = {\n\t\t\tinternalDrop: 1,\n\t\t\texternalDrop: 2,\n\t\t\tcrossContainerDrop: 3\n\t\t},\n\t\tdropState = 0,\n\t\tdropped = false,\n\t\tdragRange,\n\t\tsavedDragRange,\n\t\tdragstartContainer,\n\t\tdropContainer;\n\n\t/**\n\t * Represents DragAndDropManager Module.\n\t *\n\t * @constructor\n\t * @alias CORE.DragAndDropManager\n\t * @param {String} moduleID\n\t * @param {CORE.Sandbox} sandbox\n\t */\n\tvar DragAndDropManager = function(moduleID, sandbox) {\n\t\t/**\n\t\t * Module name.\n\t\t *\n\t\t * @type {String}\n\t\t*/\n\t\tthis.name = moduleID;\n\n\t\t/**\n\t\t * Reference to DragAndDropManager module sandbox.\n\t\t *\n\t\t * @type {CORE.Sandbox}\n\t\t */\n\t\tthis.sandbox = sandbox;\n\n\t\t/**\n\t\t * Link on the container.\n\t\t *\n\t\t * @type {Node}\n\t\t */\n\t\tthis.container = this.sandbox.getOption('container');\n\n\t\t/**\n\t\t * Indicate text based or not current container.\n\t\t *\n\t\t * @type {Boolean}\n\t\t */\n\t\tthis.isTextBasedContainer = this.sandbox.getOption('isTextBasedContainer');\n\t};\n\n\tDragAndDropManager.prototype = {\n\t\t/**\n\t\t * Called after each registration in core.\n\t\t *\n\t\t * @memberof CORE.DragAndDropManager#\n\t\t */\n\t\tinit: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (Utils.Browser.ie && Utils.Browser.version <= 8) {\n\t\t\t\tthis.sandbox.subscribe({\n\t\t\t\t\teventType: 'drop',\n\t\t\t\t\telement: this.container,\n\t\t\t\t\thandler: function(event) {\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tself.sandbox.console.warn('Drag and Drop functionality are not supported in Internet Explorer 8 and its earlier versions.');\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'drop',\n\t\t\t\telement: this.container,\n\t\t\t\thandler: self.handleNativeDrop\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'dragstart',\n\t\t\t\telement: this.container,\n\t\t\t\thandler: self.handleDragStart\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'dragend',\n\t\t\t\telement: this.container,\n\t\t\t\thandler: self.handleDragEnd\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe(\"dropProcessed\", function(data) {\n\t\t\t\tself.handleDrop(data);\n\t\t\t}, this, -2000);\n\t\t},\n\t\t/**\n\t\t * Destructor of module. Called from core\n\t\t * Remove all ui subscribers\n\t\t *\n\t\t * @memberof CORE.DragAndDropManager#\n\t\t */\n\t\tdestroy: function() {\n\t\t\tthis.removeAllEventHandlers();\n\t\t},\n\t\t/**\n\t\t* Native drop event handler.\n\t\t*\n\t\t* @memberof CORE.DragAndDropManager#\n\t\t*/\n\t\thandleNativeDrop: function(event) {\n\t\t\tvar dropContainer = this.container,\n\t\t\t\ttext,\n\t\t\t\tcaretRange,\n\t\t\t\tisAffected,\n\t\t\t\tsavedCaretRange,\n\t\t\t\tsavedRange,\n\t\t\t\tsavedRangeToRemove;\n\n\t\t\t// For textbox, input and browsers which not support 'text/html' data\n\t\t\t// we should use 'text/plain' data\n\t\t\t// For non-text-based element we should use 'text/html' data\n\t\t\tif (this.isTextBasedContainer || Utils.Browser.safari || Utils.Browser.ie) {\n\t\t\t\ttext = event.dataTransfer.getData('Text') || event.dataTransfer.getData('text/plain');\n\t\t\t} else {\n\t\t\t\ttext = event.dataTransfer.getData('text/html');\n\t\t\t}\n\n\t\t\tif (!text && this.isTextBasedContainer) {\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// We need to know type of Drag and Drop - internal, external or cross container\n\t\t\tif (!dragRange) {\n\t\t\t\tdropState = dropStates.externalDrop;\n\t\t\t} else if ( dragRange && (dragstartContainer === dropContainer) ) {\n\t\t\t\tdropState = dropStates.internalDrop;\n\t\t\t} else {\n\t\t\t\tdropState = dropStates.crossContainerDrop;\n\t\t\t}\n\n\t\t\tcaretRange = this.getCaretRangeFromDrop(event);\n\n\t\t\t// If we do not have caret range or caret range in the end of drag range\n\t\t\tif ( !caretRange || this.isCaretRangeInEndOfDragRange(dragRange, caretRange) ) {\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Save drag and caret ranges carefully without affected\n\t\t\tif (dragRange) {\n\t\t\t\tisAffected = this.isCaretRangeWillAffected(dragRange, caretRange);\n\n\t\t\t\tif (!isAffected) {\n\t\t\t\t\tsavedDragRange = this.sandbox.saveRange(dragRange);\n\t\t\t\t}\n\n\t\t\t\tsavedCaretRange = this.sandbox.saveRange( caretRange );\n\n\t\t\t\tif (isAffected) {\n\t\t\t\t\tsavedDragRange = this.sandbox.saveRange(dragRange);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tsavedCaretRange = this.sandbox.saveRange(caretRange);\n\t\t\t}\n\n\t\t\tsavedRange = dropState === dropStates.internalDrop ? savedDragRange : savedCaretRange;\n\t\t\tsavedRangeToRemove = dropState === dropStates.internalDrop ? savedCaretRange : null;\n\n\t\t\tthis.sandbox.fire('dropProcessed', {\n\t\t\t\tevent: event,\n\t\t\t\ttext: text,\n\t\t\t\tdropState: dropState,\n\t\t\t\tsavedRange: savedRange,\n\t\t\t\tsavedRangeToRemove: savedRangeToRemove,\n\t\t\t\tsavedCaretRange: savedCaretRange\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t* Drop event handler.\n\t\t*\n\t\t* @memberof CORE.DragAndDropManager#\n\t\t* @param {Object} data - Data from event\n\t\t*/\n\t\thandleDrop: function(data) {\n\t\t\tdata.event.preventDefault();\n\n\t\t\tdropped = true;\n\t\t\tthis.addContent(data.text, data.savedCaretRange);\n\t\t},\n\t\t/**\n\t\t* Dragstart event handler.\n\t\t*\n\t\t* @memberof CORE.DragAndDropManager#\n\t\t* @param {Object} event - Communication Event\n\t\t*/\n\t\thandleDragStart: function(event) {\n\t\t\tdragRange = this.sandbox.getSelection().getRangeAt(0);\n\t\t\tdragstartContainer = this.container;\n\t\t},\n\t\t/**\n\t\t* Dragend event handler.\n\t\t*\n\t\t* @memberof CORE.DragAndDropManager#\n\t\t* @param {Object} event - Communication Event\n\t\t*/\n\t\thandleDragEnd: function(event) {\n\t\t\tvar misspelledAttrName = this.sandbox.getOption('data_attribute_name'),\n\t\t\t\trange,\n\t\t\t\tselection;\n\n\t\t\tif (dropped || event.dataTransfer.dropEffect !== 'none') { // If drop is success\n\t\t\t\tif (dropState === dropStates.crossContainerDrop) {\n\t\t\t\t\tthis.sandbox.fire('crossContainerDrop', {\n\t\t\t\t\t\tevent: event,\n\t\t\t\t\t\tsavedRange: savedDragRange\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\trange = dropped ? this.sandbox.restoreRange(savedDragRange) : dragRange;\n\n\t\t\t\tif (range && dropped) {\n\t\t\t\t\tselection = this.sandbox.getSelection();\n\t\t\t\t\tselection.removeAllRanges();\n\t\t\t\t\tselection.addRange(range);\n\n\t\t\t\t\t// We should do next for IE because 'bookmarksIsEnabled' function\n\t\t\t\t\t// in sandbox returns wrong result\n\t\t\t\t\tUtils.Browser.ie && this.sandbox.setOption('leftMouseButtonPressed', false);\n\n\t\t\t\t\tthis.sandbox.fire('removeMarkupInSelectionNode');\n\t\t\t\t\trange = selection.getRangeAt(0);\n\t\t\t\t\trange.deleteContents();\n\t\t\t\t\tthis.sandbox.fire('afterDrop');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.clearTemporaryData();\n\t\t},\n\t\t/**\n\t\t* Add content to container after drop event.\n\t\t*\n\t\t* @memberof CORE.DragAndDropManager#\n\t\t* @param {String} text - Text from dataTransfer object\n\t\t* @param {Object} savedCaretRange - Saved range object\n\t\t*/\n\t\taddContent: function(text, savedCaretRange) {\n\t\t\tvar self = this,\n\t\t\t\trange = this.sandbox.createRange(),\n\t\t\t\tmisspelledAttrName = this.sandbox.getOption('data_attribute_name'),\n\t\t\t\telement = document.createElement('span'),\n\t\t\t\tcaretRange,\n\t\t\t\tstartContainer,\n\t\t\t\telementNodeRange,\n\t\t\t\tnodeContentsRange,\n\t\t\t\tselection;\n\n\t\t\t// Remove misspelled nodes\n\t\t\ttext = this.sandbox.getHtmlWithoutSpellingNodes(text);\n\n\t\t\t// Remove Grammar nodes\n\t\t\ttext = this.sandbox.getHtmlWithoutGrammarNodes(text);\n\n\t\t\t// Remove <meta> tag from html\n\t\t\ttext = text.replace(/*REG_REPLACE*//<meta.*?>/i, '');\n\t\t\t// Remove style attribute from html\n\t\t\ttext = text.replace(/*REG_REPLACE*//style=\"[^\\\"]*\"/gi, '');\n\n\t\t\telement.innerHTML = text;\n\n\t\t\tsetTimeout(function() {\n\t\t\t\t// Firefox need set focus for parent iframe\n\t\t\t\t// Other browser - for editable element in iframe\n\t\t\t\tself.sandbox.fire({\n\t\t\t\t\telement: self.container,\n\t\t\t\t\teventType: 'focus'\n\t\t\t\t});\n\n\t\t\t\tselection = self.sandbox.getSelection();\n\t\t\t\tcaretRange = self.sandbox.restoreRange(savedCaretRange);\n\t\t\t\tstartContainer = caretRange.startContainer();\n\n\t\t\t\t// We should do next for IE because 'bookmarksIsEnabled' function\n\t\t\t\t// in sandbox returns wrong result\n\t\t\t\tUtils.Browser.ie && self.sandbox.setOption('leftMouseButtonPressed', false);\n\n\t\t\t\t// We should do next because in IE our container\n\t\t\t\t// 'focused' options equals 'false' (options becomes 'true' with delay)\n\t\t\t\t// and 'removeMarkupInSelectionNode' don't save a selection\n\t\t\t\tUtils.Browser.ie && self.sandbox.setOption('focused', true);\n\n\t\t\t\t// When drop to the start of spelling node we have bug #81244\n\t\t\t\t// So we should check on drop to the start of spelling node and remove markup from this node\n\t\t\t\t// Else we should remove markup from nodes in current selection\n\t\t\t\tif ( (caretRange.startOffset() === 0) && Utils.isEqualNode(startContainer, misspelledAttrName) ) {\n\t\t\t\t\tsavedCaretRange = self.sandbox.saveRange(caretRange);\n\t\t\t\t\tself.sandbox.fire('removeMarkupInSelectionNode', {selectionNode: startContainer});\n\t\t\t\t\tcaretRange = self.sandbox.restoreRange(savedCaretRange);\n\t\t\t\t} else {\n\t\t\t\t\tselection.removeAllRanges();\n\t\t\t\t\tselection.addRange(caretRange);\n\t\t\t\t\tself.sandbox.fire('removeMarkupInSelectionNode');\n\t\t\t\t\tcaretRange = selection.getRangeAt(0);\n\t\t\t\t}\n\n\t\t\t\tcaretRange.insertNode(element);\n\n\t\t\t\t// We should remove span container and leave only added data\n\t\t\t\telementNodeRange = self.sandbox.createRange(),\n\t\t\t\tnodeContentsRange = self.sandbox.createRange();\n\t\t\t\telementNodeRange.selectNode(element);\n\t\t\t\tnodeContentsRange.selectNodeContents(element);\n\t\t\t\telementNodeRange.commonAncestorContainer().insertBefore(nodeContentsRange.extractContents(), element);\n\n\t\t\t\trange.setStartAfter(element);\n\t\t\t\trange.collapse(true);\n\t\t\t\tselection.removeAllRanges();\n\t\t\t\tselection.addRange(range);\n\n\t\t\t\tUILib.remove(element);\n\t\t\t\tself.clearTemporaryData();\n\t\t\t\tself.sandbox.fire('afterDrop');\n\t\t\t}, 50); // Firefox need some time before we start adding content and cursor to container\n\t\t},\n\t\t/**\n\t\t* Return caret range from drop event.\n\t\t*\n\t\t* @memberof CORE.DragAndDropManager#\n\t\t* @param {Object} event - HTML DOM Event\n\t\t* @returns {CORE.RangeCreator.Range} - Range object\n\t\t*/\n\t\tgetCaretRangeFromDrop: function(event) {\n\t\t\tvar currentSelection = this.sandbox.getSelection(),\n\t\t\t\tcurrentRange = currentSelection.rangeCount() > 0 ? currentSelection.getRangeAt(0) : undefined;\n\t\t\tif (this.sandbox.Utils.Browser.ie && this.sandbox.Utils.Browser.version > 8 && currentRange !== undefined && dropState === dropStates.internalDrop) { // Caret position from point for IE9+ when internal drop is\n\t\t\t\treturn currentRange;\n\t\t\t} else {\n\t\t\t\treturn this.sandbox.getCaretRangeFromEvent(event);\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t* Return true if drop range will affeted by drag range or false if not.\n\t\t*\n\t\t* @memberof CORE.DragAndDropManager#\n\t\t* @param {CORE.RangeCreator.Range} dragRange - Range object\n\t\t* @param {CORE.RangeCreator.Range} caretRange - Range object\n\t\t* @returns {Boolean} - Affected or not drop range by drag range\n\t\t*/\n\t\tisCaretRangeWillAffected: function(dragRange, caretRange) {\n\t\t\tif (dragRange.endContainer() === caretRange.startContainer() && dragRange.endOffset() < caretRange.endOffset()) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\t\t/**\n\t\t* Return true if caret range in the end of drop range or false if not.\n\t\t*\n\t\t* @memberof CORE.DragAndDropManager#\n\t\t* @param {CORE.RangeCreator.Range} dragRange - Range object\n\t\t* @param {CORE.RangeCreator.Range} caretRange - Range object\n\t\t* @returns {Boolean} - Caret range in the end of drag range or not\n\t\t*/\n\t\tisCaretRangeInEndOfDragRange: function(dragRange, caretRange) {\n\t\t\tif (dragRange && dragRange.endContainer() === caretRange.startContainer() && dragRange.endOffset() === caretRange.endOffset()) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\t\t/**\n\t\t* Clear Drag and Drop temporary data after drop event.\n\t\t*\n\t\t* @memberof CORE.DragAndDropManager#\n\t\t*/\n\t\tclearTemporaryData: function() {\n\t\t\tdropState = 0;\n\t\t\tdragRange = null;\n\t\t\tsavedDragRange = null;\n\t\t\tdragstartContainer = null;\n\t\t\tdropContainer = null;\n\t\t\tdropped = false;\n\t\t},\n\t\t/**\n\t\t * Removes all event handlers.\n\t\t *\n\t\t * @memberof CORE.DragAndDropManager#\n\t\t */\n\t\tremoveAllEventHandlers: function() {\n\t\t\tthis.sandbox.unsubscribe({\n\t\t\t\teventType: 'drop, dragstart, dragend',\n\t\t\t\telement: this.container\n\t\t\t});\n\t\t}\n\t};\n\n\texports.DragAndDropManager = DragAndDropManager;\n\n}( WEBSPELLCHECKER.CORE ));\n// keyboardmanager.js\n/**\n * @fileoverview of CORE keyboard manager.\n */\n\n(function( exports ) {\n\t'use strict';\n\n\tvar UILib = exports.prototype.UILib;\n\n\tWEBSPELLCHECKER.ALT = exports.ALT = 0.1;\n\tWEBSPELLCHECKER.CTRL = exports.CTRL = 0.2;\n\tWEBSPELLCHECKER.SHIFT = exports.SHIFT = 0.4;\n\t/**\n\t * Represents KeyboardManager Module.\n\t *\n\t * @constructor\n\t * @alias CORE.KeyboardManager\n\t * @param {String} moduleID\n\t * @param {CORE.Sandbox} sandbox\n\t */\n\tvar KeyboardManager = function(moduleID, sandbox) {\n\t\t/**\n\t\t * Module name.\n\t\t *\n\t\t * @type {String}\n\t\t*/\n\t\tthis.name = moduleID;\n\n\t\t/**\n\t\t * Reference to KeyboardManager module sandbox.\n\t\t *\n\t\t * @type {CORE.Sandbox}\n\t\t */\n\t\tthis.sandbox = sandbox;\n\n\t\t/**\n\t\t * A list of shortcuts.\n\t\t *\n\t\t * @type {Object}\n\t\t */\n\t\tthis.shortcutsList = {};\n\t\t/**\n\t\t * A list of modifierKeys.\n\t\t *\n\t\t * @type {Object}\n\t\t */\n\t\tthis.modifierKeys = this.sandbox.getOption('modifierKeys');\n\t};\n\n\tKeyboardManager.prototype = {\n\t\t/**\n\t\t * Called after each registration in core.\n\t\t *\n\t\t * @memberof CORE.KeyboardManager#\n\t\t */\n\t\tinit: function() {\n\t\t\tthis.setShortcuts( this.sandbox.getOption('shortcutsList') );\n\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'keydown',\n\t\t\t\telement: this.sandbox.getOption('container'),\n\t\t\t\thandler: this.handleKeydown,\n\t\t\t\tpriority: 1000\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe('setShortcuts', function(data) {\n\t\t\t\tthis.setShortcuts(data.shortcuts);\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe('removeShortcuts', function(data) {\n\t\t\t\tthis.removeShortcuts(data.shortcuts);\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t* Called after each keydown event in container.\n\t\t*\n\t\t* @memberof CORE.KeyboardManager#\n\t\t* @param {Object} event - HTML DOM Event\n\t\t*/\n\t\thandleKeydown: function(event) {\n\t\t\tvar shortcut = event.keyCode || event.which,\n\t\t\t\tcallback, context;\n\n\t\t\tif (event.ctrlKey || event.metaKey) {\n\t\t\t\tshortcut += this.modifierKeys.CTRL;\n\t\t\t}\n\n\t\t\tif (event.shiftKey) {\n\t\t\t\tshortcut += this.modifierKeys.SHIFT;\n\t\t\t}\n\n\t\t\tif (event.altKey) {\n\t\t\t\tshortcut += this.modifierKeys.ALT;\n\t\t\t}\n\n\t\t\tshortcut = shortcut.toFixed(1);\n\n\t\t\tif ( this.shortcutsList.hasOwnProperty(shortcut) ) {\n\t\t\t\tfor (var i = 0, len = this.shortcutsList[shortcut].length; i < len; i++) {\n\t\t\t\t\tcallback = this.shortcutsList[shortcut][i].callback;\n\t\t\t\t\tcontext = this.shortcutsList[shortcut][i].context;\n\n\t\t\t\t\tif ( !callback.call(context, event) ) {\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t* Set the shortcuts.\n\t\t*\n\t\t* @memberof CORE.KeyboardManager#\n\t\t* @param {Array} shortcuts - array of the shortcuts\n\t\t*/\n\t\tsetShortcuts: function(shortcuts) {\n\t\t\tif (!shortcuts.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfor (var i = 0, len = shortcuts.length; i < len; i++) {\n\t\t\t\tthis.setShortcut(shortcuts[i].shortcut, shortcuts[i].callback, shortcuts[i].context);\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t* Add shortcut to the shortcuts list.\n\t\t*\n\t\t* @memberof CORE.KeyboardManager#\n\t\t* @param {Number} shortcut - shortcut id in shortcuts list\n\t\t* @param {Function} callback - callback function for the shortcut\n\t\t* @param {Object} context - context for the callback function\n\t\t*/\n\t\tsetShortcut: function(shortcut, callback, context) {\n\t\t\tshortcut = shortcut.toFixed(1);\n\n\t\t\tif ( !this.shortcutsList.hasOwnProperty(shortcut) ) {\n\t\t\t\tthis.shortcutsList[shortcut] = [];\n\t\t\t}\n\n\t\t\tthis.shortcutsList[shortcut].push({\n\t\t\t\tcallback: callback,\n\t\t\t\tcontext: context || this\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t* Remove the shortcuts.\n\t\t*\n\t\t* @memberof CORE.KeyboardManager#\n\t\t* @param {Array} shortcuts - array of the shortcuts\n\t\t*/\n\t\tremoveShortcuts: function(shortcuts) {\n\t\t\tif (!shortcuts.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfor (var i = 0, len = shortcuts.length; i < len; i++) {\n\t\t\t\tthis.removeShortcut(shortcuts[i].shortcut, shortcuts[i].callback);\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t* Remove shortcut from the shortcuts list.\n\t\t*\n\t\t* @memberof CORE.KeyboardManager#\n\t\t* @param {Number} shortcut - shortcut id in shortcuts list\n\t\t* @param {Function} callback - callback function for the shortcut\n\t\t*/\n\t\tremoveShortcut: function(shortcut, callback) {\n\t\t\tshortcut = shortcut.toFixed(1);\n\n\t\t\tfor (var i = 0, len = this.shortcutsList[shortcut].length; i < len; i++) {\n\t\t\t\tif (this.shortcutsList[shortcut][i].callback === callback) {\n\t\t\t\t\tthis.shortcutsList[shortcut].splice(i, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\texports.KeyboardManager = KeyboardManager;\n\n}( WEBSPELLCHECKER.CORE ));\n // undomanager.js\n/**\n * @fileoverview of CORE undo manager.\n */\n\n(function( exports ) {\n\t'use strict';\n\n\tvar UILib = exports.prototype.UILib,\n\t\tUtils = exports.prototype.Utils,\n\t\tDataProcessor = exports.prototype.DataProcessor;\n\n\t/**\n\t * Represents UndoManager Module.\n\t *\n\t * @constructor\n\t * @alias CORE.UndoManager\n\t * @param {String} moduleID\n\t * @param {CORE.Sandbox} sandbox\n\t */\n\tvar UndoManager = function(moduleID, sandbox) {\n\t\t/**\n\t\t * Module name.\n\t\t *\n\t\t * @type {String}\n\t\t*/\n\t\tthis.name = moduleID;\n\n\t\t/**\n\t\t * Reference to UndoManager module sandbox.\n\t\t *\n\t\t * @type {CORE.Sandbox}\n\t\t */\n\t\tthis.sandbox = sandbox;\n\n\t\t/**\n\t\t * An array of the data.\n\t\t *\n\t\t * @type {Array}\n\t\t */\n\t\tthis.data = [];\n\n\t\t/**\n\t\t * Link on the container.\n\t\t *\n\t\t * @type {Node}\n\t\t */\n\t\tthis.container = this.sandbox.getOption('container');\n\n\t\t/**\n\t\t * The maximum number of snapshot id data stack.\n\t\t *\n\t\t * @type {Number}\n\t\t */\n\t\tthis.limit = this.sandbox.getOption('undoDataSize') || 20;\n\n\t\t/**\n\t\t * Index of the current item in data array.\n\t\t *\n\t\t * @type {Number}\n\t\t */\n\t\tthis.index = -1;\n\n\t\t/**\n\t\t * Indicator of the user typing. Type currently or not.\n\t\t *\n\t\t * @type {Boolean}\n\t\t */\n\t\tthis.isTyping = false;\n\n\t\t/**\n\t\t * Indicator of the data deleted. Type currently Backspace or Delete button.\n\t\t *\n\t\t * @type {Boolean}\n\t\t */\n\t\tthis.isDeleted = false;\n\n\t\t/**\n\t\t * Indicator of the changes appeared in the container.\n\t\t *\n\t\t * @type {Boolean}\n\t\t */\n\t\tthis.isDirty = false;\n\t};\n\n\tUndoManager.prototype = {\n\t\t/**\n\t\t * Called after each registration in core.\n\t\t *\n\t\t * @memberof CORE.UndoManager#\n\t\t */\n\t\tinit: function() {\n\t\t\tvar self = this;\n\n\t\t\tthis.sandbox.subscribe('allModulesReady', function(data) {\n\t\t\t\tthis.setShortcuts();\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'keydown',\n\t\t\t\telement: this.container,\n\t\t\t\thandler: this.handleKeydown,\n\t\t\t\tpriority: 1000\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'click',\n\t\t\t\telement: this.container,\n\t\t\t\thandler: self.handleNavigation\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe('cutProcessed, replaceWord, replacePhrase', function(data) {\n\t\t\t\tthis.handleCutReplace();\n\t\t\t}, this, 1000);\n\n\t\t\tthis.sandbox.subscribe('pasteProcessed', function(data) {\n\t\t\t\tthis.handlePaste(data);\n\t\t\t}, this, -1000);\n\n\t\t\tthis.sandbox.subscribe('dropProcessed', function(data) {\n\t\t\t\tthis.handleDrop(data);\n\t\t\t}, this, -1000);\n\n\t\t\tthis.sandbox.subscribe('crossContainerDrop', function(data) {\n\t\t\t\tthis.handleCrossContainerDrop(data);\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe(\"executeUndo\", function(data) {\n\t\t\t\tthis.undo();\n\t\t\t}, this);\n\n\t\t\tthis.sandbox.subscribe(\"executeRedo\", function(data) {\n\t\t\t\tthis.redo();\n\t\t\t}, this);\n\n\t\t\tthis.sandbox.subscribe(\"checkUndoRedoPosibility\", function(data) {\n\t\t\t\tthis.checkUndoRedoPosibility();\n\t\t\t}, this);\n\n\t\t\tthis.breakingRichMarkupCommands = {\n\t\t\t\t'bold': false,\n\t\t\t\t'underline': false,\n\t\t\t\t'italic': false\n\t\t\t};\n\t\t},\n\t\t/**\n\t\t * Destructor of module. Called from core\n\t\t * Remove all ui subscribers\n\t\t *\n\t\t * @memberof CORE.UndoManager#\n\t\t */\n\t\tdestroy: function() {\n\t\t\tthis.removeAllEventHandlers();\n\t\t},\n\t\t/**\n\t\t* Called after each keydown event in container.\n\t\t*\n\t\t* @memberof CORE.UndoManager#\n\t\t* @param {Object} event - HTML DOM Event\n\t\t*/\n\t\thandleKeydown: function(event) {\n\t\t\tvar keyCode = event.keyCode || event.which,\n\t\t\t\tmodKey = (keyCode >= 16 && keyCode <= 20) || keyCode === 91 || event.altKey || event.ctrlKey || event.metaKey,\n\t\t\t\tfuncKey = keyCode === 13 || keyCode === 8 || keyCode === 46; // Enter, Backspace, Delete\n\n\t\t\t// Handler if key is left, right, up, down, home, end, pgdown, pgup\n\t\t\tif (keyCode >= 33 && keyCode <= 40) {\n\t\t\t\tthis.handleNavigation();\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Handler for printable keypress\n\t\t\tif (!funcKey && !modKey && !this.isTyping) {\n\t\t\t\tthis.add({fixRichMarkup: true});\n\t\t\t\tthis.isTyping = true;\n\t\t\t\tthis.isDeleted = false;\n\t\t\t\tthis.isDirty = true;\n\t\t\t}\n\t\t\t// Handler for enter keypress\n\t\t\tif (keyCode === 13) {\n\t\t\t\tthis.add();\n\t\t\t\tthis.isTyping = false;\n\t\t\t\tthis.isDeleted = false;\n\t\t\t\tthis.isDirty = true;\n\t\t\t}\n\t\t\t// Handler for Backspace/Delete\n\t\t\tif ( (keyCode === 8 ||  keyCode === 46) && !this.isDeleted ) {\n\t\t\t\tthis.add();\n\t\t\t\tthis.isTyping = false;\n\t\t\t\tthis.isDeleted = true;\n\t\t\t\tthis.isDirty = true;\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t* Set shortcuts for undo and redo.\n\t\t*\n\t\t* @memberof CORE.UndoManager#\n\t\t*/\n\t\tsetShortcuts: function() {\n\t\t\tvar self = this,\n\t\t\t\tmodifierKeys = this.sandbox.getOption('modifierKeys');\n\n\t\t\tthis.sandbox.fire('setShortcuts', {\n\t\t\t\tshortcuts: [\n\t\t\t\t\t{\n\t\t\t\t\t\tshortcut: modifierKeys.CTRL + 90,\n\t\t\t\t\t\tcallback: self.undo,\n\t\t\t\t\t\tcontext: self\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tshortcut: modifierKeys.CTRL + modifierKeys.SHIFT + 90,\n\t\t\t\t\t\tcallback: self.redo,\n\t\t\t\t\t\tcontext: self\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tshortcut: modifierKeys.CTRL + 89,\n\t\t\t\t\t\tcallback: self.redo,\n\t\t\t\t\t\tcontext: self\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t});\n\n\t\t\tif (!this.sandbox.getOption('isTextBasedContainer')) {\n\t\t\t\tthis.sandbox.fire('setShortcuts', {\n\t\t\t\t\tshortcuts: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tshortcut: modifierKeys.CTRL + 66,\n\t\t\t\t\t\t\tcallback: function() {\n\t\t\t\t\t\t\t\tself.execCommand('bold', false, null);\n\t\t\t\t\t\t\t\tself.setBreakingRichMarkupCommands('bold');\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcontext: self\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tshortcut: modifierKeys.CTRL + 73,\n\t\t\t\t\t\t\tcallback: function() {\n\t\t\t\t\t\t\t\tself.execCommand('italic', false, null);\n\t\t\t\t\t\t\t\tself.setBreakingRichMarkupCommands('italic');\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcontext: self\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tshortcut: modifierKeys.CTRL + 85,\n\t\t\t\t\t\t\tcallback: function() {\n\t\t\t\t\t\t\t\tself.execCommand('underline', false, null);\n\t\t\t\t\t\t\t\tself.setBreakingRichMarkupCommands('underline');\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcontext: self\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t* Paste event handler.\n\t\t*\n\t\t* @memberof CORE.UndoManager#\n\t\t*/\n\t\thandlePaste: function(data) {\n\t\t\tif (data && !data.text) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.add();\n\t\t\tthis.isDirty = true;\n\t\t},\n\t\t/**\n\t\t*  Cut and replace events handler.\n\t\t*\n\t\t* @memberof CORE.UndoManager#\n\t\t*/\n\t\thandleCutReplace: function() {\n\t\t\tthis.add();\n\t\t\tthis.isDirty = true;\n\t\t},\n\t\t/**\n\t\t* Drop event handler.\n\t\t*\n\t\t* @memberof CORE.UndoManager#\n\t\t* @param {Object} data - Data from drop event\n\t\t*/\n\t\thandleDrop: function(data) {\n\t\t\tif (data && !data.text) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.add(data);\n\t\t\tthis.isDirty = true;\n\t\t},\n\t\t/**\n\t\t* Cross container drop event handler.\n\t\t*\n\t\t* @memberof CORE.UndoManager#\n\t\t* @param {Object} data - Data from drop event\n\t\t*/\n\t\thandleCrossContainerDrop: function(data) {\n\t\t\tthis.add(data);\n\t\t\tthis.isDirty = true;\n\t\t},\n\t\t/**\n\t\t* Navigation handler. Call after navigate by arrow or click in container.\n\t\t*\n\t\t* @memberof CORE.UndoManager#\n\t\t*/\n\t\thandleNavigation: function() {\n\t\t\tif (this.isTyping) {\n\t\t\t\tthis.isTyping = false;\n\t\t\t}\n\n\t\t\tif (this.isDeleted) {\n\t\t\t\tthis.isDeleted = false;\n\t\t\t}\n\n\t\t\tthis.clearBreakingRichMarkupCommands();\n\t\t},\n\t\t/**\n\t\t* Add new item in data array.\n\t\t*\n\t\t* @memberof CORE.UndoManager#\n\t\t* @param {Object} data - Data from event\n\t\t*/\n\t\tadd: function(data) {\n\t\t\tvar doc = Utils.getCurrentDocument(this.sandbox.getOption('documentContainer')),\n\t\t\t\toldText,\n\t\t\t\ttext,\n\t\t\t\tsavedSelection;\n\n\t\t\t// If snapshot is present then get html whitout Spelling, Grammar and Rangy marker nodes\n\t\t\tif (this.data.length) {\n\t\t\t\toldText = this.sandbox.removeMarkupFromString(this.data[this.index].html);\n\t\t\t\toldText = DataProcessor.getHtmlWithoutRangyMarkerNodes(oldText);\n\t\t\t}\n\n\t\t\t// Get html whitout Spelling, Grammar and Rangy marker nodes from container innerHTML\n\t\t\ttext = this.sandbox.removeMarkupFromString(this.container.innerHTML);\n\t\t\ttext = DataProcessor.getHtmlWithoutRangyMarkerNodes(text);\n\n\t\t\tthis.clearRedo();\n\n\t\t\tif ( oldText === text && (!data || !data.savedRangeToRemove) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!data || !data.savedRange) {\n\t\t\t\tsavedSelection = this.sandbox.saveSelection();\n\t\t\t}\n\n\t\t\tthis.checkDataLimit();\n\t\t\tthis.data.push({\n\t\t\t\thtml: Utils.removeFillingCharacter(this.container.innerHTML),\n\t\t\t\tsavedSelection: savedSelection ? savedSelection : null,\n\t\t\t\tsavedRange: data && data.savedRange ? data.savedRange : null,\n\t\t\t\tsavedRangeToRemove: data && data.savedRangeToRemove ? data.savedRangeToRemove : null\n\t\t\t});\n\n\t\t\tif (savedSelection) {\n\t\t\t\tthis.sandbox.restoreSelection(savedSelection, true);\n\t\t\t}\n\n\t\t\t// Fix broken bold/italic/underline markup after saving an undo snapshot if need this\n\t\t\tdata && data.fixRichMarkup && this.fixRichMarkup();\n\t\t\tthis.clearBreakingRichMarkupCommands();\n\n\t\t\tthis.index = this.data.length - 1;\n\t\t},\n\t\t/**\n\t\t* Undo operation.\n\t\t*\n\t\t* @memberof CORE.UndoManager#\n\t\t*/\n\t\tundo: function() {\n\t\t\tif (this.isDirty) {\n\t\t\t\tthis.add();\n\t\t\t\tthis.clearFlags();\n\t\t\t}\n\n\t\t\tif (this.index <= 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.container.innerHTML = this.data[--this.index].html;\n\t\t\tthis.restoreSelection();\n\t\t\tthis.clearFlags();\n\t\t\tthis.clearBreakingRichMarkupCommands();\n\n\t\t\tthis.sandbox.fire('undo', {undoLevel: this.data[this.index]});\n\t\t},\n\t\t/**\n\t\t* Redo operation.\n\t\t*\n\t\t* @memberof CORE.UndoManager#\n\t\t*/\n\t\tredo: function() {\n\t\t\tif (this.index >= this.data.length - 1) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.container.innerHTML = this.data[++this.index].html;\n\t\t\tthis.restoreSelection();\n\t\t\tthis.clearFlags();\n\t\t\tthis.clearBreakingRichMarkupCommands();\n\n\t\t\tthis.sandbox.fire('redo', {undoLevel: this.data[this.index]});\n\t\t},\n\t\t/**\n\t\t* Check posibility of the undo/redo operation.\n\t\t*\n\t\t* @memberof CORE.UndoManager#\n\t\t*/\n\t\tcheckUndoRedoPosibility: function() {\n\t\t\tthis.sandbox.fire('undoRedoPosibility', {\n\t\t\t\tcanUndo: (this.isDirty || this.index > 0) ? true : false,\n\t\t\t\tcanRedo: (this.index < this.data.length - 1) ? true : false\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t* Remove data after current when new data is added.\n\t\t*\n\t\t* @memberof CORE.UndoManager#\n\t\t*/\n\t\tclearRedo: function() {\n\t\t\tthis.data.splice(this.index + 1);\n\t\t},\n\t\t/**\n\t\t* Clear flags.\n\t\t*\n\t\t* @memberof CORE.UndoManager#\n\t\t*/\n\t\tclearFlags: function() {\n\t\t\tthis.isTyping = false;\n\t\t\tthis.isDeleted = false;\n\t\t\tthis.isDirty = false;\n\t\t},\n\t\t/**\n\t\t* Remove the oldest item in data array if length of this array equal to data limit.\n\t\t*\n\t\t* @memberof CORE.UndoManager#\n\t\t*/\n\t\tcheckDataLimit: function() {\n\t\t\tif (this.data.length > this.limit) {\n\t\t\t\tthis.data.shift();\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t* Restore selection after undo/redo action.\n\t\t*\n\t\t* @memberof CORE.UndoManager#\n\t\t*/\n\t\trestoreSelection: function() {\n\t\t\tvar selection = this.sandbox.getSelection(),\n\t\t\t\tsavedSelection = this.data[this.index].savedSelection,\n\t\t\t\tsavedRange = this.data[this.index].savedRange,\n\t\t\t\tsavedRangeToRemove = this.data[this.index].savedRangeToRemove,\n\t\t\t\trange;\n\n\t\t\tsavedRangeToRemove && this.sandbox.restoreRange(savedRangeToRemove);\n\n\t\t\tif (savedSelection) {\n\t\t\t\tsavedSelection.restored = false;\n\t\t\t\tthis.sandbox.restoreSelection(savedSelection);\n\t\t\t}\n\n\t\t\tif (savedRange) {\n\t\t\t\trange = this.sandbox.restoreRange(savedRange);\n\t\t\t\tselection.removeAllRanges();\n\t\t\t\tselection.addRange(range);\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * @memberof CORE.UndoManager#\n\t\t */\n\t\tremoveAllEventHandlers: function() {\n\t\t\tthis.sandbox.unsubscribe({\n\t\t\t\teventType: 'keydown',\n\t\t\t\telement: this.container,\n\t\t\t\thandler: this.handleKeydown,\n\t\t\t});\n\n\t\t\tthis.sandbox.unsubscribe({\n\t\t\t\telement: this.container,\n\t\t\t\teventType: 'click',\n\t\t\t\thandler: this.handleNavigation\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t* Set breaking rich markup command.\n\t\t*\n\t\t* @memberof CORE.UndoManager#\n\t\t* @param {String} type - Type of the breaking command\n\t\t*/\n\t\tsetBreakingRichMarkupCommands: function(type) {\n\t\t\tif (type in this.breakingRichMarkupCommands) {\n\t\t\t\tif (this.breakingRichMarkupCommands.hasOwnProperty(type)) {\n\t\t\t\t\tthis.breakingRichMarkupCommands[type] = !this.breakingRichMarkupCommands[type];\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t* Clear breaking rich markup command.\n\t\t*\n\t\t* @memberof CORE.UndoManager#\n\t\t*/\n\t\tclearBreakingRichMarkupCommands: function() {\n\t\t\tfor (var type in this.breakingRichMarkupCommands) {\n\t\t\t\tif (this.breakingRichMarkupCommands.hasOwnProperty(type)) {\n\t\t\t\t\tthis.breakingRichMarkupCommands[type] = false;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t* Fix broken rich markup.\n\t\t*\n\t\t* @memberof CORE.UndoManager#\n\t\t*/\n\t\tfixRichMarkup: function() {\n\t\t\tfor (var type in this.breakingRichMarkupCommands) {\n\t\t\t\tif (this.breakingRichMarkupCommands.hasOwnProperty(type) && this.breakingRichMarkupCommands[type] === true) {\n\t\t\t\t\tthis.execCommand(type, false, null);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t* Exec command for rich markup.\n\t\t*\n\t\t* @memberof CORE.UndoManager#\n\t\t* @param {String} type - Type of the rich markup command\n\t\t*/\n\t\texecCommand: function(type) {\n\t\t\tvar doc = Utils.getCurrentDocument(this.sandbox.getOption('documentContainer'));\n\n\t\t\tdoc.execCommand(type, false, null);\n\t\t}\n\t};\n\n\texports.UndoManager = UndoManager;\n\n}( WEBSPELLCHECKER.CORE ));\n// domchangeslistener.js\r\n/**\r\n * @fileoverview of CORE dom changes listener.\r\n */\r\n\r\n(function( exports ) {\r\n\t'use strict';\r\n\r\n\t/**\r\n\t * Represents DOMChangesListener Module.\r\n\t *\r\n\t * @constructor\r\n\t * @alias CORE.DOMChangesListener\r\n\t * @param {String} moduleID\r\n\t * @param {CORE.Sandbox} sandbox\r\n\t */\r\n\tvar DOMChangesListener = function(moduleID, sandbox) {\r\n\t\t/**\r\n\t\t * Module name.\r\n\t\t *\r\n\t\t * @type {String}\r\n\t\t */\r\n\t\tthis.name = moduleID;\r\n\r\n\t\t/**\r\n\t\t * Reference to DOMChangesListener module sandbox.\r\n\t\t *\r\n\t\t * @type {CORE.Sandbox}\r\n\t\t */\r\n\t\tthis.sandbox = sandbox;\r\n\r\n\t\t/**\r\n\t\t * Throttling delay.\r\n\t\t *\r\n\t\t * @type {Number}\r\n\t\t */\r\n\t\tthis.delay = 1000;\r\n\r\n\t\t/**\r\n\t\t * Mutation observer.\r\n\t\t *\r\n\t\t * @type {Object}\r\n\t\t */\r\n\t\tthis.mutationObserver = null;\r\n\r\n\t\t/**\r\n\t\t * Object with options, specifies which DOM mutations should be reported.\r\n\t\t *\r\n\t\t * @type {Object}\r\n\t\t */\r\n\t\tthis.mutationOptions = {\r\n\t\t\tattributes: true,\r\n\t\t\tattributeOldValue: true,\r\n\t\t\tchildList: true,\r\n\t\t\tcharacterData: true,\r\n\t\t\tcharacterDataOldValue: false,\r\n\t\t\tsubtree: true\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Flag for detect throttle state.\r\n\t\t *\r\n\t\t * @type {Boolean}\r\n\t\t */\r\n\t\tthis.inThrottle = false;\r\n\t};\r\n\r\n\tDOMChangesListener.prototype = {\r\n\t\t/**\r\n\t\t * Called after each registration in core.\r\n\t\t *\r\n\t\t * @memberof CORE.DOMChangesListener#\r\n\t\t */\r\n\t\tinit: function() {\r\n\t\t\t// If module is started or if browser does not support MutationObserver\r\n\t\t\t// we do not need init this module\r\n\t\t\tif ( !this.sandbox.getOption('isMutationObserver') ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.mutationObserver = new window.MutationObserver( this.handleMutations.bind(this) );\r\n\t\t\tthis.startMutationObserver();\r\n\r\n\t\t\tthis.sandbox.subscribe('lockMutationsListener', function (data) {\r\n\t\t\t\tthis.lockMutationsListener(data);\r\n\t\t\t}, this);\r\n\t\t},\r\n\t\t/**\r\n\t\t* Lock mutations listener.\r\n\t\t*\r\n\t\t* @memberof CORE.DOMChangesListener#\r\n\t\t* @param {Object} data - Data from event\r\n\t\t*\r\n\t\t*/\r\n\t\tlockMutationsListener: function (data) {\r\n\t\t\tif (data.lock) {\r\n\t\t\t\tthis.stopMutationObserver();\r\n\t\t\t} else {\r\n\t\t\t\tthis.startMutationObserver();\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t* Start mutation observer.\r\n\t\t*\r\n\t\t* @memberof CORE.DOMChangesListener#\r\n\t\t*\r\n\t\t*/\r\n\t\tstartMutationObserver: function () {\r\n\t\t\tif (this.mutationObserver) {\r\n\t\t\t\tthis.mutationObserver.observe(document.getElementsByTagName('body')[0], this.mutationOptions);\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t* Stop mutation observer.\r\n\t\t*\r\n\t\t* @memberof CORE.DOMChangesListener#\r\n\t\t*\r\n\t\t*/\r\n\t\tstopMutationObserver: function () {\r\n\t\t\tif (this.mutationObserver) {\r\n\t\t\t\tthis.mutationObserver.disconnect();\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t* DOM mutation handler.\r\n\t\t*\r\n\t\t* @memberof CORE.DOMChangesListener#\r\n\t\t* @param {Array} mutations - Array of native mutations\r\n\t\t*/\r\n\t\thandleMutations: function(mutations) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif (!this.inThrottle) {\r\n\t\t\t\tthis.inThrottle = true;\r\n\r\n\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\tself.inThrottle = false;\r\n\t\t\t\t\tself.sandbox.fire('periodicalChecking');\r\n\t\t\t\t}, this.delay);\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t * DOM changes listener destructor.\r\n\t\t *\r\n\t\t * @memberof CORE.DOMChangesListener#\r\n\t\t */\r\n\t\tdestroy: function() {\r\n\t\t\tthis.stopMutationObserver();\r\n\t\t\tthis.mutationObserver = null;\r\n\t\t}\r\n\t};\r\n\r\n\texports.DOMChangesListener = DOMChangesListener;\r\n\r\n}( WEBSPELLCHECKER.CORE ));\n// sentencescollector.js\n/**\n * @fileoverview of Grammar sentences collector module.\n */\n\n(function( exports ) {\n\t\"use strict\";\n\n\t/**\n\t* SentencesCollector Module constructor.\n\t* @constructor\n\t* @alias CORE.SentencesCollector\n\t* @param {String} moduleID\n\t* @param {CORE.Sandbox} sandbox\n\t*/\n\tvar SentencesCollector = function( moduleID, sandbox ) {\n\t\t/**\n\t\t* module name\n\t\t* @type {String}\n\t\t*/\n\t\tthis.name = moduleID;\n\n\t\t/**\n\t\t* reference to SentencesCollector module sandbox\n\t\t* @type {CORE.Sandbox}\n\t\t*/\n\t\tthis.sandbox = sandbox;\n\t};\n\n\tSentencesCollector.prototype = {\n\t\t/**\n\t\t* Called after each registration in core\n\t\t* @memberof CORE.SentencesCollector#\n\t\t*/\n\t\tinit: function() {\n\t\t\t// @TODO: causes some problems when we fire 'empty' events - when there is no need to fire grammar check\n\t\t\tthis.sandbox.subscribe('startGrammarCheck', function(data) {\n\t\t\t\tthis.startGrammarCheck();\n\t\t\t}, this);\n\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'keydown',\n\t\t\t\telement: this.sandbox.getOption('container'),\n\t\t\t\thandler:  function(event) {\n\t\t\t\t\tvar enableGrammar = this.sandbox.getOption('enableGrammar');\t//@TODO tmp solution\n\n\t\t\t\t\tif(enableGrammar) {\n\t\t\t\t\t\tthis.handleKeydown(event);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe('collectSentences', function(data) {\n\t\t\t\tvar enableGrammar = this.sandbox.getOption('enableGrammar');\t//@TODO tmp solution\n\n\t\t\t\tif(enableGrammar) {\n\t\t\t\t\tthis.findSentences(data.source);\n\t\t\t\t}\n\t\t\t}, this);\n\t\t},\n\n\t\t/**\n\t\t* @example\n\t\t* // return sentences collection without phrases in elements from ignoreElementsRegex and ignoreGrammarElementsRegex option\n\t\t* range = this.sandbox.createRange();\n\t\t* range.selectNodeContents(document.getElementById('containerID'));\n\t\t* this.findSentences(range.toString());\n\t\t* @example\n\t\t* // return sentences collection without markuped grammar phrases\n\t\t* range = this.sandbox.createRange();\n\t\t* range.selectNodeContents(document.getElementById('containerID'));\n\t\t* this.findSentences(range);\n\t\t*\n\t\t* @memberof CORE.SentencesCollector#\n\t\t* @param {String|CORE.RangeCreator.Range} source - source from what we will collect our sentences\n\t\t* @returns {Array.<String>} - Sentences Collection\n\t\t* @fires CORE.Communication.sentencesCollected\n\t\t*/\n\t\tfindSentences: function( source ) {\n\t\t\tvar sentenceCollection,\n\t\t\t\tnewSentences,\n\t\t\t\tself = this;\n\n\t\t\tif( this.sandbox.Utils.is( source, 'String' ) ) {\n\t\t\t\tsentenceCollection = this.collectSentencesFromString(source);\n\t\t\t}\n\n\t\t\tif( this.sandbox.Utils.is( source, 'Object' ) ) {\n\t\t\t\tsentenceCollection = this.collectSentencesInRange(source);\n\t\t\t}\n\n\t\t\tthis.sandbox.fire('sentencesCollected', { sentencesCollection: sentenceCollection });\n\n\t\t\treturn newSentences;\n\t\t},\n\n\t\t/**\n\t\t* @memberof CORE.SentencesCollector#\n\t\t* @param {CORE.RangeCreator.Range} range - RangeObject\n\t\t* @returns {Array.<String>} - Sentences Collection\n\t\t*/\n\t\tcollectSentencesInRange: function(range) {\n\t\t\tvar rangeString = this.createStringForGrammarCheck( range.commonAncestorContainer() );\n\n\t\t\treturn this.collectSentencesFromString(rangeString);\n\t\t},\n\n\t\t/**\n\t\t* @memberof CORE.SentencesCollector#\n\t\t* @returns {String} - String collected from node without Grammar elements\n\t\t*/\n\t\tcreateStringForGrammarCheck: function(rootNode) {\n\t\t\tvar UILib = this.sandbox.UILib,\n\t\t\t\tresultText = '',\n\t\t\t\tqueue = [rootNode],\n\t\t\t\tnode = queue.shift(),\n\t\t\t\tieSeparator = this.sandbox.getRegExp('ieSeparator'),\n\t\t\t\tblockElementsRegex = this.sandbox.getRegExp('blockElementsRegex'),\n\t\t\t\tproblemPhraseNode = this.sandbox.getOption('problem_grammar_node'),\n\t\t\t\tproblemDataAttrName = this.sandbox.getOption('problem_grammar_data_attribute'),\n\t\t\t\tignoreElementsRegex = this.sandbox.getRegExp('ignoreElementsRegex'),\n\t\t\t\tignoreGrammarElementsRegex = this.sandbox.getRegExp('ignoreGrammarElementsRegex'),\n\t\t\t\tbookmarkClassRegex = new RegExp(/*REG_REPLACE*/\"(^|\\\\s)rangySelectionBoundary(\\\\s|$)\"),\n\t\t\t\tsentenceEndChars = this.sandbox.getRegExp('sentenceEndCharsGrammar'),\n\t\t\t\tnonWhiteSpaceExtended = this.sandbox.getRegExp('nonWhiteSpaceExtended'),\n\t\t\t\tmarker = String.fromCharCode(8204); // 8204 - space without width\n\n\t\t\twhile (node) {\n\t\t\t\tswitch (node.nodeType) {\n\t\t\t\t\tcase 3 :\n\t\t\t\t\t\tresultText += node.nodeValue;\n\t\t\t\t\tbreak;\n\t\t\t\t\tcase 1 :\n\t\t\t\t\t\tif (node.nodeName.toLowerCase() == problemPhraseNode.toLowerCase() && node.getAttribute(problemDataAttrName) && node.innerHTML) {\n\t\t\t\t\t\t\tresultText += marker + node.getAttribute(problemDataAttrName) + marker;\n\t\t\t\t\t\t} else if ( !bookmarkClassRegex.test(UILib.attr(node, 'className')) &&\n\t\t\t\t\t\t\t !ignoreElementsRegex.match(node.nodeName) &&\n\t\t\t\t\t\t\t // TODO fix bug WP-167 Grammar breaks table cells\n\t\t\t\t\t\t\t !ignoreGrammarElementsRegex.match(node.nodeName) ) {\n\t\t\t\t\t\t\tfor(var i = 0; i < node.childNodes.length; i++) {\n\t\t\t\t\t\t\t\tqueue.splice(i, 0, node.childNodes[i]);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( blockElementsRegex.match(node.nodeName) ) {\n\t\t\t\t\t\t\t\t// Add \\u2029 after block element\n\t\t\t\t\t\t\t\tif (queue.length > node.childNodes.length) {\n\t\t\t\t\t\t\t\t\tqueue.splice(i, 0, document.createTextNode('\\u2029'));\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Add \\u2029 or space before block element if need so\n\t\t\t\t\t\t\t\tif ( resultText.length > 0 && sentenceEndChars.search(resultText) === -1 && nonWhiteSpaceExtended.search(resultText) !== -1 ) {\n\t\t\t\t\t\t\t\t\tqueue.splice(0, 0, document.createTextNode('\\u2029'));\n\t\t\t\t\t\t\t\t} else if (resultText.length > 0 && resultText[resultText.length - 1] != ' ') {\n\t\t\t\t\t\t\t\t\tqueue.splice(0, 0, document.createTextNode(' '));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tnode = queue.shift();\n\t\t\t}\n\n\t\t\tresultText = this.sandbox.removeSpecialCharacters(resultText);\n\t\t\tresultText = ieSeparator.replace(resultText, ' ');\n\n\t\t\treturn resultText;\n\t\t},\n\n\t\t/**\n\t\t* @memberof CORE.SentencesCollector#\n\t\t* @param {string} text - String with some text\n\t\t* @returns {Object} - Sentences Collection\n\t\t*/\n\t\tcollectSentencesFromString: function( text ) {\n\t\t\tvar Utils = this.sandbox.Utils,\n\t\t\t\tself = this;\n\n\t\t\ttext = text.source || text;\n\n\t\t\tfunction sentence( text ) {\n\t\t\t\tvar sentences = [],\n\t\t\t\t\tsentenceFull = [],\n\t\t\t\t\tincrease = 0,\n\t\t\t\t\tlastAddedIndex = 0,\n\t\t\t\t\tsentence = '',\n\t\t\t\t\tmarker = String.fromCharCode(8204),\n\t\t\t\t\twithMarker = false;\n\n\t\t\t\t// look forward to check space existance after dot(one or more)\n\t\t\t\t// \\xA0 - 160 char code which represents non breaking space in IE\n\t\t\t\tvar findStopChars = /*REG_REPLACE*//[.!?\\u2029](?=[\\s\\xA0]?)/gm; findStopChars.lastIndex = 0;\n\n\t\t\t\t// remove waste spaces\n\t\t\t\tfunction trimToOne( txt ) {\n\t\t\t\t\tvar space = /*REG_REPLACE*//[\\t|\\v|\\f|\\r]+/g;\n\n\t\t\t\t\tspace.lastIndex = 0;\n\n\t\t\t\t\treturn txt.replace( space, \" \" );\n\t\t\t\t}\n\n\t\t\t\t// Add found sentence to the array of the sentences\n\t\t\t\tfunction addSentenceToArray(from, to, text) {\n\t\t\t\t\tsentence = text.substring( from, to );\n\t\t\t\t\tsentence = sentence.trim();\n\t\t\t\t\twithMarker = sentence.includes(marker);\n\t\t\t\t\tsentence = sentence.replace(/\\u200c/g, ''); // \\u200c - 8204\n\t\t\t\t\tsentence.length && sentences.push({\n\t\t\t\t\t\tsentence: sentence,\n\t\t\t\t\t\tmarkuped: withMarker\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// Create a range of characters left and right by 5 characters\n\t\t\t\tfunction Range( position, text ) {\n\t\t\t\t\tthis.position = position;\n\t\t\t\t\tthis.offset = 5;\n\t\t\t\t\tthis.left = text.substr( this.position - 5, 5 );\n\t\t\t\t\tthis.right = text.substr( this.position + 1, 6 );\n\t\t\t\t\tthis.toString = this.left.concat( text.charAt(this.position), this.right );\n\t\t\t\t}\n\n\t\t\t\ttext = text.trim();\n\t\t\t\ttext = trimToOne( text );\n\n\t\t\t\t/*\n\t\t\t\t * #50982 - US on Grammar multilanguage support\n\t\t\t\t * also check this unicode sheet here: http://www.fileformat.info/info/unicode/category/Lu/list.htm\n\t\t\t\t * E.g.: in case when we will need to specify all uncicode ranges for uppercase letters in order to make\n\t\t\t\t * this regex correct for all languages: /[A-ZÐ-Ð¯]/g\n\t\t\t\t * And so on for other regex here\n\t\t\t\t */\n\t\t\t\t// find the sentences\n\t\t\t\tfunction replacer( char, pos, text ) {\n\n\t\t\t\t\t// If char is \\u2029 we have been found sentence\n\t\t\t\t\tif (char.charCodeAt(0) === 8233) {\n\t\t\t\t\t\taddSentenceToArray(increase, pos, text);\n\t\t\t\t\t\tincrease = lastAddedIndex = pos + 1;\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Create range to left and range to right for 5 letters;\n\t\t\t\t\tvar range = new Range( pos, text );\n\n\t\t\t\t\t// If left part of range contains a digit or spaces before a dot or uppercase letters - skip sentence checking for this step\n\t\t\t\t\t/*\n\t\t\t\t\t\t/\\d/g\n\t\t\t\t\t\t- digits\n\t\t\t\t\t\t- 'a7y'\n\n\t\t\t\t\t\t/[\\n|\\t|\\v|\\f|\\r]+/g\n\t\t\t\t\t\t- matches anything that is enclosed in the brackets 0 or more times\n\t\t\t\t\t\t- '\\n', '\\t'\n\n\t\t\t\t\t\tUtils.hasUppercaseLetter()\n\t\t\t\t\t\t- returns true if string has uppercase letter\n\t\t\t\t\t\t- 'theBm'\n\t\t\t\t\t*/\n\t\t\t\t\tif ( /*REG_REPLACE*//\\d/g.test(range.left) || /*REG_REPLACE*//[\\n|\\t|\\v|\\f|\\r]+/g.test(range.left) || Utils.hasUppercaseLetter(range.left) ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t/*\n\t\t\t\t\t\tUtils.startsWithSpaceAndUppercaseLetter()\n\t\t\t\t\t\t- returns true if string starts with space and then after space follow uppercase letter\n\t\t\t\t\t\t- ' Z', '   Ð¯'\n\t\t\t\t\t*/\n\t\t\t\t\tif ( range.position + 1 === text.length || Utils.startsWithSpaceAndUppercaseLetter(range.right) ) {\n\t\t\t\t\t\t// We have been found sentence\n\t\t\t\t\t\taddSentenceToArray(increase, range.position + 1, text);\n\t\t\t\t\t\tincrease = lastAddedIndex = range.position + 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Finding sentences in text\n\t\t\t\ttext.replace( findStopChars, replacer );\n\n\t\t\t\t// Fix bug WP-953 and same problem for other cases\n\t\t\t\t// Grammar doesn't mark problems after change language\n\t\t\t\taddSentenceToArray(lastAddedIndex, text.length, text);\n\n\t\t\t\treturn sentences;\n\t\t\t};\n\n\t\t\treturn sentence( text );\n\t\t},\n\n\t\t/**\n\t\t* @memberof CORE.SentencesCollector#\n\t\t* @param {Object} event - HTML DOM Event\n\t\t*/\n\t\thandleKeydown: function( event ) {\n\t\t\tvar self = this;\n\n\t\t\tif (event.keyCode == 32 || event.keyCode == 13 || event.charCode == 32 || event.charCode == 13) {\n\t\t\t\tself.sandbox.addDeferredFunction('collectSentencesAfterKeypress', {\n\t\t\t\t\tsingle: true,\n\t\t\t\t\tdelay: 0,\n\t\t\t\t\tdeferredFunction: function() {\n\t\t\t\t\t\tself.startGrammarCheck();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tself.sandbox.addDeferredFunction('collectSentencesAfter4Sec', {\n\t\t\t\tsingle: true,\n\t\t\t\tdelay: 4000,\n\t\t\t\tdeferredFunction: function() {\n\t\t\t\t\tself.startGrammarCheck();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t// Expand the range of the entire container and takes all text from container\n\t\tstartGrammarCheck: function() {\n\t\t\tvar range = this.sandbox.createRange(),\n\t\t\t\tcontainer = this.sandbox.getOption('container');\n\n\t\t\trange.selectNodeContents(container);\n\n\t\t\t// this.sandbox.fire('collectSentences', { source: range.toString() });\n\t\t\t// @TODO: may be waste usage of ranges(check for previous solution)\n\t\t\tthis.sandbox.fire('collectSentences', { source: range });\n\t\t}\n\t};\n\n\texports.SentencesCollector = SentencesCollector;\n}( WEBSPELLCHECKER.CORE ));\n// dictionarymanager.js\n/**\n * @fileoverview of CORE dictionary manager.\n */\n\n(function( exports ) {\n\t'use strict';\n\tvar UILib;\n\t// make sure that we declaring GrammarDictionaryManager only once\n\tif(exports.GrammarDictionaryManager) {\n\t\treturn;\n\t}\n\n\t/**\n\t * Represents GrammarDictionaryManager Module.\n\t *\n\t * @constructor\n\t * @alias CORE.GrammarDictionaryManager\n\t * @param {String} moduleID\n\t * @param {CORE.Sandbox} sandbox\n\t */\n\tvar GrammarDictionaryManager = function(moduleID, sandbox) {\n\t\t/**\n\t\t * Module name.\n\t\t *\n\t\t * @type {String}\n\t\t*/\n\t\tthis.name = moduleID;\n\n\t\t/**\n\t\t * Reference to GrammarDictionaryManager module sandbox.\n\t\t *\n\t\t * @type {CORE.Sandbox}\n\t\t */\n\t\tthis.sandbox = sandbox;\n\n\t\tUILib = this.sandbox.UILib;\n\t};\n\n\tGrammarDictionaryManager.prototype = {\n\t\t/**\n\t\t * Called after each registration in core.\n\t\t *\n\t\t * @memberof CORE.GrammarDictionaryManager#\n\t\t */\n\t\tinit: function() {\n\t\t\tvar self = this;\n\n\t\t\tthis.sandbox.subscribe('sentencesCollected, problemsCollected', function(data) {\n\t\t\t\tif (data.sentencesCollection) {\n\t\t\t\t\tthis.sentencesCollectedHandler(data.sentencesCollection);\n\t\t\t\t}\n\t\t\t}, this);\n\n\t\t\tthis.sandbox.subscribe('getGrammarSuggestionsList', function(event) {\n\t\t\t\tvar rule = event.rule,\n\t\t\t\t\tproblemNode = event.problemNode,\n\t\t\t\t\tphrase = event.phrase,\n\t\t\t\t\tgrammarAttrName = self.sandbox.getOption('problem_grammar_data_attribute'),\n\t\t\t\t\tgrammarAttrRuleName = self.sandbox.getOption('problem_grammar_data_attribute_rule'),\n\t\t\t\t\tlang = event.lang || self.sandbox.getOption('lang'),\n\t\t\t\t\tsuggestionList;\n\n\t\t\t\tif(problemNode) {\n\t\t\t\t\trule = rule || UILib.attr(problemNode, grammarAttrRuleName);\n\t\t\t\t\tphrase = phrase || UILib.attr(problemNode, grammarAttrName);\n\t\t\t\t}\n\n\t\t\t\tsuggestionList = this.getSuggestionsListHandler(phrase, rule, lang).suggestionList;\n\n\t\t\t\tevent.setReturnedData({\n\t\t\t\t\tsuggestionList: suggestionList,\n\t\t\t\t\tproblemDescription: GrammarDictionaryManager.Dictionary.getProblemDescription(phrase, rule, lang)\n\t\t\t\t});\n\t\t\t}, this);\n\n\t\t\t// Creating cache with sentences and problems\n\t\t\tthis.cache = this.createCacheSentences();\n\n\t\t\tthis.sandbox.subscribe('updateSentencesCache', function (data) {\n\t\t\t\tthis.handleCacheUpdate(data);\n\t\t\t}, this);\n\n\t\t\tthis.sandbox.subscribe('enableGrammarChanged', function (data) {\n\t\t\t\tif (data.state) {\n\t\t\t\t\t// we need to clear the cache in order to markup grammar problems again\n\t\t\t\t\t// after Grammar state changed from 'off' to 'on'\n\t\t\t\t\tthis.sandbox.fire('updateSentencesCache', { phrase: null });\n\t\t\t\t}\n\t\t\t}, this);\n\t\t},\n\t\t/**\n\t\t * Subscribe function for 'sentencesCollected' event\n\t\t *\n\t\t * @memberof CORE.GrammarDictionaryManager#\n\t\t * @param {Array} sentencesCollection \t- Colection of sentences\n\t\t */\n\t\tsentencesCollectedHandler: function(sentencesCollection) {\n\t\t\tvar lang = this.sandbox.getOption('lang'),\n\t\t\t\tnewSentences;\n\n\t\t\tif(sentencesCollection.length > 0) {\n\t\t\t\tnewSentences = this.cache.update(sentencesCollection);\n\t\t\t\tthis.getPhraseInfo( newSentences, lang );\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Subscribe function for 'getGrammarSuggestionsList' event\n\t\t *\n\t\t * @param {String} phrase \t- Phrase.\n\t\t * @param {String} rule \t- Rule.\n\t\t * @param {String} lang \t- Dictionary language.\n\t\t * @memberof CORE.GrammarDictionaryManager#\n\t\t */\n\t\tgetSuggestionsListHandler: function (phrase, rule, lang) {\n\t\t\tvar phraseObject = GrammarDictionaryManager.Dictionary.getPhrase(phrase, rule, lang),\n\t\t\t\tresult = { suggestionList: phraseObject ? phraseObject.suggestions : [] };\n\n\t\t\tthis.sandbox.fire('suggestionListSend', result);\n\t\t\treturn result;\n\t\t},\n\n\t\t/**\n\t\t * @memberof CORE.GrammarDictionaryManager#\n\t\t * @param {Array} unknownSentences \t- Array of unknown sentences.\n\t\t * @param {String} lang \t\t\t- Sentences language.\n\t\t *\n\t\t * @fires CORE.Communication#problemSentencesFound\n\t\t */\n\t\t// here we assume that all words are unknown cuz we compared them in sentencecollector.js already (see diffArray method)\n\t\tgetPhraseInfo: function(unknownSentences, lang) {\n\t\t\tvar self = this,\n\t\t\t\tgrammarLangList = this.sandbox.getOption('grammarLangList'),\n\t\t\t\tdictionary = GrammarDictionaryManager.Dictionary;\n\n\t\t\t// prevent sending requests to the server for unsupported languages\n\t\t\tif (!grammarLangList) {\n\t\t\t\tconsole.warn('Webspellchecker: Grammarcheck lang list not defined.');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!(lang in grammarLangList.ltr) && !(lang in grammarLangList.rtl)) {\n\t\t\t\tthis.sandbox.console.warn('Specified \"' + lang + '\" language is not supported for your Customer ID. More details at http://wiki.webspellchecker.net or contact support@webspellchecker.net');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.sandbox.addDeferredFunction('getPhraseInfo', {\n\t\t\t\tdelay: 500,\n\t\t\t\tcollection: unknownSentences,\n\t\t\t\tpartialItemsCount: 2, // two sentences per iteration\n\t\t\t\tonUnregister: function () {\n\t\t\t\t\tvar currentTask = this;\n\n\t\t\t\t\t// Go through all sentences in collection and remove it from cache\n\t\t\t\t\t// Fix cached sentences without right information about grammar errors\n\t\t\t\t\tself.sandbox.removeSentencesFromCache(currentTask.collection);\n\t\t\t\t},\n\t\t\t\tdeferredFunction: function(sentences) {\n\t\t\t\t\tvar currentTask = this;\n\n\t\t\t\t\tself.sandbox.fire('remoteAction', {\n\t\t\t\t\t\tactionMethod: 'grammarCheck',\n\t\t\t\t\t\tlang: lang,\n\t\t\t\t\t\tsentences: JSON.stringify(sentences),\n\t\t\t\t\t\tonSuccess: function(data) {\n\t\t\t\t\t\t\tvar foundGrammarErrors = [];\n\n\t\t\t\t\t\t\tfor (var i = 0; i < data.length; i++) {\n\t\t\t\t\t\t\t\tvar item = data[i],\n\t\t\t\t\t\t\t\t\tmatches = [];\n\n\t\t\t\t\t\t\t\tfor (var j = 0; j < item.matches.length; j++) {\n\t\t\t\t\t\t\t\t\tvar match = item.matches[j];\n\n\t\t\t\t\t\t\t\t\tmatches.push(match);\n\t\t\t\t\t\t\t\t\tmatch.phrase = item.sentence.substring(match.offset, match.offset + match.length);\n\t\t\t\t\t\t\t\t\tdictionary.addPhrase( match, lang );\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tself.sandbox.fire('updateSentencesCache', {\n\t\t\t\t\t\t\t\t\tphrasesInfo: {\n\t\t\t\t\t\t\t\t\t\tsentence: item.sentence,\n\t\t\t\t\t\t\t\t\t\tphrases: matches\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tif (matches.length) {\n\t\t\t\t\t\t\t\t\tfoundGrammarErrors.push({\n\t\t\t\t\t\t\t\t\t\tsentence: item.sentence,\n\t\t\t\t\t\t\t\t\t\tphrases: matches\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tself.sandbox.fireInAllApps('problemSentencesFound', { sentences: foundGrammarErrors, lang: lang });\n\t\t\t\t\t\t\tself.sandbox.fireInAllApps('problemsFound', { problems: foundGrammarErrors, lang: lang, problemType: 'grammar' });\n\n\t\t\t\t\t\t\t// Reset (set to zero) 'numberOfFailedRequest' for successful request\n\t\t\t\t\t\t\tself.sandbox.setOption('numberOfFailedRequest', 0);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonError: function(e) {\n\t\t\t\t\t\t\tvar numberOfFailedRequest = self.sandbox.getOption('numberOfFailedRequest');\n\n\t\t\t\t\t\t\tself.sandbox.setOption('numberOfFailedRequest', ++numberOfFailedRequest);\n\n\t\t\t\t\t\t\tif (numberOfFailedRequest > 4) {\n\t\t\t\t\t\t\t\tself.sandbox.setPaused(true);\n\t\t\t\t\t\t\t\tself.sandbox.removeAllDeferredFunctions();\n\n\t\t\t\t\t\t\t\t// Go through all sentences in collection and remove it from cache\n\t\t\t\t\t\t\t\t// Fix cached sentences without right information about grammar errors\n\t\t\t\t\t\t\t\tself.sandbox.removeSentencesFromCache(sentences);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Re create request if 'numberOfFailedRequest' < 5\n\t\t\t\t\t\t\t\tself.getPhraseInfo(sentences, lang);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * @memberof CORE.GrammarDictionaryManager#\n\t\t *\n\t\t * @param {String} phrase - Phrase.\n\t\t * @param {String} phrase - Rule.\n\t\t * @param {String} lang - Dictionary language.\n\t\t *\n\t\t * @returns {object} - Phrase from CORE.GrammarDictionaryManager.Dictionary.\n\t\t */\n\t\tgetPhraseFromDictionary: function(phrase, rule, lang) {\n\t\t\tvar dictionary = GrammarDictionaryManager.Dictionary;\n\n\t\t\treturn dictionary.getPhrase(phrase, rule, lang);\n\t\t},\n\t\t/**\n\t\t * Grammar cache update handler\n\t\t *\n\t\t * @memberof CORE.GrammarDictionaryManager#\n\t\t * \n\t\t * @param {Object} data - Data from event\n\t\t */\n\t\thandleCacheUpdate: function(data) {\n\t\t\tvar sentence = data.sentence,\n\t\t\t\tphrase = data.phrase,\n\t\t\t\tphrasesInfo = data.phrasesInfo;\n\n\t\t\tif (sentence) { // remove sentence from cache\n\t\t\t\tthis.cache.deleteSentence(sentence);\n\t\t\t} else if (phrase) { // remove sentences that does contain this phrase from cache\n\t\t\t\tthis.cache.deleteSentencesByPhrase(phrase);\n\t\t\t} else if (phrasesInfo) { // update current records with info on grammar phrases\n\t\t\t\tthis.cache.update(phrasesInfo.sentence, phrasesInfo.phrases);\n\t\t\t} else { // completely clear the cache\n\t\t\t\tthis.cache.clear();\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Create sentences cache for next manipulation\n\t\t * \n\t\t * @memberof CORE.GrammarDictionaryManager#\n\t\t */\n\t\tcreateCacheSentences: function() {\n\t\t\tvar self = this,\n\t\t\t\tsentencesStorage = {},\n\t\t\t\tkeyPrefix = 'sentence_';\n\n\t\t\treturn {\n\t\t\t\tadd: function(sentence) {\n\t\t\t\t\treturn sentencesStorage[keyPrefix + sentence] = {\n\t\t\t\t\t\tsentence: sentence,\n\t\t\t\t\t\tphrases: []\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tget: function(sentence) {\n\t\t\t\t\treturn sentencesStorage[keyPrefix + sentence];\n\t\t\t\t},\n\t\t\t\tdeleteSentence: function(sentence) {\n\t\t\t\t\tif (sentencesStorage[keyPrefix + sentence]) {\n\t\t\t\t\t\tdelete sentencesStorage[keyPrefix + sentence];\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdeleteSentencesByPhrase: function(phrase) {\n\t\t\t\t\tvar cachedData,\n\t\t\t\t\t\tphraseData;\n\n\t\t\t\t\tfor (var sentenceKey in sentencesStorage) {\n\t\t\t\t\t\tcachedData = sentencesStorage[sentenceKey];\n\n\t\t\t\t\t\tfor (var i = 0; i < cachedData.phrases.length; i++) {\n\t\t\t\t\t\t\tphraseData = cachedData.phrases[i];\n\n\t\t\t\t\t\t\tif (phraseData.phrase === phrase) {\n\t\t\t\t\t\t\t\tdelete sentencesStorage[sentenceKey];\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t/*\n\t\t\t\t * Will update current cache with new results.\n\t\t\t\t *\n\t\t\t\t * arguments: [Array.<String>]\n\t\t\t\t * If you will specify just an array of text sentences as the only argument then\n\t\t\t\t * method will merge incoming array with cached one.\n\t\t\t\t * E.g.: update(['This is first sentence.', 'The second one!'])\n\t\t\t\t *\n\t\t\t\t * * arguments: [String, Array.<Object>]\n\t\t\t\t * When you use this method with sentence text and phrases info on this sentence\n\t\t\t\t * then method will just update cached sentence (if so) with phrase info\n\t\t\t\t * E.g.: update('This is sentence that have grammar issues.', [{\n\t\t\t\t * \t\t\tphrase: \"have grammar\",\n\t\t\t\t * \t\t\tproblemId: \"436211712\",\n\t\t\t\t * \t\t\tsuggestions: [\"have the grammar\", \"have a grammar\", \"have an grammar\"]\n\t\t\t\t * \t\t }])\n\t\t\t\t */\n\t\t\t\tupdate: function() {\n\t\t\t\t\tvar type = Object.prototype.toString.call(arguments[0]).slice(8, -1).toLowerCase(),\n\t\t\t\t\t\tdictionary = exports.GrammarDictionaryManager.Dictionary,\n\t\t\t\t\t\tnewSentences = [];\n\n\t\t\t\t\tif (type === 'array') {\n\t\t\t\t\t\t// Compare incoming sentences with cached. Get new and return them. Remove waste outdated records\n\t\t\t\t\t\tvar incomingSentences = arguments[0];\n\t\t\t\t\t\tvar lang = self.sandbox.getOption('lang');\n\t\t\t\t\t\tvar problemsSentences = [];\n\n\t\t\t\t\t\tfor (var i = 0; i < incomingSentences.length; i++) {\n\t\t\t\t\t\t\tvar sentence = incomingSentences[i].sentence,\n\t\t\t\t\t\t\t\tmarkuped = incomingSentences[i].markuped;\n\n\t\t\t\t\t\t\tif (sentencesStorage[keyPrefix + sentence]) {\n\t\t\t\t\t\t\t\t// we already cached this sentence\n\t\t\t\t\t\t\t\tvar prefixedSentence = sentencesStorage[keyPrefix + sentence];\n\n\t\t\t\t\t\t\t\tprefixedSentence.stayAlive = true;\n\t\t\t\t\t\t\t\t!markuped && problemsSentences.push(prefixedSentence);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// it's new sentence. We need to cache it and add to new sentences array\n\t\t\t\t\t\t\t\tvar added = this.add(sentence);\n\n\t\t\t\t\t\t\t\tadded.stayAlive = true;\n\t\t\t\t\t\t\t\tnewSentences.push(sentence);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// get rid of same sentences in queue\n\t\t\t\t\t\tproblemsSentences = self.sandbox.Utils.ArrayUtils.arrayUnique(problemsSentences, function (a, b) {\n\t\t\t\t\t\t\treturn a.sentence === b.sentence;\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// fire markup for cached sentences that appears again in text\n\t\t\t\t\t\tself.sandbox.fireInAllApps('problemSentencesFound', { sentences: problemsSentences, lang: lang });\n\t\t\t\t\t\tself.sandbox.fireInAllApps('problemsFound', { problems: problemsSentences, lang: lang, problemType: 'grammar' });\n\n\t\t\t\t\t\t// remove waste cached sentences\n\t\t\t\t\t\tfor (var sentenceKey in sentencesStorage) {\n\t\t\t\t\t\t\tif (!sentencesStorage[sentenceKey].stayAlive) {\n\t\t\t\t\t\t\t\tdelete sentencesStorage[sentenceKey];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdelete sentencesStorage[sentenceKey].stayAlive;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn newSentences;\n\n\t\t\t\t\t} else if (type === 'string') {\n\t\t\t\t\t\t// Fill cached sentence record with phrases info\n\t\t\t\t\t\tvar sentence = arguments[0],\n\t\t\t\t\t\t\tphrases = arguments[1] || [];\n\n\t\t\t\t\t\tif (sentencesStorage[keyPrefix + sentence]) { // does cahced sentence record still persist in editor ?\n\t\t\t\t\t\t\tsentencesStorage[keyPrefix + sentence].phrases = phrases;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tisEmpty: function() {\n\t\t\t\t\treturn !!self.Utils.getKeys(sentencesStorage).length;\n\t\t\t\t},\n\t\t\t\tclear: function() {\n\t\t\t\t\tsentencesStorage = {};\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t};\n\n\t/**\n\t * Represents GrammarDictionaryManager.Dictionary Object.\n\t *\n\t * @constructor\n\t */\n\tGrammarDictionaryManager.Dictionary = GrammarDictionaryManager.Dictionary || (function() {\n\t\t// problemID isn't unique. It is id for type of grammar problem. So two different phrases can have the same problemID (same type of error).\n\t\t// So we separate the problemsStorage and phraseStorage to prevent duplicates\n\n\t\tvar problemsStorage = {}, // stores problemID and its description\n\t\t\tignoreStorage = {}, // stores information about ignoring phrases in instances\n\t\t\tphrasesStoragePrefix = 'phrase_';\n\n\t\t/**\n\t\t *\n\t\t * @param data It is data from server\n\t\t * @param lang\n\t\t * @returns {{id: number, phrase: (*|addToDictionary.phrase|CORE.GrammarDictionaryManager.Dictionary.addPhrase.phrase), suggestions: (*|CKEDITOR.plugins.proofrayt.suggestions|addToDictionary.suggestions|CORE.GrammarDictionaryManager.Dictionary.addPhrase.suggestions|Array), problemId: (*|CORE.GrammarDictionaryManager.Dictionary.addPhrase.problem_id)}}\n\t\t * @private\n\t\t */\n\t\tvar addToDictionary = function( data, lang ) {\n\t\t\tvar phrase = data.phrase,\n\t\t\t\tsuggestions = data.suggestions,\n\t\t\t\tproblemId = data.rule.id,\n\t\t\t\tproblemDescription = data.message;\n\n\t\t\t// @TODO: Maybe we do not need this check for LanguageTool.\n\t\t\t// @TODO: sometimes we have no suggestions but problem description only. This is how grammar engine works..\n\t\t\tif(!suggestions || suggestions.length === 0 || (suggestions.length === 1 && suggestions[0] == '')) {\n\t\t\t\tsuggestions = [];\n\t\t\t}\n\n\t\t\tproblemsStorage[lang] = problemsStorage[lang] || {};\n\t\t\tproblemsStorage[lang][problemId] = problemsStorage[lang][problemId] || {};\n\n\t\t\tproblemsStorage[lang][problemId][phrasesStoragePrefix + phrase] = {\n\t\t\t\tsuggestions: suggestions,\n\t\t\t\tproblemDescription: problemDescription\n\t\t\t};\n\n\t\t\treturn problemsStorage[lang][problemId][phrasesStoragePrefix + phrase];\n\t\t};\n\n\t\treturn {\n\t\t\taddPhrase: function() {\n\t\t\t\treturn addToDictionary.apply(this, arguments);\n\t\t\t},\n\n\t\t\tgetPhrase: function( phraseKey, problemId, lang ) {\n\t\t\t\treturn problemsStorage[lang] && problemsStorage[lang][problemId] && problemsStorage[lang][problemId][phrasesStoragePrefix + phraseKey];\n\t\t\t},\n\n\t\t\tgetProblemDescription: function(phraseKey, problemId, lang) {\n\t\t\t\treturn problemsStorage[lang] && problemsStorage[lang][problemId] && problemsStorage[lang][problemId][phrasesStoragePrefix + phraseKey] && problemsStorage[lang][problemId][phrasesStoragePrefix + phraseKey].problemDescription;\n\t\t\t},\n\n\t\t\teach: function(lang, callback) {\n\t\t\t\tif(typeof callback === 'function') {\n\t\t\t\t\tfor (var problemId in problemsStorage[lang]) {\n\t\t\t\t\t\tfor (var phraseKey in problemsStorage[lang][problemId]) {\n\t\t\t\t\t\t\tvar phrase = phraseKey.substring(phrasesStoragePrefix.length);\n\n\t\t\t\t\t\t\tcallback(problemsStorage[lang][problemId][phraseKey], phrase);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tclear: function() {\n\t\t\t\tproblemsStorage = {};\n\t\t\t},\n\n\t\t\tsetIgnoreInInstance: function(phraseKey, problemId, uid) {\n\t\t\t\tif (typeof uid !== 'undefined') {\n\t\t\t\t\tif (!ignoreStorage[uid]) {\n\t\t\t\t\t\tignoreStorage[uid] = {};\n\t\t\t\t\t}\n\n\t\t\t\t\tignoreStorage[uid] = ignoreStorage[uid] || {};\n\t\t\t\t\tignoreStorage[uid][problemId] = ignoreStorage[uid][problemId] || {};\n\n\t\t\t\t\tignoreStorage[uid][problemId][phrasesStoragePrefix + phraseKey] = true;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tisIgnoreInInstance: function(phraseKey, problemId, uid) {\n\t\t\t\tif (typeof uid !== 'undefined') {\n\t\t\t\t\treturn ignoreStorage[uid] && ignoreStorage[uid][problemId] && ignoreStorage[uid][problemId][phrasesStoragePrefix + phraseKey];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t})();\n\n\texports.GrammarDictionaryManager = GrammarDictionaryManager;\n}( WEBSPELLCHECKER.CORE ));\n// grammarphrasesfinder.js\n/**\n * @fileoverview of Grammar phrases finder module.\n */\n\n// @TODO: check wordsfinder.js for latest bug fixes and transfer them here\n\n(function( exports ) {\n\t'use strict';\n\n\t/**\n\t * Represents GrammarPhrasesFinder Module.\n\t *\n\t * @constructor\n\t * @alias CORE.GrammarPhrasesFinder\n\t * @param {String} moduleID\n\t * @param {CORE.Sandbox} sandbox\n\t */\n\tvar GrammarPhrasesFinder = function(moduleID, sandbox) {\n\t\t/**\n\t\t * Module name.\n\t\t *\n\t\t * @type {String}\n\t\t*/\n\t\tthis.name = moduleID;\n\n\t\t/**\n\t\t * Reference to GrammarPhrasesFinder module sandbox.\n\t\t *\n\t\t * @type {CORE.Sandbox}\n\t\t */\n\t\tthis.sandbox = sandbox;\n\t};\n\n\tGrammarPhrasesFinder.prototype = {\n\t\t/**\n\t\t * Called after each registration in core.\n\t\t *\n\t\t * @memberof CORE.GrammarPhrasesFinder#\n\t\t */\n\t\tinit: function() {\n\t\t\tthis.sandbox.subscribe('problemSentencesFound', function(data) {\n\t\t\t\tthis.processGrammarProblem(data.sentences, data.lang);\n\t\t\t}, this);\n\t\t},\n\t\t/**\n\t\t * Checks if problem sentences are present in the current instance and triggers Ranges search for each sentence.\n\t\t * This method can be called trough 'problemSentencesFound' event from another application.\n\t\t *\n\t\t * @memberof CORE.GrammarPhrasesFinder#\n\t\t * @param {Array<String>} sentences - Problem sentences collection\n\t\t * @param {String} lang \t\t\t- Language of problem sentences\n\t\t * @fires CORE.Communication.markupPhrase\n\t\t */\n\t\tprocessGrammarProblem: function(sentences, lang) {\n\t\t\tvar self = this,\n\t\t\t\tcurrent_lang = self.sandbox.getOption('lang'), // current instance language\n\t\t\t\tuid = self.sandbox.getOption('uid'),\n\t\t\t\tdictionary = exports.GrammarDictionaryManager.Dictionary;\n\n\t\t\t// this method can be called trough fireInAllApps event in sandbox method from another application\n\t\t\t// and another application may work with another language\n\t\t\tif (lang != current_lang) {\n\t\t\t\treturn false; // return false if problem phrases is for another language\n\t\t\t}\n\t\t\t// Check if sentences is in current instance\n\t\t\t// And phrases in sentences is not ignored\n\t\t\tvar sentencesInCurrentControl = [];\n\t\t\tfor (var i = 0; i < sentences.length; i++) {\n\t\t\t\tvar item = sentences[i],\n\t\t\t\t\tphrases = [];\n\n\t\t\t\tfor (var j = 0; j < item.phrases.length; j++) {\n\t\t\t\t\tvar match = item.phrases[j];\n\n\t\t\t\t\tif (!dictionary.isIgnoreInInstance(match.phrase, match.rule.id, uid) ) {\n\t\t\t\t\t\tphrases.push(match);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (phrases.length) {\n\t\t\t\t\tsentencesInCurrentControl.push({\n\t\t\t\t\t\tsentence: item.sentence,\n\t\t\t\t\t\tphrases: phrases\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (sentencesInCurrentControl.length !== 0) {\n\t\t\t\tself.sandbox.addDeferredFunction(\"findGrammarProblemRangesForMarkupForLang_\" + lang, {\n\t\t\t\t\tdelay: 100,\n\t\t\t\t\tcollection: sentencesInCurrentControl,\n\t\t\t\t\tdefferedFunctionArgs: [lang],\n\t\t\t\t\tpartialItemsCount: 1,\n\t\t\t\t\tdeferredFunction: function(sentences, lang) {\n\t\t\t\t\t\tvar savedSel,\n\t\t\t\t\t\t\tfocused = self.sandbox.isFocused(),\n\t\t\t\t\t\t\tdoc = self.sandbox.Utils.getCurrentDocument(self.sandbox.getOption('documentContainer'));\n\n\t\t\t\t\t\tif (focused) {\n\t\t\t\t\t\t\tsavedSel = self.sandbox.saveSelection();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar ranges = self.findPhraseRangesForMarkup(sentences);\n\t\t\t\t\t\tself.sandbox.fire('markupPhrase', { ranges: ranges, lang: lang }); //markupPhrase\n\n\t\t\t\t\t\tif (savedSel) {\n\t\t\t\t\t\t\tself.sandbox.restoreSelection(savedSel, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * !!!! ONLY one sentence must be processed in this method\n\t\t * because sort method for sorting ranges is very slow\n\t\t *\n\t\t * @memberof CORE.GrammarPhrasesFinder#\n\t\t * @param {Array<String>} sentences\t\t\t\t- Collection of sentences\n\t\t * @returns {Array<CORE.RangeCreator.Range>} \t- Collection of Ranges\n\t\t */\n\t\tfindPhraseRangesForMarkup: function(sentences) {\n\t\t\t// !!!! ONLY one sentences must be processed in this method\n\t\t\t// !!!! because sort method for sorting ranges is very slow\n\n\t\t\t// TODO: implement block processing\n\t\t\tvar range = this.sandbox.createRange(),\n\t\t\t\tcontainer = this.sandbox.getOption( 'container' ),\n\t\t\t\tfinder;\n\n\t\t\trange.selectNodeContents( container );\n\n\t\t\tfinder = new GrammarPhrasesFinder.Finder( this.sandbox );\n\n\t\t\tfinder.collectBlockInfo( range.commonAncestorContainer() );\n\n\t\t\tvar ranges = []; // ranges with phrases\n\t\t\tfor (var i = 0; i < sentences.length; i++) {\n\t\t\t\tif (!sentences[i].sentence.length) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tfinder.lastIndex = 0;\n\t\t\t\twhile(finder.findPhrases(sentences[i]) !== null) {\n\t\t\t\t\tranges = ranges.concat(finder.phraseRanges);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// return sorted ranges for back forward processing on page, this sort will solve problem with modified ranges\n\t\t\t// needed for phrases with same startContainer\n\t\t\treturn ranges.reverse();\n\t\t}\n\t};\n\n\t/**\n\t * Represents GrammarPhrasesFinder object.\n\t *\n\t * @constructor\n\t * @param {CORE.Sandbox} sandbox\n\t */\n\tGrammarPhrasesFinder.Finder = function(sandbox) {\n\n\t\tthis.newParts = { // TODO: rename\n\t\t\tgetPos: function(index) {\n\t\t\t\twhile(!this[index]) {\n\t\t\t\t\tindex--;\n\t\t\t\t}\n\t\t\t\treturn this[index];\n\t\t\t}\n\t\t};\n\n\t\tthis.foundedProblems = {\n\t\t\tprevious: 0,\n\t\t\tgetPreviousProblemsCount: function (index) {\n\t\t\t\twhile (!this[index] && index > 0) {\n\t\t\t\t\tindex--;\n\t\t\t\t}\n\n\t\t\t\treturn this[index] || 0;\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Text model of Node\n\t\t *\n\t\t * @type {String}\n\t\t */\n\t\tthis.resultText = '';\n\n\t\t/**\n\t\t * Latest phrase index in [resultText]{@link CORE.GrammarPhrasesFinder.Finder#resultText}\n\t\t *\n\t\t * @type {Number}\n\t\t */\n\t\tthis.lastIndex = 0; // last found index TODO: rename\n\n\t\t/**\n\t\t * Latest found phrase range\n\t\t *\n\t\t * @type {CORE.RangeCreator.Range}\n\t\t */\n\t\tthis.phraseRange = null;\n\n\t\t/**\n\t\t * Phrase index between founded problems\n\t\t *\n\t\t * @type {Number}\n\t\t */\n\t\tthis.phraseIndex = 0;\n\n\t\tthis.reset = function() {\n\t\t\tthis.resultText = '';\n\t\t\tthis.lastIndex = 0;\n\t\t\tthis.phraseIndex = 0;\n\t\t\tthis.phraseRange = null;\n\n\t\t\tfor(var key in this.newParts) {\n\t\t\t\tif(this.newParts.hasOwnProperty(key) && key !== 'getPos') {\n\t\t\t\t\tdelete this.newParts[key];\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Collects string and additional information from specific Node.\n\t\t * Provides custom models {newParts} and {resultText} for searching phrases in document.\n\t\t *\n\t\t * @param {Node} block\n\t\t */\n\t\tthis.collectBlockInfo = function(block) {\n\t\t\tvar queue = [{ el: block, editable: sandbox.getOption('isProofreadInDialogActive') ? true : block.isContentEditable }],\n\t\t\t\tnode = queue.shift(),\n\t\t\t\tlang = sandbox.getOption('lang'),\n\t\t\t\tlanguagesMap = sandbox.getOption('languagesMap'),\n\t\t\t\tlanguageAttributeName = sandbox.getOption('languageAttributeName'),\n\t\t\t\tlanguageNodeName = sandbox.getOption('languageNodeName'),\n\t\t\t\tself = this,\n\t\t\t\tdifferentLanguage;\n\n\t\t\tvar blockElementsRegex = sandbox.getRegExp('blockElementsRegex'),\n\t\t\t\tignoreElementsRegex = sandbox.getRegExp('ignoreElementsRegex'),\n\t\t\t\tignoreGrammarElementsRegex = sandbox.getRegExp('ignoreGrammarElementsRegex'),\n\t\t\t\tieSeparator = sandbox.getRegExp('ieSeparator'),\n\t\t\t\tproblemPhraseNode = sandbox.getOption('problem_grammar_node'),\n\t\t\t\tproblemDataAttrName = sandbox.getOption('problem_grammar_data_attribute'),\n\t\t\t\tbookmarkClassRegex = /*REG_REPLACE*/new RegExp(\"(^|\\\\s)rangySelectionBoundary(\\\\s|$)\"),\n\t\t\t\tsentenceEndChars = sandbox.getRegExp('sentenceEndCharsGrammar'),\n\t\t\t\tnonWhiteSpaceExtended = sandbox.getRegExp('nonWhiteSpaceExtended'),\n\t\t\t\tindexOffset = 0,\n\t\t\t\ttext = '',\n\t\t\t\tfoundCharacters = [],\n\t\t\t\tregExpress = sandbox.getRegExp('specialCharacters').set().onePlus();\n\n\t\t\t// Build custom model without tags and special characters\n\t\t\tfunction addPart(start, end, node){\n\t\t\t\tif(start === end) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar part = {\n\n\t\t\t\t\tnode: node.el,\n\t\t\t\t\tstart: self.resultText.length  ,\n\t\t\t\t\tend: self.resultText.length + end - start ,\n\t\t\t\t\toffset: start,\n\t\t\t\t\tproblemPhrase: node.problemPhrase\n\t\t\t\t};\n\t\t\t\tself.newParts[part.start] = part;\n\t\t\t\tself.newParts[part.end] = part;\n\t\t\t\tif (node.editable == false) {\n\t\t\t\t\tself.resultText += node.el.nodeValue.replace(/*REG_REPLACE*//./g, ' ').substring(start, end);\n\t\t\t\t} else {\n\t\t\t\t\tself.resultText += node.el.nodeValue.substring(start, end);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction addFoundedProblems(index) {\n\t\t\t\tvar prevValue = self.foundedProblems[self.foundedProblems.previous] || 0;\n\n\t\t\t\tself.foundedProblems[index] = prevValue + 1;\n\t\t\t\tself.foundedProblems.previous = index;\n\t\t\t}\n\n\t\t\twhile (node) {\n\t\t\t\tswitch (node.el.nodeType) {\n\t\t\t\t\tcase 3 : // Node.TEXT_NODE || 3\n\t\t\t\t\t\tif(node.el.length) {\n\t\t\t\t\t\t\tindexOffset = node.indexOffset || 0;\n\t\t\t\t\t\t\ttext = node.el.nodeValue;\n\t\t\t\t\t\t\t// Find characters in any combination in node value\n\t\t\t\t\t\t\tfoundCharacters = regExpress.match( text.substring(indexOffset) );\n\t\t\t\t\t\t\tif (foundCharacters) {\n\t\t\t\t\t\t\t\t// add part without special characters to custom model\n\t\t\t\t\t\t\t\taddPart(indexOffset, indexOffset + foundCharacters.index, node);\n\t\t\t\t\t\t\t\t// in the next iteration, we will start with a given position\n\t\t\t\t\t\t\t\tnode.indexOffset = indexOffset + foundCharacters.index + foundCharacters[0].length;\n\t\t\t\t\t\t\t\tqueue.splice(0, 0, node);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// if we have't more special characters add to the end of the word\n\t\t\t\t\t\t\t\taddPart(indexOffset, text.length, node);\n\t\t\t\t\t\t\t\tnode.emptyCharsCountInPart = 0;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t\tcase 1 :\n\t\t\t\t\t\t// Fix bug WP-927\n\t\t\t\t\t\t// Grammar for CKEditor 4: When some not supported by Grammar part of text is wrapped in language span grammar problems inside still being recognized\n\t\t\t\t\t\tdifferentLanguage = ( node.el.lang && languagesMap[node.el.getAttribute(languageAttributeName)] !== lang ) ? true : false;\n\n\t\t\t\t\t\tif (node.el.nodeName.toLowerCase() == problemPhraseNode.toLowerCase() && node.el.getAttribute(problemDataAttrName) && node.el.innerHTML) {\n\t\t\t\t\t\t\t// If we have problem node we should mark it with 'problemPhrase: true' field.\n\t\t\t\t\t\t\t// And will not remarkup this node in future.\n\t\t\t\t\t\t\tvar text = node.el.getAttribute(problemDataAttrName);\n\n\t\t\t\t\t\t\tqueue.splice(0, 0, { el: document.createTextNode(text), editable: true, problemPhrase: true });\n\t\t\t\t\t\t\taddFoundedProblems(this.resultText.length + text.length);\n\t\t\t\t\t\t} else if ( !bookmarkClassRegex.test(sandbox.UILib.attr(node.el, 'className')) &&\n\t\t\t\t\t\t\t\t\t!ignoreElementsRegex.test(node.el.nodeName) &&\n\t\t\t\t\t\t\t\t\t// TODO fix bug WP-167 Grammar breaks table cells\n\t\t\t\t\t\t\t\t\t!ignoreGrammarElementsRegex.test(node.el.nodeName) &&\n\t\t\t\t\t\t\t\t\t!differentLanguage ) {\n\t\t\t\t\t\t\tvar _editable = node.el.hasAttribute('contenteditable') ? node.el.isContentEditable : node.editable;\n\t\t\t\t\t\t\tfor (var i=0; i < node.el.childNodes.length; i++) {\n\t\t\t\t\t\t\t\tqueue.splice(i, 0, { el: node.el.childNodes[i], editable: _editable });\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( blockElementsRegex.match(node.el.nodeName) ) {\n\t\t\t\t\t\t\t\t// Add \\u2029 after block element\n\t\t\t\t\t\t\t\tif (queue.length > node.el.childNodes.length) {\n\t\t\t\t\t\t\t\t\tqueue.splice(i, 0, { el: document.createTextNode('\\u2029'), editable: true });\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Add \\u2029 or space before block element if need so\n\t\t\t\t\t\t\t\tif ( this.resultText.length > 0 && sentenceEndChars.search(this.resultText) === -1 && nonWhiteSpaceExtended.search(this.resultText) !== -1 ) {\n\t\t\t\t\t\t\t\t\tqueue.splice(0, 0, { el: document.createTextNode('\\u2029'), editable: true });\n\t\t\t\t\t\t\t\t} else if (this.resultText.length > 0 && this.resultText[this.resultText.length - 1] != ' ') {\n\t\t\t\t\t\t\t\t\tqueue.splice(0, 0, { el: document.createTextNode(' '), editable: true });\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tnode = queue.shift();\n\t\t\t}\n\n\t\t\tthis.resultText = ieSeparator.replace(this.resultText, ' ');\n\t\t};\n\n\t\t/**\n\t\t * Searches for a phrases in the sentences in the Node that was passed to [collectBlockInfo]{@link CORE.GrammarPhrasesFinder.Finder#collectBlockInfo} method\n\t\t *\n\t\t * @param {object} data - object with sentence which you need to find\n\t\t * @returns {CORE.RangeCreator.Range} - Range object\n\t\t */\n\t\tthis.findPhrases = function(data) {\n\t\t\t // we should include here all possible word breaking symbols\n\t\t\tvar sentence = data.sentence,\n\t\t\t\tindex = this.resultText.indexOf(sentence, this.lastIndex),\n\t\t\t\tprevSymbolsRegExp = /[.!?\\u2029][\\s\\xA0]*$/g,\n\t\t\t\tnewLineSymbolRegExp = /^[\\s\\xA0]*(?=[\\u2029]+)/g,\n\t\t\t\tnonWhiteSpaceExtended = sandbox.getRegExp('nonWhiteSpaceExtended'),\n\t\t\t\tUtils = sandbox.Utils,\n\t\t\t\tprevTrue = false,\n\t\t\t\tnextTrue = false,\n\t\t\t\tphraseRanges = [],\n\t\t\t\tprevText, nextText;\n\n\t\t\t// need to check for sentence boundary points\n\t\t\tif (index > 0) {\n\t\t\t\t// if index is > 0 checking for previous and next chars\n\t\t\t\t// also checking for text length for solving problem with unknown character in end when index + sentence.length > this.resultText.length\n\t\t\t\tthis.lastIndex = index + sentence.length;\n\t\t\t\tprevText = this.resultText.substring(0, index);\n\t\t\t\tnextText = this.resultText.substring(this.lastIndex);\n\n\t\t\t\t/*\n\t\t\t\t\t/[.!?\\u2029][\\s\\xA0]*$/ - prevSymbolsRegExp\n\t\t\t\t\t- first dot, exclamation mark or question mark\n\t\t\t\t\t- then one of the space symbol 0 or more times\n\t\t\t\t\t- matches end of input\n\t\t\t\t\t- 'Hello.', 'Hello!   ', 'Hello\\u2029', 'Hello\\u2029          '\n\n\t\t\t\t\t/[^ \\f\\n\\r\\t\\v\\uFEFF\\u0085\\u00A0\\u1680\\u180E\\u2000-\\u200C\\u2028\\u2029\\u202F\\u205F\\u3000]+/ - nonWhiteSpaceExtended\n\t\t\t\t\t- matches all non white space symbols founded 1 or more times\n\t\t\t\t\t- '.', 'a', '   z', '(', '     .'\n\t\t\t\t\t- nonWhiteSpaceExtended.search(prevText) === -1 - in this case checks on white space symbols only\n\t\t\t\t\t- returns true if all symbols is white space\n\t\t\t\t\t- ' ', '    '\n\t\t\t\t\t- for prevText we check symbols before index\n\t\t\t\t\t- for nextText we check symbols after lastIndex\n\t\t\t\t*/\n\t\t\t\tif (prevSymbolsRegExp.test(prevText) || nonWhiteSpaceExtended.search(prevText) === -1) {\n\t\t\t\t\tprevTrue = true;\n\t\t\t\t}\n\n\t\t\t\t/*\n\t\t\t\t\t/^[\\s\\xA0]*(?=[\\u2029]+)/g - newLineSymbolRegExp\n\t\t\t\t\t- first one of the space symbol 0 or more times\n\t\t\t\t\t- then \\u2029 1 or more times\n\t\t\t\t\t- matches beginning of input\n\t\t\t\t\t- '    \\u2029'\n\n\t\t\t\t\tUtils.startsWithSpaceAndUppercaseLetter()\n\t\t\t\t\t- returns true if string starts with space and then after space follow uppercase letter\n\t\t\t\t\t- ' Z', '   Ð¯'\n\t\t\t\t*/\n\t\t\t\tif ( this.lastIndex === this.resultText.length || newLineSymbolRegExp.test(nextText) || nonWhiteSpaceExtended.search(nextText) === -1 || Utils.startsWithSpaceAndUppercaseLetter(nextText) ) {\n\t\t\t\t\tnextTrue = true;\n\t\t\t\t}\n\n\t\t\t\tindex = prevTrue && nextTrue ? index : \"skipped\";\n\t\t\t} else if (index === 0) {\n\t\t\t\t// if index is == 0 checking for next chars only\n\t\t\t\tthis.lastIndex = index + sentence.length;\n\t\t\t\tnextText = this.resultText.substring(this.lastIndex);\n\n\t\t\t\tif ( newLineSymbolRegExp.test(nextText) || nonWhiteSpaceExtended.search(nextText) === -1 || Utils.startsWithSpaceAndUppercaseLetter(nextText) ) {\n\t\t\t\t\tnextTrue = true;\n\t\t\t\t}\n\n\t\t\t\tindex = nextTrue ? index : \"skipped\";\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (index == \"skipped\") {\n\t\t\t\treturn this.findPhrases.call(this, data);\n\t\t\t}\n\n\t\t\tthis.phraseIndex = this.foundedProblems.getPreviousProblemsCount(index);\n\n\t\t\t// One sentence can have few grammar problems.\n\t\t\t// We should find ranges for all of this problems.\n\t\t\tfor (var i = 0; i < data.phrases.length; i++) {\n\t\t\t\tvar range = sandbox.createRange(),\n\t\t\t\t\tphrase = data.phrases[i];\n\n\t\t\t\tvar startPos = this.newParts.getPos(index + phrase.offset);\n\t\t\t\tvar endPos = this.newParts.getPos(index + phrase.offset + phrase.length - 1);\n\n\t\t\t\t// We do not need work with already marked problem phrase\n\t\t\t\tif (startPos.problemPhrase || endPos.problemPhrase) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\trange.setStart(startPos.node, index + phrase.offset - startPos.start + startPos.offset);\n\t\t\t\trange.setEnd(endPos.node, index + phrase.offset + phrase.length - endPos.start + endPos.offset);\n\t\t\t\trange = sandbox.Utils.fixRangeBoundaryPoints(range);\n\t\t\t\tphraseRanges.push({\n\t\t\t\t\trange: range,\n\t\t\t\t\trule: phrase.rule.id,\n\t\t\t\t\tphrase: phrase.phrase,\n\t\t\t\t\tsuggestions: phrase.suggestions,\n\t\t\t\t\tmessage: phrase.message,\n\t\t\t\t\tindex: this.phraseIndex\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.phraseRanges = phraseRanges;\n\n\t\t\treturn this.phraseRanges;\n\t\t};\n\t};\n\n\texports.GrammarPhrasesFinder = GrammarPhrasesFinder;\n}( WEBSPELLCHECKER.CORE ));\n// sentencesprocessor.js\r\n/**\r\n * @fileoverview of CORE phrases processor module.\r\n */\r\n\r\n(function( exports ) {\r\n\t'use strict';\r\n\r\n\t/**\r\n\t * Represents SentencesProcessor Module.\r\n\t *\r\n\t * @constructor\r\n\t * @alias CORE.SentencesProcessor\r\n\t * @param {String} moduleID\r\n\t * @param {CORE.Sandbox} sandbox\r\n\t */\r\n\tvar SentencesProcessor = function(moduleID, sandbox) {\r\n\t\t/**\r\n\t\t * Module name.\r\n\t\t *\r\n\t\t * @type {String}\r\n\t\t */\r\n\t\tthis.name = moduleID;\r\n\r\n\t\t/**\r\n\t\t * Reference to SentencesProcessor module sandbox.\r\n\t\t *\r\n\t\t * @type {CORE.Sandbox}\r\n\t\t */\r\n\t\tthis.sandbox = sandbox;\r\n\t};\r\n\r\n\tSentencesProcessor.prototype = {\r\n\t\t/**\r\n\t\t * Called after each registration in core.\r\n\t\t *\r\n\t\t * @memberof CORE.SentencesProcessor#\r\n\t\t */\r\n\t\tinit: function() {\r\n\t\t\tthis.sandbox.subscribe(\"replacePhrase\", function(data) {\r\n\t\t\t\tthis.replacePhraseInSelection(data.phrase, data.grammarNode);\r\n\t\t\t}, this);\r\n\r\n\t\t\tthis.sandbox.subscribe(\"ignorePhrase\", function(data) {\r\n\t\t\t\tthis.ignorePhraseInSelection(data.grammarNode);\r\n\t\t\t}, this);\r\n\r\n\t\t\tthis.sandbox.subscribe(\"ignoreAllPhrases\", function(data) {\r\n\t\t\t\tthis.ignorePhraseInDocument(data.grammarNode);\r\n\t\t\t}, this);\r\n\t\t},\r\n\t\t/**\r\n\t\t * Replaces selected Grammar phrase with new one.\r\n\t\t *\r\n\t\t * @param {String} phrase - Phrase for replacement\r\n\t\t * @param {Node} grammarNode - Grammar node\r\n\t\t */\r\n\t\treplacePhraseInSelection: function(phrase, grammarNode) {\r\n\t\t\tvar container = this.sandbox.getOption('container'),\r\n\t\t\t\t_grammarNode;\r\n\r\n\t\t\t_grammarNode = grammarNode ? grammarNode : this.sandbox.getGrammarNodeFromSelection();\r\n\r\n\t\t\tif ( _grammarNode && container.contains(_grammarNode) ) {\r\n\t\t\t\tvar oldPhrase = this.sandbox.UILib.attr(_grammarNode, this.sandbox.getOption('problem_grammar_data_attribute'));\r\n\t\t\t\tthis.sandbox.fire('updateSentencesCache', {phrase: oldPhrase});\r\n\t\t\t\tthis.replacePhraseByNode(_grammarNode, phrase);\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t * Ignores selected Grammar phrase.\r\n\t\t *\r\n\t\t * @param {Node} grammarNode - Grammar node\r\n\t\t */\r\n\t\tignorePhraseInSelection: function(grammarNode) {\r\n\t\t\tvar container = this.sandbox.getOption('container'),\r\n\t\t\t\t_grammarNode;\r\n\r\n\t\t\t_grammarNode = grammarNode ? grammarNode : this.sandbox.getGrammarNodeFromSelection();\r\n\r\n\t\t\tif ( _grammarNode && container.contains(_grammarNode) ) {\r\n\t\t\t\tthis.ignorePhrases([_grammarNode]);\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t * Ignores selected Grammar phrase everywhere in document\r\n\t\t * @param {Node} grammarNode - Grammar node\r\n\t\t */\r\n\t\tignorePhraseInDocument: function(grammarNode) {\r\n\t\t\tvar container = this.sandbox.getOption('container'),\r\n\t\t\t\tproblemPhraseNode = this.sandbox.getOption('problem_grammar_node'),\r\n\t\t\t\tdataAttributeName = this.sandbox.getOption('problem_grammar_data_attribute'),\r\n\t\t\t\tdataAttributeRuleName = this.sandbox.getOption('problem_grammar_data_attribute_rule'),\r\n\t\t\t\tphraseNodes = [],\r\n\t\t\t\t_grammarNode, _grammarPhrase;\r\n\r\n\t\t\t_grammarNode = grammarNode ? grammarNode : this.sandbox.getGrammarNodeFromSelection();\r\n\r\n\t\t\tif ( _grammarNode && container.contains(_grammarNode) ) {\r\n\t\t\t\t_grammarPhrase = _grammarNode.getAttribute(dataAttributeName).replace(/\"/g, '\\\\\"');\r\n\t\t\t\tphraseNodes.push.apply(phraseNodes, this.sandbox.UILib.query(container, problemPhraseNode + '[' + dataAttributeName + '=\"' + _grammarPhrase + '\"]' + '[' + dataAttributeRuleName + '=\"' + _grammarNode.getAttribute(dataAttributeRuleName) + '\"]'));\r\n\t\t\t\tthis.ignorePhrases(phraseNodes);\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t * Raplaces Grammar node with phrase without Grammar markup\r\n\t\t *\r\n\t\t * @param {Array<Node>} phraseNodes - Array of Grammar Nodes\r\n\t\t */\r\n\t\tignorePhrases: function(/* array */ phraseNodes) {\r\n\t\t\tvar range = this.sandbox.createRange(),\r\n\t\t\t\tdictionary = exports.GrammarDictionaryManager.Dictionary,\r\n\t\t\t\tdataAttributeName = this.sandbox.getOption('problem_grammar_data_attribute'),\r\n\t\t\t\tdataAttributeRuleName = this.sandbox.getOption('problem_grammar_data_attribute_rule'),\r\n\t\t\t\tlang = this.sandbox.getOption('lang'),\r\n\t\t\t\tuid = this.sandbox.getOption('uid'),\r\n\t\t\t\tfocused = this.sandbox.isFocused(),\r\n\t\t\t\tsavedSel;\r\n\r\n\t\t\tif (focused && phraseNodes.length > 0) {\r\n\t\t\t\t// TODO: review possibility to move focus check inside saveSelection method.\r\n\t\t\t\tsavedSel = this.sandbox.saveSelection();\r\n\t\t\t}\r\n\r\n\t\t\twhile(phraseNodes.length > 0) {\r\n\t\t\t\tvar node = phraseNodes.shift(),\r\n\t\t\t\t\tphrase = node.getAttribute(dataAttributeName),\r\n\t\t\t\t\trule = node.getAttribute(dataAttributeRuleName);\r\n\r\n\t\t\t\tif (dictionary.getPhrase(phrase, rule, lang)) {\r\n\t\t\t\t\tdictionary.setIgnoreInInstance(phrase, rule, uid); // ignored\r\n\t\t\t\t}\r\n\r\n\t\t\t\trange.selectNodeContents(node);\r\n\t\t\t\tvar fragment = range.extractContents();\r\n\t\t\t\trange.selectNode(node);\r\n\t\t\t\trange.deleteContents();\r\n\t\t\t\trange.insertNode(fragment);\r\n\t\t\t\t// TODO needs to refactoring markup module\r\n\t\t\t\tthis.sandbox.fire('removedMarkupInContainer', {\r\n\t\t\t\t\tancestorContainer : range.commonAncestorContainer(),\r\n\t\t\t\t\tremovedNodes: [node],\r\n\t\t\t\t\ttype: 'grammar',\r\n\t\t\t\t\ttext: phrase\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tthis.sandbox.restoreSelection(savedSel);\r\n\t\t},\r\n\t\t/**\r\n\t\t * Raplaces Grammar node with new phrase\r\n\t\t *\r\n\t\t * @param {Node} node - Grammar Node\r\n\t\t * @param {String} newPhrase - Phrase for replacement\r\n\t\t */\r\n\t\treplacePhraseByNode: function(/* grammarNode */ node, newPhrase){\r\n\t\t\tvar childNodes = this.sandbox.getChildProblemNodes(node),\r\n\t\t\t\tparentNodes = this.sandbox.getParentProblemNodes(node);\r\n\r\n\t\t\t//TODO Modify selection management.\r\n\t\t\tnode.innerHTML = newPhrase;\r\n\t\t\tvar range = this.sandbox.createRange();\r\n\t\t\trange.selectNodeContents(node);\r\n\t\t\trange.collapse(false);\r\n\t\t\tvar selection = this.sandbox.getSelection();\r\n\t\t\t// TODO need rethink mirror based behavior\r\n\t\t\tif ( this.sandbox.getOption('mirrorBasedInstance') || this.sandbox.getGrammarNodeFromSelection() === node ) {\r\n\t\t\t\tselection.removeAllRanges();\r\n\t\t\t\tselection.addRange(range);\r\n\t\t\t}\r\n\t\t\tvar savedSel = this.sandbox.saveSelection();\r\n\t\t\trange = this.sandbox.createRange();\r\n\t\t\trange.selectNode(node);\r\n\t\t\tvar fragment = range.createContextualFragment(node.innerHTML);\r\n\t\t\trange.deleteContents();\r\n\t\t\trange.insertNode(fragment);\r\n\t\t\t// TODO needs to refactoring markup module\r\n\t\t\tthis.sandbox.fire('removedMarkupInContainer', {\r\n\t\t\t\tancestorContainer : range.commonAncestorContainer(),\r\n\t\t\t\ttextChanged: true,\r\n\t\t\t\tremovedNodes: [node].concat(childNodes)\r\n\t\t\t});\r\n\t\t\tthis.sandbox.fire('removeMarkup', {\r\n\t\t\t\tnodes: parentNodes,\r\n\t\t\t\tgrammar: true\r\n\t\t\t});\r\n\t\t\tthis.sandbox.restoreSelection(savedSel);\r\n\r\n\t\t\tif ( this.sandbox.getOption('mirrorBasedInstance') ) {\r\n\t\t\t\tvar text = this.sandbox.getTextBeforeCursor();\r\n\r\n\t\t\t\tif ( text !== null && text.substring(text.length - newPhrase.length) !==  newPhrase) {\r\n\t\t\t\t\ttext += newPhrase;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.sandbox.fire('textReplaced', {\r\n\t\t\t\t\ttextBeforeCursor: text ? text : null,\r\n\t\t\t\t\tnewText: newPhrase\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\texports.SentencesProcessor = SentencesProcessor;\r\n\r\n}( WEBSPELLCHECKER.CORE ));\n// grammarmarkup.js\r\n/**\r\n * @fileoverview of Grammar markup module.\r\n */\r\n\r\n// @TODO: check markup.js for latest bug fixes and transfer them here\r\n\r\n(function( exports ) {\r\n\t'use strict';\r\n\tvar UILib;\r\n\t/**\r\n\t* GrammarMarkup Module constructor.\r\n\t* @constructor\r\n\t* @alias CORE.GrammarMarkup\r\n\t* @param {String} moduleID\r\n\t* @param {CORE.Sandbox} sandbox\r\n\t*/\r\n\tvar GrammarMarkup = function(moduleID, sandbox) {\r\n\t\t/**\r\n\t\t* module name\r\n\t\t* @type {String}\r\n\t\t*/\r\n\t\tthis.name = moduleID;\r\n\t\t/**\r\n\t\t * Link on the container.\r\n\t\t *\r\n\t\t * @type {Node}\r\n\t\t */\r\n\t\tthis.container = sandbox.getOption('container');\r\n\r\n\t\t/**\r\n\t\t* reference to GrammarMarkup module sandbox\r\n\t\t* @type {CORE.Sandbox}\r\n\t\t*/\r\n\t\tthis.sandbox = sandbox;\r\n\t\tUILib = sandbox.UILib;\r\n\t};\r\n\r\n\tGrammarMarkup.prototype = {\r\n\t\t/**\r\n\t\t* Called after each registration in core\r\n\t\t* @memberof CORE.GrammarMarkup#\r\n\t\t*/\r\n\t\tinit: function() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tthis.sandbox.subscribe('markupPhrase', function(data) {\r\n\t\t\t\tthis.markupPhrase(data.ranges, data.lang);\r\n\t\t\t}, this);\r\n\r\n\t\t\tthis.sandbox.subscribe({\r\n\t\t\t\teventType: 'keydown',\r\n\t\t\t\telement: this.container,\r\n\t\t\t\thandler: function(event) {\r\n\t\t\t\t\tvar enableGrammar = this.sandbox.getOption('enableGrammar');\t//@TODO tmp solution\r\n\t\t\t\t\tif(enableGrammar) {\r\n\t\t\t\t\t\tself.handleKeydown(event);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tthis.sandbox.subscribe('removeMarkupInSelectionNode, removeGrammarMarkupInSelectionNode', function(data) {\r\n\t\t\t\tvar enableGrammar = this.sandbox.getOption('enableGrammar');\t//@TODO tmp solution\r\n\r\n\t\t\t\tif(enableGrammar) {\r\n\t\t\t\t\tthis.removeMarkupInSelectionNode(data);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\r\n\t\t\tthis.sandbox.subscribe('removeMarkupInDocument', function() {\r\n\t\t\t\tthis.removeMarkupInDocument();\r\n\t\t\t}, this);\r\n\r\n\t\t\tthis.sandbox.subscribe('removeMarkupFromPhrases', function(data) {\r\n\t\t\t\tthis.removeMarkupFromPhrases(data.phrases);\r\n\t\t\t}, this);\r\n\r\n\t\t\tthis.sandbox.subscribe('removeMarkup', function(data) {\r\n\t\t\t\tdata.grammar && this.removeMarkup(data.nodes);\r\n\t\t\t}, this);\r\n\t\t},\r\n\t\t/**\r\n\t\t* @memberof CORE.GrammarMarkup#\r\n\t\t* @param {Object} event - HTML DOM Event\r\n\t\t*/\r\n\t\thandleKeydown: function(event) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tUtils = this.sandbox.Utils,\r\n\t\t\t\tcKey = 67,\r\n\t\t\t\txKey = 88,\r\n\t\t\t\taKey = 65,\r\n\t\t\t\tuKey = 90,\r\n\t\t\t\trKey = 89,\r\n\t\t\t\tcopyAction, selectAllAction, undoAction, redoAction, additionalRedoAction,\r\n\t\t\t\tnotShortcutActions, printableKey, notExcludeKey, alternativeKey,\r\n\t\t\t\texcludeKeyCodes = [\t// key codes that not in range between 40..91\r\n\t\t\t\t\t45,\t\t// 'insert' key\r\n\t\t\t\t],\r\n\t\t\t\talternativeKeyCodes = [ // key codes that shoud remove markup regardless to all other conditions\r\n\t\t\t\t\t8,\t\t// backspace\r\n\t\t\t\t\t13,\t\t// enter\r\n\t\t\t\t\t32,\t\t// space\r\n\t\t\t\t\t106,\t// numpad '*'\r\n\t\t\t\t\t107,\t// numpad '+'\r\n\t\t\t\t\t109,\t// numpad '-'\r\n\t\t\t\t\t110,\t// numpad '.'\r\n\t\t\t\t\t111,\t// numpad '/'\r\n\t\t\t\t\t187,\t// '-' or '_' (+ shift key)\r\n\t\t\t\t\t186,\t// ';' or ':' (+ shift key)\r\n\t\t\t\t\t188,\t// ',' or '<' (+ shift key)\r\n\t\t\t\t\t190,\t// '.' or '>' (+ shift key)\r\n\t\t\t\t\t191,\t// '/' or '?' (+ shift key)\r\n\t\t\t\t\t192,\t// '`' or '~' (+ shift key)\r\n\t\t\t\t\t219,\t// '[' or '{' (+ shift key)\r\n\t\t\t\t\t220,\t// '\\' or '|' (+ shift key)\r\n\t\t\t\t\t221,\t// ']' or '}' (+ shift key)\r\n\t\t\t\t\t222\t\t// \"'\" or '\"' (+ shift key)\r\n\t\t\t\t];\r\n\r\n\t\t\t// Firefox has another keycode for some key\r\n\t\t\tif (Utils.Browser.gecko) {\r\n\t\t\t\talternativeKeyCodes.push(173);\r\n\t\t\t} else {\r\n\t\t\t\talternativeKeyCodes.push(189);\r\n\t\t\t}\r\n\r\n\t\t\tcopyAction = (event.ctrlKey || event.metaKey) && event.keyCode === cKey;\r\n\t\t\tselectAllAction = (event.ctrlKey || event.metaKey) && event.keyCode === aKey;\r\n\t\t\tundoAction = (event.ctrlKey || event.metaKey) && !event.shiftKey && event.keyCode === uKey;\r\n\t\t\tredoAction = (event.ctrlKey || event.metaKey) && event.shiftKey && event.keyCode === uKey;\r\n\t\t\tadditionalRedoAction = (event.ctrlKey || event.metaKey) && !event.shiftKey && event.keyCode === rKey;\r\n\r\n\t\t\tnotShortcutActions = !copyAction && !selectAllAction && !undoAction && !redoAction && !additionalRedoAction;\r\n\t\t\tprintableKey = (event.keyCode > 40 && event.keyCode < 91) || (event.keyCode >= 96 && event.keyCode <= 105);\r\n\t\t\tnotExcludeKey = excludeKeyCodes.indexOf(event.keyCode) < 0;\r\n\t\t\talternativeKey = alternativeKeyCodes.indexOf(event.keyCode) >= 0;\r\n\r\n\t\t\tif(notShortcutActions && printableKey && notExcludeKey || alternativeKey) {\r\n\t\t\t\tself.removeMarkupInSelectionNode();\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t* @memberof CORE.GrammarMarkup#\r\n\t\t* @param {Array} ranges - Array of ranges\r\n\t\t*/\r\n\t\tmarkupPhrase: function(ranges, lang) {\r\n\t\t\tif(ranges.length === 0) {\r\n\t\t\t\treturn; // TODO: move to another place?\r\n\t\t\t}\r\n\r\n\t\t\tvar self = this,\r\n\t\t\t\tdocumentContainer = self.sandbox.getOption('documentContainer'),\r\n\t\t\t\tproblemPhraseNode = self.sandbox.getOption('problem_grammar_node'),\r\n\t\t\t\tproblemDataAttrName = self.sandbox.getOption('problem_grammar_data_attribute'),\r\n\t\t\t\tproblemDataAttrNameRule = self.sandbox.getOption('problem_grammar_data_attribute_rule'),\r\n\t\t\t\tproblemPhraseClass = self.sandbox.getOption('problem_grammar_class'),\r\n\t\t\t\tdataLangAttrName = self.sandbox.getOption('data_lang_attribute'),\r\n\t\t\t\tieSeparator = self.sandbox.getRegExp('ieSeparator');\r\n\r\n\t\t\tvar strong = self.sandbox.Utils.getCurrentDocument(documentContainer).createElement(problemPhraseNode);\r\n\t\t\tthis.sandbox.UILib.addClass(strong, problemPhraseClass);\r\n\r\n\t\t\t// Markup functionality does not broke nodes.\r\n\t\t\t// So we need to lock mutations listener.\r\n\t\t\tthis.sandbox.fireInAllApps('lockMutationsListener', { lock: true });\r\n\t\t\t\r\n\t\t\tfor (var i = 0; i < ranges.length; i++) {\r\n\t\t\t\tvar _range = ranges[i].range;\r\n\t\t\t\tvar _selectionNode = _range.commonAncestorContainer();\r\n\t\t\t\tvar _grammarParentsNode = self.sandbox.Utils.isEqualNode(_selectionNode, problemDataAttrName) ? [_selectionNode] : UILib.findNodeParents(_selectionNode, problemPhraseNode, problemDataAttrName);\r\n\r\n\t\t\t\tif(_grammarParentsNode.length === 0) {\r\n\t\t\t\t\tvar _strong = strong.cloneNode(true);\r\n\t\t\t\t\tvar _phrase = _range.toString();\r\n\r\n\t\t\t\t\tif (lang) {\r\n\t\t\t\t\t\t_strong.setAttribute(dataLangAttrName, lang);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// we need to remove possible bookmarks\r\n\t\t\t\t\t_phrase = self.sandbox.removeSpecialCharacters(_phrase);\r\n\t\t\t\t\t_phrase = ieSeparator.replace(_phrase, ' ');\r\n\t\t\t\t\t_strong.setAttribute( problemDataAttrName, _phrase );\r\n\t\t\t\t\t_strong.setAttribute( problemDataAttrNameRule, ranges[i].rule );\r\n\t\t\t\t\t_strong.appendChild(_range.extractContents());\r\n\t\t\t\t\t_range.insertNode(_strong);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// TODO needs to refactoring markup module\r\n\t\t\t\t\tthis.sandbox.fire('markupedNode', {\r\n\t\t\t\t\t\tnode: _strong,\r\n\t\t\t\t\t\ttype: 'grammar',\r\n\t\t\t\t\t\trule: ranges[i].rule,\r\n\t\t\t\t\t\tphrase: ranges[i].phrase,\r\n\t\t\t\t\t\tsuggestions: ranges[i].suggestions,\r\n\t\t\t\t\t\tmessage: ranges[i].message,\r\n\t\t\t\t\t\tindex: ranges[i].index\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tvar _grammarChildNodes = UILib.findNodeChildren(_strong, problemPhraseNode, problemDataAttrName);\r\n\r\n\t\t\t\t\twhile (_grammarChildNodes.length > 0) {\r\n\t\t\t\t\t\tvar _grammarNode = _grammarChildNodes.shift();\r\n\t\t\t\t\t\tself.removeMarkup(_grammarNode);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Unlock mutations listener after markup functionality.\r\n\t\t\tthis.sandbox.fireInAllApps('lockMutationsListener', {lock: false});\r\n\t\t},\r\n\t\t/**\r\n\t\t* Finds all grammar nodes in document and call [removeMarkup]{@link CORE.GrammarMarkup#removeMarkup} method\r\n\t\t* @memberof CORE.GrammarMarkup#\r\n\t\t*/\r\n\t\tremoveMarkupInDocument: function() {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcontainer = self.sandbox.getOption('container'),\r\n\t\t\t\tproblemPhraseNode = self.sandbox.getOption('problem_grammar_node'),\r\n\t\t\t\tproblemDataAttrName = self.sandbox.getOption('problem_grammar_data_attribute');\r\n\t\t\tvar _nodesWithMarkup = UILib.query(container, problemPhraseNode + '[' + problemDataAttrName + ']');\r\n\r\n\t\t\tself.removeMarkup(_nodesWithMarkup);\r\n\t\t\t// clear grammar cache\r\n\t\t\tthis.sandbox.fire('updateSentencesCache', {});\r\n\t\t},\r\n\t\t/**\r\n\t\t* Finds all grammar nodes with requested phrases and call [removeMarkup]{@link CORE.GrammarMarkup#removeMarkup} method\r\n\t\t* @param {Array} phrases - Array of phrases\r\n\t\t* @memberof CORE.GrammarMarkup#\r\n\t\t*/\r\n\t\tremoveMarkupFromPhrases: function(phrases) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tUILib = this.sandbox.UILib,\r\n\t\t\t\tcontainer = this.container,\r\n\t\t\t\tproblemPhraseNode = self.sandbox.getOption('problem_grammar_node'),\r\n\t\t\t\tproblemDataAttrName = self.sandbox.getOption('problem_grammar_data_attribute'),\r\n\t\t\t\t_grammarNodes = [],\r\n\t\t\t\tphrase;\r\n\r\n\t\t\tfor(var i = 0; i < phrases.length; i++) {\r\n\t\t\t\t_grammarNodes.push.apply(_grammarNodes, UILib.query(container, problemPhraseNode + '[' + problemDataAttrName + '=\"' + phrases[i].phrase + '\"]'));\r\n\t\t\t}\r\n\r\n\t\t\tself.removeMarkup(_grammarNodes);\r\n\r\n\t\t\tUILib.each(_grammarNodes, function(i, grammarNode) {\r\n\t\t\t\tphrase = UILib.attr(grammarNode, problemDataAttrName);\r\n\t\t\t\t// we need to remove from grammar cache sentence that contains phrase in order to make possible further markup\r\n\t\t\t\tself.sandbox.fire('updateSentencesCache', {phrase: phrase});\r\n\t\t\t});\r\n\t\t},\r\n\t\t/**\r\n\t\t* Finds grammar node in current selection and call [removeMarkup]{@link CORE.GrammarMarkup#removeMarkup} method\r\n\t\t* @memberof CORE.GrammarMarkup#\r\n\t\t*/\r\n\t\tremoveMarkupInSelectionNode: function(data) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tUtils = this.sandbox.Utils,\r\n\t\t\t\tUILib = this.sandbox.UILib,\r\n\t\t\t\tproblemDataAttrName = this.sandbox.getOption('problem_grammar_data_attribute'),\r\n\t\t\t\tproblemPhraseNode = this.sandbox.getOption('problem_grammar_node'),\r\n\t\t\t\tselectionNode = data && data.selectionNode,\r\n\t\t\t\tremoveInside = data && data.removeInside,\r\n\t\t\t\tforceBookmark = data && data.forceBookmark,\r\n\t\t\t\tselection = this.sandbox.getSelection(),\r\n\t\t\t\tcontainer = this.container,\r\n\t\t\t\tleftStartNode, rightStartNode,\r\n\t\t\t\trange, leftStartOffset, rightStartOffset, phrase,\r\n\t\t\t\tgrammarNodesToRemove = [], // Grammar nodes we need to remove from DOM\r\n\t\t\t\tnodesWithCachedPhrases = []; // all Grammar nodes that contain phrases in cached sentences\r\n\r\n\t\t\tfunction getGrammarNodes(nodeArray) {\r\n\t\t\t\tvar result = [];\r\n\r\n\t\t\t\tresult = nodeArray.filter(function(node) {\r\n\t\t\t\t\treturn Utils.isEqualNode(node, problemDataAttrName);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(result.length === 0) {\r\n\t\t\t\t\t// We assume here that all nodes from nodeArray are inside of Grammar wrapper node.\r\n\t\t\t\t\t// Cuz if we have one node inside of Grammar and one outside - Grammar node will be included to the list as well (see range.getNodes method docs)\r\n\t\t\t\t\t// Lets take first and try to find Grammar parent node\r\n\t\t\t\t\tresult = UILib.findNodeParents(nodeArray[0], problemPhraseNode, problemDataAttrName);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\r\n\t\t\tif(selectionNode) {\r\n\t\t\t\tif ( container.contains(selectionNode) ) {\r\n\t\t\t\t\trange = self.sandbox.createRange();\r\n\t\t\t\t\trange.selectNode(selectionNode);\r\n\t\t\t\t\tgrammarNodesToRemove = range.getNodes();\r\n\t\t\t\t\tnodesWithCachedPhrases = grammarNodesToRemove;\r\n\t\t\t\t}\r\n\t\t\t} else if(selection.rangeCount() > 0) {\r\n\t\t\t\trange = selection.getRangeAt(0);\r\n\r\n\t\t\t\t// no need to check for bakcward selection as start and end containers always in right order\r\n\t\t\t\tleftStartNode = range.startContainer();\r\n\t\t\t\trightStartNode = range.endContainer();\r\n\r\n\t\t\t\tleftStartOffset = range.startOffset();\r\n\t\t\t\trightStartOffset = range.endOffset();\r\n\r\n\t\t\t\t// get neighbour nodes to the borders of selection\r\n\t\t\t\tgrammarNodesToRemove = this.getNeighbourGrammarNodes(leftStartNode, rightStartNode, leftStartOffset, rightStartOffset);\r\n\r\n\t\t\t\t// We need to get all Grammar nodes that included into selected range plus neighbour one.\r\n\t\t\t\t// Thus we will correctly update sentences cache by removing from it sentences that contains phrases from found nodes.\r\n\t\t\t\tnodesWithCachedPhrases = range.getNodes();\r\n\t\t\t\tnodesWithCachedPhrases = grammarNodesToRemove.concat(nodesWithCachedPhrases);\r\n\r\n\t\t\t\tif(removeInside) {\r\n\t\t\t\t\tgrammarNodesToRemove = nodesWithCachedPhrases;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// filter all found nodes and leave only Grammar\r\n\t\t\tnodesWithCachedPhrases = getGrammarNodes(nodesWithCachedPhrases);\r\n\t\t\tgrammarNodesToRemove = getGrammarNodes(grammarNodesToRemove);\r\n\t\t\t// make array of unique items to prevent situation when we have two same Grammar nodes\r\n\t\t\tnodesWithCachedPhrases = Utils.ArrayUtils.arrayUnique(nodesWithCachedPhrases);\r\n\t\t\tgrammarNodesToRemove = Utils.ArrayUtils.arrayUnique(grammarNodesToRemove);\r\n\r\n\t\t\t// we need to remove from grammar cache sentences that contains phrases in order to make possible further markup\r\n\t\t\tfor (var i = 0, len = nodesWithCachedPhrases.length; i < len; i += 1) {\r\n\t\t\t\tphrase = UILib.attr(nodesWithCachedPhrases[i], problemDataAttrName);\r\n\t\t\t\tthis.sandbox.fire('updateSentencesCache', {phrase: phrase});\r\n\t\t\t}\r\n\r\n\t\t\tif(forceBookmark && !this.sandbox.getOption('focused') && grammarNodesToRemove.length > 0) {\r\n\t\t\t\tthis.sandbox.fire({\r\n\t\t\t\t\teventType: 'focus',\r\n\t\t\t\t\telement: this.container\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i = 0, len = grammarNodesToRemove.length; i < len; i += 1) {\r\n\t\t\t\tgrammarNodesToRemove[i].innerHTML && self.removeMarkup(grammarNodesToRemove[i]);\r\n\t\t\t}\r\n\t\t},\r\n\t\tgetNeighbourGrammarNodes: function(leftStartNode, rightStartNode, leftStartOffset, rightStartOffset) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tUtils = this.sandbox.Utils,\r\n\t\t\t\tUILib = this.sandbox.UILib,\r\n\t\t\t\tfoundNodes = [],\r\n\t\t\t\tleftGrammarNode, rightGrammarNode,\r\n\t\t\t\tproblemDataAttrName = this.sandbox.getOption('problem_grammar_data_attribute'),\r\n\t\t\t\tproblemNodeName = this.sandbox.getOption('problem_grammar_node');\r\n\r\n\t\t\t// rtl search direction\r\n\t\t\tleftGrammarNode = getNearestGrammarNode(false, leftStartNode, leftStartOffset);\r\n\t\t\t// ltr search direction\r\n\t\t\trightGrammarNode = getNearestGrammarNode(true, rightStartNode, rightStartOffset);\r\n\r\n\t\t\tfoundNodes = foundNodes.concat(leftGrammarNode, rightGrammarNode);\r\n\r\n\t\t\treturn foundNodes;\r\n\r\n\t\t\tfunction getNearestGrammarNode(direction, startNode, startOffset) {\r\n\t\t\t\tvar container = self.sandbox.getOption('container'),\r\n\t\t\t\t\tblockElementsRegex = self.sandbox.getRegExp('blockElementsRegex'),\r\n\t\t\t\t\tnonWhiteSpaceExtended = self.sandbox.getRegExp('nonWhiteSpaceExtended'),\r\n\t\t\t\t\tnonWhiteSpaceExtendedGlobal = nonWhiteSpaceExtended.g(),\r\n\t\t\t\t\tgrammarNode, text, walker;\r\n\r\n\t\t\t\tif(startNode) {\r\n\t\t\t\t\twalker = new Utils.Walker(startNode, startOffset, direction, container);\r\n\r\n\t\t\t\t\tdo {\r\n\t\t\t\t\t\t// 1. If we have sibling node and this node is block element we should not remove markup from this elements\r\n\t\t\t\t\t\t// <p>texxt</p>\r\n\t\t\t\t\t\t// <p>texxt</p>\r\n\t\t\t\t\t\t// <p>hel^lo</p>\r\n\t\t\t\t\t\t// <p>texxt</p>\r\n\t\t\t\t\t\t// <p>texxt</p>\r\n\t\t\t\t\t\tif ( walker.siblingNode && blockElementsRegex.test(walker.siblingNode.nodeName.toLowerCase()) && walker.textWalkedThrough.length > 0 && nonWhiteSpaceExtended.test(walker.textWalkedThrough) ) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// 2. If we found grammar node stop further search\r\n\t\t\t\t\t\t// Bug #72148 FF - added check for text walked through to prevent situations like this:\r\n\t\t\t\t\t\t//\r\n\t\t\t\t\t\t// is: \t\t\t<span class=\"gramm-problem\">an examples of</span>[space]<span class=\"gramm-problem\">^an examples of^</span>\r\n\t\t\t\t\t\t// should be: \t<span class=\"sgramm-problem\">an examples of</span>[space]^<span class=\"gramm-problem\">an examples of</span>^\r\n\t\t\t\t\t\t//\r\n\t\t\t\t\t\t// otherwise we will not find neighbour Grammar nodes and stay satisfied with first parent Grammar node\r\n\t\t\t\t\t\tif ( Utils.isEqualNode(walker.currentNode, problemDataAttrName) && walker.textWalkedThrough.length > 0 ) {\r\n\t\t\t\t\t\t\tgrammarNode = walker.currentNode;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ttext = walker.textWalkedThrough;\r\n\r\n\t\t\t\t\t\tif(!direction) {\r\n\t\t\t\t\t\t\ttext = text.split('').reverse().join('');\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// 3. If we found word symbols (not white space symbols) in text we should stop searching\r\n\t\t\t\t\t\tnonWhiteSpaceExtendedGlobal.setLastIndex(0);\r\n\t\t\t\t\t\tif(nonWhiteSpaceExtendedGlobal.test(text)) {\r\n\t\t\t\t\t\t\t// we reached the word\r\n\t\t\t\t\t\t\tif(nonWhiteSpaceExtendedGlobal.getLastIndex() + 1 <= text.length) {\r\n\t\t\t\t\t\t\t\tgrammarNode = UILib.findNodeParents(walker.currentNode, problemNodeName, problemDataAttrName)[0];\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} while (walker.getNext());\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn grammarNode;\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t* @memberof CORE.GrammarMarkup#\r\n\t\t* @param {Array} nodes - Array of Grammar nodes\r\n\t\t*/\r\n\t\tremoveMarkup: function(nodes) {\r\n\t\t\tvar savedSel,\r\n\t\t\t\tdoc = this.sandbox.Utils.getCurrentDocument(this.sandbox.getOption('documentContainer')),\r\n\t\t\t\tfocused = this.sandbox.isFocused(),\r\n\t\t\t\t_nodes = [].concat(nodes);\r\n\r\n\t\t\tif (focused && _nodes.length > 0) {\r\n\t\t\t\tsavedSel = this.sandbox.saveSelection();\r\n\t\t\t}\r\n\r\n\t\t\t// Remove markup functionality does not broke nodes.\r\n\t\t\t// So we need to lock mutations listener.\r\n\t\t\tthis.sandbox.fireInAllApps('lockMutationsListener', {lock: true});\r\n\r\n\t\t\twhile(_nodes.length > 0) {\r\n\t\t\t\tvar _grammarNode = _nodes.shift();\r\n\t\t\t\tvar range = this.sandbox.createRange();\r\n\t\t\t\t\r\n\t\t\t\trange.selectNodeContents(_grammarNode);\r\n\t\t\t\tvar fragment = range.extractContents();\r\n\t\t\t\trange.selectNode(_grammarNode);\r\n\t\t\t\trange.deleteContents();\r\n\t\t\t\t// TODO needs to refactoring markup module\r\n\t\t\t\tthis.sandbox.fire('removedMarkupInContainer', {\r\n\t\t\t\t\tnode: range.commonAncestorContainer(),\r\n\t\t\t\t\tremovedNodes: [_grammarNode]\r\n\t\t\t\t});\r\n\t\t\t\trange.insertNode(fragment);\r\n\t\t\t}\r\n\r\n\t\t\tthis.sandbox.restoreSelection(savedSel, true);\r\n\r\n\t\t\t// Unlock mutations listener after remove markup functionality.\r\n\t\t\tthis.sandbox.fireInAllApps('lockMutationsListener', { lock: false });\r\n\t\t}\r\n\t};\r\n\r\n\texports.GrammarMarkup = GrammarMarkup;\r\n\r\n}( WEBSPELLCHECKER.CORE ));\n(function() {\n\t/*\n\t * EC integration workflow.\n\t * 1. On document load check what WEBSPELLCHECKER.CORE already loaded.\n\t * 2. If false - call function loadWSCBundle (Now it's functionality does not use because EC integration included to wsc bundle).\n\t * 3. When WEBSPELLCHECKER.CORE defined call wscBundleLoadCallback.\n\t * 4. Define control manipulation methods. Run all ready callbacks. Run static (declarative) control creation.\n\t *\n\t * WEBSPELLCHECKER.init - create instance of EC integration.\n\t * if WSCBundle not loaded first load wscBundle. Subscribe on WEBSPELLCHECKER.ready\n\t *\n\t * init flow.\n\t * options: WEBSPELLCHECKER.init -> createInstance -> createApp -> WEBSPELLCHECKER._createApp.\n\t *\n\t * appInstance return:\n\t * createAppCallback -> callbackSuccess\n\t * for backward compatibility instance of App returned synchronous\n\t * WEBSPELLCHECKER._createApp -> createApp -> createInstance -> WEBSPELLCHECKER.init -> client code\n\t */\n\n\t/**\n\t * Represents default for Editable Controls configuration for a declarative initialization.\n\t *\n\t * @public\n\t * @constant\n\t * @type {Object}\n\t * @name WEBSPELLCHECKER_CONFIG\n\t *\n\t * @property {string} [serviceProtocol='http'] - The parameter allows to specify protocol for WSC service (entry point is ssrv.cgi) full path.\n\t * @property {string} [serviceHost='svc.webspellchecker.net'] - The parameter allows to specify host for WSC service (entry point is ssrv.cgi) full path.\n\t * @property {string} [servicePath='spellcheck31/script/ssrv.cgi'] - The parameter allows to specify path for WSC service (entry point is ssrv.cgi) full path.\n\t * @property {number} [servicePort='80'] - The parameter allows to specify default port for WSC service (entry point is ssrv.cgi) full path.\n\t * @property {string} [serviceId='1:j47ai-r4SLN1-dG5xP1-UuonU-WqXUZ3-0bzqZ1-QI8OP1-bQZcb1-KQuPE3-nWbcY3-aA4Zk4-wT9'] - The parameter sets the customer ID. It used for a migration from free, ad-supported version to paid, ad-free version.\n\t *\n\t * @example\n\t * <script>\n\t *     window.WEBSPELLCHECKER_CONFIG = {\n\t *         serviceProtocol: 'http',\n\t *         serviceHost: 'svc.webspellchecker.net',\n\t *         servicePath: 'spellcheck31/script/ssrv.cgi',\n\t *         servicePort: '80',\n\t *         enableGrammar: true,\n\t *         serviceId: '1:j47ai-r4SLN1-dG5xP1-UuonU-WqXUZ3-0bzqZ1-QI8OP1-bQZcb1-KQuPE3-nWbcY3-aA4Zk4-wT9'\n\t *     };\n\t * </script>\n\t *\n\t * <input data-wsc-autocreate=\"true\" type=\"text\" value=\"\">\n\t */\n\twindow.WEBSPELLCHECKER_CONFIG = window.WEBSPELLCHECKER_CONFIG || {};\n\n\twindow.WEBSPELLCHECKER = window.WEBSPELLCHECKER || {};\n\n\tvar isWSCBundleLoaded = (typeof WEBSPELLCHECKER.CORE !== 'undefined'),\n\t\twebspellcheckerReady = (typeof window.webspellcheckerReady === 'function') ? window.webspellcheckerReady : function () { },\n\t\tisWSCReady = false,\n\t\treadyCallbacks = [],\n\t\tOptionsManager = WEBSPELLCHECKER.OptionsManager,\n\t\toptionTypes = OptionsManager.optionTypes,\n\t\tAppTemplate = OptionsManager.importOptionsTemplate('AppTemplate'),\n\t\tECTemplate;\n\n\tECTemplate = OptionsManager.mergeOptionsTemplates({\n\t\tdisableOptionsStorage: { defaultValue: [], type: optionTypes.array }\n\t}, AppTemplate);\n\n\tECTemplate.setDefaults({\n\t\tappType: 'proofreader_editable_controls',\n\t\tautoStartup: true,\n\t\tunits: ['editableControls', 'spelling', 'grammar', 'ui']\n\t});\n\n\tfunction createInstance(options, callbackSuccess, callbackError) {\n\t\tvar config = window.WEBSPELLCHECKER_CONFIG,\n\t\t\tUtils = WEBSPELLCHECKER.CORE.prototype.Utils,\n\t\t\tcriticalMessage = '',\n\t\t\tlowerCaseName,\n\t\t\tECInstance,\n\t\t\tECInstanceResult,\n\t\t\terror;\n\n\t\toptions = options || {};\n\t\toptions.container = (typeof options.container === 'string') ? document.getElementById(options.container) : options.container;\n\n\t\toptions = Object.assign({}, options);\n\n\t\t//for fast debugging.\n\t\t(function(){\n\t\t\tfor (var k in ECTemplate) {\n\t\t\t\tif (typeof options[k] !== 'undefined') {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif ( config.hasOwnProperty(k) ) {\n\t\t\t\t\toptions[k] = config[k];\n\t\t\t\t}\n\t\t\t\t// html attributes parameters stored in Lower Case.\n\t\t\t\tlowerCaseName = k.toLowerCase();\n\n\t\t\t\tif ( options[lowerCaseName] && k.toLowerCase() !== k ) {\n\t\t\t\t\toptions[k] = options[lowerCaseName];\n\t\t\t\t\tdelete options[lowerCaseName];\n\t\t\t\t}\n\t\t\t}\n\t\t})();\n\t\toptions = OptionsManager.createOptions(options, ECTemplate, function errorHandler(errors) {\n\t\t\terrors.reports.forEach(function(report) {\n\t\t\t\tif (report.critical) { criticalMessage += report.message + '; '; }\n\t\t\t}, this);\n\t\t});\n\n\t\tif (criticalMessage !== '') {\n\t\t\terror = new Error(criticalMessage);\n\t\t\tcallbackError(error);\n\t\t\treturn error;\n\t\t}\n\n\t\tfunction createApp() {\n\t\t\tvar instance = WEBSPELLCHECKER._createApp(options, function(instance) {\n\t\t\t\t\t// if instance already defined\n\t\t\t\t\t// it happened when WEBSPELLCHECKER._createApp return instance immediately\n\t\t\t\t\t// it need for backward compatibility.\n\t\t\t\t\t// By new flow we _createApp work async.\n\t\t\t\t\tECInstance = ECInstance || extendAppInstance(instance);\n\t\t\t\t\tECInstance = createAppCallback(ECInstance);\n\t\t\t\t\tcallbackSuccess && callbackSuccess(ECInstance);\n\t\t\t\t});\n\n\t\t\t//TODO: remove after 5 version release.\n\t\t\t// Backward compatibility for sync webspellchecker using.\n\t\t\t// By new flow we fire callback only when all async modules ready.\n\t\t\tif (instance && !ECInstance) {\n\t\t\t\tECInstance = extendAppInstance(instance);\n\t\t\t}\n\t\t}\n\n\t\tfunction extendAppInstance(appInstance) {\n\t\t\tvar sandbox = appInstance._sandbox;\n\t\t\t/**\n\t\t\t * Represent a WEBSPELLCHECKER Editable Controls instance. Extends methods from the AppInstance.\n\t\t\t * Result of WEBSPELLCHECKER.init method\n\t\t\t * @see {@link WEBSPELLCHECKER.init}\n\t\t\t *\n\t\t\t * @typedef {AppInstance} EditableControlsInstance\n\t\t\t * @augments AppInstance\n\t\t\t * @namespace EditableControlsInstance\n\t\t\t */\n\t\t\tvar _ECInstance = {\n\t\t\t\t/**\n\t\t\t\t * Open dialog.<br>\n\t\t\t\t * Type of the dialog is 'pasteDialog' and 'baseDialog'.\n\t\t\t\t *\n\t\t\t\t * @public\n\t\t\t\t * @memberof EditableControlsInstance#\n\t\t\t\t *\n\t\t\t\t * @param {String} dialogName - Type of the dialog. Can be 'pasteDialog' and 'baseDialog'.\n\t\t\t\t * @example\n\t\t\t\t * var appInstance = WEBSPELLCHECKER.getControlById('originalElementId');\n\t\t\t\t * appInstance.openDialog('dialogName');\n\t\t\t\t */\n\t\t\t\topenDialog: function(dialogName) {\n\t\t\t\t\tappInstance.fire('openDialog', {\n\t\t\t\t\t\tdialogName: dialogName\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * Set CSS styles to a specified HTML control.\n\t\t\t\t *\n\t\t\t\t * @public\n\t\t\t\t *\n\t\t\t\t * @memberof EditableControlsInstance#\n\t\t\t\t * @param {Object} styles - Object with CSS styles.\n\t\t\t\t * @example\n\t\t\t\t * var appInstance = WEBSPELLCHECKER.getControlById('originalElementId');\n\t\t\t\t * appInstance.setCssStyles({\n\t\t\t\t *     color: 'red',\n\t\t\t\t *     width: '400px'\n\t\t\t\t * });\n\t\t\t\t */\n\t\t\t\tsetCssStyles: function(styles) {\n\t\t\t\t\tvar container = sandbox.getOption('container');\n\n\t\t\t\t\tfor (var style in styles) {\n\t\t\t\t\t\tif (styles.hasOwnProperty(style)) {\n\t\t\t\t\t\t\tcontainer.style[style] = styles[style];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * Set a shortcuts combination.<br>\n\t\t\t\t * Use the next combinations for modifier keys:<br>\n\t\t\t\t * <pre>\n\t\t\t\t * WEBSPELLCHECKER.CTRL - for 'ctrl' (on Windows) or 'command' (on Mac) key.\n\t\t\t\t * WEBSPELLCHECKER.ALT - for 'alt' key.\n\t\t\t\t * WEBSPELLCHECKER.SHIFT - for 'shift' key.\n\t\t\t\t * </pre>\n\t\t\t\t * For other keys use numerical code from the next link:<br>\n\t\t\t\t * {@link https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/keyCode}\n\t\t\t\t *\n\t\t\t\t * @public\n\t\t\t\t *\n\t\t\t\t * @memberof EditableControlsInstance#\n\t\t\t\t * @param {Array} shortcuts - Array of the Objects contains shortcuts combinations, callback function and context for callback function\n\t\t\t\t * @example\n\t\t\t\t * WEBSPELLCHECKER.init(options, function(instance) {\n\t                         *     instance.setShortcuts([{\n\t\t\t\t *         shortcut: SCAYT.CTRL + 81, // for 'ctrl + q' combination\n\t\t\t\t *         callback: function(){ alert(\"Hi\"); }\n\t\t\t         *     }]);\n\t                         * });\n\t\t\t\t *\n\t\t\t\t */\n\t\t\t\tsetShortcuts: function(shortcuts) {\n\t\t\t\t\tsandbox.fire('setShortcuts', {\n\t\t\t\t\t\tshortcuts: shortcuts\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * Remove a shortcuts combination.<br>\n\t\t\t\t * Use the next combinations for modifier keys:<br>\n\t\t\t\t * <pre>\n\t\t\t\t * WEBSPELLCHECKER.CTRL - for 'ctrl' (on Windows) or 'command' (on Mac) key.\n\t\t\t\t * WEBSPELLCHECKER.ALT - for 'alt' key.\n\t\t\t\t * WEBSPELLCHECKER.SHIFT - for 'shift' key.\n\t\t\t\t * </pre>\n\t\t\t\t * For other keys use numerical code from the next link:<br>\n\t\t\t\t * {@link https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/keyCode}\n\t\t\t\t *\n\t\t\t\t * @public\n\t\t\t\t *\n\t\t\t\t * @memberof EditableControlsInstance#\n\t\t\t\t * @param {Array} shortcuts - Array of the Objects contains shortcuts combinations and callback function\n\t\t\t\t * @example\n\t\t\t\t * var callback1 = function() {};\n\t\t\t\t * var callback2 = function() {};\n\t\t\t\t * var context = {};\n\t\t\t\t * var EditableControlsInstance= WEBSPELLCHECKER.getControlById('originalElementId');\n\t\t\t\t * wscInstance.setShortcuts([\n\t\t\t\t *     {\n\t\t\t\t *         shortcut: WEBSPELLCHECKER.CTRL + 66, // for 'ctrl + B' combination\n\t\t\t\t *         callback: callback1\n\t\t\t\t *     },\n\t\t\t\t *     {\n\t\t\t\t *         shortcut: WEBSPELLCHECKER.CTRL + WEBSPELLCHECKER.SHIFT + 66, // for 'ctrl + shift + B' combination\n\t\t\t\t *         callback: callback2, // 'this' in callback2 function will be the 'context' object\n\t\t\t\t *         context: context\n\t\t\t\t *     }\n\t\t\t\t * ]);\n\t\t\t\t *\n\t\t\t\t * wscInstance.removeShortcuts([\n\t\t\t\t *     {\n\t\t\t\t *         shortcut: WEBSPELLCHECKER.CTRL + 66, // for 'ctrl + B' combination\n\t\t\t\t *         callback: callback1\n\t\t\t\t *     },\n\t\t\t\t *     {\n\t\t\t\t *         shortcut: WEBSPELLCHECKER.CTRL + WEBSPELLCHECKER.SHIFT + 66, // for 'ctrl + shift + B' combination\n\t\t\t\t *         callback: callback2 // 'this' in callback2 function will be the 'context' object\n\t\t\t\t *     }\n\t\t\t\t * ]);\n\t\t\t\t */\n\t\t\t\tremoveShortcuts: function(shortcuts) {\n\t\t\t\t\tsandbox.fire('removeShortcuts', {\n\t\t\t\t\t\tshortcuts: shortcuts\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t_ECInstance = Object.assign(appInstance, _ECInstance);\n\n\t\t\treturn _ECInstance;\n\t\t}\n\n\t\tfunction createAppCallback( extendAppInstance ) {\n\t\t\tvar sandbox = extendAppInstance._sandbox,\n\t\t\t\tmaxLengthModule = extendAppInstance._getService('MaxLength'),\n\t\t\t\twrapper = extendAppInstance._getService('Wrapper');\n\n\t\t\t/**\n\t\t\t * Get length of text in the container.\n\t\t\t *\n\t\t\t * @public\n\t\t\t * @alias EditableControlsInstance.getTextLength\n\t\t\t *\n\t\t\t * @returns {number} - Length of text in the container.\n\t\t\t * @example\n\t\t\t * var EditableControlsInstance= WEBSPELLCHECKER.getControlById('originalElementId');\n\t\t\t * var textLength = wscInstance.getTextLength();\n\t\t\t */\n\t\t\textendAppInstance.getTextLength = function() {\n\t\t\t\treturn maxLengthModule.getTextLength();\n\t\t\t};\n\t\t\t/**\n\t\t\t * Refresh a instance.<br>\n\t\t\t * The method should be used when the native HTML element's content was changed programmatically.<br>\n\t\t\t * After calling wscInstance.refresh(), the markup in the control will be updated.\n\t\t\t *\n\t\t\t * @public\n\t\t\t * @alias EditableControlsInstance.refresh\n\t\t\t *\n\t\t\t * @example\n\t\t\t * var originalElement = document.getElementById('originalElementId');\n\t\t\t * var EditableControlsInstance= WEBSPELLCHECKER.getControlById('originalElementId');\n\t\t\t *\n\t\t\t * originalElement.value = 'Some new value';\n\t\t\t * wscInstance.refresh();\n\t\t\t */\n\t\t\textendAppInstance.refresh = function() {\n\t\t\t\tvar container = sandbox.getOption('container');\n\n\t\t\t\tif (wrapper.isTextBased) {\n\t\t\t\t\tcontainer.innerHTML = sandbox.DataProcessor.textToHtml(wrapper.getData(), wrapper.isInputBased);\n\t\t\t\t\textendAppInstance.reloadMarkup();\n\t\t\t\t}\n\t\t\t};\n\t\t\t/**\n\t\t\t * Get data from container.\n\t\t\t *\n\t\t\t * @public\n\t\t\t * @alias EditableControlsInstance.getData\n\t\t\t *\n\t\t\t * @returns {String} - Data from container.\n\t\t\t * @example\n\t\t\t * var EditableControlsInstance= WEBSPELLCHECKER.getControlById('originalElementId');\n\t\t\t * var data = wscInstance.getData(); // if original element is input/textarea - method returns text, else - html\n\t\t\t */\n\t\t\textendAppInstance.getData = function() {\n\t\t\t\t\treturn wrapper.getData();\n\t\t\t};\n\t\t\t/**\n\t\t\t * Set data to a container.\n\t\t\t *\n\t\t\t * @public\n\t\t\t * @alias EditableControlsInstance.setData\n\t\t\t *\n\t\t\t * @param {String} data - Data to set to a container\n\t\t\t * @example\n\t\t\t * var EditableControlsInstance= WEBSPELLCHECKER.getControlById('originalElementId');\n\t\t\t * wscInstance.setData('Some data'); // if original element is input/textarea - pass text, else - text or html\n\t\t\t */\n\t\t\textendAppInstance.setData = function(data) {\n\t\t\t\tif (typeof data !== 'string') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twrapper.setData(data);\n\t\t\t\textendAppInstance.reloadMarkup();\n\t\t\t};\n\n\t\t\tdelete extendAppInstance._sandbox;\n\t\t\tdelete extendAppInstance._getService;\n\t\t\treturn extendAppInstance;\n\t\t}\n\n\t\tfunction observeOnload() {\n\t\t\toptions.container.onload = function() {\n\t\t\t\tcreateApp();\n\t\t\t};\n\t\t}\n\n\t\t// If we in iframe we need to wait for 'load' event\n\t\tif (options.container &&  options.container.nodeName && options.container.nodeName.toLowerCase() === 'iframe') {\n\t\t\t// IE have bug with 'onload' event in iframe\n\t\t\t// So we should do next trick\n\t\t\tif (options.container.attachEvent) {\n\t\t\t\t// If iframe already loaded we can create instance\n\t\t\t\tif (options.container.readyState === 'complete') {\n\t\t\t\t\tcreateApp();\n\t\t\t\t} else {\n\t\t\t\t\toptions.container.attachEvent('onload', function() {\n\t\t\t\t\t\tcreateApp();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tvar win = options.container.contentWindow,\n\t\t\t\t\tdoc = win.document,\n\t\t\t\t\tblank = 'about:blank',\n\t\t\t\t\tsrc = options.container.src.trim();\n\n\t\t\t\t// If iframe already loaded we can create instance\n\t\t\t\tif (doc.readyState === 'interactive' || doc.readyState === 'complete') {\n\t\t\t\t\t// Chrome has bug with readyState for iframe\n\t\t\t\t\t// and initialize it with 'about:blank' page\n\t\t\t\t\t// So we need to check it and if so we should observe iframe onload\n\t\t\t\t\t// if no we should create instance immediately\n\t\t\t\t\t// http://stackoverflow.com/questions/17158932/how-to-detect-when-an-iframe-has-already-been-loaded\n\t\t\t\t\tif (Utils.Browser.chrome && win.location.href === blank && src !== blank) {\n\t\t\t\t\t\tobserveOnload();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcreateApp();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tobserveOnload();\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tcreateApp();\n\t\t}\n\n\t\treturn ECInstance;\n\t}\n\n\t/**\n\t *\n\t * @param {Object} params - Loading parameters and callbacks.\n\t */\n\tfunction loadScript(params) {\n\t\tvar script = document.createElement('script'),\n\t\t\thead = document.getElementsByTagName('head')[0];\n\n\t\tfunction removeScript(parent, script) {\n\t\t\tparent.removeChild(script);\n\t\t}\n\n\t\tscript['type'] = 'text/javascript';\n\t\tscript['src'] = params.url;\n\n\t\tscript.onload = function() {\n\t\t\tif (this.success) {\n\t\t\t\treturn; // for tests and for single call in IE8\n\t\t\t}\n\n\t\t\tthis.success = true;\n\t\t\tparams.onSuccess();\n\t\t\tremoveScript(head, script);\n\t\t};\n\n\t\tscript.onerror = function() {\n\t\t\tparams.onError();\n\t\t\tremoveScript(head, script);\n\t\t};\n\n\t\thead.appendChild(script);\n\t}\n\n\t// Now it's doesn't work. We bundle all in one file. But in future maybe should separate.\n\tfunction loadWSCBundle(params) {\n\t\tparams.url = '../wscbundle/wscbundle.js';\n\t\tloadScript(params);\n\t}\n\t/**\n\t *\n\t */\n\tfunction wscBundleLoadCallback() {\n\t\t/**\n\t\t * Get a instance by ID.\n\t\t *\n\t\t * @public\n\t\t *\n\t\t * @static\n\t\t * @param {String} id - ID of the original element.\n\t\t * @returns {EditableControlsInstance} - an instance of Editable Controls application.\n\t\t * @example\n\t\t * var EditableControlsInstance= WEBSPELLCHECKER.getControlById('originalElementId');\n\t\t */\n\t\tWEBSPELLCHECKER.getControlById = function(id) {\n\t\t\treturn WEBSPELLCHECKER.CORE.prototype.instanceManager.getControlById(id);\n\t\t};\n\n\t\t/**\n\t\t * Create an instance by ID or from passed HTML element.\n\t\t *\n\t\t * @public\n\t\t *\n\t\t * @static\n\t\t * @param {String} id - ID of the original element.\n\t\t * @param {Options} options\n\t\t * @param {InitCallbackSuccess} SuccessCallback - Callback function.\n\t\t * @param {CallbackError} ErrorCallback - Callback function.\n\t\t *\n\t\t * @returns {EditableControlsInstance} - link to an instance of Editable Controls application.\n\t\t * @example\n\t\t * var EditableControlsInstance;\n\t\t * WEBSPELLCHECKER.createControlById('originalElementId', {\n\t\t *         autoStartup: true,\n\t\t *         spellcheckLang: 'de_DE',\n\t\t *         localization: 'de',\n\t\t *         serviceProtocol: 'http',\n\t\t *         servicePort: '80',\n\t\t *         serviceHost: document.location.host,\n\t\t *         servicePath: 'spellcheck/script/ssrv.cgi'\n\t\t *     },\n\t\t *     function(instance) {\n\t\t *         EditableControlsInstance = instance;\n\t\t *     }\n\t\t * );\n\t\t */\n\t\tWEBSPELLCHECKER.createControlById = function(id, options, onSuccess, onError) {\n\t\t\toptions = options || {};\n\t\t\toptions.container = document.getElementById(id);\n\n\t\t\tWEBSPELLCHECKER.init(options, onSuccess, onError);\n\t\t};\n\n\t\treadyCallbacks.forEach(function(callback) {\n\t\t\tcallback();\n\t\t});\n\n\t\twebspellcheckerReady();\n\t\tisWSCReady = true;\n\n\t\t/**\n\t\t * Represent a WEBSPELLCHECKER auto search creation mechanism.\n\t\t *\n\t\t * @namespace AutoSearchCreation\n\t\t *\n\t\t * @property {boolean} [WEBSPELLCHECKER_CONFIG.autoSearch=false] - The parameter turns on the autoSearch mechanism that automatically detects editable fields on the page and on focus enables proofreading in them.\n\t\t *\n\t\t * @property {array} [WEBSPELLCHECKER_CONFIG.disableAutoSearchIn=['input']] - The parameter allows disabling the autoSearch mechanism by class, id, data attribute name and HTML elements.\n\t\t * If enableAutoserchIn option is specified than this option will be ignored.\n\t\t * Possible values are:\n \t\t * '.class' - disable autoSearch for elements with a specified class.\n \t\t * '#id' - disable autoSearch for elements with a specified id.\n \t\t * '[data-attribute]' - disable autoSearch for elements with a specified data attribute name.\n \t\t * 'textarea' - disable autoSearch for HTML elements (e.g. textarea, input).\n\t\t * \n\t\t * @property {array} [WEBSPELLCHECKER_CONFIG.enableAutoSearchIn=[]] - The parameter allows enabling the autoSearch mechanism only for elements with provided class, id, data attribute name or HTML elements type.\n\t\t * Possible values are:\n \t\t * '.class' - enable autoSearch for elements with a specified class.\n \t\t * '#id' - enable autoSearch for elements with a specified id.\n \t\t * '[data-attribute]' - enable autoSearch for elements with a specified data attribute name.\n \t\t * 'textarea' - enable autoSearch for HTML elements (e.g. textarea, input).\n\t\t *\n\t\t *\n\t\t * @example\n\t\t * <script>\n\t\t *     window.WEBSPELLCHECKER_CONFIG = {\n\t\t *         autoSearch: true,\n\t\t *         disableAutoSearchIn: ['.class', '#id', '[data-attribute]', 'textarea'], // will be ignored if enableAutoSearchIn option is specified\n\t\t *         enableAutoSearchIn: ['.class', '#id', '[data-attribute]', 'textarea'],\n\t\t *         serviceId: \"Your current service ID\",\n\t\t *         enableGrammar: true,\n\t\t *         serviceProtocol: 'https',\n\t\t *         serviceHost: 'svc.webspellchecker.net',\n\t\t *         servicePath: 'spellcheck31/script/ssrv.cgi',\n\t\t *         servicePort: '443',\n\t\t *         lang: 'en_US'\n\t\t *     }\n\t\t * </script>\n\t\t *\n\t\t * <script src=\"https://svc.webspellchecker.net/spellcheck31/wscbundle/wscbundle.js\"></script>\n\t\t */\n\t\t(function() {\n\t\t\tvar UILib = WEBSPELLCHECKER.CORE.prototype.UILib,\n\t\t\t\tUtils = WEBSPELLCHECKER.CORE.prototype.Utils,\n\t\t\t\tinstanceManager = WEBSPELLCHECKER.CORE.prototype.instanceManager,\n\t\t\t\ttimeoutDelay = 2000,\n\t\t\t\tfilterBy = {\n\t\t\t\t\tclasses: [],\n\t\t\t\t\tattributes: [],\n\t\t\t\t\tids: [],\n\t\t\t\t\telements: []\n\t\t\t\t},\n\t\t\t\tfilters = {\n\t\t\t\t\tenable: function(element) {\n\t\t\t\t\t\tif ( !isElementInFilters(element) ) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tdisable: function (element) {\n\t\t\t\t\t\tif ( isElementInFilters(element) ) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tvisibilityApiData = Utils.getVisibilityApiData(),\n\t\t\t\toptions,\n\t\t\t\ttimeoutId,\n\t\t\t\tfilterType;\n\n\t\t\tif (WEBSPELLCHECKER._autoSearchCreationActivated) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tUILib.domReady(function () {\n\t\t\t\tautoSearchCreation();\n\t\t\t});\n\n\t\t\tfunction autoSearchCreation() {\n\t\t\t\tvar baseScript = Utils.getBaseData('wscbundle.js').script,\n\t\t\t\t\toptionAttrPrefix = 'data-wsc-',\n\t\t\t\t\tautosearch;\n\n\t\t\t\tif (!baseScript) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\toptions = Utils.getOptionsFromDataAttrs(baseScript, optionAttrPrefix);\n\n\t\t\t\tautosearch = options.autosearch || window.WEBSPELLCHECKER_CONFIG.autoSearch;\n\n\t\t\t\tif ( !autosearch || !Utils.isMutationObserver() ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tWEBSPELLCHECKER._autoSearchCreationActivated = true;\n\n\t\t\t\toptions.autoStartup = (options.autostartup === false || window.WEBSPELLCHECKER_CONFIG.autoStartup === false) ? false : true;\n\t\t\t\toptions.enableBadgeButton = true;\n\t\t\t\toptions.units = ['spelling', 'grammar', 'ui', 'autoSearchCreation'];\n\t\t\t\toptions.appType = 'proofreader_autosearch';\n\n\t\t\t\tif (!options.disableoptionsstorage && !window.WEBSPELLCHECKER_CONFIG.disableOptionsStorage) {\n\t\t\t\t\toptions.disableOptionsStorage = ['all'];\n\t\t\t\t}\n\n\t\t\t\tconfigureFilterFunctionality();\n\t\t\t\tstartActiveElementChecking();\n\n\t\t\t\tUILib.on('blur', window, createInstanceIfRequired);\n\t\t\t\tUILib.on('focusin', document, createInstanceIfRequired);\n\t\t\t\tvisibilityApiData.hidden && UILib.on(visibilityApiData.visibilityChangeEvent, document, handleVisibilityChange);\n\t\t\t}\n\n\t\t\tfunction startActiveElementChecking() {\n\t\t\t\ttimeoutId = setTimeout(function () {\n\t\t\t\t\tstartActiveElementChecking();\n\t\t\t\t}, timeoutDelay);\n\n\t\t\t\tcreateInstanceIfRequired();\n\t\t\t}\n\n\t\t\tfunction stopActiveElementChecking() {\n\t\t\t\tclearTimeout(timeoutId);\n\t\t\t\ttimeoutId = null;\n\t\t\t}\n\n\t\t\tfunction handleVisibilityChange() {\n\t\t\t\tif (document[visibilityApiData.hidden]) {\n\t\t\t\t\tstopActiveElementChecking();\n\t\t\t\t} else {\n\t\t\t\t\tstartActiveElementChecking();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction configureFilterFunctionality() {\n\t\t\t\tvar enableAutoSearchIn = options.enableautosearchin || window.WEBSPELLCHECKER_CONFIG.enableAutoSearchIn,\n\t\t\t\t\tdisableAutoSearchIn = options.disableautosearchin || window.WEBSPELLCHECKER_CONFIG.disableAutoSearchIn,\n\t\t\t\t\twithoutFilters = !enableAutoSearchIn && !disableAutoSearchIn,\n\t\t\t\t\tarr;\n\n\t\t\t\t// Enable functionality has highest priority than disable\n\t\t\t\tif (enableAutoSearchIn) {\n\t\t\t\t\tarr = enableAutoSearchIn;\n\t\t\t\t\tfilterType = 'enable';\n\t\t\t\t} else {\n\t\t\t\t\tarr = disableAutoSearchIn || [];\n\t\t\t\t\tfilterType = 'disable';\n\t\t\t\t}\n\n\t\t\t\tfor (var i = 0; i < arr.length; i++) {\n\t\t\t\t\tvar item = arr[i];\n\n\t\t\t\t\tswitch (item[0]) {\n\t\t\t\t\t\tcase '.':\n\t\t\t\t\t\t\tfilterBy.classes.push( item.substring(1) );\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase '#':\n\t\t\t\t\t\t\tfilterBy.ids.push( item.substring(1) );\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase '[':\n\t\t\t\t\t\t\tfilterBy.attributes.push( item.substring(1, item.length - 1) );\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tfilterBy.elements.push(item);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (withoutFilters) {\n\t\t\t\t\tfilterBy.elements.push('input');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction isElementInFilters(element) {\n\t\t\t\t// Case for filter by 'class'\n\t\t\t\tfor (var i = 0; i < filterBy.classes.length; i++) {\n\t\t\t\t\tif ( UILib.hasClass(element, filterBy.classes[i]) ) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Case for filter by 'attribute'\n\t\t\t\tfor (var i = 0; i < filterBy.attributes.length; i++) {\n\t\t\t\t\tif ( UILib.attr(element, filterBy.attributes[i]) ) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Case for filter by 'id'\n\t\t\t\tfor (var i = 0; i < filterBy.ids.length; i++) {\n\t\t\t\t\tif (element.id === filterBy.ids[i]) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Case for filter by 'element'\n\t\t\t\tfor (var i = 0; i < filterBy.elements.length; i++) {\n\t\t\t\t\tif ( element.nodeName.toLowerCase() === filterBy.elements[i].toLowerCase() ) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tfunction isDisabledByDefault(element) {\n\t\t\t\tvar disableByClass = ['sc-input-text', 'sc-cm-paste-holder', 'public-DraftEditor-content', 'wsc-input'];\n\n\t\t\t\tfor (var i = 0; i < disableByClass.length; i++) {\n\t\t\t\t\tif ( UILib.hasClass(element, disableByClass[i]) ) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tfunction getActiveElementWithoutInstance() {\n\t\t\t\tvar activeElement = document.activeElement,\n\t\t\t\t\tbody = document.getElementsByTagName('body')[0],\n\t\t\t\t\tisBody = activeElement === body ? true : false,\n\t\t\t\t\tisIframe = activeElement && activeElement.nodeName && activeElement.nodeName.toLowerCase() === 'iframe',\n\t\t\t\t\tisTextBased = Utils.isTextBased(activeElement),\n\t\t\t\t\tisInputBased = Utils.isInputBased(activeElement),\n\t\t\t\t\telement = activeElement,\n\t\t\t\t\tinstanceClass = ECTemplate.getDefaultValue('instance_class'),\n\t\t\t\t\tiframeBody, parentsEditable;\n\n\t\t\t\t// We should work with iframes carefully.\n\t\t\t\t// For cross-origin iframes we need to keep in mind next exception:\n\t\t\t\t// Uncaught DOMException: Blocked a frame with origin \"_\" from accessing a cross-origin frame.\n\t\t\t\t// And with iframes without body.\n\t\t\t\tif (isIframe) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tiframeBody = activeElement.contentWindow.document.getElementsByTagName('body')[0];\n\t\t\t\t\t} catch (e) {}\n\n\t\t\t\t\tif (iframeBody) {\n\t\t\t\t\t\telement = iframeBody;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tactiveElement = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// In some cases activeElement can be null\n\t\t\t\tif (!activeElement) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\t// Case for already created instance\n\t\t\t\tif ( instanceManager.getInstanceByElement(element) !== null) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\t// Case for disabled by default elements\n\t\t\t\tif ( isDisabledByDefault(element) ) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\t// Case for filter functionality\n\t\t\t\tif ( filters[filterType](activeElement) ) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\t// Case for model editor\n\t\t\t\tif ( Utils.isModelEditor(element) ) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\telement: element,\n\t\t\t\t\t\tmodelEditor: true\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Case for CKEditor5\n\t\t\t\tif ( Utils.isCKEditor5(element) ) {\n\t\t\t\t\tif (!element.editor || !element.editor.getData || !element.editor.setData) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\telement: element,\n\t\t\t\t\t\tmodelEditor: true,\n\t\t\t\t\t\tiframe: isIframe ? activeElement : null\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Case for body or iframe\n\t\t\t\tif (isBody || isIframe) {\n\t\t\t\t\t// In element variable we have main body or iframe's body in this case\n\t\t\t\t\t// If element is not editable\n\t\t\t\t\tif (!element.isContentEditable) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\telement: element,\n\t\t\t\t\t\tiframe: isIframe ? activeElement : null\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// Case for text based elements\n\t\t\t\tif (isTextBased) {\n\t\t\t\t\t// We can not support inputs in MS EDGE browser because it has next bug:\n\t\t\t\t\t// 'scrollLeft for text input elements is always 0'\n\t\t\t\t\t// https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/1032362/\n\t\t\t\t\t// Additional discussion:\n\t\t\t\t\t// https://github.com/LeaVerou/stretchy/issues/9\n\t\t\t\t\tif (Utils.Browser.edge && isInputBased) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\n\t\t\t\t\t// We can not support textarea with horizontal scroll\n\t\t\t\t\tif (!isInputBased) {\n\t\t\t\t\t\tif ( element.getAttribute('wrap') === 'off' || Utils.getComputedStyle(element)['whiteSpace'] === 'nowrap' ) {\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// For disabled, read only or hidden elements\n\t\t\t\t\tif (element.disabled || element.readOnly || Utils.isHidden(element) ) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\telement: element\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// For case if active element is not body, iframe or text based\n\t\t\t\t// If instance was created for nearest parent of current element\n\t\t\t\tif ( UILib.parents(element, '.' + instanceClass)[0] ) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\t// IE doesn't use uppermost contenteditable ancestor\n\t\t\t\t// And for case when we have next html:\n\t\t\t\t// <div contenteditable=\"true\">\n\t\t\t\t//     <p>Text</p>\n\t\t\t\t//     <p contenteditable=\"false\">\n\t\t\t\t//         Text\n\t\t\t\t//         <span contenteditable=\"true\">Text</span>\n\t\t\t\t//     </p>\n\t\t\t\t// </div>\n\t\t\t\t// We need to check parents contenteditable elements manually\n\t\t\t\tparentsEditable = UILib.parents(element, '[contenteditable=\"true\"]');\n\n\t\t\t\t// We need to initialize our instance on the uppermost contenteditable ancestor\n\t\t\t\tif (parentsEditable.length) {\n\t\t\t\t\telement = parentsEditable[parentsEditable.length - 1];\n\t\t\t\t}\n\n\t\t\t\t// If element is not editable\n\t\t\t\tif (!element.isContentEditable) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\telement: element\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tfunction createInstanceIfRequired() {\n\t\t\t\t// We need work with timeout because firefox doesn't change active element immediately\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tvar activeElement = getActiveElementWithoutInstance(),\n\t\t\t\t\t\t_options = Object.assign({}, options);\n\n\t\t\t\t\tif (!activeElement) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t_options.isModelEditor = activeElement.modelEditor ? true : false;\n\t\t\t\t\t_options.container = activeElement.iframe ? activeElement.iframe : activeElement.element;\n\n\t\t\t\t\tcreateInstance(_options);\n\t\t\t\t}, 0);\n\t\t\t}\n\t\t})();\n\n\t\t/**\n\t\t * Static control creation\n\t\t */\n\t\t(function staticControlCreation() {\n\t\t\tvar optionAttrPrefix = 'data-wsc-',\n\t\t\t\tUILib = WEBSPELLCHECKER.CORE.prototype.UILib,\n\t\t\t\tUtils = WEBSPELLCHECKER.CORE.prototype.Utils;\n\n\t\t\tif (WEBSPELLCHECKER._staticControlCreationActivated) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tWEBSPELLCHECKER._staticControlCreationActivated = true;\n\n\t\t\tUILib.domReady(function() {\n\t\t\t\t//domReady for backwardcompatibility should run before that.\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tvar options,\n\t\t\t\t\t\teditableContols = UILib.find('*[' + optionAttrPrefix + 'autocreate]');\n\n\t\t\t\t\tfor (var i = 0; i < editableContols.length; i++ ) {\n\t\t\t\t\t\toptions = Utils.getOptionsFromDataAttrs(editableContols[i], optionAttrPrefix);\n\t\t\t\t\t\toptions.container = editableContols[i];\n\t\t\t\t\t\toptions.autoStartup = (options.autostartup === false) ? false : true;\n\t\t\t\t\t\t(function(i) {\n\t\t\t\t\t\t\tcreateInstance(options,\n\t\t\t\t\t\t\t\tfunction(instance) {\n\t\t\t\t\t\t\t\t\t// @TODO: can't write instance as data-spelling attribute\n\t\t\t\t\t\t\t\t\t// as there is no such functionality in jquip. See jQuery data functionality\n\t\t\t\t\t\t\t\t\teditableContols[i].webspellcheckerInstance = instance;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t})(i);\n\t\t\t\t\t}\n\n\t\t\t\t\t/**\n\t\t\t\t\t * The function which runs when wscbundle.js is already loaded.\n\t\t\t\t\t * @name webspellcheckerAlreadyLoaded\n\t\t\t\t\t * @function\n\t\t\t\t\t * @global\n\t\t\t\t\t * @public\n\t\t\t\t\t *\n\t\t\t\t\t * @example\n\t\t\t\t\t * // Asynchronous loading\n\t\t\t\t\t * <script async src=\"path/to/wscbundle.js\"></script>\n\t\t\t\t\t *\n\t\t\t\t\t * <script>\n\t\t\t\t\t *     // Define the function 'webspellcheckerAlreadyLoaded' which will be launched right after is fully loaded.\n\t\t\t\t\t *     function webspellcheckerAlreadyLoaded() {\n\t\t\t\t\t *         // is available to be launched\n\t\t\t\t\t *         WEBSPELLCHECKER.init({\n\t\t\t\t\t *             container: document.getElementById('elementId'),\n\t\t\t\t\t *             autoStartup: true,\n\t\t\t\t\t *             serviceProtocol: 'http',\n\t\t\t\t\t *             servicePort: '80',\n\t\t\t\t\t *             serviceHost: document.location.host,\n\t\t\t\t\t *             servicePath: 'spellcheck/script/ssrv.cgi'\n\t\t\t\t\t *     });\n\t\t\t\t\t * }\n\t\t\t\t\t * </script>\n\t\t\t\t\t */\n\t\t\t\t\tif (window.webspellcheckerAlreadyLoaded) {\n\t\t\t\t\t\twindow.webspellcheckerAlreadyLoaded();\n\t\t\t\t\t}\n\t\t\t\t}, 20)\n\t\t\t});\n\t\t})();\n\n\t\t/**\n\t\t * Setup focus on fake div if original element (input/texarea) has 'autofocus' attribute\n\t\t */\n\t\t(function setupAutofocus() {\n\t\t\tvar UILib = WEBSPELLCHECKER.CORE.prototype.UILib;\n\n\t\t\tUILib.domReady(function() {\n\t\t\t\tvar firstAutofocusElement = UILib.find('*[autofocus]')[0],\n\t\t\t\t\twscElement = firstAutofocusElement && firstAutofocusElement.proofraytFakeElement;\n\n\t\t\t\tif (wscElement && wscElement.contentEditable) {\n\t\t\t\t\twscElement.focus();\n\t\t\t\t}\n\t\t\t});\n\t\t})();\n\t}\n\t/**\n\t * Handler of WebSpellChecker ready to work.\n\t * @private\n\t * @param {function} handler - ready handler.\n\t */\n\tWEBSPELLCHECKER.ready = function(callback) {\n\t\tif (isWSCReady === false) {\n\t\t\treadyCallbacks.push(callback);\n\t\t} else {\n\t\t\tcallback();\n\t\t}\n\t};\n\n\t/**\n\t * init success Callback.\n\t *\n\t * @callback InitCallbackSuccess\n\t * @param {EditableControlsInstance} - link to instance of Editable controls application.\n\t */\n\n\t/**\n\t * Create Webspellchecker application for Editable controls.\n\t *\n\t * @param {Options} options\n\t * @param {InitCallbackSuccess} callbackSuccess\n\t * @param {CallbackError} callbackError\n\t *\n\t * @return {EditableControlsInstance} - link to instance of Editable Controls application.\n\t * @example\n\t * var EditableControlsInstance;\n\t * WEBSPELLCHECKER.init({\n\t *         container: 'originalElementId'\n\t *         autoStartup: true,\n\t *         spellcheckLang: 'de_DE',\n\t *         localization: 'de',\n\t *         serviceProtocol: 'http',\n\t *         servicePort: '80',\n\t *         serviceHost: document.location.host,\n\t *         servicePath: 'spellcheck/script/ssrv.cgi'\n\t *     },\n\t *     function(instance) {\n\t *         EditableControlsInstance = instance;\n\t *     },\n\t *     function(error) {\n\t *         console.log(error);\n\t *     }\n\t * );\n\t */\n\tWEBSPELLCHECKER.init = function(options, callbackSuccess, callbackError) {\n\t\tvar isFunction = WEBSPELLCHECKER.Utils.TypeChecker.isFunction,\n\t\t\tsyncInstance;\n\n\t\tcallbackSuccess = isFunction(callbackSuccess) ? callbackSuccess : function() {};\n\t\tcallbackError = isFunction(callbackError) ? callbackError : function(err) {\n\t\t\tthrow err;\n\t\t};\n\n\t\tif (isWSCReady === false) {\n\t\t\tWEBSPELLCHECKER.ready(function() {\n\t\t\t\tcreateInstance(options, callbackSuccess, callbackError);\n\t\t\t});\n\t\t} else {\n\t\t\tsyncInstance = createInstance(options, callbackSuccess, callbackError);\n\n\t\t\treturn syncInstance;\n\t\t}\n\t};\n\n\tif (isWSCBundleLoaded === false) {\n\t\tloadWSCBundle({\n\t\t\tonSuccess: function() {\n\t\t\t\twscBundleLoadCallback();\n\t\t\t\tisWSCBundleLoaded = true;\n\t\t\t},\n\t\t\tonError: function() {}\n\t\t});\n\t} else {\n\t\twscBundleLoadCallback();\n\t}\n})();\n\n// mirror.js\n/**\n * @fileoverview of CORE mirror module.\n */\n\n(function( exports ) {\n\t'use strict';\n\n\tvar UILib = exports.prototype.UILib,\n\t\tUtils = exports.prototype.Utils,\n\t\tDataProcessor = exports.prototype.DataProcessor;\n\n\t/**\n\t * Represents Mirror Module.\n\t *\n\t * @constructor\n\t * @alias CORE.Mirror\n\t * @param {String} moduleID\n\t * @param {CORE.Sandbox} sandbox\n\t */\n\tvar Mirror = function(moduleID, sandbox) {\n\t\t/**\n\t\t * Module name.\n\t\t *\n\t\t * @type {String}\n\t\t*/\n\t\tthis.name = moduleID;\n\n\t\t/**\n\t\t * Reference to Mirror module sandbox.\n\t\t *\n\t\t * @type {CORE.Sandbox}\n\t\t */\n\t\tthis.sandbox = sandbox;\n\n\t\t/**\n\t\t * Link on the original element.\n\t\t *\n\t\t * @type {Node}\n\t\t */\n\t\tthis.originalElement = this.sandbox.getOption('originalContainer');\n\n\t\t/**\n\t\t * Link on the mirror element.\n\t\t *\n\t\t * @type {Null|Node}\n\t\t */\n\t\tthis.mirrorElement = null;\n\n\t\t/**\n\t\t * Link on the mirror element text container.\n\t\t *\n\t\t * @type {Null|Node}\n\t\t */\n\t\tthis.mirrorElementTextContainer = null;\n\n\t\t/**\n\t\t * Old text in the original text based container.\n\t\t *\n\t\t * @type {String}\n\t\t */\n\t\tthis.oldText = '';\n\n\t\t/**\n\t\t * Indicate if original element is input based.\n\t\t *\n\t\t * @type {Boolean}\n\t\t */\n\t\tthis.isInput = Utils.isInputBased(this.originalElement);\n\n\t\t/**\n\t\t * Indicate if current browser is IE11.\n\t\t *\n\t\t * @type {Boolean}\n\t\t */\n\t\tthis.isIE11 = Utils.Browser.ie && Utils.Browser.version === 11;\n\n\t\t/**\n\t\t * Indicate if left mouse button pressed in the original element.\n\t\t *\n\t\t * @type {Boolean}\n\t\t */\n\t\tthis.leftMouseButtonPressed = false;\n\n\t\t/**\n\t\t * Timeout delay.\n\t\t *\n\t\t * @type {Number}\n\t\t */\n\t\tthis.timeoutDelay = 1000;\n\n\t\t/**\n\t\t * Timeout identifier.\n\t\t *\n\t\t * @type {Number}\n\t\t */\n\t\tthis.timeoutId = null;\n\n\t\t/**\n\t\t * Object with options, specifies which DOM mutations should be reported.\n\t\t *\n\t\t * @type {Object}\n\t\t */\n\t\tthis.mutationOptions = {\n\t\t\tattributes: true,\n\t\t\tattributeOldValue: false,\n\t\t\tchildList: false,\n\t\t\tcharacterData: false,\n\t\t\tcharacterDataOldValue: false,\n\t\t\tsubtree: false\n\t\t};\n\n\t\t/**\n\t\t * Object for text node parts from mirror element.\n\t\t *\n\t\t * @type {Object}\n\t\t */\n\t\tthis.textNodeParts = {};\n\n\t\t/**\n\t\t * Nodes to remove after text changing in mirror element.\n\t\t *\n\t\t * @type {Array}\n\t\t */\n\t\tthis.nodesToRemove = [];\n\n\t\t/**\n\t\t * Object with data about Visibility API.\n\t\t *\n\t\t * @type {Object}\n\t\t */\n\t\tthis.visibilityApiData = Utils.getVisibilityApiData();\n\n\t\t/**\n\t\t * Properties that will be copied into the mirror div.\n\t\t *\n\t\t * @type {Array}\n\t\t */\n\t\tthis.properties = {\n\t\t\touter: [\n\t\t\t\t'boxSizing',\n\t\t\t\t'width',\n\t\t\t\t'height',\n\t\t\t\t'overflowX',\n\t\t\t\t'overflowY',\n\n\t\t\t\t'borderTopWidth',\n\t\t\t\t'borderRightWidth',\n\t\t\t\t'borderBottomWidth',\n\t\t\t\t'borderLeftWidth',\n\t\t\t\t'borderTopStyle',\n\t\t\t\t'borderRightStyle',\n\t\t\t\t'borderBottomStyle',\n\t\t\t\t'borderLeftStyle',\n\t\t\t\t'borderTopLeftRadius',\n\t\t\t\t'borderTopRightRadius',\n\t\t\t\t'borderBottomRightRadius',\n\t\t\t\t'borderBottomLeftRadius',\n\n\t\t\t\t'paddingTop',\n\t\t\t\t'paddingRight',\n\t\t\t\t'paddingBottom',\n\t\t\t\t'paddingLeft',\n\n\t\t\t\t'fontSize',\n\t\t\t\t'lineHeight',\n\t\t\t\t'fontFamily',\n\n\t\t\t\t'textAlign'\n\t\t\t],\n\t\t\tinner: [\n\t\t\t\t'direction',\n\n\t\t\t\t'fontStyle',\n\t\t\t\t'fontVariant',\n\t\t\t\t'fontWeight',\n\t\t\t\t'fontStretch',\n\t\t\t\t'fontSize',\n\t\t\t\t'fontSizeAdjust',\n\t\t\t\t'lineHeight',\n\t\t\t\t'fontFamily',\n\n\t\t\t\t'textAlign',\n\t\t\t\t'textTransform',\n\t\t\t\t'textIndent',\n\t\t\t\t'textDecoration',\n\n\t\t\t\t'letterSpacing',\n\t\t\t\t'wordSpacing',\n\n\t\t\t\t'tabSize',\n\t\t\t\t'MozTabSize'\n\t\t\t],\n\t\t\tbackground: [\n\t\t\t\t'backgroundClip',\n\t\t\t\t'backgroundColor',\n\t\t\t\t'backgroundImage',\n\t\t\t\t'backgroundOrigin',\n\t\t\t\t'backgroundPosition',\n\t\t\t\t'backgroundRepeat',\n\t\t\t\t'backgroundSize',\n\t\t\t\t'backgroundAttachment'\n\t\t\t]\n\t\t};\n\t};\n\n\tMirror.prototype = {\n\t\t/**\n\t\t * Called after each registration in core.\n\t\t *\n\t\t * @memberof CORE.Mirror#\n\t\t */\n\t\tinit: function() {\n\t\t\tvar self = this;\n\t\t\t\n\t\t\t// We do not need to initialize this module if original element is not text based or hidden\n\t\t\tif (!Utils.isTextBased(this.originalElement) || Utils.isHidden(this.originalElement) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// If browser does not support MutationObserver we do not need create MutationObserver\n\t\t\t// and start to observe it\n\t\t\tif ( !('MutationObserver' in window) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.createMirrorElement();\n\t\t\tthis.copyStyles(true);\n\t\t\tthis.renderProblems([]);\n\t\t\tthis.startChecking();\n\n\t\t\tthis.sandbox.setContainer(this.mirrorElement);\n\t\t\tthis.sandbox.setOption('documentContainer', this.mirrorElement);\n\t\t\tthis.sandbox.setOption('mirrorBasedInstance', true);\n\t\t\tthis.sandbox.setOption('isTextBasedContainer', true);\n\n\t\t\tthis.mutationObserver = new window.MutationObserver( this.handleMutations.bind(this) );\n\t\t\tthis.startInputListener();\n\n\t\t\t// Safari does not react on textarea and div resize\n\t\t\t// So we do not need to work with MutationObserver and periodicalChecking for Safari\n\t\t\tif (!Utils.Browser.safari) {\n\t\t\t\tthis.startMutationObserver();\n\n\t\t\t\tthis.sandbox.subscribe('periodicalChecking', function (data) {\n\t\t\t\t\tself.copyStyles(true);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'scroll',\n\t\t\t\telement: this.originalElement,\n\t\t\t\thandler: this.handleScroll\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'textReplaced',\n\t\t\t\thandler: this.updateTextInOriginalContainer\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe('periodicalChecking', function (data) {\n\t\t\t\tself.copyStyles(true);\n\t\t\t});\n\n\t\t\tif (this.isInput) {\n\t\t\t\tthis.sandbox.subscribe({\n\t\t\t\t\teventType: 'input, keyup, click, change, mousewheel, touchmove',\n\t\t\t\t\telement: this.originalElement,\n\t\t\t\t\thandler: this.handleScroll\n\t\t\t\t});\n\n\t\t\t\tthis.sandbox.subscribe({\n\t\t\t\t\teventType: 'focus, blur',\n\t\t\t\t\telement: this.originalElement,\n\t\t\t\t\thandler: this.handleScrollWithDelay\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Page Visibility API for the opportunity to not perform unnecessary tasks when the webpage is not visible\n\t\t\tif (this.visibilityApiData.hidden) {\n\t\t\t\tthis.sandbox.subscribe({\n\t\t\t\t\teventType: this.visibilityApiData.visibilityChangeEvent,\n\t\t\t\t\telement: document,\n\t\t\t\t\thandler: this.handleVisibilityChange\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t* Create mirror div element for text based original element.\n\t\t*\n\t\t* @memberof CORE.Mirror#\n\t\t*/\n\t\tcreateMirrorElement: function() {\n\t\t\tvar computed = Utils.getComputedStyle(this.originalElement),\n\t\t\t\telement = null,\n\t\t\t\telementTextContainer = null;\n\n\t\t\telement = UILib.create('<div>')[0];\n\t\t\telement.style.position = 'absolute';\n\t\t\telement.style.whiteSpace = 'pre-wrap';\n\t\t\telement.style.borderColor = 'transparent';\n\t\t\telement.style.color = 'transparent';\n\n\t\t\t// Only for textarea\n\t\t\tif (!this.isInput) {\n\t\t\t\telement.style.wordWrap = 'break-word';\n\t\t\t}\n\n\t\t\tUILib.attr(element, 'contenteditable', true);\n\t\t\tUILib.attr(element, 'spellcheck', false);\n\t\t\tUILib.attr(element, 'aria-readonly', false);\n\t\t\tUILib.attr(element, 'tabindex', -1);\n\t\t\tUILib.addClass(element, 'wsc-mirror');\n\n\t\t\tfor (var i = 0; i < this.properties.background.length; i++) {\n\t\t\t\tvar prop = this.properties.background[i];\n\n\t\t\t\telement.style[prop] = computed[prop];\n\t\t\t}\n\n\t\t\telementTextContainer =  UILib.create('<span>')[0];\n\t\t\telementTextContainer.style.visibility = 'visible';\n\t\t\telementTextContainer.style.color = 'transparent';\n\t\t\telementTextContainer.style.whiteSpace = 'pre-wrap';\n\t\t\telementTextContainer.style.margin = '0';\n\t\t\telementTextContainer.style.padding = '0';\n\t\t\telementTextContainer.style.border = '0';\n\n\t\t\t// Only Firefox needs to set text container as inline-block\n\t\t\t// In IE text even has wrong position in inline-block element\n\t\t\tif (Utils.Browser.gecko) {\n\t\t\t\telementTextContainer.style.display = 'inline-block';\n\n\t\t\t\tif (!this.isInput) {\n\t\t\t\t\telementTextContainer.style.width = '100%';\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (this.isInput) {\n\t\t\t\telementTextContainer.style.whiteSpace = 'nowrap';\n\t\t\t}\n\n\t\t\tUILib.appendTo(elementTextContainer, element);\n\t\t\tUILib.appendTo(UILib.create('<br>')[0], element);\n\n\t\t\tUILib.insertBefore(element, this.originalElement);\n\t\t\tUILib.attr(this.originalElement, 'spellcheck', false);\n\t\t\tthis.originalElement.style.background = 'transparent';\n\n\t\t\tif (this.originalElement.style.position === 'static' || computed['position'] === 'static') {\n\t\t\t\tthis.originalElement.style.position = 'relative';\n\t\t\t}\n\n\t\t\t// For FireFox we need to set line-height in style for correct work\n\t\t\tif (Utils.Browser.gecko && !this.isInput) {\n\t\t\t\tthis.originalElement.style.lineHeight = computed['lineHeight'];\n\t\t\t}\n\t\t\t\n\t\t\t// For IE we need to set font-family, font-size, line-height and msOverflowStyle in style for correct work.\n\t\t\t// Fix for WP-1748: Mirror: IE. Wrong font styles and line height for default unstyled textarea.\n\t\t\t// FIx for WP-2217: WebSpellChecker Proofreader: Markup is broken for textarea IE 11\n\t\t\tif (Utils.Browser.ie) {\n\t\t\t\tthis.originalElement.style.fontFamily = computed['fontFamily'];\n\t\t\t\tthis.originalElement.style.fontSize = computed['fontSize'];\n\t\t\t\tthis.originalElement.style.lineHeight = computed['lineHeight'];\n\n\t\t\t\tif (!this.isInput) {\n\t\t\t\t\tthis.originalElement.style.msOverflowStyle = '-ms-autohiding-scrollbar';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.mirrorElement = element;\n\t\t\tthis.mirrorElementTextContainer = elementTextContainer;\n\t\t\tthis.oldText = this.originalElement.value;\n\n\t\t\t// Firefox has next bug: 'Textarea text scrolls under padding instead of over'\n\t\t\t// https://bugzilla.mozilla.org/show_bug.cgi?id=1099204\n\t\t\t// It is not fixed yet.\n\t\t},\n\t\t/**\n\t\t* Create mirror div element for text based original element.\n\t\t*\n\t\t* @memberof CORE.Mirror#\n\t\t* @param {Boolean} lockMutations - Flag for lock mutations listener\n\t\t*/\n\t\tcopyStyles: function(lockMutations) {\n\t\t\tvar computed = Utils.getComputedStyle(this.originalElement),\n\t\t\t\tposition = this.getPosition(),\n\t\t\t\tmirrorElementTop = parseInt(this.mirrorElement.style['top']),\n\t\t\t\tmirrorElementLeft = parseInt(this.mirrorElement.style['left']),\n\t\t\t\toriginalElementBox = this.originalElement.getBoundingClientRect();\n\n\t\t\tlockMutations && this.sandbox.fireInAllApps('lockMutationsListener', { lock: true });\n\n\t\t\t// Copy styles for outer div\n\t\t\tfor (var i = 0; i < this.properties.outer.length; i++) {\n\t\t\t\tvar prop = this.properties.outer[i],\n\t\t\t\t\tmirrorElementProp = this.mirrorElement.style[prop];\n\n\t\t\t\tif ( (prop === 'height' || prop === 'width') && Utils.Browser.ie ) {\n\t\t\t\t\t// IE has bug in inputs and textareas with computed height and width and if box-sizing = border-box.\n\t\t\t\t\t// https://stackoverflow.com/questions/19717907/getcomputedstyle-reporting-different-heights-between-chrome-safari-firefox-and-i\n\t\t\t\t\tif (computed['boxSizing'] === 'border-box') {\n\t\t\t\t\t\tthis.mirrorElement.style[prop] = originalElementBox[prop] + 'px';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.mirrorElement.style[prop] = computed[prop];\n\t\t\t\t\t}\n\t\t\t\t} else if ( (prop === 'overflowX' || prop === 'overflowY') && Utils.Browser.gecko) {\n\t\t\t\t\t// For Firefox we work with overflow separately\n\t\t\t\t\tcontinue;\n\t\t\t\t} else if (prop === 'lineHeight' && this.isInput) {\n\t\t\t\t\t// Special case for inputs because text is rendered centered and line height may be != height\n\t\t\t\t\tthis.mirrorElement.style[prop] = computed['height'];\n\t\t\t\t} else if (mirrorElementProp !== prop) {\n\t\t\t\t\tthis.mirrorElement.style[prop] = computed[prop];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Copy styles for inner span\n\t\t\tfor (var i = 0; i < this.properties.inner.length; i++) {\n\t\t\t\tvar prop = this.properties.inner[i],\n\t\t\t\t\tmirrorElementTextProp = this.mirrorElementTextContainer.style[prop];\n\n\t\t\t\tif (!this.isInput && prop === 'lineHeight' && Utils.Browser.gecko && mirrorElementTextProp !== prop) {\n\t\t\t\t\tthis.mirrorElementTextContainer.style[prop] = computed[prop];\n\t\t\t\t\t\n\t\t\t\t\tif (this.originalElement.style[prop] !== computed[prop]) {\n\t\t\t\t\t\tthis.originalElement.style[prop] = computed[prop];\n\t\t\t\t\t}\n\t\t\t\t} else if (mirrorElementTextProp !== prop) {\n\t\t\t\t\tthis.mirrorElementTextContainer.style[prop] = computed[prop];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (Utils.Browser.gecko) {\n\t\t\t\t// Firefox lies about the overflow property for textareas\n\t\t\t\t// https://bugzilla.mozilla.org/show_bug.cgi?id=984275\n\t\t\t\t// Also Firefox on Windows returns computed height lower than scrollHeight\n\t\t\t\t// For example:\n\t\t\t\t// scrollHeight = 169\n\t\t\t\t// computed['height'] = 168.8\n\t\t\t\tvar computedHeight = Math.round(parseFloat(computed['height']));\n\n\t\t\t\tif ( this.originalElement.scrollHeight > computedHeight && this.mirrorElement.style['overflowY'] !== 'scroll') {\n\t\t\t\t\tthis.mirrorElement.style['overflowY'] = 'scroll';\n\t\t\t\t}\n\n\t\t\t\t// For correct width of the internal mirror span for Firefox without vertical scroll\n\t\t\t\tif (this.originalElement.scrollHeight <= computedHeight) {\n\t\t\t\t\tthis.mirrorElement.style['overflowY'] = 'hidden';\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (this.mirrorElement.style['overflowX'] !== 'hidden') {\n\t\t\t\t\tthis.mirrorElement.style['overflowX'] = 'hidden';\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (Utils.Browser.ie && !this.isInput) {\n\t\t\t\t\tthis.mirrorElement.style['overflowX'] = 'hidden';\n\t\t\t\t\tthis.mirrorElement.style['overflowY'] = 'hidden';\n\t\t\t\t} else {\n\t\t\t\t\tthis.mirrorElement.style['overflowX'] = 'hidden';\n\t\t\t\t\tthis.mirrorElement.style['overflowY'] = 'hidden';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( mirrorElementLeft !== parseInt(position.x) ) {\n\t\t\t\tthis.mirrorElement.style['left'] = position.x + 'px';\n\t\t\t}\n\n\t\t\tif ( mirrorElementTop !== parseInt(position.y) ) {\n\t\t\t\tthis.mirrorElement.style['top'] = position.y + 'px';\n\t\t\t}\n\n\t\t\tlockMutations && this.sandbox.fireInAllApps('lockMutationsListener', { lock: false });\n\t\t},\n\t\t/**\n\t\t* Start checking for the styles of the original element.\n\t\t*\n\t\t* @memberof CORE.Mirror#\n\t\t*/\n\t\tstartChecking: function() {\n\t\t\tvar self = this;\n\n\t\t\tthis.timeoutId = setTimeout(function() {\n\t\t\t\tself.startChecking();\n\t\t\t}, this.timeoutDelay);\n\n\t\t\t// Safari does not react on textarea and div resize\n\t\t\t// So we need to copy styles for Safari each checking phase\n\t\t\tUtils.Browser.safari && this.copyStyles(true);\n\t\t\tthis.checkTextChanges();\n\t\t},\n\t\t/**\n\t\t* Stop checking for the styles of the original element.\n\t\t*\n\t\t* @memberof CORE.Mirror#\n\t\t*/\n\t\tstopChecking: function() {\n\t\t\tclearTimeout(this.timeoutId);\n\t\t\tthis.timeoutId = null;\n\t\t},\n\t\t/**\n\t\t* Get position of the original container.\n\t\t*\n\t\t* @memberof CORE.Mirror#\n\t\t* @returns {Object} - Object with coordinates\n\t\t*/\n\t\tgetPosition: function() {\n\t\t\tvar position = {x: 0, y: 0},\n\t\t\t\toffsetParent = this.sandbox.getOffsetParent(this.mirrorElement),\n\t\t\t\toffsetParentBox = offsetParent.getBoundingClientRect(),\n\t\t\t\tcontainerBox = this.originalElement.getBoundingClientRect();\n\n\t\t\tposition.x = containerBox.left - offsetParentBox.left;\n\t\t\tposition.y = containerBox.top - offsetParentBox.top;\n\n\t\t\treturn position;\n\t\t},\n\t\t/**\n\t\t* Handler for mutations event in the original container.\n\t\t*\n\t\t* @memberof CORE.Mirror#\n\t\t* @param {Object} event - HTML DOM Event\n\t\t*/\n\t\thandleMutations: function(event) {\n\t\t\tif ( (this.originalElement.style.width && this.originalElement.style.width !== this.mirrorElement.style.width) ||\n\t\t\t\t (this.originalElement.style.height && this.originalElement.style.height !== this.mirrorElement.style.height) ) {\n\t\t\t\t\n\t\t\t\tthis.copyStyles();\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t* Handler for input event in the original container.\n\t\t*\n\t\t* @memberof CORE.Mirror#\n\t\t* @param {Object} event - HTML DOM Event\n\t\t*/\n\t\thandleInput: function(event) {\n\t\t\tvar self = this,\n\t\t\t\tstringsDiff = this.getStringsDiff(),\n\t\t\t\tfilteredRanges = this.getFilteredProblemPositions(stringsDiff),\n\t\t\t\tboundaries = this.getBoundaries(filteredRanges),\n\t\t\t\tsortedBoundaries = this.sortBoundaries(boundaries),\n\t\t\t\tisUpdated;\n\n\t\t\tif (this.isIE11 && filteredRanges.length) {\n\t\t\t\tisUpdated = this.updateTextInMirrorContainer(stringsDiff);\n\n\t\t\t\tif (!isUpdated) {\n\t\t\t\t\tthis.renderProblems(sortedBoundaries);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.renderProblems(sortedBoundaries);\n\t\t\t}\n\n\t\t\tthis.sandbox.addDeferredFunction('collectProblemsAfterDelay', {\n\t\t\t\tsingle: true,\n\t\t\t\tdelay: 2000,\n\t\t\t\tdeferredFunction: function() {\n\t\t\t\t\tself.sandbox.startProblemsCheck();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t* Handler for scroll event in the original container.\n\t\t*\n\t\t* @memberof CORE.Mirror#\n\t\t* @param {Object} event - HTML DOM Event\n\t\t*/\n\t\thandleScroll: function(event) {\n\t\t\tvar originalElementScrollWidth = this.originalElement.scrollWidth + 'px',\n\t\t\t\toriginalElementScrollHeight = this.originalElement.scrollHeight + 'px',\n\t\t\t\tscrollTop,\n\t\t\t\tscrollLeft,\n\t\t\t\tscrollWidth;\n\n\t\t\t// Firefox scrolls text container without keep in mind padding of internal container.\n\t\t\t// So we need to change width for input and height for textarea for Firefox.\n\t\t\tif (Utils.Browser.gecko) {\n\t\t\t\tif (this.isInput && this.mirrorElementTextContainer.style['width'] !== originalElementScrollWidth) {\n\t\t\t\t\tthis.mirrorElementTextContainer.style['width'] = originalElementScrollWidth;\n\t\t\t\t} else if (!this.isInput && this.mirrorElementTextContainer.style['height'] !== originalElementScrollHeight) {\n\t\t\t\t\tthis.mirrorElementTextContainer.style['height'] = originalElementScrollHeight;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (Utils.Browser.ie) {\n\t\t\t\tscrollWidth = Utils.getScrollWidthForInput(this.originalElement) + 'px';\n\n\t\t\t\tif (this.isInput && this.mirrorElementTextContainer.style['width'] !== scrollWidth) {\n\t\t\t\t\tthis.mirrorElementTextContainer.style['width'] = scrollWidth;\n\t\t\t\t} else if (!this.isInput && this.mirrorElementTextContainer.style['height'] !== originalElementScrollHeight) {\n\t\t\t\t\tthis.mirrorElementTextContainer.style['height'] = originalElementScrollHeight;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tscrollTop = this.originalElement.scrollTop;\n\t\t\tthis.mirrorElement.scrollTop = scrollTop;\n\n\t\t\t// IE11 has a bug with scrollLeft for the input elements.\n\t\t\t// scrollLeft always equals to 0.\n\t\t\t// So we need to check this value trickier.\n\t\t\tif (this.isInput) {\n\t\t\t\tscrollLeft = Utils.getScrollLeftForInput(this.originalElement);\n\t\t\t\tthis.mirrorElement.scrollLeft = scrollLeft;\n\t\t\t} else {\n\t\t\t\tscrollLeft = this.originalElement.scrollLeft\n\t\t\t\tthis.mirrorElement.scrollLeft = scrollLeft;\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t* Handler for scroll event in the original container with delay.\n\t\t*\n\t\t* @memberof CORE.Mirror#\n\t\t* @param {Object} event - HTML DOM Event\n\t\t*/\n\t\thandleScrollWithDelay: function(event) {\n\t\t\tvar self = this;\n\n\t\t\tsetTimeout(function() {\n\t\t\t\tself.handleScroll();\n\t\t\t}, 0);\n\t\t},\n\t\t/**\n\t\t* Handler for visibilitychange event.\n\t\t*\n\t\t* @memberof CORE.Mirror#\n\t\t* @param {Object} event - HTML DOM Event\n\t\t*/\n\t\thandleVisibilityChange: function(event) {\n\t\t\tif (document[this.visibilityApiData.hidden]) {\n\t\t\t\tthis.stopChecking();\n\t\t\t} else {\n\t\t\t\tthis.startChecking();\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t* Update text in the original container.\n\t\t*\n\t\t* @memberof CORE.Mirror#\n\t\t* @param {Object} data - Data from event\n\t\t*/\n\t\tupdateTextInOriginalContainer: function(data) {\n\t\t\tvar text, isOriginalTextCutted;\n\n\t\t\ttext = DataProcessor.htmlToText(this.mirrorElementTextContainer.innerHTML, this.isInput);\n\t\t\tthis.originalElement.value = this.fixNewLineSymbols(this.originalElement.value, text);\n\n\t\t\tif (data.textBeforeCursor !== null) {\n\t\t\t\tthis.originalElement.setSelectionRange(data.textBeforeCursor.length, data.textBeforeCursor.length);\n\t\t\t\tthis.sandbox.fire({\n\t\t\t\t\teventType: 'focus',\n\t\t\t\t\telement: this.originalElement\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.sandbox.fire({\n\t\t\t\t\teventType: 'blur',\n\t\t\t\t\telement: this.mirrorElement\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tisOriginalTextCutted = this.checkMaxLength(data);\n\n\t\t\t!isOriginalTextCutted && this.stopInputListener();\n\t\t\tthis.sandbox.fire({\n\t\t\t\telement: this.originalElement,\n\t\t\t\teventType: 'input'\n\t\t\t});\n\t\t\t!isOriginalTextCutted && this.startInputListener();\n\n\t\t\tthis.handleScroll();\n\t\t\tthis.oldText = this.originalElement.value;\n\t\t},\n\t\t/**\n\t\t* Update text in the mirror container.\n\t\t*\n\t\t* @memberof CORE.Mirror#\n\t\t* @param {Object} stringsDiff - Object with strings differences data\n\t\t* @returns {Boolean} result of the updating\n\t\t*/\n\t\tupdateTextInMirrorContainer: function(stringsDiff) {\n\t\t\tvar range = this.sandbox.createRange(),\n\t\t\t\tspellingNodeName = this.sandbox.getOption(\"misspelled_word_node\"),\n\t\t\t\tspellingAttrName = this.sandbox.getOption(\"data_attribute_name\"),\n\t\t\t\tgrammarNodeName = this.sandbox.getOption('problem_grammar_node'),\n\t\t\t\tgrammarAttrName = this.sandbox.getOption('problem_grammar_data_attribute'),\n\t\t\t\tself = this,\n\t\t\t\tnodesToRemove = [],\n\t\t\t\tstartPos, endPos, startContainer, spellingNode, grammarNode, text;\n\n\t\t\tif (!stringsDiff || !stringsDiff.clear) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tstartPos = this.getNodePartByPosition(stringsDiff.start);\n\n\t\t\tswitch (stringsDiff.operation) {\n\t\t\t\tcase 'insert':\n\t\t\t\t\ttext = stringsDiff.text;\n\n\t\t\t\t\t// We need to replace spaces with non-breaking spaces - http://stackoverflow.com/a/13402035/1269037\n\t\t\t\t\tif (this.isInput) {\n\t\t\t\t\t\ttext = text.replace(/\\s/g, '\\u00a0');\n\t\t\t\t\t}\n\n\t\t\t\t\trange.setStart(startPos.node, stringsDiff.start - startPos.start);\n\t\t\t\t\trange.collapse(true);\n\t\t\t\t\trange.insertNode(document.createTextNode(text));\n\n\t\t\t\t\tstartContainer = range.startContainer();\n\n\t\t\t\t\tif (Utils.isEqualNode(startContainer, spellingAttrName) ) {\n\t\t\t\t\t\tspellingNode = startContainer;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tspellingNode = UILib.findNodeParents(startContainer, spellingNodeName, spellingAttrName)[0];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Utils.isEqualNode(startContainer, grammarAttrName) ) {\n\t\t\t\t\t\tgrammarNode = startContainer;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tgrammarNode = UILib.findNodeParents(startContainer, grammarNodeName, grammarAttrName)[0];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (spellingNode) {\n\t\t\t\t\t\tnodesToRemove.push(spellingNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (grammarNode) {\n\t\t\t\t\t\tgrammarNode.isGrammarNode = true;\n\t\t\t\t\t\tnodesToRemove.push(grammarNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'delete':\n\t\t\t\t\tendPos = this.getNodePartByPosition(stringsDiff.end);\n\t\t\t\t\trange.setStart(startPos.node, stringsDiff.start - startPos.start);\n\t\t\t\t\trange.setEnd(endPos.node, stringsDiff.end - endPos.start + 1);\n\t\t\t\t\trange.deleteContents();\n\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.originalElement.value === this.mirrorElementTextContainer.textContent) {\n\t\t\t\tfor (var i = 0; i < this.nodesToRemove.length; i++) {\n\t\t\t\t\tif (this.mirrorElementTextContainer.contains(this.nodesToRemove[i])) {\n\t\t\t\t\t\tif (nodesToRemove.indexOf(this.nodesToRemove[i]) === -1) {\n\t\t\t\t\t\t\tnodesToRemove.push(this.nodesToRemove[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.sandbox.fire('removeMarkup', {wsc: true, nodes : nodesToRemove});\n\n\t\t\t\tUILib.each(nodesToRemove, function (i, node) {\n\t\t\t\t\tif (node.isGrammarNode) {\n\t\t\t\t\t\tvar phrase = UILib.attr(node, grammarAttrName);\n\t\t\t\t\t\t// we need to remove from grammar cache sentence that contains phrase in order to make possible further markup\n\t\t\t\t\t\tself.sandbox.fire('updateSentencesCache', { phrase: phrase });\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthis.mirrorElementTextContainer.normalize();\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\t\t/**\n\t\t* Fix extra new line symbols between original and mirror elements.\n\t\t*\n\t\t* @memberof CORE.Mirror#\n\t\t* @param {String} originalString - String from original element\n\t\t* @param {String} mirrorString - String from mirror element\n\t\t* @returns {String} result of the fixing\n\t\t*/\n\t\tfixNewLineSymbols: function(originalString, mirrorString) {\n\t\t\tvar originalNewLine = originalString.match(/\\n*$/);\n\n\t\t\tif (originalNewLine[0].length) {\n\t\t\t\tmirrorString = mirrorString.replace(/\\n*$/, originalNewLine[0]);\n\t\t\t}\n\n\t\t\treturn mirrorString;\n\t\t},\n\t\t/**\n\t\t* Check maxLength of the text based elements.\n\t\t*\n\t\t* @memberof CORE.Mirror#\n\t\t* @param {Object} data - Data\n\t\t*/\n\t\tcheckMaxLength: function(data) {\n\t\t\tvar maxLength = this.originalElement.maxLength,\n\t\t\t\tvalue = this.originalElement.value,\n\t\t\t\tlengthDiff = value.length - maxLength,\n\t\t\t\tlengthToRemove,\n\t\t\t\tcursorPosition;\n\n\t\t\tdata = data || {};\n\n\t\t\tlengthToRemove = data.newText && (lengthDiff >= data.newText.length) ? data.newText.length : lengthDiff;\n\n\t\t\tif (maxLength === -1 || lengthDiff <= 0) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (!data.textBeforeCursor) {\n\t\t\t\tthis.originalElement.value = value.substring(0, value.length - lengthToRemove);\n\t\t\t} else {\n\t\t\t\tcursorPosition = this.originalElement.selectionStart;\n\t\t\t\tthis.originalElement.value = value.substring(0, cursorPosition - lengthToRemove) + value.substring(cursorPosition);\n\t\t\t\tthis.originalElement.setSelectionRange(cursorPosition - lengthToRemove, cursorPosition - lengthToRemove);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\t\t/**\n\t\t* Check text changes in the original element and update text in mirror element if need so.\n\t\t*\n\t\t* @memberof CORE.Mirror#\n\t\t*/\n\t\tcheckTextChanges: function() {\n\t\t\tif (this.originalElement.value !== this.oldText) {\n\t\t\t\tthis.handleInput();\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t* Get differences between two strings.\n\t\t*\n\t\t* @memberof CORE.Mirror#\n\t\t* @returns {Object} string diff\n\t\t*\n\t\t*/\n\t\tgetStringsDiff: function() {\n\t\t\tvar text = this.originalElement.value,\n\t\t\t\toldText = this.oldText,\n\t\t\t\tisAdded = text.length > oldText.length ? true : false,\n\t\t\t\tisEqual = text.length === oldText.length ? true : false,\n\t\t\t\tmoreText = isAdded ? text : oldText,\n\t\t\t\tlessText = isAdded ? oldText : text,\n\t\t\t\tlengthDiff = isAdded ? text.length - oldText.length : oldText.length - text.length,\n\t\t\t\tstart, end;\n\n\t\t\tif (oldText === text) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.oldText = text;\n\n\t\t\tif (text.length > oldText.length) {\n\t\t\t\t// Text was added to the end\n\t\t\t\tif ( text.substring(0, oldText.length) === oldText ) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\toperation: 'insert',\n\t\t\t\t\t\tclear: true,\n\t\t\t\t\t\tchanged: 0,\n\t\t\t\t\t\tstart: oldText.length,\n\t\t\t\t\t\tend: oldText.length,\n\t\t\t\t\t\ttext: moreText.substring(oldText.length),\n\t\t\t\t\t\tlengthDiff: lengthDiff\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// Text was added to the begin\n\t\t\t\tif ( text.substring(lengthDiff) === oldText ) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\toperation: 'insert',\n\t\t\t\t\t\tclear: true,\n\t\t\t\t\t\tchanged: 0,\n\t\t\t\t\t\tstart: 0,\n\t\t\t\t\t\tend: 0,\n\t\t\t\t\t\ttext: moreText.substring(0, lengthDiff),\n\t\t\t\t\t\tlengthDiff: lengthDiff\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (oldText.length > text.length) {\n\t\t\t\t// Text was removed from the end\n\t\t\t\tif ( oldText.substring(0, text.length) === text ) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\toperation: 'delete',\n\t\t\t\t\t\tclear: true,\n\t\t\t\t\t\tchanged: 0,\n\t\t\t\t\t\tstart: text.length,\n\t\t\t\t\t\tend: text.length,\n\t\t\t\t\t\ttext: moreText.substring(lessText.length),\n\t\t\t\t\t\tlengthDiff: lengthDiff\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// Text was removed from the begin\n\t\t\t\tif ( oldText.substring(lengthDiff) === text ) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\toperation: 'delete',\n\t\t\t\t\t\tclear: true,\n\t\t\t\t\t\tchanged: 0,\n\t\t\t\t\t\tstart: 0,\n\t\t\t\t\t\tend: 0,\n\t\t\t\t\t\ttext: moreText.substring(0, lengthDiff),\n\t\t\t\t\t\tlengthDiff: lengthDiff\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (var i = 0; i < moreText.length; i++) {\n\t\t\t\tif (moreText[i] === lessText[i]) {\n\t\t\t\t\tcontinue;\n\t\t\t\t} else {\n\t\t\t\t\tstart = i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (var i = moreText.length - 1; i >= 0; i--) {\n\t\t\t\tif (moreText[i] === lessText[i - lengthDiff]) {\n\t\t\t\t\tcontinue;\n\t\t\t\t} else {\n\t\t\t\t\tend = (start - i > 0) ? start + lengthDiff - 1 : i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\toperation: isAdded ? 'insert' : isEqual ? 'change' : 'delete',\n\t\t\t\tclear: (end - start + 1 === lengthDiff) ? true : false,\n\t\t\t\tchanged: (end - start + 1 === lengthDiff) ? 0 : end - start + 1 - lengthDiff,\n\t\t\t\tstart: start,\n\t\t\t\tend: end,\n\t\t\t\ttext: moreText.substring(start, end + 1),\n\t\t\t\tlengthDiff: lengthDiff\n\t\t\t};\n\t\t},\n\t\t/**\n\t\t* Start mutation observer.\n\t\t*\n\t\t* @memberof CORE.Mirror#\n\t\t*\n\t\t*/\n\t\tstartMutationObserver: function() {\n\t\t\tif (this.mutationObserver) {\n\t\t\t\tthis.mutationObserver.observe(this.originalElement, this.mutationOptions);\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t* Stop mutation observer.\n\t\t*\n\t\t* @memberof CORE.Mirror#\n\t\t*\n\t\t*/\n\t\tstopMutationObserver: function() {\n\t\t\tif (this.mutationObserver) {\n\t\t\t\tthis.mutationObserver.disconnect();\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t* Start input listener.\n\t\t*\n\t\t* @memberof CORE.Mirror#\n\t\t*\n\t\t*/\n\t\tstartInputListener: function() {\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'input',\n\t\t\t\telement: this.originalElement,\n\t\t\t\thandler: this.handleInput\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t* Stop input listener.\n\t\t*\n\t\t* @memberof CORE.Mirror#\n\t\t*\n\t\t*/\n\t\tstopInputListener: function() {\n\t\t\tthis.sandbox.unsubscribe({\n\t\t\t\teventType: 'input',\n\t\t\t\telement: this.originalElement,\n\t\t\t\thandler: this.handleInput\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t* Get filtred positions of the problem nodes.\n\t\t*\n\t\t* @memberof CORE.Mirror#\n\t\t* @param {Object} stringsDiff - Object with strings differences data\n\t\t* @returns {Array} ranges\n\t\t*\n\t\t*/\n\t\tgetFilteredProblemPositions: function(stringsDiff) {\n\t\t\tvar queue = [this.mirrorElementTextContainer],\n\t\t\t\tnode = queue.shift(),\n\t\t\t\tspellingNodeName = this.sandbox.getOption('misspelled_word_node'),\n\t\t\t\tspellingAttrName = this.sandbox.getOption('data_attribute_name'),\n\t\t\t\tgrammarNodeName = this.sandbox.getOption('problem_grammar_node'),\n\t\t\t\tgrammarAttrName = this.sandbox.getOption('problem_grammar_data_attribute'),\n\t\t\t\tgrammarAttrRuleName = this.sandbox.getOption('problem_grammar_data_attribute_rule'),\n\t\t\t\twordBoundaryRegex = this.sandbox.getRegExp('wordBoundaryRegexAndQuotes'),\n\t\t\t\tranges = [],\n\t\t\t\tfilteredRanges = [],\n\t\t\t\tresultText = '',\n\t\t\t\tself = this;\n\n\t\t\tthis.textNodeParts = {};\n\t\t\tthis.nodesToRemove = [];\n\n\t\t\tfunction addPart(node) {\n\t\t\t\tvar part = {\n\t\t\t\t\tnode: node,\n\t\t\t\t\tstart: resultText.length,\n\t\t\t\t\tend: resultText.length + node.nodeValue.length\n\t\t\t\t};\n\n\t\t\t\tself.textNodeParts[part.start] = part;\n\t\t\t\tself.textNodeParts[part.end] = part;\n\t\t\t}\n\n\t\t\twhile (node) {\n\t\t\t\tswitch (node.nodeType) {\n\t\t\t\t\tcase 3 : // Node.TEXT_NODE || 3\n\t\t\t\t\t\tif (this.isIE11) {\n\t\t\t\t\t\t\taddPart(node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresultText += node.nodeValue;\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 1 : // Node.ELEMENT_NODE || 1\n\t\t\t\t\t\tvar isSpellingNode = node.nodeName.toLowerCase() == spellingNodeName.toLowerCase() && node.getAttribute(spellingAttrName),\n\t\t\t\t\t\t\tisGrammarNode = node.nodeName.toLowerCase() == grammarNodeName.toLowerCase() && node.getAttribute(grammarAttrName);\n\n\t\t\t\t\t\tif (isSpellingNode || isGrammarNode) {\n\t\t\t\t\t\t\tvar text = isSpellingNode ? node.getAttribute(spellingAttrName) : node.getAttribute(grammarAttrName),\n\t\t\t\t\t\t\t\trule = isGrammarNode ? node.getAttribute(grammarAttrRuleName) : '';\n\n\t\t\t\t\t\t\tranges.push({\n\t\t\t\t\t\t\t\ttext: text,\n\t\t\t\t\t\t\t\trule: rule,\n\t\t\t\t\t\t\t\ttype: isSpellingNode ? 'spelling' : 'grammar',\n\t\t\t\t\t\t\t\tlang: node.getAttribute('data-wsc-lang'),\n\t\t\t\t\t\t\t\tstart: resultText.length,\n\t\t\t\t\t\t\t\tend: resultText.length + (text.length - 1),\n\t\t\t\t\t\t\t\tnode: node\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfor (var i = 0; i < node.childNodes.length; i++) {\n\t\t\t\t\t\t\tqueue.splice(i, 0,node.childNodes[i]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tnode = queue.shift();\n\t\t\t}\n\n\t\t\tfor (var i = 0; i < ranges.length; i++) {\n\t\t\t\tvar range = ranges[i];\n\n\t\t\t\tif (stringsDiff.operation === 'insert') {\n\t\t\t\t\tvar insertStart = stringsDiff.clear ? stringsDiff.start : stringsDiff.end - stringsDiff.lengthDiff + 1;\n\n\t\t\t\t\tif (range.start >= insertStart) {\n\t\t\t\t\t\trange.start += stringsDiff.lengthDiff;\n\t\t\t\t\t\trange.end += stringsDiff.lengthDiff;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( this.originalElement.value.substring(range.start, range.end + 1) !== range.text) {\n\t\t\t\t\t\tif (this.isIE11) {\n\t\t\t\t\t\t\tthis.nodesToRemove.push(range.node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Range inside diff\n\t\t\t\t// range: [3, 6]\n\t\t\t\t// diff: [1, 10]\n\t\t\t\tif (range.start >= stringsDiff.start && range.end <= stringsDiff.end) {\n\t\t\t\t\tif (this.isIE11) {\n\t\t\t\t\t\tthis.nodesToRemove.push(range.node);\n\t\t\t\t\t}\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Start or end of the diff inside range\n\t\t\t\t// 1. range: [5, 15]\n\t\t\t\t//    diff: [3, 8]\n\t\t\t\t// 2. range: [3, 6]\n\t\t\t\t//    diff: [5, 9]\n\t\t\t\t// 3. range: [3, 8]\n\t\t\t\t//    diff: [1, 5]\n\t\t\t\tif ( (stringsDiff.start >= range.start && stringsDiff.start <= range.end) ||\n\t\t\t\t\t(stringsDiff.end >= range.start && stringsDiff.end <= range.end) ) {\n\t\t\t\t\tif (this.isIE11) {\n\t\t\t\t\t\tthis.nodesToRemove.push(range.node);\n\t\t\t\t\t}\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Diff ends before range\n\t\t\t\tif ( (range.start - stringsDiff.end === 1) && !wordBoundaryRegex.test(this.originalElement.value[stringsDiff.end]) ) {\n\t\t\t\t\tif (this.isIE11) {\n\t\t\t\t\t\tthis.nodesToRemove.push(range.node);\n\t\t\t\t\t}\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Diff starts after range\n\t\t\t\tif ( (stringsDiff.start - range.end === 1) && !wordBoundaryRegex.test(this.originalElement.value[stringsDiff.start]) ) {\n\t\t\t\t\tif (this.isIE11) {\n\t\t\t\t\t\tthis.nodesToRemove.push(range.node);\n\t\t\t\t\t}\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (stringsDiff.operation === 'delete') {\n\t\t\t\t\tvar deleteStart = stringsDiff.clear ? stringsDiff.start : stringsDiff.end - stringsDiff.lengthDiff + 1;\n\n\t\t\t\t\tif (range.start >= deleteStart) {\n\t\t\t\t\t\trange.start -= stringsDiff.lengthDiff;\n\t\t\t\t\t\trange.end -= stringsDiff.lengthDiff;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( this.originalElement.value.substring(range.start, range.end + 1) !== range.text) {\n\t\t\t\t\t\tif (this.isIE11) {\n\t\t\t\t\t\t\tthis.nodesToRemove.push(range.node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfilteredRanges.push(ranges[i]);\n\t\t\t}\n\n\t\t\treturn filteredRanges;\n\t\t},\n\t\t/**\n\t\t* Get boundaries points.\n\t\t*\n\t\t* @memberof CORE.Mirror#\n\t\t* @param {Array} ranges - Array of ranges\n\t\t*\n\t\t*/\n\t\tgetBoundaries: function(ranges) {\n\t\t\tvar boundaries = [];\n\n\t\t\tfor (var i = 0; i < ranges.length; i++) {\n\t\t\t\tvar range = ranges[i];\n\n\t\t\t\tboundaries.push({\n\t\t\t\t\tpos: 'start',\n\t\t\t\t\tindex: range.start,\n\t\t\t\t\ttype: range.type,\n\t\t\t\t\ttext: range.text,\n\t\t\t\t\trule: range.rule,\n\t\t\t\t\tlang: range.lang\n\t\t\t\t});\n\n\t\t\t\tboundaries.push({\n\t\t\t\t\tpos: 'end',\n\t\t\t\t\tindex: range.end + 1\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn boundaries;\n\t\t},\n\t\t/**\n\t\t* Sort problem nodes boundary points.\n\t\t*\n\t\t* @memberof CORE.Mirror#\n\t\t* @param {Array} boundaries - Array of the boundary points\n\t\t*\n\t\t*/\n\t\tsortBoundaries: function(boundaries) {\n\t\t\tboundaries.sort(function(a, b) {\n\t\t\t\tif (a.index !== b.index) {\n\t\t\t\t\treturn b.index - a.index;\n\t\t\t\t} else if (a.pos === 'end' && b.pos === 'start') {\n\t\t\t\t\treturn 1;\n\t\t\t\t} else if (a.pos === 'start' && b.pos === 'end') {\n\t\t\t\t\treturn -1;\n\t\t\t\t} else if (a.pos === 'start' && b.pos === 'start') {\n\t\t\t\t\treturn (a.type === 'spelling' && b.type === 'grammar') ? -1 : 1;\n\t\t\t\t} else {\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn boundaries;\n\t\t},\n\t\t/**\n\t\t* Add markup for problem nodes.\n\t\t*\n\t\t* @memberof CORE.Mirror#\n\t\t* @param {Array} boundaries - Array of the boundary points\n\t\t*\n\t\t*/\n\t\trenderProblems: function(boundaries) {\n\t\t\tvar text = this.originalElement.value,\n\t\t\t\ttextNode = this.sandbox.getOption('misspelled_word_node'),\n\t\t\t\tspellingAttrName = this.sandbox.getOption('data_attribute_name'),\n\t\t\t\tspellingClass = this.sandbox.getOption('misspelled_word_class'),\n\t\t\t\tgrammarAttrName = this.sandbox.getOption('problem_grammar_data_attribute'),\n\t\t\t\tgrammarClass = this.sandbox.getOption('problem_grammar_class'),\n\t\t\t\tgrammarAttrRuleName = this.sandbox.getOption('problem_grammar_data_attribute_rule'),\n\t\t\t\tself = this;\n\n\t\t\t// We need to replace spaces with non-breaking spaces - http://stackoverflow.com/a/13402035/1269037\n\t\t\tif (this.isInput) {\n\t\t\t\ttext = text.replace(/\\s/g, '\\u00a0');\n\t\t\t}\n\n\t\t\t// Chrome and IE work faster with string insertion.\n\t\t\t// Other browsers work faster with array insertion.\n\t\t\tif (!Utils.Browser.chrome || !Utils.Browser.ie) {\n\t\t\t\ttext = text.split('');\n\t\t\t}\n\n\t\t\tfor (var i = 0; i < boundaries.length; i++) {\n\t\t\t\tvar boundary = boundaries[i],\n\t\t\t\t\tmarkup;\n\n\t\t\t\tif (boundary.pos === 'end') {\n\t\t\t\t\tmarkup = '@lt;/' + textNode + '@gt;';\n\t\t\t\t} else if (boundary.type === 'spelling') {\n\t\t\t\t\tmarkup = '@lt;' + textNode + ' class=@quot;' + spellingClass + '@quot; ' + spellingAttrName + '=@quot;' + boundary.text + '@quot;' + ' data-wsc-lang=@quot;' + boundary.lang + '@quot;' + '@gt;';\n\t\t\t\t} else {\n\t\t\t\t\tmarkup = '@lt;' + textNode + ' class=@quot;' + grammarClass + '@quot; ' + grammarAttrName + '=@quot;' + boundary.text + '@quot; ' + ' data-wsc-lang=@quot;' + boundary.lang + '@quot;' + grammarAttrRuleName + '=@quot;' + boundary.rule + '@quot;' + '@gt;';\n\t\t\t\t}\n\n\t\t\t\tif (!Utils.Browser.chrome || !Utils.Browser.ie) {\n\t\t\t\t\ttext.splice(boundary.index, 0, markup);\n\t\t\t\t} else {\n\t\t\t\t\ttext = text.substring(0, boundary.index) + markup + text.substring(boundary.index);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!Utils.Browser.chrome || !Utils.Browser.ie) {\n\t\t\t\ttext = text.join('');\n\t\t\t}\n\n\t\t\ttext = Utils.escapeHTML(text);\n\t\t\ttext = Utils.unescapeProblemTags(text);\n\n\t\t\ttext = text.replace(/\\n$/, '\\n\\n');\n\n\t\t\tself.mirrorElementTextContainer.innerHTML = text;\n\t\t},\n\t\t/**\n\t\t* Get text node part by index from string.\n\t\t*\n\t\t* @memberof CORE.Mirror#\n\t\t* @param {Number} index - Index in the string\n\t\t* @returns {Object}\n\t\t*\n\t\t*/\n\t\tgetNodePartByPosition: function(index) {\n\t\t\twhile (!this.textNodeParts[index]) {\n\t\t\t\tindex--;\n\t\t\t}\n\n\t\t\treturn this.textNodeParts[index];\n\t\t},\n\t\t/**\n\t\t* Get data from the container.\n\t\t*\n\t\t* @memberof CORE.Mirror#\n\t\t* @returns {String}\n\t\t*/\n\t\tgetData: function() {\n\t\t\t// For text based elements we should use 'value' (textarea, input)\n\t\t\t// For other - html of container\n\t\t\treturn this.originalElement.value || this.sandbox.getHtmlWithoutProblemNodes(this.originalElement.innerHTML);\n\t\t},\n\t\t/**\n\t\t* Set data to the container.\n\t\t*\n\t\t* @memberof CORE.Mirror#\n\t\t* @param {string} data - text or html string\n\t\t*/\n\t\tsetData: function(data) {\n\t\t\tdata = this.sandbox.getHtmlWithoutProblemNodes(data);\n\n\t\t\tif ( this.sandbox.getOption('mirrorBasedInstance') ) {\n\t\t\t\tthis.originalElement.value = DataProcessor.htmlToText(data, this.isInput);\n\t\t\t\tthis.checkMaxLength();\n\t\t\t\tthis.renderProblems([]);\n\t\t\t} else {\n\t\t\t\tthis.originalElement.innerHTML = data;\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Mirror module destructor.\n\t\t *\n\t\t * @memberof CORE.Mirror#\n\t\t */\n\t\tdestroy: function() {\n\t\t\tthis.stopMutationObserver();\n\t\t\tthis.mutationObserver = null;\n\t\t\tthis.stopChecking();\n\n\t\t\tif (this.mirrorElement) {\n\t\t\t\tfor (var i = 0; i < this.properties.background.length; i++) {\n\t\t\t\t\tvar prop = this.properties.background[i];\n\n\t\t\t\t\tthis.originalElement.style[prop] = this.mirrorElement.style[prop];\n\t\t\t\t}\n\n\t\t\t\tUILib.remove(this.mirrorElement);\n\t\t\t}\n\t\t}\n\t};\n\n\texports.Mirror = Mirror;\n\n}( WEBSPELLCHECKER.CORE ));\n// contenteditablemirror.js\n/**\n * @fileoverview Mirror for contenteditable elements.\n */\n\n(function( exports ) {\n\t'use strict';\n\t\n\tvar UILib = exports.prototype.UILib,\n\t\tUtils = exports.prototype.Utils;\n\n\t/**\n\t * Represents ContenteditableMirror Module.\n\t *\n\t * @constructor\n\t * @alias CORE.Mirror\n\t * @param {String} moduleID\n\t * @param {CORE.Sandbox} sandbox\n\t */\n\tvar ContenteditableMirror = function(moduleID, sandbox) {\n\t\t/**\n\t\t * Module name.\n\t\t *\n\t\t * @type {String}\n\t\t */\n\t\tthis.name = moduleID;\n\n\t\t/**\n\t\t * Reference to ContenteditableMirror module sandbox.\n\t\t *\n\t\t * @type {CORE.Sandbox}\n\t\t */\n\t\tthis.sandbox = sandbox;\n\n\t\t/**\n\t\t * Link on the original element.\n\t\t *\n\t\t * @type {Node}\n\t\t */\n\t\tthis.originalElement = this.sandbox.getOption('originalContainer');\n\n\t\t/**\n\t\t * Link on the mirror element.\n\t\t *\n\t\t * @type {Null|Node}\n\t\t */\n\t\tthis.mirrorElement = null;\n\n\t\t/**\n\t\t * Indicate if original element is model editor.\n\t\t *\n\t\t * @type {Boolean}\n\t\t */\n\t\tthis.modelEditor = Utils.isCKEditor5(this.originalElement) || Utils.isModelEditor(this.originalElement);\n\n\t\t/**\n\t\t * Properties that will be copied into the mirror div.\n\t\t *\n\t\t * @type {Array}\n\t\t */\n\t\tthis.properties = [\n\t\t\t'boxSizing',\n\t\t\t'width',\n\t\t\t'height',\n\n\t\t\t'borderTopWidth',\n\t\t\t'borderRightWidth',\n\t\t\t'borderBottomWidth',\n\t\t\t'borderLeftWidth',\n\t\t\t'borderTopStyle',\n\t\t\t'borderRightStyle',\n\t\t\t'borderBottomStyle',\n\t\t\t'borderLeftStyle',\n\n\t\t\t'paddingTop',\n\t\t\t'paddingRight',\n\t\t\t'paddingBottom',\n\t\t\t'paddingLeft'\n\t\t];\n\n\t\t/**\n\t\t * Object with options, specifies which DOM mutations should be reported.\n\t\t *\n\t\t * @type {Object}\n\t\t */\n\t\tthis.mutationOptions = {\n\t\t\tattributes: true,\n\t\t\tattributeOldValue: false,\n\t\t\tchildList: true,\n\t\t\tcharacterData: true,\n\t\t\tcharacterDataOldValue: false,\n\t\t\tsubtree: true\n\t\t};\n\n\t\t/**\n\t\t * Object with already markuped problems.\n\t\t *\n\t\t * @type {Object}\n\t\t */\n\t\tthis.markupedProblems = {};\n\n\t\t/**\n\t\t * Timeout identifier.\n\t\t *\n\t\t * @type {Number}\n\t\t */\n\t\tthis.timeoutId = null;\n\t};\n\n\tContenteditableMirror.prototype = {\n\t\tconstructor: ContenteditableMirror,\n\t\t/**\n\t\t * Called after each registration in core.\n\t\t *\n\t\t * @memberof CORE.ContenteditableMirror#\n\t\t */\n\t\tinit: function() {\n\t\t\t// We do not need to initialize this module if:\n\t\t\t// - container is not model editor\n\t\t\t// - browsers do not support MutationObserver\n\t\t\tif ( !this.modelEditor || !this.sandbox.getOption('isMutationObserver') ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.createMirrorElement();\n\t\t\tthis.copyStyles();\n\t\t\tthis.handleScroll();\n\n\t\t\tthis.sandbox.setContainer(this.mirrorElement);\n\n\t\t\tthis.attachEvents();\n\n\t\t\tthis.sandbox.subscribe('periodicalChecking', function(data) {\n\t\t\t\tthis.copyStyles();\n\t\t\t}, this);\n\n\t\t\tthis.sandbox.subscribe('markupProblems', function(data) {\n\t\t\t\tthis.markupProblems(data);\n\t\t\t}, this);\n\n\t\t\tthis.sandbox.subscribe('replaceProblem', function(data) {\n\t\t\t\tthis.replaceProblem(data);\n\t\t\t}, this);\n\n\t\t\tthis.sandbox.subscribe('ignoreAllProblems', function(data) {\n\t\t\t\tthis.ignoreAllProblems(data);\n\t\t\t}, this);\n\n\t\t\tthis.sandbox.subscribe('removeMarkupFromProblems', function(data) {\n\t\t\t\tthis.removeMarkupFromProblems(data);\n\t\t\t}, this);\n\n\t\t\tthis.sandbox.subscribe('removeMarkupInContainer', function (data) {\n\t\t\t\tthis.removeAllMarkupedProblems();\n\t\t\t}, this);\n\n\t\t\tthis.sandbox.subscribe('toggleApp', function (data) {\n\t\t\t\tif (data.flag) {\n\t\t\t\t\tthis.attachEvents();\n\t\t\t\t\tthis.startMutationObserver();\n\t\t\t\t} else {\n\t\t\t\t\tthis.detachEvents();\n\t\t\t\t\tthis.stopMutationObserver();\n\t\t\t\t\tthis.removeAllMarkupedProblems();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.mutationObserver = new window.MutationObserver( this.handleMutations.bind(this) );\n\t\t\tthis.startMutationObserver();\n\t\t},\n\t\t/**\n\t\t * Create mirror div element for contenteditable element.\n\t\t *\n\t\t * @memberof CORE.ContenteditableMirror#\n\t\t */\n\t\tcreateMirrorElement: function () {\n\t\t\tvar element = null,\n\t\t\t\telementProblemBox = null;\n\n\t\t\telement = UILib.create('<div>')[0];\n\t\t\telement.style.position = 'absolute';\n\t\t\telement.style.overflow = 'hidden';\n\t\t\telement.style.borderColor = 'transparent';\n\t\t\telement.style.color = 'transparent';\n\t\t\telement.style.zIndex = '0';\n\t\t\telement.style.pointerEvents = 'none';\n\t\t\tUILib.addClass(element, 'wsc-contenteditable-mirror');\n\n\t\t\telementProblemBox = UILib.create('<div>')[0];\n\t\t\telementProblemBox.style.position = 'relative';\n\t\t\telementProblemBox.style.margin = '0';\n\t\t\telementProblemBox.style.padding = '0';\n\t\t\telementProblemBox.style.minWidth = '100%';\n\t\t\telementProblemBox.style.minHeight = '100%';\n\t\t\telementProblemBox.style.border = '0';\n\t\t\tUILib.appendTo(elementProblemBox, element);\n\n\t\t\tUILib.appendTo(element, 'body');\n\t\t\tUILib.attr(this.originalElement, 'spellcheck', false);\n\n\t\t\tthis.mirrorElement = element;\n\t\t\tthis.mirrorElementProblemBox = elementProblemBox;\n\t\t},\n\t\t/**\n\t\t * Copy styles from original element to mirror div element.\n\t\t *\n\t\t * @memberof CORE.ContenteditableMirror#\n\t\t * @param {Boolean} lockMutations - Flag for lock mutations listener\n\t\t */\n\t\tcopyStyles: function (lockMutations) {\n\t\t\tvar computed = Utils.getComputedStyle(this.originalElement),\n\t\t\t\tmaxZIndex = Utils.getMaxZIndex(this.originalElement),\n\t\t\t\tposition = this.getPosition(),\n\t\t\t\tmirrorElementTop = parseInt(this.mirrorElement.style['top']),\n\t\t\t\tmirrorElementLeft = parseInt(this.mirrorElement.style['left']),\n\t\t\t\tmirrorElementZIndex = parseInt(this.mirrorElement.style['zIndex']);\n\n\t\t\tthis.sandbox.fireInAllApps('lockMutationsListener', { lock: true });\n\n\t\t\tfor (var i = 0; i < this.properties.length; i++) {\n\t\t\t\tvar prop = this.properties[i],\n\t\t\t\t\tmirrorElementProp = this.mirrorElement.style[prop];\n\n\t\t\t\tif (mirrorElementProp !== computed[prop]) {\n\t\t\t\t\tthis.mirrorElement.style[prop] = computed[prop];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( mirrorElementLeft !== parseInt(position.left) ) {\n\t\t\t\tthis.mirrorElement.style['left'] = position.left + 'px';\n\t\t\t}\n\n\t\t\tif ( mirrorElementTop !== parseInt(position.top) ) {\n\t\t\t\tthis.mirrorElement.style['top'] = position.top + 'px';\n\t\t\t}\n\n\t\t\tif (mirrorElementZIndex !== maxZIndex) {\n\t\t\t\tthis.mirrorElement.style['zIndex'] = maxZIndex;\n\t\t\t}\n\n\t\t\tthis.sandbox.fireInAllApps('lockMutationsListener', { lock: false });\n\t\t},\n\t\t/**\n\t\t * Get position of the original container.\n\t\t *\n\t\t * @memberof CORE.ContenteditableMirror#\n\t\t * @returns {Object} - Object with coordinates\n\t\t */\n\t\tgetPosition: function () {\n\t\t\tvar position = { left: 0, top: 0 },\n\t\t\t\thtml = document.documentElement,\n\t\t\t\thtmlBox = html.getBoundingClientRect(),\n\t\t\t\tcontainerBox = this.originalElement.getBoundingClientRect();\n\n\t\t\tposition.left = containerBox.left - htmlBox.left + html.offsetLeft;\n\t\t\tposition.top = containerBox.top - htmlBox.top + html.offsetTop;\n\n\t\t\treturn position;\n\t\t},\n\t\t/**\n\t\t * Handler for scroll event in the original container.\n\t\t *\n\t\t * @memberof CORE.ContenteditableMirror#\n\t\t * @param {Object} event - HTML DOM Event\n\t\t */\n\t\thandleScroll: function(event) {\n\t\t\tvar originalElementScrollWidth = this.originalElement.scrollWidth + 'px',\n\t\t\t\toriginalElementScrollHeight = this.originalElement.scrollHeight + 'px',\n\t\t\t\tscrollWidth;\n\n\t\t\tif (this.mirrorElementProblemBox.style['width'] !== originalElementScrollWidth) {\n\t\t\t\tthis.mirrorElementProblemBox.style['width'] = originalElementScrollWidth;\n\t\t\t}\n\n\t\t\tif (this.mirrorElementProblemBox.style['height'] !== originalElementScrollHeight) {\n\t\t\t\tthis.mirrorElementProblemBox.style['height'] = originalElementScrollHeight;\n\t\t\t}\n\n\t\t\tthis.mirrorElement.scrollTop = this.originalElement.scrollTop;\n\t\t\tthis.mirrorElement.scrollLeft = this.originalElement.scrollLeft;\n\t\t},\n\t\t/**\n\t\t * Handler for keydown event in the original container.\n\t\t *\n\t\t * @memberof CORE.ContenteditableMirror#\n\t\t * @param {Object} event - HTML DOM Event\n\t\t */\n\t\thandleKeydown: function(event) {\n\t\t\tvar selection = window.getSelection(),\n\t\t\t\tshortcutKeys = [65, 67, 89, 90], // 'A' - select all, 'C' - copy, 'Y' - additional redo, 'Z' - undo/redo\n\t\t\t\textraKeys = [0, 8, 46, 59, 61, 173, 229], // IME bug on Android Chrome, 'Backspace', 'delete', ';' for Forefox, '=' for Firefox, '-' for Firefox, IME bug on Android Chrome\n\t\t\t\trange, rangeCoordinates, keyCode, shortcutAction, printableKey, left, right, bottom, leftProblemNodes, rightProblemNodes;\n\t\t\t\n\t\t\tif (!selection.rangeCount) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\trange = selection.getRangeAt(0);\n\t\t\trangeCoordinates = range.getBoundingClientRect();\n\n\t\t\t// For collapsed cursor Safari sets [0, 0, 0, 0] coordinates\n\t\t\t// but range.getClientRects()[0] returns correct coordinates\n\t\t\tif (rangeCoordinates.bottom - rangeCoordinates.top === 0) {\n\t\t\t\trangeCoordinates = range.getClientRects()[0];\n\t\t\t}\n\n\t\t\t// If cursor in the block element with just <br> inside (after enter key press)\n\t\t\t// range has wrong coordinates \n\t\t\tif (!rangeCoordinates) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tkeyCode = event.keyCode;\n\t\t\tshortcutAction = (event.ctrlKey || event.metaKey) && shortcutKeys.includes(keyCode);\n\t\t\tprintableKey = \n\t\t\t\t(keyCode > 47 && keyCode < 58) || // number keys\n\t\t\t\t(keyCode > 64 && keyCode < 91) || // letter keys\n\t\t\t\t(keyCode > 95 && keyCode < 112) || // numpad keys\n\t\t\t\t(keyCode > 185 && keyCode < 193) || // ;=,-./` keys\n\t\t\t\t(keyCode > 218 && keyCode < 223) ||   // [\\]' keys\n\t\t\t\t( extraKeys.includes(keyCode) ); // extra keys and some keys for Firefox\n\n\t\t\tif (shortcutAction || !printableKey) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.mirrorElement.style.pointerEvents = 'auto';\n\t\t\tleft = +rangeCoordinates.left.toFixed(1);\n\t\t\tright = +rangeCoordinates.right.toFixed(1);\n\t\t\tbottom = +rangeCoordinates.bottom.toFixed(1) - 1; // -1 for Firefox\n\t\t\tleftProblemNodes = this.sandbox.getProblemNodesFromPoint(left - 1, bottom);\n\t\t\trightProblemNodes = this.sandbox.getProblemNodesFromPoint(right + 1, bottom);\n\t\t\t\n\n\t\t\tfor (var i = 0; i < leftProblemNodes.length; i++) {\n\t\t\t\tleftProblemNodes[i].removeLater = true;\n\t\t\t}\n\n\t\t\tfor (var i = 0; i < rightProblemNodes.length; i++) {\n\t\t\t\trightProblemNodes[i].removeLater = true;\n\t\t\t}\n\t\t\t\n\t\t\tthis.mirrorElement.style.pointerEvents = 'none';\n\t\t},\n\t\t/**\n\t\t * Get problem types.\n\t\t *\n\t\t * @memberof CORE.ContenteditableMirror#\n\t\t * @returns {Object} - Object with problem types\n\t\t */\n\t\tgetProblemTypes: function() {\n\t\t\tif (!this.problemTypes) {\n\t\t\t\tthis.problemTypes = this.sandbox.getProblemTypes();\n\t\t\t}\n\t\t\t\n\t\t\treturn this.problemTypes;\n\t\t},\n\t\t/**\n\t\t * Create DOM elements for problems.\n\t\t *\n\t\t * @memberof CORE.ContenteditableMirror#\n\t\t * @param {Object} data - Data from event\n\t\t */\n\t\tmarkupProblems: function(data) {\n\t\t\tvar problemTypes = this.getProblemTypes(),\n\t\t\t\tcurrentDocument = Utils.getCurrentDocument( this.sandbox.getOption('documentContainer') ),\n\t\t\t\tmirrorElementProblemBox = this.mirrorElementProblemBox,\n\t\t\t\tmirrorElementProblemBoxCoordinates = mirrorElementProblemBox.getBoundingClientRect(),\n\t\t\t\tproblemPrefix = 'problem_',\n\t\t\t\tprefixedText, problemType, markupedProblem;\n\n\t\t\tif (!data.ranges.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.sandbox.fireInAllApps('lockMutationsListener', { lock: true });\n\n\t\t\tfor (var i = 0; i < data.ranges.length; i++) {\n\t\t\t\tvar item = data.ranges[i],\n\t\t\t\t\tproblemType = problemTypes[item.problemType],\n\t\t\t\t\tprefixedText = problemPrefix + item.text,\n\t\t\t\t\talreadyMarkuped = false,\n\t\t\t\t\trangeCoordinates, elements, sameTypes, sameStart, sameEnd;\n\n\t\t\t\tif (!problemType) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif ( this.markupedProblems.hasOwnProperty(prefixedText) ) {\n\t\t\t\t\tfor (var j = 0; j < this.markupedProblems[prefixedText].length; j++) {\n\t\t\t\t\t\tmarkupedProblem = this.markupedProblems[prefixedText][j];\n\t\t\t\t\t\tsameTypes = (item.problemType === markupedProblem.type);\n\t\t\t\t\t\tsameStart = (item.range.startContainer === markupedProblem.range.startContainer && item.range.startOffset === markupedProblem.range.startOffset);\n\t\t\t\t\t\tsameEnd = (item.range.endContainer === markupedProblem.range.endContainer && item.range.endOffset === markupedProblem.range.endOffset);\n\n\t\t\t\t\t\tif (sameTypes && sameStart && sameEnd) {\n\t\t\t\t\t\t\talreadyMarkuped = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (alreadyMarkuped) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\trangeCoordinates = this.getCoordinatesFromRange(item.range);\n\t\t\t\telements = this.createProblemElements({\n\t\t\t\t\tcoordinates: rangeCoordinates,\n\t\t\t\t\tproblemType: problemType,\n\t\t\t\t\ttext: item.text,\n\t\t\t\t\trule: item.rule || '',\n\t\t\t\t\tlang: data.lang,\n\t\t\t\t\trelatedCoordinates: mirrorElementProblemBoxCoordinates,\n\t\t\t\t\tdocument: currentDocument\n\t\t\t\t});\n\n\t\t\t\tif (!this.markupedProblems.hasOwnProperty(prefixedText)) {\n\t\t\t\t\tthis.markupedProblems[prefixedText] = [];\n\t\t\t\t}\n\n\t\t\t\tthis.markupedProblems[prefixedText].push({\n\t\t\t\t\ttext: item.text,\n\t\t\t\t\ttype: item.problemType,\n\t\t\t\t\trange: item.range,\n\t\t\t\t\tlang: data.lang,\n\t\t\t\t\trule: item.rule || '',\n\t\t\t\t\telements: elements\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.sandbox.fireInAllApps('lockMutationsListener', { lock: false });\n\t\t},\n\t\t/**\n\t\t * Get coordinates from range.\n\t\t *\n\t\t * @memberof CORE.ContenteditableMirror#\n\t\t * @param {Object} range - Range instance\n\t\t * @returns {Array} - Array with coordinates\n\t\t */\n\t\tgetCoordinatesFromRange: function(range) {\n\t\t\tvar coordinates = range.getClientRects(),\n\t\t\t\tresult = [],\n\t\t\t\tsetStart = function(coordinates) {\n\t\t\t\t\tstart = {\n\t\t\t\t\t\ttop: coordinates.top,\n\t\t\t\t\t\tright: coordinates.right,\n\t\t\t\t\t\tbottom: coordinates.bottom,\n\t\t\t\t\t\tleft: coordinates.left\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tstart;\n\n\t\t\tif (!coordinates.length) {\n\t\t\t\treturn [range.getBoundingClientRect()];\n\t\t\t}\n\n\t\t\tif (coordinates.length === 1) {\n\t\t\t\treturn [coordinates[0]];\n\t\t\t}\n\n\t\t\tsetStart(coordinates[0]);\n\n\t\t\tfor (var i = 1; i < coordinates.length; i++) {\n\t\t\t\tif (coordinates[i].left >= start.left) {\n\t\t\t\t\tstart.top = Math.min(start.top, coordinates[i].top);\n\t\t\t\t\tstart.bottom = Math.max(start.bottom, coordinates[i].bottom);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tresult.push({\n\t\t\t\t\ttop: start.top,\n\t\t\t\t\tright: coordinates[i - 1].right,\n\t\t\t\t\tbottom: start.bottom,\n\t\t\t\t\tleft: start.left\n\t\t\t\t});\n\n\t\t\t\tsetStart(coordinates[i]);\n\t\t\t}\n\n\t\t\tresult.push({\n\t\t\t\ttop: start.top,\n\t\t\t\tright: coordinates[i - 1].right,\n\t\t\t\tbottom: start.bottom,\n\t\t\t\tleft: start.left\n\t\t\t});\n\n\t\t\treturn result;\n\t\t},\n\t\t/**\n\t\t * Create problem elements.\n\t\t *\n\t\t * @memberof CORE.ContenteditableMirror#\n\t\t * @param {Object} data - Data for creating elements\n\t\t * @returns {Array} - Array with elements\n\t\t */\n\t\tcreateProblemElements: function(data) {\n\t\t\tvar elements = [],\n\t\t\t\telement, coordinates;\n\n\t\t\tfor (var i = 0; i < data.coordinates.length; i++) {\n\t\t\t\telement = data.document.createElement(this.sandbox.getOption(data.problemType.nodeName));\n\t\t\t\tcoordinates = data.coordinates[i];\n\t\t\t\tUILib.addClass(element, this.sandbox.getOption(data.problemType.classOption));\n\t\t\t\telement.setAttribute(this.sandbox.getOption(data.problemType.attrName), data.text);\n\t\t\t\telement.setAttribute(this.sandbox.getOption(data.problemType.attrLang), data.lang);\n\t\t\t\tdata.rule && element.setAttribute(this.sandbox.getOption(data.problemType.attrRuleName), data.rule);\n\t\t\t\telement.style.position = 'absolute';\n\t\t\t\telement.style.width = (coordinates.right - coordinates.left).toFixed(1) + 'px';\n\t\t\t\telement.style.height = (coordinates.bottom - coordinates.top).toFixed(1) + 'px';\n\t\t\t\telement.style.top = (coordinates.top - data.relatedCoordinates.top).toFixed(1) + 'px';\n\t\t\t\telement.style.left = (coordinates.left - data.relatedCoordinates.left).toFixed(1) + 'px';\n\t\t\t\tUILib.appendTo(element, this.mirrorElementProblemBox);\n\t\t\t\telements.push(element);\n\t\t\t}\n\n\t\t\treturn elements;\n\t\t},\n\t\t/**\n\t\t * Replace problem.\n\t\t *\n\t\t * @memberof CORE.ContenteditableMirror#\n\t\t * @param {Object} data - Data from event\n\t\t */\n\t\treplaceProblem: function(data) {\n\t\t\tvar problemTypes = this.getProblemTypes(),\n\t\t\t\tproblemType = problemTypes[data.problemType],\n\t\t\t\tnode = data[problemType.problemNodeName],\n\t\t\t\ttext = data[problemType.replaceField],\n\t\t\t\ttextNode = document.createTextNode(text),\n\t\t\t\tselection = window.getSelection(),\n\t\t\t\tmarkupedProblem = this.getMarkupedProblem(node, data.problemType),\n\t\t\t\tself = this,\n\t\t\t\trange, clonedRange;\n\n\t\t\tif (!markupedProblem) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\trange = markupedProblem.problem.range;\n\t\t\tclonedRange = range.cloneRange();\n\t\t\tclonedRange.collapse();\n\t\t\tselection.removeAllRanges();\n\t\t\tselection.addRange(clonedRange);\n\n\t\t\t// We need to work with replace functionality with timeout\n\t\t\t// because some editors listen selectionchange event which is async\n\t\t\tsetTimeout(function() {\n\t\t\t\trange.deleteContents();\n\t\t\t\trange.insertNode(textNode);\n\t\t\t\trange.selectNodeContents(textNode);\n\t\t\t\trange.collapse();\n\t\t\t\tselection.removeAllRanges();\n\t\t\t\tselection.addRange(range);\n\t\t\t\tself.removeMarkupedProblem({\n\t\t\t\t\tprefixedText: markupedProblem.prefixedText,\n\t\t\t\t\tindex: markupedProblem.index\n\t\t\t\t});\n\t\t\t}, 0);\n\t\t},\n\t\t/**\n\t\t * Ignore all problems.\n\t\t *\n\t\t * @memberof CORE.ContenteditableMirror#\n\t\t * @param {Object} data - Data from event\n\t\t */\n\t\tignoreAllProblems: function(data) {\n\t\t\tvar problemTypes = this.getProblemTypes(),\n\t\t\t\tproblemType = problemTypes[data.problemType],\n\t\t\t\tnode = data[problemType.problemNodeName],\n\t\t\t\ttext = node.getAttribute( this.sandbox.getOption(problemType.attrName) ),\n\t\t\t\tprefixedText = 'problem_' + text;\n\n\t\t\tif (this.markupedProblems.hasOwnProperty(prefixedText)) {\n\t\t\t\tfor (var i = this.markupedProblems[prefixedText].length - 1; i >= 0; i--) {\n\t\t\t\t\tvar markupedProblem = this.markupedProblems[prefixedText][i];\n\n\t\t\t\t\tif (markupedProblem.type !== data.problemType) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.removeMarkupedProblem({\n\t\t\t\t\t\tprefixedText: prefixedText,\n\t\t\t\t\t\tindex: i\n\t\t\t\t\t});\n\t\t\t\t\tProblemTypesActions[data.problemType].setIgnoreStatus(node, this.sandbox);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Remove markup from problems.\n\t\t *\n\t\t * @memberof CORE.ContenteditableMirror#\n\t\t * @param {Object} data - Data from event\n\t\t */\n\t\tremoveMarkupFromProblems: function(data) {\n\t\t\tvar problemTypes = this.getProblemTypes(),\n\t\t\t\tproblemType = problemTypes[data.problemType],\n\t\t\t\ttextField = problemType.replaceField,\n\t\t\t\tproblemPrefix = 'problem_';\n\n\t\t\tif (!data.problems.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfor (var i = 0; i < data.problems.length; i++) {\n\t\t\t\tvar item = data.problems[i],\n\t\t\t\t\tprefixedText = problemPrefix + item[textField];\n\n\t\t\t\tif (this.markupedProblems.hasOwnProperty(prefixedText)) {\n\t\t\t\t\tfor (var j = this.markupedProblems[prefixedText].length - 1; j >= 0; j--) {\n\t\t\t\t\t\tvar markupedProblem = this.markupedProblems[prefixedText][j];\n\n\t\t\t\t\t\tif (markupedProblem.type !== data.problemType) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.removeMarkupedProblem({\n\t\t\t\t\t\t\tprefixedText: prefixedText,\n\t\t\t\t\t\t\tindex: j\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Handler for mutations event in the container.\n\t\t *\n\t\t * @memberof CORE.ContenteditableMirror#\n\t\t * @param {Object} event - HTML DOM Event\n\t\t */\n\t\thandleMutations: function(event) {\n\t\t\tvar self = this;\n\n\t\t\tthis.sandbox.addDeferredFunction('changeProblemsPosition', {\n\t\t\t\tsingle: true,\n\t\t\t\tdelay: 10,\n\t\t\t\tdeferredFunction: function () {\n\t\t\t\t\tself.changeProblemsPosition();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.sandbox.addDeferredFunction('startProblemsCheck', {\n\t\t\t\tsingle: true,\n\t\t\t\tdelay: 2000,\n\t\t\t\tdeferredFunction: function () {\n\t\t\t\t\tself.sandbox.fire('startProblemsCheck', {});\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Start mutation observer.\n\t\t *\n\t\t * @memberof CORE.ContenteditableMirror#\n\t\t */\n\t\tstartMutationObserver: function() {\n\t\t\tif (this.mutationObserver) {\n\t\t\t\tthis.mutationObserver.observe(this.originalElement, this.mutationOptions);\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Stop mutation observer.\n\t\t *\n\t\t * @memberof CORE.ContenteditableMirror#\n\t\t */\n\t\tstopMutationObserver: function() {\n\t\t\tif (this.mutationObserver) {\n\t\t\t\tthis.mutationObserver.disconnect();\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Change problems position.\n\t\t *\n\t\t * @memberof CORE.ContenteditableMirror#\n\t\t */\n\t\tchangeProblemsPosition: function() {\n\t\t\tvar problemTypes = this.getProblemTypes(),\n\t\t\t\tcurrentDocument = Utils.getCurrentDocument( this.sandbox.getOption('documentContainer') ),\n\t\t\t\tmirrorElementProblemBox = this.mirrorElementProblemBox,\n\t\t\t\tmirrorElementProblemBoxCoordinates = mirrorElementProblemBox.getBoundingClientRect(),\n\t\t\t\tmarkapedArray = [],\n\t\t\t\tmarkupedProblem, collapsed, differentText, removeLater, rangeCoordinates, problemType, rangeWidth, rangeHeight, rangeTop, rangeLeft;\n\n\t\t\tthis.sandbox.fireInAllApps('lockMutationsListener', { lock: true });\n\n\t\t\tfor (var item in this.markupedProblems) {\n\t\t\t\tif ( this.markupedProblems.hasOwnProperty(item) ) {\n\t\t\t\t\tfor (var i = this.markupedProblems[item].length - 1; i >= 0; i--) {\n\t\t\t\t\t\tmarkupedProblem = this.markupedProblems[item][i];\n\t\t\t\t\t\tcollapsed = markupedProblem.range.collapsed;\n\t\t\t\t\t\tdifferentText = markupedProblem.range.toString() !== markupedProblem.text;\n\t\t\t\t\t\tremoveLater = markupedProblem.elements[0].removeLater || markupedProblem.elements[markupedProblem.elements.length - 1].removeLater;\n\n\t\t\t\t\t\tif (collapsed || differentText || removeLater) {\n\t\t\t\t\t\t\tthis.removeMarkupedProblem({\n\t\t\t\t\t\t\t\tprefixedText: item,\n\t\t\t\t\t\t\t\tindex: i\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tmarkupedProblem.coordinates = this.getCoordinatesFromRange(markupedProblem.range);\n\t\t\t\t\t\tmarkapedArray.push(markupedProblem);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (var i = 0; i < markapedArray.length; i++) {\n\t\t\t\tmarkupedProblem = markapedArray[i];\n\t\t\t\trangeCoordinates = markupedProblem.coordinates;\n\t\t\t\tproblemType = problemTypes[markupedProblem.type];\n\n\t\t\t\tif (rangeCoordinates.length !== markupedProblem.elements.length) {\n\t\t\t\t\tmarkupedProblem.elements.forEach(function (element) {\n\t\t\t\t\t\telement.parentNode.removeChild(element);\n\t\t\t\t\t});\n\n\t\t\t\t\tmarkupedProblem.elements = this.createProblemElements({\n\t\t\t\t\t\tcoordinates: rangeCoordinates,\n\t\t\t\t\t\tproblemType: problemType,\n\t\t\t\t\t\ttext: markupedProblem.text,\n\t\t\t\t\t\trule: markupedProblem.rule || '',\n\t\t\t\t\t\tlang: markupedProblem.lang,\n\t\t\t\t\t\trelatedCoordinates: mirrorElementProblemBoxCoordinates,\n\t\t\t\t\t\tdocument: currentDocument\n\t\t\t\t\t});\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tfor (var j = 0; j < rangeCoordinates.length; j++) {\n\t\t\t\t\trangeWidth = (rangeCoordinates[j].right - rangeCoordinates[j].left).toFixed(1) + 'px';\n\t\t\t\t\trangeHeight = (rangeCoordinates[j].bottom - rangeCoordinates[j].top).toFixed(1) + 'px';\n\t\t\t\t\trangeTop = (rangeCoordinates[j].top - mirrorElementProblemBoxCoordinates.top).toFixed(1) + 'px';\n\t\t\t\t\trangeLeft = (rangeCoordinates[j].left - mirrorElementProblemBoxCoordinates.left).toFixed(1) + 'px';\n\n\t\t\t\t\tif (rangeWidth !== markupedProblem.elements[j].style.width) {\n\t\t\t\t\t\tmarkupedProblem.elements[j].style.width = rangeWidth;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rangeHeight !== markupedProblem.elements[j].style.height) {\n\t\t\t\t\t\tmarkupedProblem.elements[j].style.height = rangeHeight;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rangeTop !== markupedProblem.elements[j].style.top) {\n\t\t\t\t\t\tmarkupedProblem.elements[j].style.top = rangeTop;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rangeLeft !== markupedProblem.elements[j].style.left) {\n\t\t\t\t\t\tmarkupedProblem.elements[j].style.left = rangeLeft;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.sandbox.fireInAllApps('lockMutationsListener', { lock: false });\n\t\t},\n\t\t/**\n\t\t * Repaint mirror and all sub elements.\n\t\t *\n\t\t * @memberof CORE.ContenteditableMirror#\n\t\t * @param {Object|Undefined} data - Data from event\n\t\t */\n\t\trepaintMirrorLayout: function(data) {\n\t\t\tvar self = this,\n\t\t\t\tdelay = 0;\n\n\t\t\t// For 'orientationchange' event we need to change position after\n\t\t\t// browser reflow/repaint actions\n\t\t\tif (data && data.type === 'orientationchange') {\n\t\t\t\tdelay = 500;\n\t\t\t}\n\n\t\t\tthis.timeoutId = setTimeout(function () {\n\t\t\t\tself.copyStyles();\n\t\t\t\tself.handleScroll();\n\t\t\t\tself.changeProblemsPosition();\n\t\t\t}, delay);\n\t\t},\n\t\tgetMarkupedProblem: function(node, type) {\n\t\t\tvar problemTypes = this.getProblemTypes(),\n\t\t\t\tproblemPrefix = 'problem_',\n\t\t\t\ttext = node.getAttribute( this.sandbox.getOption(problemTypes[type].attrName) ),\n\t\t\t\tprefixedText = problemPrefix + text,\n\t\t\t\tresult = null,\n\t\t\t\tfounded = false,\n\t\t\t\tproblem, element;\n\n\t\t\tif ( !this.markupedProblems.hasOwnProperty(prefixedText) ) {\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tfor (var i = 0; i < this.markupedProblems[prefixedText].length; i++) {\n\t\t\t\tproblem = this.markupedProblems[prefixedText][i];\n\n\t\t\t\tfor (var j = 0; j < problem.elements.length; j++) {\n\t\t\t\t\telement = problem.elements[j];\n\n\t\t\t\t\tif (element === node) {\n\t\t\t\t\t\tresult = {\n\t\t\t\t\t\t\tproblem: problem,\n\t\t\t\t\t\t\tprefixedText: prefixedText,\n\t\t\t\t\t\t\tindex: i\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tfounded = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (founded) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\t\t/**\n\t\t * Remove markuped problem.\n\t\t *\n\t\t * @memberof CORE.ContenteditableMirror#\n\t\t * @param {Object} data - Data for removing problem\n\t\t */\n\t\tremoveMarkupedProblem: function(data) {\n\t\t\tvar prefixedText = data.prefixedText,\n\t\t\t\tindex = data.index,\n\t\t\t\tproblemsArray = this.markupedProblems[prefixedText],\n\t\t\t\tproblem = problemsArray[index],\n\t\t\t\telement;\n\n\t\t\tthis.sandbox.fireInAllApps('lockMutationsListener', { lock: true });\n\n\t\t\tfor (var i = 0; i < problem.elements.length; i++) {\n\t\t\t\telement = problem.elements[i];\n\t\t\t\telement.parentNode.removeChild(element);\n\t\t\t}\n\n\t\t\tproblemsArray.splice(index, 1);\n\t\t\t\n\t\t\tif (!problemsArray.length) {\n\t\t\t\tdelete this.markupedProblems[prefixedText];\n\t\t\t}\n\n\t\t\tthis.sandbox.fireInAllApps('lockMutationsListener', { lock: false });\n\t\t},\n\t\t/**\n\t\t * Remove all markuped problems.\n\t\t *\n\t\t * @memberof CORE.ContenteditableMirror#\n\t\t */\n\t\tremoveAllMarkupedProblems: function() {\n\t\t\tthis.mirrorElementProblemBox.innerHTML = '';\n\t\t\tthis.markupedProblems = {};\n\t\t\tthis.sandbox.fire('updateSentencesCache', {}); // Clear sentences cache\n\t\t},\n\t\t/**\n\t\t * Attach event handlers.\n\t\t *\n\t\t * @memberof CORE.ContenteditableMirror#\n\t\t */\n\t\tattachEvents: function() {\n\t\t\tif (this.sandbox.getOption('isTouchDevice')) {\n\t\t\t\tthis.sandbox.subscribe({\n\t\t\t\t\teventType: 'orientationchange',\n\t\t\t\t\telement: window,\n\t\t\t\t\thandler: this.repaintMirrorLayout\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.sandbox.subscribe({\n\t\t\t\t\teventType: 'resize',\n\t\t\t\t\telement: window,\n\t\t\t\t\thandler: this.repaintMirrorLayout\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'scroll',\n\t\t\t\telement: this.originalElement,\n\t\t\t\thandler: this.handleScroll\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe({\n\t\t\t\teventType: 'keydown',\n\t\t\t\telement: this.originalElement,\n\t\t\t\thandler: this.handleKeydown\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Detach event handlers.\n\t\t *\n\t\t * @memberof CORE.ContenteditableMirror#\n\t\t */\n\t\tdetachEvents: function() {\n\t\t\tif (this.sandbox.getOption('isTouchDevice')) {\n\t\t\t\tthis.sandbox.unsubscribe({\n\t\t\t\t\teventType: 'orientationchange',\n\t\t\t\t\telement: window,\n\t\t\t\t\thandler: this.repaintMirrorLayout\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.sandbox.unsubscribe({\n\t\t\t\t\teventType: 'resize',\n\t\t\t\t\telement: window,\n\t\t\t\t\thandler: this.repaintMirrorLayout\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.sandbox.unsubscribe({\n\t\t\t\teventType: 'scroll',\n\t\t\t\telement: this.originalElement,\n\t\t\t\thandler: this.handleScroll\n\t\t\t});\n\n\t\t\tthis.sandbox.unsubscribe({\n\t\t\t\teventType: 'keydown',\n\t\t\t\telement: this.originalElement,\n\t\t\t\thandler: this.handleKeydown\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * ContenteditableMirror destructor.\n\t\t *\n\t\t * @memberof CORE.ContenteditableMirror#\n\t\t */\n\t\tdestroy: function() {\n\t\t\tthis.stopMutationObserver();\n\t\t\tthis.mutationObserver = null;\n\t\t\tclearTimeout(this.timeoutId);\n\n\t\t\tif (this.mirrorElement) {\n\t\t\t\tthis.removeAllMarkupedProblems();\n\t\t\t\tUILib.remove(this.mirrorElement);\n\t\t\t\tthis.mirrorElement = null;\n\t\t\t\tthis.mirrorElementProblemBox = null;\n\t\t\t}\n\t\t}\n\t};\n\n\tvar ProblemTypesActions = {\n\t\tspelling: {\n\t\t\tsetIgnoreStatus: function(node, sandbox) {\n\t\t\t\tvar uid = sandbox.getOption('uid'),\n\t\t\t\t\tdictionary = WEBSPELLCHECKER.CORE.DictionaryManager.Dictionary,\n\t\t\t\t\tnodeInfo = sandbox.getNodeInfo(node),\n\t\t\t\t\tword = node.getAttribute( sandbox.getOption(nodeInfo.attrName) ),\n\t\t\t\t\tlang = node.getAttribute( sandbox.getOption(nodeInfo.attrLang) );\n\n\t\t\t\tif ( dictionary.getWord(word, lang) ) {\n\t\t\t\t\tdictionary.getWord(word, lang).setStatus(WEBSPELLCHECKER.CORE.DictionaryManager.wordStatus.userIgnore, uid);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tgrammar: {\n\t\t\tsetIgnoreStatus: function (node, sandbox) {\n\t\t\t\tvar uid = sandbox.getOption('uid'),\n\t\t\t\t\tdictionary = WEBSPELLCHECKER.CORE.GrammarDictionaryManager.Dictionary,\n\t\t\t\t\tnodeInfo = sandbox.getNodeInfo(node),\n\t\t\t\t\tphrase = node.getAttribute( sandbox.getOption(nodeInfo.attrName) ),\n\t\t\t\t\trule = node.getAttribute( sandbox.getOption(nodeInfo.attrRuleName) ),\n\t\t\t\t\tlang = node.getAttribute( sandbox.getOption(nodeInfo.attrLang) );\n\n\t\t\t\tif (dictionary.getPhrase(phrase, rule, lang)) {\n\t\t\t\t\tdictionary.setIgnoreInInstance(phrase, rule, uid);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\texports.ContenteditableMirror = ContenteditableMirror;\n\n}( WEBSPELLCHECKER.CORE ));\n// problemstokenizer.js\n/**\n * @fileoverview of CORE problems tokenizer module.\n */\n\n(function( exports ) {\n\t'use strict';\n\n\tvar UILib = exports.prototype.UILib,\n\t\tUtils = exports.prototype.Utils;\n\n\t/**\n\t* ProblemsTokenizer Module constructor.\n\t* @constructor\n\t* @alias CORE.ProblemsTokenizer\n\t* @param {String} moduleID\n\t* @param {CORE.Sandbox} sandbox\n\t*/\n\tvar ProblemsTokenizer = function(moduleID, sandbox) {\n\t\t/**\n\t\t * Module name.\n\t\t *\n\t\t * @type {String}\n\t\t */\n\t\tthis.name = moduleID;\n\n\t\t/**\n\t\t * Reference to ProblemsTokenizer module sandbox.\n\t\t *\n\t\t * @type {CORE.Sandbox}\n\t\t */\n\t\tthis.sandbox = sandbox;\n\t};\n\n\tProblemsTokenizer.prototype = {\n\t\t/**\n\t\t * Called after each registration in core.\n\t\t *\n\t\t * @memberof CORE.ProblemsTokenizer#\n\t\t */\n\t\tinit: function() {\n\t\t\t// We do not need to initialize this module if:\n\t\t\t// - browsers do not support MutationObserver\n\t\t\tif ( !this.sandbox.getOption('isMutationObserver') ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.sandbox.subscribe('startProblemsCheck', function(data) {\n\t\t\t\tthis.startProblemsCheck();\n\t\t\t});\n\n\t\t\tthis.sandbox.subscribe('problemsFound', function(data) {\n\t\t\t\tthis.processFoundedProblems(data);\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Start problems check functionality.\n\t\t * \n\t\t * @memberof CORE.ProblemsTokenizer#\n\t\t */\n\t\tstartProblemsCheck: function() {\n\t\t\tvar collections = this.prepareTokensCollectionsToGettingInfo( this.getTokensCollections() );\n\n\t\t\tthis.sandbox.fire('problemsCollected', {\n\t\t\t\twordsCollection: collections.wordsCollection,\n\t\t\t\tsentencesCollection: collections.sentencesCollection\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Process founded problems.\n\t\t * \n\t\t * @memberof CORE.ProblemsTokenizer#\n\t\t * @param {Object} data - Data from event\n\t\t */\n\t\tprocessFoundedProblems: function(data) {\n\t\t\tvar self = this,\n\t\t\t\tcurrentLang = this.sandbox.getOption('lang'),\n\t\t\t\tproblemType = data.problemType,\n\t\t\t\tproblemsInCurrentControl;\n\n\t\t\t// We do not need process problems for another language\n\t\t\tif (data.lang !== currentLang) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif ( ProblemTypesActions.hasOwnProperty(problemType) ) {\n\t\t\t\tproblemsInCurrentControl = ProblemTypesActions[problemType].filter(data.problems, this.sandbox);\n\n\t\t\t\tif (problemsInCurrentControl.length !== 0) {\n\t\t\t\t\taddDeferredFunction(ProblemTypesActions[problemType].deferredPrefix, problemType, problemsInCurrentControl);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction addDeferredFunction(name, problemType, problemsCollection) {\n\t\t\t\tself.sandbox.addDeferredFunction(name + data.lang, {\n\t\t\t\t\tdelay: 100,\n\t\t\t\t\tcollection: problemsCollection,\n\t\t\t\t\tdefferedFunctionArgs: [data.lang],\n\t\t\t\t\tpartialItemsCount: 50,\n\t\t\t\t\tdeferredFunction: function(problems, lang) {\n\t\t\t\t\t\tvar ranges;\n\n\t\t\t\t\t\tranges = self.findProblemsRangesForMarkup({ problems: problems, problemType: problemType });\n\t\t\t\t\t\tself.sandbox.fire('markupProblems', { ranges: ranges, lang: lang });\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\t\t},\n\t\t/**\n\t\t * Create string and text nodes model for problem check.\n\t\t * \n\t\t * @memberof CORE.ProblemsTokenizer#\n\t\t * @param {Node} rootNode - Node for collecting info\n\t\t * @param {Boolean} fullInfo - Flag for getting full info\n\t\t * @returns {Object} - Object with collected info\n\t\t */\n\t\tcollectInfoFromNode: function(rootNode, fullInfo) {\n\t\t\tvar queue = [{ el: rootNode, editable: rootNode.isContentEditable }],\n\t\t\t\tnode = queue.shift(),\n\t\t\t\tblockElementsRegex = this.sandbox.getRegExp('blockElementsRegex'),\n\t\t\t\tignoreElementsRegex = this.sandbox.getRegExp('ignoreElementsRegex'),\n\t\t\t\tinfo = {\n\t\t\t\t\tresultText: '',\n\t\t\t\t\tcustomModel: {}\n\t\t\t\t};\n\n\t\t\tfunction createPartInfo(node) {\n\t\t\t\tif (node.el.length) {\n\t\t\t\t\tif (fullInfo) {\n\t\t\t\t\t\tvar part = {\n\t\t\t\t\t\t\tnode: node.el,\n\t\t\t\t\t\t\tstart: info.resultText.length,\n\t\t\t\t\t\t\tend: info.resultText.length + node.el.nodeValue.length - 1\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tinfo.customModel[part.start] = part;\n\t\t\t\t\t\tinfo.customModel[part.end] = part;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node.editable === false && fullInfo) {\n\t\t\t\t\t\tinfo.resultText += node.el.nodeValue.replace(/./g, ' ');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tinfo.resultText += node.el.nodeValue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\twhile (node) {\n\t\t\t\tswitch (node.el.nodeType) {\n\t\t\t\t\tcase 3:\n\t\t\t\t\t\tcreatePartInfo(node);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\tif (!ignoreElementsRegex.match(node.el.nodeName)) {\n\t\t\t\t\t\t\tvar editable = node.el.isContentEditable;\n\n\t\t\t\t\t\t\tfor (var i = 0; i < node.el.childNodes.length; i++) {\n\t\t\t\t\t\t\t\tqueue.splice(i, 0, { el: node.el.childNodes[i], editable: editable });\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (blockElementsRegex.match(node.el.nodeName)) {\n\t\t\t\t\t\t\t\tqueue.splice(i, 0, { el: document.createTextNode('\\u2029'), editable: true }); // Add \\u2029 after block element\n\t\t\t\t\t\t\t\tqueue.splice(0, 0, { el: document.createTextNode('\\u2029'), editable: true }); // Add \\u2029 before block element\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tnode = queue.shift();\n\t\t\t}\n\n\t\t\treturn info;\n\t\t},\n\t\t/**\n\t\t * Returns arrays of words from string.\n\t\t * \n\t\t * @memberof CORE.ProblemsTokenizer#\n\t\t * @param {String} string - String for tokenization\n\t\t * @returns {Array} - Array with words\n\t\t */\n\t\ttokenizeWords: function(string) {\n\t\t\tvar wordBoundary = this.sandbox.getRegExp('wordBoundaryRegex'),\n\t\t\t\tnonWhiteSpaceExtended = this.sandbox.getRegExp('nonWhiteSpaceExtended'),\n\t\t\t\tspecialCharacters = this.sandbox.getRegExp('specialCharacters').set(),\n\t\t\t\tsituationalSeparators = this.sandbox.getRegExp('situationalSeparators').set(),\n\t\t\t\tminWordLength = this.sandbox.getOption('minWordLength'),\n\t\t\t\tprefix = 'word_',\n\t\t\t\taddToResult = function () {\n\t\t\t\t\tif (buffer && buffer.length >= minWordLength) {\n\t\t\t\t\t\tif (!result) {\n\t\t\t\t\t\t\tresult = {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!result[prefix + buffer]) {\n\t\t\t\t\t\t\tresult[prefix + buffer] = {\n\t\t\t\t\t\t\t\tword: buffer,\n\t\t\t\t\t\t\t\tpositions: []\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresult[prefix + buffer].positions.push({ start: startIndex, end: i - 1 });\n\t\t\t\t\t}\n\n\t\t\t\t\tstartIndex = -1;\n\t\t\t\t\tbuffer = '';\n\t\t\t\t},\n\t\t\t\ti = 0,\n\t\t\t\tstartIndex = -1,\n\t\t\t\tbuffer = '',\n\t\t\t\tresult,\n\t\t\t\tchar,\n\t\t\t\tnextChar,\n\t\t\t\tnextIndex;\n\n\t\t\twhile (i < string.length) {\n\t\t\t\tchar = string[i];\n\n\t\t\t\tif (specialCharacters.test(char)) {\n\t\t\t\t\ti++;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (situationalSeparators.test(char)) {\n\t\t\t\t\tif (startIndex !== -1) {\n\t\t\t\t\t\tnextIndex = i + 1;\n\t\t\t\t\t\tnextChar = string[nextIndex];\n\n\t\t\t\t\t\twhile (specialCharacters.test(nextChar)) {\n\t\t\t\t\t\t\tnextIndex += 1;\n\t\t\t\t\t\t\tnextChar = string[nextIndex];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!nextChar || situationalSeparators.test(nextChar) || wordBoundary.test(nextChar)) {\n\t\t\t\t\t\t\taddToResult();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbuffer += char;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\ti++;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (wordBoundary.test(char)) {\n\t\t\t\t\tif (startIndex !== -1) {\n\t\t\t\t\t\taddToResult();\n\t\t\t\t\t}\n\n\t\t\t\t\ti++;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (nonWhiteSpaceExtended.test(char)) {\n\t\t\t\t\tif (startIndex === -1) {\n\t\t\t\t\t\tstartIndex = i;\n\t\t\t\t\t}\n\n\t\t\t\t\tbuffer += char;\n\t\t\t\t\ti++;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\taddToResult();\n\n\t\t\treturn result;\n\t\t},\n\t\t/**\n\t\t * Returns arrays of sentences from string.\n\t\t * \n\t\t * @memberof CORE.ProblemsTokenizer#\n\t\t * @param {String} string - String for tokenization\n\t\t * @returns {Array} - Array with sentences\n\t\t */\n\t\ttokenizeSentences: function(string) {\n\t\t\tvar RegularsManager = this.sandbox.RegularsManager,\n\t\t\t\tspecialCharacters = this.sandbox.getRegExp('specialCharacters').set(),\n\t\t\t\tsentenceEndChars = RegularsManager.sentenceEndChars.composition(RegularsManager.wrap('\\\\u2029')).set(),\n\t\t\t\tspace = this.sandbox.getRegExp('space').set(),\n\t\t\t\tnonWhiteSpaceExtended = this.sandbox.getRegExp('nonWhiteSpaceExtended'),\n\t\t\t\tprefix = 'sentence_',\n\t\t\t\taddToResult = function (withEndChar) {\n\t\t\t\t\tif (buffer) {\n\t\t\t\t\t\tvar sentence = withEndChar ? buffer + char : buffer;\n\n\t\t\t\t\t\tif (!result) {\n\t\t\t\t\t\t\tresult = {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!result[prefix + sentence]) {\n\t\t\t\t\t\t\tresult[prefix + sentence] = {\n\t\t\t\t\t\t\t\tsentence: sentence,\n\t\t\t\t\t\t\t\tpositions: []\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresult[prefix + sentence].positions.push({ start: startIndex, end: withEndChar ? i : i - 1 });\n\t\t\t\t\t}\n\n\t\t\t\t\tstartIndex = -1;\n\t\t\t\t\tbuffer = '';\n\t\t\t\t},\n\t\t\t\taddToBuffer = function () {\n\t\t\t\t\tif (char.charCodeAt(0) === 160) {\n\t\t\t\t\t\tbuffer += ' ';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbuffer += char;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tresult = [],\n\t\t\t\ti = 0,\n\t\t\t\tstartIndex = -1,\n\t\t\t\tbuffer = '',\n\t\t\t\tchar,\n\t\t\t\tprevChar,\n\t\t\t\tprevIndex,\n\t\t\t\tnextChar,\n\t\t\t\tnextIndex;\n\n\t\t\twhile (i < string.length) {\n\t\t\t\tchar = string[i];\n\n\t\t\t\tif (specialCharacters.test(char)) {\n\t\t\t\t\ti++;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (sentenceEndChars.test(char)) {\n\t\t\t\t\tif (startIndex !== -1) {\n\t\t\t\t\t\t// If char is '\\u2029' we have found sentence\n\t\t\t\t\t\tif (char.charCodeAt(0) === 8233) {\n\t\t\t\t\t\t\taddToResult();\n\t\t\t\t\t\t\ti++;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// If char is '.' we need to check previous symbols on abbreviation\n\t\t\t\t\t\tif (char.charCodeAt(0) === 46) {\n\t\t\t\t\t\t\tprevIndex = i - 1;\n\t\t\t\t\t\t\tprevChar = string[prevIndex];\n\n\t\t\t\t\t\t\t// Skip next special characters\n\t\t\t\t\t\t\twhile (specialCharacters.test(prevChar)) {\n\t\t\t\t\t\t\t\tprevIndex -= 1;\n\t\t\t\t\t\t\t\tprevChar = string[prevIndex];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (prevChar && Utils.isUppercaseLetter(prevChar)) {\n\t\t\t\t\t\t\t\taddToBuffer();\n\t\t\t\t\t\t\t\ti++;\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Check symbols after sentence end char\n\t\t\t\t\t\t// We need some of the space symbols\n\t\t\t\t\t\tnextIndex = i + 1;\n\t\t\t\t\t\tnextChar = string[nextIndex];\n\n\t\t\t\t\t\t// Skip next special characters\n\t\t\t\t\t\twhile (specialCharacters.test(nextChar)) {\n\t\t\t\t\t\t\tnextIndex += 1;\n\t\t\t\t\t\t\tnextChar = string[nextIndex];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!nextChar) {\n\t\t\t\t\t\t\taddToResult(true);\n\t\t\t\t\t\t\ti++;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!space.test(nextChar)) {\n\t\t\t\t\t\t\taddToBuffer();\n\t\t\t\t\t\t\ti++;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Check symbols after space\n\t\t\t\t\t\t// We need capital letter\n\t\t\t\t\t\tnextIndex += 1;\n\t\t\t\t\t\tnextChar = string[nextIndex];\n\n\t\t\t\t\t\t// Skip next spaces and special characters\n\t\t\t\t\t\twhile (space.test(nextChar) || specialCharacters.test(nextChar)) {\n\t\t\t\t\t\t\t// Space regex contain one of our sentence end char ('\\u2029')\n\t\t\t\t\t\t\t// We do not need to skip it\n\t\t\t\t\t\t\tif (nextChar.charCodeAt(0) === 8233) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tnextIndex += 1;\n\t\t\t\t\t\t\tnextChar = string[nextIndex];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!nextChar || Utils.isUppercaseLetter(nextChar) || nextChar.charCodeAt(0) === 8233) {\n\t\t\t\t\t\t\taddToResult(true);\n\t\t\t\t\t\t\ti = nextIndex;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\taddToBuffer();\n\t\t\t\t\t\t\ti++;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\ti++;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (space.test(char) && startIndex === -1) {\n\t\t\t\t\ti++;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (nonWhiteSpaceExtended.test(char)) {\n\t\t\t\t\tif (startIndex === -1) {\n\t\t\t\t\t\tstartIndex = i;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\taddToBuffer();\n\t\t\t\ti++;\n\t\t\t}\n\n\t\t\taddToResult();\n\n\t\t\treturn result;\n\t\t},\n\t\t/**\n\t\t * Get text node by index.\n\t\t * \n\t\t * @memberof CORE.ProblemsTokenizer#\n\t\t * @param {Object} textNodes - Object with text node indexes\n\t\t * @param {Number} index - Index for searching\n\t\t * @returns {Object} - Object with founded text node\n\t\t */\n\t\tgetTextNodeByIndex: function(textNodes, index) {\n\t\t\twhile (!textNodes[index]) {\n\t\t\t\tindex--;\n\t\t\t}\n\n\t\t\treturn textNodes[index];\n\t\t},\n\t\t/**\n\t\t * Returns object with words and sentences.\n\t\t * \n\t\t * @memberof CORE.ProblemsTokenizer#\n\t\t * @param {String} string - String for tokenization\n\t\t * @returns {Array} - Array with sentences\n\t\t */\n\t\tgetTokensCollections: function() {\n\t\t\tvar enableGrammar = this.sandbox.getOption('enableGrammar'),\n\t\t\t\tcontainer = this.sandbox.getOption('originalContainer'),\n\t\t\t\tcollections = {},\n\t\t\t\tinfo, words, sentences;\n\n\t\t\tinfo = this.collectInfoFromNode(container);\n\t\t\twords = this.tokenizeWords(info.resultText);\n\n\t\t\tif (enableGrammar) {\n\t\t\t\tsentences = this.tokenizeSentences(info.resultText);\n\t\t\t}\n\n\t\t\tif (words) {\n\t\t\t\tcollections.words = words;\n\t\t\t}\n\n\t\t\tif (sentences) {\n\t\t\t\tcollections.sentences = sentences;\n\t\t\t}\n\n\t\t\treturn collections;\n\t\t},\n\t\t/**\n\t\t * Returns object with prepared to getting info words and sentences.\n\t\t * \n\t\t * @memberof CORE.ProblemsTokenizer#\n\t\t * @param {Object} collections - Object with tokens collections\n\t\t * @returns {Object} - Object with prepared to getting info tokens collections\n\t\t */\n\t\tprepareTokensCollectionsToGettingInfo: function(collections) {\n\t\t\tvar lang = this.sandbox.getOption('lang'),\n\t\t\t\tsentencePrefix = 'sentence_',\n\t\t\t\tresult = {\n\t\t\t\t\twordsCollection: {\n\t\t\t\t\t\tdetectedLanguages: {}\n\t\t\t\t\t},\n\t\t\t\t\tsentencesCollection: []\n\t\t\t\t};\n\n\t\t\tif (collections.words) {\n\t\t\t\tfor (var item in collections.words) {\n\t\t\t\t\tif ( collections.words.hasOwnProperty(item) ) {\n\t\t\t\t\t\tif (!result.wordsCollection.words) {\n\t\t\t\t\t\t\tresult.wordsCollection.words = {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresult.wordsCollection.words[item] = {\n\t\t\t\t\t\t\tword: collections.words[item].word\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tresult.wordsCollection.detectedLanguages[lang] = 1;\n\t\t\t}\n\n\t\t\tif (collections.sentences) {\n\t\t\t\tfor (var item in collections.sentences) {\n\t\t\t\t\tif ( collections.sentences.hasOwnProperty(item) ) {\n\t\t\t\t\t\tresult.sentencesCollection.push({\n\t\t\t\t\t\t\tsentence: collections.sentences[item].sentence,\n\t\t\t\t\t\t\tmarkuped: false\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\t\tfindProblemsRangesForMarkup: function(data) {\n\t\t\tvar container = this.sandbox.getOption('originalContainer'),\n\t\t\t\tinfo = this.collectInfoFromNode(container, true),\n\t\t\t\tproblemType = data.problemType,\n\t\t\t\tranges = [],\n\t\t\t\ttokensInContainer, prefixedProblem, processedProblem, position, range, startPos, endPos;\n\n\t\t\tif ( ProblemTypesActions.hasOwnProperty(problemType) ) {\n\t\t\t\ttokensInContainer = this[ProblemTypesActions[problemType].tokenizer](info.resultText);\n\n\t\t\t\tfor (var i = 0; i < data.problems.length; i++) {\n\t\t\t\t\tprefixedProblem = ProblemTypesActions[problemType].problemName + '_' + data.problems[i][ProblemTypesActions[problemType].problemName];\n\n\t\t\t\t\tif (tokensInContainer.hasOwnProperty(prefixedProblem)) {\n\t\t\t\t\t\tprocessedProblem = ProblemTypesActions[problemType].processProblem( tokensInContainer[prefixedProblem], data.problems[i] );\n\n\t\t\t\t\t\tfor (var j = 0; j < processedProblem.positions.length; j++) {\n\t\t\t\t\t\t\tposition = processedProblem.positions[j];\n\t\t\t\t\t\t\trange = document.createRange();\n\t\t\t\t\t\t\tstartPos = this.getTextNodeByIndex(info.customModel, position.start);\n\t\t\t\t\t\t\tendPos = this.getTextNodeByIndex(info.customModel, position.end);\n\t\t\t\t\t\t\trange.setStart(startPos.node, position.start - startPos.start);\n\t\t\t\t\t\t\trange.setEnd(endPos.node, position.end - endPos.start + 1);\n\t\t\t\t\t\t\tranges.push({\n\t\t\t\t\t\t\t\trange: range,\n\t\t\t\t\t\t\t\tproblemType: problemType,\n\t\t\t\t\t\t\t\ttext: processedProblem.text || position.text,\n\t\t\t\t\t\t\t\trule: position.rule || ''\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn ranges;\n\t\t}\n\t};\n\n\tvar ProblemTypesActions = {\n\t\tspelling: {\n\t\t\tproblemName: 'word',\n\t\t\tdeferredPrefix: 'findWordRangesForMarkupForLang_',\n\t\t\ttokenizer: 'tokenizeWords',\n\t\t\tfilter: function(problems, sandbox) {\n\t\t\t\tvar result = [],\n\t\t\t\t\tuid = sandbox.getOption('uid');\n\n\t\t\t\tfor (var i = 0; i < problems.length; i++) {\n\t\t\t\t\t// Check if words is in current instance\n\t\t\t\t\tif (problems[i].existsInInstance(uid) && (problems[i].getStatus(uid) === 1)) {\n\t\t\t\t\t\tresult.push(problems[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\t\t\tprocessProblem(problemInContainer, problemFromEvent) {\n\t\t\t\treturn {\n\t\t\t\t\ttext: problemInContainer.word,\n\t\t\t\t\tpositions: problemInContainer.positions\n\t\t\t\t};\n\t\t\t}\n\t\t},\n\t\tgrammar: {\n\t\t\tproblemName: 'sentence',\n\t\t\tdeferredPrefix: 'findGrammarProblemRangesForMarkupForLang_',\n\t\t\ttokenizer: 'tokenizeSentences',\n\t\t\tfilter: function(problems, sandbox) {\n\t\t\t\tvar result = [],\n\t\t\t\t\tuid = sandbox.getOption('uid'),\n\t\t\t\t\tdictionary = WEBSPELLCHECKER.CORE.GrammarDictionaryManager.Dictionary;\n\n\t\t\t\tfor (var i = 0; i < problems.length; i++) {\n\t\t\t\t\tvar item = problems[i],\n\t\t\t\t\t\tphrases = [];\n\n\t\t\t\t\tfor (var j = 0; j < item.phrases.length; j++) {\n\t\t\t\t\t\tvar match = item.phrases[j];\n\n\t\t\t\t\t\tif (!dictionary.isIgnoreInInstance(match.phrase, match.rule.id, uid)) {\n\t\t\t\t\t\t\tphrases.push(match);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (phrases.length) {\n\t\t\t\t\t\tresult.push({\n\t\t\t\t\t\t\tsentence: item.sentence,\n\t\t\t\t\t\t\tphrases: phrases\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\t\t\tprocessProblem(problemInContainer, problemFromEvent) {\n\t\t\t\tvar problem = {\n\t\t\t\t\t\tpositions: []\n\t\t\t\t\t};\n\n\t\t\t\tfor (var i = 0; i < problemInContainer.positions.length; i++) {\n\t\t\t\t\tfor (var j = 0; j < problemFromEvent.phrases.length; j++) {\n\t\t\t\t\t\tproblem.positions.push({\n\t\t\t\t\t\t\tstart: problemInContainer.positions[i].start + problemFromEvent.phrases[j].offset,\n\t\t\t\t\t\t\tend: problemInContainer.positions[i].start + problemFromEvent.phrases[j].offset + problemFromEvent.phrases[j].length - 1,\n\t\t\t\t\t\t\ttext: problemFromEvent.phrases[j].phrase,\n\t\t\t\t\t\t\trule: problemFromEvent.phrases[j].rule.id\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn problem;\n\t\t\t}\n\t\t}\n\t};\n\n\texports.ProblemsTokenizer = ProblemsTokenizer;\n\n}( WEBSPELLCHECKER.CORE ));\n// garbagecollector.js\n/**\n * @fileoverview of CORE garbage collector.\n */\n\n(function( exports ) {\n\t'use strict';\n\n\tvar Utils = exports.prototype.Utils,\n\t\tUILib = exports.prototype.UILib;\n\n\t/**\n\t * Represents GarbageCollector Module.\n\t *\n\t * @constructor\n\t * @alias CORE.GarbageCollector\n\t * @param {String} moduleID\n\t * @param {CORE.Sandbox} sandbox\n\t */\n\tvar GarbageCollector = function(moduleID, sandbox) {\n\t\t/**\n\t\t * Module name.\n\t\t *\n\t\t * @type {String}\n\t\t*/\n\t\tthis.name = moduleID;\n\n\t\t/**\n\t\t * Reference to GarbageCollector module sandbox.\n\t\t *\n\t\t * @type {CORE.Sandbox}\n\t\t */\n\t\tthis.sandbox = sandbox;\n\n\t\t/**\n\t\t * Link on the container.\n\t\t *\n\t\t * @type {Node}\n\t\t */\n\t\tthis.container = this.sandbox.getOption('container');\n\n\t\t/**\n\t\t * Object with options, specifies which DOM mutations should be reported.\n\t\t *\n\t\t * @type {Object}\n\t\t */\n\t\tthis.mutationOptions = {\n\t\t\tattributes: false,\n\t\t\tattributeOldValue: false,\n\t\t\tchildList: true,\n\t\t\tcharacterData: true,\n\t\t\tcharacterDataOldValue: false,\n\t\t\tsubtree: true\n\t\t};\n\t};\n\n\tGarbageCollector.prototype = {\n\t\t/**\n\t\t * Called after each registration in core.\n\t\t *\n\t\t * @memberof CORE.GarbageCollector#\n\t\t */\n\t\tinit: function() {\n\t\t\tthis.sandbox.subscribe('fixBrokenNodes', function(data) {\n\t\t\t\tthis.fixBrokenNodes(data);\n\t\t\t}, this);\n\n\t\t\t// We do not need to initialize this module for:\n\t\t\t// - browsers which do not support MutationObserver\n\t\t\t// - mirror based original elements\n\t\t\t// - model editors\n\t\t\tif ( !('MutationObserver' in window) || this.sandbox.getOption('mirrorBasedInstance') || this.sandbox.getOption('isModelEditor') ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.mutationObserver = new window.MutationObserver( this.fixBrokenNodes.bind(this) );\n\t\t\tthis.startMutationObserver();\n\n\t\t\tthis.sandbox.subscribe('lockMutationsListener', function(data) {\n\t\t\t\tthis.lockMutationsListener(data);\n\t\t\t}, this);\n\n\n\t\t\tthis.fixBrokenNodes();\n\t\t},\n\t\t/**\n\t\t* Fix broken nodes after changes or after 'fixBrokenNodes' event.\n\t\t*\n\t\t* @memberof CORE.GarbageCollector#\n\t\t* @param {Object} data - Data from event\n\t\t*\n\t\t*/\n\t\tfixBrokenNodes: function(data) {\n\t\t\tvar self = this,\n\t\t\t\tgrammarAttrName = this.sandbox.getOption('problem_grammar_data_attribute');\n\n\t\t\tthis.sandbox.addDeferredFunction('collectBrokenNodesAfterChanges', {\n\t\t\t\tsingle: true,\n\t\t\t\tdelay: 1000,\n\t\t\t\tdeferredFunction: function() {\n\t\t\t\t\tvar brokenNodes = self.collectBrokenNodes(data);\n\n\t\t\t\t\tself.sandbox.fire('removeMarkup', {spelling: true, nodes : brokenNodes});\n\n\t\t\t\t\tUILib.each(brokenNodes, function (i, node) {\n\t\t\t\t\t\tif (node.isGrammarNode) {\n\t\t\t\t\t\t\tvar phrase = UILib.attr(node, grammarAttrName);\n\t\t\t\t\t\t\t// we need to remove from grammar cache sentence that contains phrase in order to make possible further markup\n\t\t\t\t\t\t\tself.sandbox.fire('updateSentencesCache', { phrase: phrase });\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tself.sandbox.fire('garbageCollected');\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t* Lock mutations listener.\n\t\t*\n\t\t* @memberof CORE.GarbageCollector#\n\t\t* @param {Object} data - Data from event\n\t\t*\n\t\t*/\n\t\tlockMutationsListener: function(data) {\n\t\t\tif (data.lock) {\n\t\t\t\tthis.stopMutationObserver();\n\t\t\t} else {\n\t\t\t\tthis.startMutationObserver();\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t* Start mutation observer.\n\t\t*\n\t\t* @memberof CORE.GarbageCollector#\n\t\t*\n\t\t*/\n\t\tstartMutationObserver: function() {\n\t\t\tif (this.mutationObserver) {\n\t\t\t\tthis.mutationObserver.observe(this.container, this.mutationOptions);\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t* Stop mutation observer.\n\t\t*\n\t\t* @memberof CORE.GarbageCollector#\n\t\t*\n\t\t*/\n\t\tstopMutationObserver: function() {\n\t\t\tif (this.mutationObserver) {\n\t\t\t\tthis.mutationObserver.disconnect();\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t* Collect all broken nodes\n\t\t*\n\t\t* @memberof CORE.GarbageCollector#\n\t\t* @param {Object} data - Data from event\n\t\t* @returns {Array} - Broken nodes collection\n\t\t*/\n\t\tcollectBrokenNodes: function(data) {\n\t\t\tvar queue = data && data.container ? [data.container] : [this.container],\n\t\t\t\tnode = queue.shift(),\n\t\t\t\tself = this,\n\t\t\t\tblockElementsRegex = this.sandbox.getRegExp('blockElementsRegex'),\n\t\t\t\tignoreElementsRegex = this.sandbox.getRegExp('ignoreElementsRegex'),\n\t\t\t\tpunctuationRegExp = this.sandbox.getRegExp('punctuationRegExp').set(),\n\t\t\t\tieSeparator = this.sandbox.getRegExp('ieSeparator'),\n\t\t\t\tbookmarkClassRegex = new RegExp(\"(^|\\\\s)rangySelectionBoundary(\\\\s|$)\"),\n\t\t\t\twordBoundaryRegex = this.sandbox.getRegExp('wordBoundaryRegexAndQuotes'),\n\t\t\t\tspaceRegex = this.sandbox.getRegExp('space'),\n\t\t\t\tdictionary = exports.DictionaryManager.Dictionary,\n\t\t\t\tsentencesDictionary = exports.GrammarDictionaryManager.Dictionary,\n\t\t\t\tlang = this.sandbox.getOption('lang'),\n\t\t\t\tlangAttribute = this.sandbox.getOption('data_lang_attribute'),\n\t\t\t\tnodesToCheck = [],\n\t\t\t\tnodesToRemove = [],\n\t\t\t\tresultText = '';\n\n\t\t\twhile (node) {\n\t\t\t\tswitch (node.nodeType) {\n\t\t\t\t\tcase 3 : // Node.TEXT_NODE || 3\n\t\t\t\t\t\tresultText += node.nodeValue;\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 1 : // Node.ELEMENT_NODE || 1\n\t\t\t\t\t\tvar nodeInfo = this.sandbox.getFullNodeInfo(node);\n\n\t\t\t\t\t\tif (nodeInfo && nodeInfo.broken) {\n\t\t\t\t\t\t\tnodesToRemove.push(node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!bookmarkClassRegex.test(UILib.attr(node, 'className')) && !ignoreElementsRegex.match(node.nodeName)) {\n\t\t\t\t\t\t\tif (nodeInfo && !nodeInfo.broken) {\n\t\t\t\t\t\t\t\tvar attrText = node.getAttribute(this.sandbox.getOption(nodeInfo.attrName) ),\n\t\t\t\t\t\t\t\t\trealText = node.textContent || node.innerText,\n\t\t\t\t\t\t\t\t\trealTextLength = realText.length,\n\t\t\t\t\t\t\t\t\truleName = nodeInfo.type === 'grammar' ? node.getAttribute(this.sandbox.getOption(nodeInfo.attrRuleName) ) : '',\n\t\t\t\t\t\t\t\t\tisDifferentLanguages,\n\t\t\t\t\t\t\t\t\tinDictionary,\n\t\t\t\t\t\t\t\t\titem;\n\n\t\t\t\t\t\t\t\trealText = this.sandbox.removeSpecialCharacters(realText);\n\t\t\t\t\t\t\t\trealText = ieSeparator.replace(realText, ' ');\n\n\t\t\t\t\t\t\t\tisDifferentLanguages = lang !== UILib.attr(node, langAttribute) ? true : false;\n\t\t\t\t\t\t\t\tinDictionary = nodeInfo.type === 'spelling' ? dictionary.getWord(realText, lang) : sentencesDictionary.getPhrase(realText, ruleName, lang);\n\t\t\t\t\t\t\t\tnode.isGrammarNode = nodeInfo.type === 'grammar' ? true : false;\n\n\t\t\t\t\t\t\t\titem = {\n\t\t\t\t\t\t\t\t\tnode: node,\n\t\t\t\t\t\t\t\t\tstart: resultText.length,\n\t\t\t\t\t\t\t\t\tend: resultText.length + (realTextLength - 1)\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (attrText !== realText || isDifferentLanguages || !inDictionary) {\n\t\t\t\t\t\t\t\t\tnodesToRemove.push(node);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tnodesToCheck.push(item);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Some editors like TinyMCE add style attribute for our nodes after drag and drop event\n\t\t\t\t\t\t\t\t// So we need to clear this attribute for expected view of our nodes\n\t\t\t\t\t\t\t\tnode.removeAttribute('style');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tfor (var i = 0; i < node.childNodes.length; i++) {\n\t\t\t\t\t\t\t\tqueue.splice(i, 0,node.childNodes[i]);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( blockElementsRegex.match(node.nodeName) ) {\n\t\t\t\t\t\t\t\tif (queue.length > node.childNodes.length) {\n\t\t\t\t\t\t\t\t\tqueue.splice(i, 0, document.createTextNode(' '));\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (resultText.length > 0 && resultText[resultText.length - 1] != ' ') {\n\t\t\t\t\t\t\t\t\tqueue.splice(0, 0, document.createTextNode(' '));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tnode = queue.shift();\n\t\t\t}\n\n\t\t\tfor (var i = 0; i < nodesToCheck.length; i++) {\n\t\t\t\tvar itemToCheck = nodesToCheck[i],\n\t\t\t\t\tfirstSymbol = resultText[itemToCheck.start],\n\t\t\t\t\tlastSymbol = resultText[itemToCheck.end],\n\t\t\t\t\tprevSymbol = resultText[itemToCheck.start - 1],\n\t\t\t\t\tnextSymbol = resultText[itemToCheck.end + 1];\n\n\t\t\t\t/*\n\t\t\t\t\tIf text in the start of sentence - '^Hhello^ man.'\n\t\t\t\t\tOr if text has space symbol in the start - 'Hello man^ .^'\n\t\t\t\t\tOr if previous symbol is word boundary - 'Hello ^maan^'\n\n\t\t\t\t\tAnd\n\n\t\t\t\t\tIf text in the end of sentence - 'Hello ^maan^'\n\t\t\t\t\tOr if text has space symbol in the end - 'Hello man ^, ^'\n\t\t\t\t\tOr if next symbol is word boundary - 'Hello ^maan^ '\n\t\t\t\t*/\n\t\t\t\tif ( (itemToCheck.start === 0 || spaceRegex.test(firstSymbol) || wordBoundaryRegex.test(prevSymbol))\n\t\t\t\t\t&& (itemToCheck.end === resultText.length - 1 || spaceRegex.test(lastSymbol) || wordBoundaryRegex.test(nextSymbol)) ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tnodesToRemove.push(itemToCheck.node);\n\t\t\t}\n\n\t\t\treturn nodesToRemove.reverse();\n\t\t},\n\t\t/**\n\t\t * Garbage collector destructor.\n\t\t *\n\t\t * @memberof CORE.GarbageCollector#\n\t\t */\n\t\tdestroy: function() {\n\t\t\tthis.stopMutationObserver();\n\t\t\tthis.mutationObserver = null;\n\t\t}\n\n\t};\n\n\texports.GarbageCollector = GarbageCollector;\n\n}( WEBSPELLCHECKER.CORE ));\n(function(){\n    window.SCAYT = WEBSPELLCHECKER.CORE;\n    var Utils = SCAYT.prototype.Utils;\n\n    function mapOptions(options, optionsMap) {\n        var newName;\n        options = Object.assign({}, options);\n\n        for(var k in options) {\n            newName = optionsMap[k];\n            if(newName) {\n                options[newName] = options[k];\n                delete options[k]\n            }\n        }\n\n        return options;\n    }\n\n    function createInst(options, optionsMap, initMethod, onSuccess, onError) {\n        options = mapOptions(options, optionsMap);\n        var inst = initMethod(options, onSuccess, onError);\n\n        return inst;\n    }\n    var editorsOptionsMap = {\n        customer_id: 'serviceId',\n        ignoreGraytElementsRegex: 'ignoreGrammarElements',\n        graytAutoStartup: 'enableGrammar',\n        charsToObserve: 'charsToObserve',\n        service_protocol: 'serviceProtocol',\n        service_host: 'serviceHost',\n        service_port: 'servicePort',\n        service_path: 'servicePath',\n        customDictionary: 'customDictionaryIds',\n        'ignore-words-with-mixed-cases': 'ignoreWordsWithMixedCases',\n        'ignore-all-caps-words': 'ignoreAllCapsWords',\n        'ignore-domain-names': 'ignoreDomainNames',\n        'ignore-words-with-numbers': 'ignoreWordsWithNumbers'\n    };\n    var createEditorIntegration = function(options, onSuccess, onError) {\n        var optionsMap = editorsOptionsMap,\n            eventMap = {\n                graytStateChanged: 'enableGrammarChanged'\n            },\n            optionValues,\n            oldOptions;\n\n        options.autoStartup = true;\n        options.units = ['spelling', 'grammar'];\n        if ( options['options-to-restore'] ) {\n            for(var i = 0; i < options['options-to-restore'].length; i += 1) {\n                optionValues = options['options-to-restore'][i];\n                if(optionsMap[optionValues]) {\n                    options['options-to-restore'][i] = optionsMap[optionValues];\n                }\n            }\n        }\n        // Create Instance.\n        var inst = createInst(options, optionsMap, WEBSPELLCHECKER._createApp, onSuccess, onError);\n        var _subscribe = inst.subscribe;\n\n        inst._getOption = inst.getOption;\n        inst.getOption = function(optionName) {\n            oldOptions = {\n                wordBoundaryRegex: inst._sandbox.getRegExp('wordBoundaryRegex')._getRegExp()\n            };\n            return (oldOptions[optionName]) ? oldOptions[optionName] : inst._getOption(optionName);\n        };\n\n        inst.subscribe = function(eventName) {\n            var args = [];\n            eventName = (eventMap[eventName]) ? eventMap[eventName] : eventName;\n            args[0] = eventName;\n            for(var i = 1; i < arguments.length; i +=1) {\n                args[i] = arguments[i];\n            }\n            _subscribe.apply(inst, args);\n        };\n\n        var _fire = inst.fire;\n        inst.fire = function(eventName, data) {\n            // Backword compatibility for old CKEditor plugin and new application\n            // https://webspellchecker.atlassian.net/browse/WP-1765\n            if (eventName === 'getGrammarSuggestionsList' && !data.rule) {\n                data.rule = inst.problemNodeFromSelection && inst.problemNodeFromSelection.getAttribute( inst.getGrammarNodeRuleAttributeName() );\n            }\n            _fire.apply(inst, arguments);\n        };\n\n        // Backword compatibility for old CKEditor plugin and new application\n\t\t// https://webspellchecker.atlassian.net/browse/WP-1765\n        var _getProblemDescriptionText = inst.getProblemDescriptionText;\n        inst.getProblemDescriptionText = function(grammarPhrase, rule, lang) {\n            if (arguments.length === 2) {\n                lang = rule;\n                rule = inst.problemNodeFromSelection && inst.problemNodeFromSelection.getAttribute( inst.getGrammarNodeRuleAttributeName() );\n            }\n            return _getProblemDescriptionText(grammarPhrase, rule, lang);\n        }\n\n        // Backword compatibility for old CKEditor plugin and new application\n\t\t// https://webspellchecker.atlassian.net/browse/WP-1765\n        var _getProblemNodeFromSelection = inst.getProblemNodeFromSelection;\n        inst.getProblemNodeFromSelection = function() {\n            inst.problemNodeFromSelection = _getProblemNodeFromSelection();\n\n            return inst.problemNodeFromSelection;\n        }\n\n        inst.isScaytNode = inst.isSpellingNode;\n        inst.getScaytNodeAttributeName = inst.getSpellingNodeAttributeName;\n        inst.getScaytLangList = inst.getSpellingLangList;\n        inst.getGraytNodeAttributeName = inst.getGrammarNodeAttributeName;\n        inst.getGraytNodeRuleAttributeName = inst.getGrammarNodeRuleAttributeName;\n        inst.getGraytLangList = inst.getGrammarLangList;\n        inst.getSelectionNode = inst.getProblemNodeFromSelection;\n        inst.isGraytNode = inst.isGrammarNode;\n        inst.isLicensed = function() {\n            return !inst.isBannerEnable();\n        };\n\n        var getApplicationConfig = inst.getApplicationConfig;\n        inst.getApplicationConfig = function() {\n            var config = getApplicationConfig.call(inst),\n                res = {},\n                mapValue;\n\n            for(var k in optionsMap) {\n                mapValue = optionsMap[k];\n                if(typeof config[mapValue] !== 'undefined') {\n                    res[k] = config[mapValue];\n                }\n            }\n\n            return res;\n        }\n\n        var commitOption = inst.commitOption;\n        inst.commitOption = function(options) {\n            var changedOptions = options.changedOptions;\n\n            changedOptions = mapOptions(changedOptions, optionsMap);\n            options.changedOptions = changedOptions;\n            commitOption(options);\n        }\n\n        if( inst._sandbox.getOption('basePath') ) {\n            SCAYT.CKSCAYT.prototype.basePath = inst._sandbox.getOption('basePath');\n        }\n\n        return inst;\n    };\n\n    var scaytOptionsMap = {\n        spellcheckLang: 'lang',\n        elementsToIgnore: 'ignoreElements',\n        contextMenuCommands: 'actionItems',\n        uiTabs: 'settingsSections',\n        enableGrayt: 'enableGrammar',\n        customerId: 'serviceId'\n    };\n\n    var basePaths = {\n        scayt: Utils.getBaseData('scayt.js').path,\n        customscayt: Utils.getBaseData('customscayt.js').path,\n        ckscayt: Utils.getBaseData('ckscayt.js').path,\n        tinymcescayt: Utils.getBaseData('tinymcescayt.js').path\n    }\n\n    function setServiceParameters(options) {\n        var scriptLocation;\n\n        function setIfEmpty(options, serviceParams) {\n            for (var k in serviceParams) {\n                if (typeof options[k] === 'undefined') {\n                    options[k] = serviceParams[k];\n                }\n            }\n        }\n\n        if(options.scayt_srcUrl) {\n            options.basePath = options.scayt_srcUrl.replace('ckscayt.js', '')\n            options.basePath = options.basePath.replace('tinymcescayt.js', '')\n        }\n        if (!options.basePath) {\n            for(var k in basePaths) {\n                options.basePath = Utils.getBaseData(k + '.js').path;\n                if(options.basePath) break;\n            }\n        }\n        if(!options.basePath) return;\n        scriptLocation = Utils.getLocationInfo(options.basePath);\n        setIfEmpty(options, {\n            serviceProtocol: scriptLocation.protocol,\n            serviceHost: scriptLocation.host,\n            servicePort: scriptLocation.port,\n            servicePath: scriptLocation.pathname + './../../../script/ssrv.cgi'\n        });\n\n        return options;\n    }\n\n    SCAYT.SCAYT = function(options, onSuccess, onError) {\n        options.basePath = basePaths.scayt\n        setServiceParameters(options);\n        if (options.contextMenuSections) {\n            options.contextMenuSections = options.contextMenuSections.replace(/*REG_REPLACE*//\\s/g, '');\n            options.contextMenuSections = options.contextMenuSections.split('|');\n        }\n        if (options.contextMenuCommands) {\n            options.contextMenuCommands = options.contextMenuCommands.replace(/*REG_REPLACE*//\\s/g, '');\n            options.contextMenuCommands = options.contextMenuCommands.replace(/*REG_REPLACE*//toggleproofrayt/g, 'toggle');\n            options.contextMenuCommands = options.contextMenuCommands.split('|');\n            if( options.contextMenuCommands.includes('problemdescription') === false ) {\n                options.disableProblemDescription = true;\n            }\n        }\n        options.enableBadgeButton = (typeof options.enableBadgeButton === \"undefined\") ? false : options.enableBadgeButton;\n        if (options.uiTabs) {\n            options.uiTabs = options.uiTabs.replace(/*REG_REPLACE*//\\s/g, '');\n            options.uiTabs = options.uiTabs.split(',');\n        }\n        if( Array.isArray(options.disableOptionsStorage) ) {\n            options.disableOptionsStorage = options.disableOptionsStorage.map( function(value) {\n                return editorsOptionsMap[value] || value;\n            })\n        }\n        var inst = createInst(options, scaytOptionsMap, WEBSPELLCHECKER.init, onSuccess, onError);\n        return inst;\n    };\n\n    SCAYT.SCAYT.createScaytControl = function(container, options, onSuccess, onError) {\n        options.container = container;\n        return new SCAYT.SCAYT(options, onSuccess, onError);\n    }\n\n\n    SCAYT.SCAYT.createScaytControlById = function(id, options, onSuccess, onError) {\n        options.container = id;\n        return new SCAYT.SCAYT(options, onSuccess, onError);\n    }\n\n    SCAYT.SCAYT.getScaytControlById = WEBSPELLCHECKER.getControlById;\n    SCAYT.prototype.instanceManager.getScaytControlById = SCAYT.prototype.instanceManager.getControlById;\n\n    SCAYT.CUSTOMSCAYT = function(options, onSuccess, onError) {\n        options = Object.assign({\n            units: ['spelling', 'grammar', 'ui']\n        }, options);\n        //Handle Froala case.\n        if(options.contextMenuSections === \"suggest|moresuggest\") {\n            options.actionItems = [];\n        }\n        options.enableBadgeButton = (typeof options.enableBadgeButton === \"undefined\") ? false : options.enableBadgeButton;\n\n        options.basePath = basePaths.customscayt\n        options.data_attribute_name = options.data_attribute_name || 'data-scayt-word';\n        options.problem_grammar_data_attribute = options.problem_grammar_data_attribute || 'data-grayt-phrase';\n        options.appType = 'scayt_froala'; // Hard fix for: https://webspellchecker.atlassian.net/browse/WP-1893\n        SCAYT.CUSTOMSCAYT.prototype.basePath = options.basePath;\n        setServiceParameters(options);\n\n        // Fix for: https://webspellchecker.atlassian.net/browse/WP-1898\n        if (options.contextMenuSections) {\n            options.contextMenuSections = options.contextMenuSections.replace(/*REG_REPLACE*//\\s/g, '');\n            options.contextMenuSections = options.contextMenuSections.split('|');\n        }\n\n        if (options.contextMenuCommands) {\n            options.contextMenuCommands = options.contextMenuCommands.replace(/*REG_REPLACE*//\\s/g, '');\n            options.contextMenuCommands = options.contextMenuCommands.split('|');\n        }\n        if( Array.isArray(options.disableOptionsStorage) ) {\n            options.disableOptionsStorage = options.disableOptionsStorage.map( function(value) {\n                return editorsOptionsMap[value] || value;\n            })\n        }\n\n        var inst = createInst(options, scaytOptionsMap, WEBSPELLCHECKER._createApp, onSuccess, onError);\n        return inst;\n    };\n\n    SCAYT.CKSCAYT = function(options, onSuccess, onError) {\n        options.basePath = basePaths.ckscayt;\n        options.appType = 'scayt_ckeditor'; // Hard fix for: https://webspellchecker.atlassian.net/browse/WP-1893\n        setServiceParameters(options);\n        SCAYT.CKSCAYT.prototype.basePath = options.basePath;\n        var ckInst = createEditorIntegration(options, onSuccess, onError);\n        var origGetLocal = ckInst.getLocal;\n        var localMap = {\n            label_allCaps: 'label_ignoreAllCapsWords',\n            label_mixedCase: 'label_ignoreWordsWithMixedCases',\n            label_mixedWithDigits: 'label_ignoreWordsWithNumbers'\n        }\n        ckInst.getLocal = function(itemName) {\n            itemName = localMap[itemName] || itemName;\n            var prefix ='oldck_';\n            var local = origGetLocal.call(ckInst, prefix + itemName);\n            if(local === prefix + itemName) {\n                local = origGetLocal.call(ckInst, itemName);\n            }\n            return local;\n        }\n        return ckInst;\n    };\n\n    SCAYT.CKSCAYT.prototype.basePath = basePaths.ckscayt;\n\n    SCAYT.TINYMCE = function(options, onSuccess, onError) {\n        options.basePath = basePaths.tinymcescayt;\n        options.appType = 'scayt_tinymce'; // Hard fix for: https://webspellchecker.atlassian.net/browse/WP-1893\n        setServiceParameters(options);\n        SCAYT.TINYMCE.prototype.basePath = options.basePath;\n        var inst = createEditorIntegration(options, onSuccess, onError);\n        inst.getLangList = inst.getSpellingLangList;\n        return inst;\n    };\n\n    function configBackward() {\n        if(typeof window.SCAYT_CONFIG === 'object') {\n            window.WEBSPELLCHECKER_CONFIG = window.WEBSPELLCHECKER_CONFIG || {};\n            var mappedName = ''\n\n            for(var k in window.SCAYT_CONFIG) {\n                mappedName = scaytOptionsMap[k] || k;\n                window.WEBSPELLCHECKER_CONFIG[mappedName] = window.SCAYT_CONFIG[k];\n            }\n        }\n    }\n\n    (function staticControlCreation() {\n        var optionAttrPrefix = 'data-scayt-',\n            replacePrefix = 'data-wsc-',\n            UILib = WEBSPELLCHECKER.CORE.prototype.UILib,\n            Utils = WEBSPELLCHECKER.CORE.prototype.Utils;\n\n        UILib.domReady(function() {\n            configBackward();\n            var options, node, attributes, attributeName, attributeValue, config,\n                editableContols = UILib.find('*[' + optionAttrPrefix + 'autocreate]');\n\n            options = setServiceParameters({ basePath: basePaths.scayt});\n            config = window.WEBSPELLCHECKER_CONFIG;\n\n            for (var i = 0; i < editableContols.length; i++ ) {\n                node = editableContols[i];\n                attributes = Utils.HTMLCollectionToArray(node.attributes);\n                for(var j = 0; j < attributes.length; j += 1) {\n                    attributeName = attributes[j].name;\n                    if( attributeName.includes(optionAttrPrefix) ) {\n                        attributeValue = node.getAttribute(attributeName);\n                        node.removeAttribute(attributeName);\n                        attributeName = attributeName.replace(optionAttrPrefix, replacePrefix);\n\n                        for (var m in scaytOptionsMap) {\n                            if ( attributeName.includes( m.toLowerCase() ) ) {\n                                attributeName = attributeName.replace(m.toLowerCase(), scaytOptionsMap[m]);\n                            }\n                        }\n\n                        node.setAttribute(attributeName, attributeValue || '');\n                    }\n                }\n\n                for (var k in options) {\n                    if (options.hasOwnProperty(k) && !node.getAttribute(replacePrefix + k) && !config[k]) {\n                        node.setAttribute(replacePrefix + k, options[k]);\n                    }\n                }\n            }\n        });\n    })();\n\n    if (window.scaytAlreadyLoaded) {\n        window.scaytAlreadyLoaded()\n    }\n\n    Utils.inArray = function( array, value ) {\n        for(var i=0; i<array.length; i++) {\n            if(array[i] === value) {\n                return true;\n            }\n        }\n\n        return false;\n    };\n\n    Utils.indexOf = function(array, searchElement /*, fromIndex */) {\n        var result,\n            args = Array.prototype.slice.apply(arguments);\n\n        args.shift();\n        if (Object.prototype.toString.call(array) === '[object Array]' && !Array.prototype.indexOf) {\n            result = indexOf.apply(array, args);\n        } else {\n            result = Array.prototype.indexOf.apply(array, args);\n        }\n\n        return result;\n\n        function indexOf(searchElement /*, fromIndex */) {\n            'use strict';\n\n            if (this == null) {\n                throw new TypeError();\n            }\n\n            var n, k, t = Object(this),\n                len = t.length >>> 0;\n\n            if (len === 0) {\n                return -1;\n            }\n\n            n = 0;\n            if (arguments.length > 1) {\n                n = Number(arguments[1]);\n                if (n != n) { // shortcut for verifying if it's NaN\n                    n = 0;\n                } else if (n != 0 && n != Infinity && n != -Infinity) {\n                    n = (n > 0 || -1) * Math.floor(Math.abs(n));\n                }\n            }\n\n            if (n >= len) {\n                return -1;\n            }\n\n            for (k = n >= 0 ? n : Math.max(len - Math.abs(n), 0); k < len; k++) {\n                if (k in t && t[k] === searchElement) {\n                    return k;\n                }\n            }\n\n            return -1;\n        }\n    };\n})()\nif(window.WEBSPELLCHECKER && typeof window.WEBSPELLCHECKER.onload == \"function\"){window.WEBSPELLCHECKER.onload(window.WEBSPELLCHECKER); } window.WEBSPELLCHECKER = WEBSPELLCHECKER;})(this);"]}